var minimal$1=Object.freeze({__proto__:null}),_stream_duplex=Object.freeze({__proto__:null}),_stream_readable=Object.freeze({__proto__:null}),commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function getAugmentedNamespace(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})})),t}function commonjsRequire(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var s$2=1e3,m=60*s$2,h=60*m,d=24*h,w=7*d,y=365.25*d,ms=function(e,t){t=t||{};var r=typeof e;if("string"===r&&e.length>0)return parse(e);if("number"===r&&isFinite(e))return t.long?fmtLong(e):fmtShort(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function parse(e){if(!((e=String(e)).length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var r=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return r*y;case"weeks":case"week":case"w":return r*w;case"days":case"day":case"d":return r*d;case"hours":case"hour":case"hrs":case"hr":case"h":return r*h;case"minutes":case"minute":case"mins":case"min":case"m":return r*m;case"seconds":case"second":case"secs":case"sec":case"s":return r*s$2;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}function fmtShort(e){var t=Math.abs(e);return t>=d?Math.round(e/d)+"d":t>=h?Math.round(e/h)+"h":t>=m?Math.round(e/m)+"m":t>=s$2?Math.round(e/s$2)+"s":e+"ms"}function fmtLong(e){var t=Math.abs(e);return t>=d?plural(e,t,d,"day"):t>=h?plural(e,t,h,"hour"):t>=m?plural(e,t,m,"minute"):t>=s$2?plural(e,t,s$2,"second"):e+" ms"}function plural(e,t,r,n){var i=t>=1.5*r;return Math.round(e/r)+" "+n+(i?"s":"")}function setup(e){function t(e){let n,i,s,o=null;function a(...e){if(!a.enabled)return;const r=a,i=Number(new Date),s=i-(n||i);r.diff=s,r.prev=n,r.curr=i,n=i,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let o=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((n,i)=>{if("%%"===n)return"%";o++;const s=t.formatters[i];if("function"==typeof s){const t=e[o];n=s.call(r,t),e.splice(o,1),o--}return n})),t.formatArgs.call(r,e);(r.log||t.log).apply(r,e)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=r,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==o?o:(i!==t.namespaces&&(i=t.namespaces,s=t.enabled(e)),s),set:e=>{o=e}}),"function"==typeof t.init&&t.init(a),a}function r(e,r){const n=t(this.namespace+(void 0===r?":":r)+e);return n.log=this.log,n}function n(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},t.disable=function(){const e=[...t.names.map(n),...t.skips.map(n).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let r;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const n=("string"==typeof e?e:"").split(/[\s,]+/),i=n.length;for(r=0;r<i;r++)n[r]&&("-"===(e=n[r].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let r,n;for(r=0,n=t.skips.length;r<n;r++)if(t.skips[r].test(e))return!1;for(r=0,n=t.names.length;r<n;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=ms,t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((r=>{t[r]=e[r]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let r=0;for(let t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return t.colors[Math.abs(r)%t.colors.length]},t.enable(t.load()),t}var common$9=setup,global$1=void 0!==global$1?global$1:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}var cachedSetTimeout=defaultSetTimout,cachedClearTimeout=defaultClearTimeout;function runTimeout(e){if(cachedSetTimeout===setTimeout)return setTimeout(e,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(e,0);try{return cachedSetTimeout(e,0)}catch(t){try{return cachedSetTimeout.call(null,e,0)}catch(t){return cachedSetTimeout.call(this,e,0)}}}function runClearTimeout(e){if(cachedClearTimeout===clearTimeout)return clearTimeout(e);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(e);try{return cachedClearTimeout(e)}catch(t){try{return cachedClearTimeout.call(null,e)}catch(t){return cachedClearTimeout.call(this,e)}}}"function"==typeof global$1.setTimeout&&(cachedSetTimeout=setTimeout),"function"==typeof global$1.clearTimeout&&(cachedClearTimeout=clearTimeout);var queue=[],draining=!1,currentQueue,queueIndex=-1;function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var e=runTimeout(cleanUpNextTick);draining=!0;for(var t=queue.length;t;){for(currentQueue=queue,queue=[];++queueIndex<t;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,t=queue.length}currentQueue=null,draining=!1,runClearTimeout(e)}}function nextTick(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];queue.push(new Item(e,t)),1!==queue.length||draining||runTimeout(drainQueue)}function Item(e,t){this.fun=e,this.array=t}Item.prototype.run=function(){this.fun.apply(null,this.array)};var title="browser",platform$1="browser",browser$9=!0,env$2={},argv=[],version$3="",versions={},release$1={},config$3={};function noop$5(){}var on$2=noop$5,addListener=noop$5,once$2=noop$5,off=noop$5,removeListener=noop$5,removeAllListeners=noop$5,emit=noop$5;function binding(e){throw new Error("process.binding is not supported")}function cwd(){return"/"}function chdir(e){throw new Error("process.chdir is not supported")}function umask(){return 0}var performance=global$1.performance||{},performanceNow=performance.now||performance.mozNow||performance.msNow||performance.oNow||performance.webkitNow||function(){return(new Date).getTime()};function hrtime(e){var t=.001*performanceNow.call(performance),r=Math.floor(t),n=Math.floor(t%1*1e9);return e&&(r-=e[0],(n-=e[1])<0&&(r--,n+=1e9)),[r,n]}var startTime=new Date;function uptime$1(){return(new Date-startTime)/1e3}var browser$1$1={nextTick:nextTick,title:title,browser:browser$9,env:env$2,argv:argv,version:version$3,versions:versions,on:on$2,addListener:addListener,once:once$2,off:off,removeListener:removeListener,removeAllListeners:removeAllListeners,emit:emit,binding:binding,cwd:cwd,chdir:chdir,umask:umask,hrtime:hrtime,platform:platform$1,release:release$1,config:config$3,uptime:uptime$1},process=browser$1$1;function useColors(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))}function formatArgs(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+module.exports.humanize(this.diff),!this.useColors)return;const t="color: "+this.color;e.splice(1,0,t,"color: inherit");let r=0,n=0;e[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(r++,"%c"===e&&(n=r))})),e.splice(n,0,t)}function save(e){try{e?exports.storage.setItem("debug",e):exports.storage.removeItem("debug")}catch(e){}}function load(){let e;try{e=exports.storage.getItem("debug")}catch(e){}return!e&&void 0!==process&&"env"in process&&(e=process.env.DEBUG),e}function localstorage(){try{return localStorage}catch(e){}}exports.formatArgs=formatArgs,exports.save=save,exports.load=load,exports.useColors=useColors,exports.storage=localstorage(),exports.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),exports.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],exports.log=console.debug||console.log||(()=>{}),module.exports=common$9(exports);const{formatters:formatters}=module.exports;formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}};var browser$8=Object.freeze({__proto__:null}),require$$0$b=getAugmentedNamespace(browser$8),domain$1;function EventHandlers(){}function EventEmitter$e(){EventEmitter$e.init.call(this)}function $getMaxListeners(e){return void 0===e._maxListeners?EventEmitter$e.defaultMaxListeners:e._maxListeners}function emitNone(e,t,r){if(t)e.call(r);else for(var n=e.length,i=arrayClone(e,n),s=0;s<n;++s)i[s].call(r)}function emitOne(e,t,r,n){if(t)e.call(r,n);else for(var i=e.length,s=arrayClone(e,i),o=0;o<i;++o)s[o].call(r,n)}function emitTwo(e,t,r,n,i){if(t)e.call(r,n,i);else for(var s=e.length,o=arrayClone(e,s),a=0;a<s;++a)o[a].call(r,n,i)}function emitThree(e,t,r,n,i,s){if(t)e.call(r,n,i,s);else for(var o=e.length,a=arrayClone(e,o),u=0;u<o;++u)a[u].call(r,n,i,s)}function emitMany(e,t,r,n){if(t)e.apply(r,n);else for(var i=e.length,s=arrayClone(e,i),o=0;o<i;++o)s[o].apply(r,n)}function _addListener(e,t,r,n){var i,s,o;if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');if((s=e._events)?(s.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),s=e._events),o=s[t]):(s=e._events=new EventHandlers,e._eventsCount=0),o){if("function"==typeof o?o=s[t]=n?[r,o]:[o,r]:n?o.unshift(r):o.push(r),!o.warned&&(i=$getMaxListeners(e))&&i>0&&o.length>i){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=e,a.type=t,a.count=o.length,emitWarning(a)}}else o=s[t]=r,++e._eventsCount;return e}function emitWarning(e){"function"==typeof console.warn?console.warn(e):console.log(e)}function _onceWrap(e,t,r){var n=!1;function i(){e.removeListener(t,i),n||(n=!0,r.apply(e,arguments))}return i.listener=r,i}function listenerCount(e){var t=this._events;if(t){var r=t[e];if("function"==typeof r)return 1;if(r)return r.length}return 0}function spliceOne(e,t){for(var r=t,n=r+1,i=e.length;n<i;r+=1,n+=1)e[r]=e[n];e.pop()}function arrayClone(e,t){for(var r=new Array(t);t--;)r[t]=e[t];return r}function unwrapListeners(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}EventHandlers.prototype=Object.create(null),EventEmitter$e.EventEmitter=EventEmitter$e,EventEmitter$e.usingDomains=!1,EventEmitter$e.prototype.domain=void 0,EventEmitter$e.prototype._events=void 0,EventEmitter$e.prototype._maxListeners=void 0,EventEmitter$e.defaultMaxListeners=10,EventEmitter$e.init=function(){this.domain=null,EventEmitter$e.usingDomains&&domain$1.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new EventHandlers,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},EventEmitter$e.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},EventEmitter$e.prototype.getMaxListeners=function(){return $getMaxListeners(this)},EventEmitter$e.prototype.emit=function(e){var t,r,n,i,s,o,a,u="error"===e;if(o=this._events)u=u&&null==o.error;else if(!u)return!1;if(a=this.domain,u){if(t=arguments[1],!a){if(t instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=a,t.domainThrown=!1,a.emit("error",t),!1}if(!(r=o[e]))return!1;var l="function"==typeof r;switch(n=arguments.length){case 1:emitNone(r,l,this);break;case 2:emitOne(r,l,this,arguments[1]);break;case 3:emitTwo(r,l,this,arguments[1],arguments[2]);break;case 4:emitThree(r,l,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(n-1),s=1;s<n;s++)i[s-1]=arguments[s];emitMany(r,l,this,i)}return!0},EventEmitter$e.prototype.addListener=function(e,t){return _addListener(this,e,t,!1)},EventEmitter$e.prototype.on=EventEmitter$e.prototype.addListener,EventEmitter$e.prototype.prependListener=function(e,t){return _addListener(this,e,t,!0)},EventEmitter$e.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,_onceWrap(this,e,t)),this},EventEmitter$e.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,_onceWrap(this,e,t)),this},EventEmitter$e.prototype.removeListener=function(e,t){var r,n,i,s,o;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(n=this._events))return this;if(!(r=n[e]))return this;if(r===t||r.listener&&r.listener===t)0==--this._eventsCount?this._events=new EventHandlers:(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,s=r.length;s-- >0;)if(r[s]===t||r[s].listener&&r[s].listener===t){o=r[s].listener,i=s;break}if(i<0)return this;if(1===r.length){if(r[0]=void 0,0==--this._eventsCount)return this._events=new EventHandlers,this;delete n[e]}else spliceOne(r,i);n.removeListener&&this.emit("removeListener",e,o||t)}return this},EventEmitter$e.prototype.off=function(e,t){return this.removeListener(e,t)},EventEmitter$e.prototype.removeAllListeners=function(e){var t,r;if(!(r=this._events))return this;if(!r.removeListener)return 0===arguments.length?(this._events=new EventHandlers,this._eventsCount=0):r[e]&&(0==--this._eventsCount?this._events=new EventHandlers:delete r[e]),this;if(0===arguments.length){for(var n,i=Object.keys(r),s=0;s<i.length;++s)"removeListener"!==(n=i[s])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=new EventHandlers,this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},EventEmitter$e.prototype.listeners=function(e){var t,r=this._events;return r&&(t=r[e])?"function"==typeof t?[t.listener||t]:unwrapListeners(t):[]},EventEmitter$e.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):listenerCount.call(e,t)},EventEmitter$e.prototype.listenerCount=listenerCount,EventEmitter$e.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var _polyfillNode_events=Object.freeze({__proto__:null,default:EventEmitter$e,EventEmitter:EventEmitter$e}),require$$1$9=getAugmentedNamespace(_polyfillNode_events);function assign$1(e,t){for(const r in t)Object.defineProperty(e,r,{value:t[r],enumerable:!0,configurable:!0});return e}function createError$1(e,t,r){if(!e||"string"==typeof e)throw new TypeError("Please pass an Error to err-code");r||(r={}),"object"==typeof t&&(r=t,t=""),t&&(r.code=t);try{return assign$1(e,r)}catch(t){r.message=e.message,r.stack=e.stack;const n=function(){};n.prototype=Object.create(Object.getPrototypeOf(e));return assign$1(new n,r)}}var errCode$m=createError$1,src$q={exports:{}},encode_1$1=encode$6,MSB$2=128,REST$2=127,MSBALL$1=~REST$2,INT$1=Math.pow(2,31);function encode$6(e,t,r){t=t||[];for(var n=r=r||0;e>=INT$1;)t[r++]=255&e|MSB$2,e/=128;for(;e&MSBALL$1;)t[r++]=255&e|MSB$2,e>>>=7;return t[r]=0|e,encode$6.bytes=r-n+1,t}var decode$9=read$2,MSB$1$1=128,REST$1$1=127;function read$2(e,t){var r,n=0,i=0,s=t=t||0,o=e.length;do{if(s>=o)throw read$2.bytes=0,new RangeError("Could not decode varint");r=e[s++],n+=i<28?(r&REST$1$1)<<i:(r&REST$1$1)*Math.pow(2,i),i+=7}while(r>=MSB$1$1);return read$2.bytes=s-t,n}var N1$1=Math.pow(2,7),N2$1=Math.pow(2,14),N3$1=Math.pow(2,21),N4$1=Math.pow(2,28),N5$1=Math.pow(2,35),N6$1=Math.pow(2,42),N7$1=Math.pow(2,49),N8$1=Math.pow(2,56),N9$1=Math.pow(2,63),length$2=function(e){return e<N1$1?1:e<N2$1?2:e<N3$1?3:e<N4$1?4:e<N5$1?5:e<N6$1?6:e<N7$1?7:e<N8$1?8:e<N9$1?9:10},varint$7={encode:encode_1$1,decode:decode$9,encodingLength:length$2},_brrp_varint=varint$7;const decode$8=e=>[_brrp_varint.decode(e),_brrp_varint.decode.bytes],encodeTo=(e,t,r=0)=>(_brrp_varint.encode(e,t,r),t),encodingLength=e=>_brrp_varint.encodingLength(e),equals$3=(e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0},coerce=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")},fromString$a=e=>(new TextEncoder).encode(e),toString$6=e=>(new TextDecoder).decode(e),create$8=(e,t)=>{const r=t.byteLength,n=encodingLength(e),i=n+encodingLength(r),s=new Uint8Array(i+r);return encodeTo(e,s,0),encodeTo(r,s,n),s.set(t,i),new Digest$1(e,r,t,s)},decode$7=e=>{const t=coerce(e),[r,n]=decode$8(t),[i,s]=decode$8(t.subarray(n)),o=t.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new Digest$1(r,i,o,t)},equals$2=(e,t)=>e===t||e.code===t.code&&e.size===t.size&&equals$3(e.bytes,t.bytes);class Digest$1{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}var digest=Object.freeze({__proto__:null,create:create$8,decode:decode$7,equals:equals$2,Digest:Digest$1});function base$2(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(255!==r[o])throw new TypeError(s+" is ambiguous");r[o]=i}var a=e.length,u=e.charAt(0),c=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,i=0;e[t]===u;)n++,t++;for(var s=(e.length-t)*c+1>>>0,o=new Uint8Array(s);e[t];){var l=r[e.charCodeAt(t)];if(255===l)return;for(var h=0,d=s-1;(0!==l||h<i)&&-1!==d;d--,h++)l+=a*o[d]>>>0,o[d]=l%256>>>0,l=l/256>>>0;if(0!==l)throw new Error("Non-zero carry");i=h,t++}if(" "!==e[t]){for(var f=s-i;f!==s&&0===o[f];)f++;for(var p=new Uint8Array(n+(s-f)),y=n;f!==s;)p[y++]=o[f++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,i=0,s=t.length;i!==s&&0===t[i];)i++,r++;for(var o=(s-i)*l+1>>>0,c=new Uint8Array(o);i!==s;){for(var h=t[i],d=0,f=o-1;(0!==h||d<n)&&-1!==f;f--,d++)h+=256*c[f]>>>0,c[f]=h%a>>>0,h=h/a>>>0;if(0!==h)throw new Error("Non-zero carry");n=d,i++}for(var p=o-n;p!==o&&0===c[p];)p++;for(var y=u.repeat(r);p<o;++p)y+=e.charAt(c[p]);return y},decodeUnsafe:h,decode:function(e){var r=h(e);if(r)return r;throw new Error(`Non-${t} character`)}}}var src$p=base$2,_brrp__multiformats_scope_baseX=src$p;class Encoder$1{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Decoder$1{constructor(e,t,r){this.name=e,this.prefix=t,this.baseDecode=r}decode(e){if("string"==typeof e){if(e[0]===this.prefix)return this.baseDecode(e.slice(1));throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`)}throw Error("Can only multibase decode strings")}or(e){return or$1(this,e)}}class ComposedDecoder{constructor(e){this.decoders=e}or(e){return or$1(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const or$1=(e,t)=>new ComposedDecoder({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class Codec{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new Encoder$1(e,t,r),this.decoder=new Decoder$1(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const from$3=({name:e,prefix:t,encode:r,decode:n})=>new Codec(e,t,r,n),baseX=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:i}=_brrp__multiformats_scope_baseX(r,t);return from$3({prefix:e,name:t,encode:n,decode:e=>coerce(i(e))})},decode$6=(e,t,r,n)=>{const i={};for(let e=0;e<t.length;++e)i[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;const o=new Uint8Array(s*r/8|0);let a=0,u=0,c=0;for(let t=0;t<s;++t){const s=i[e[t]];if(void 0===s)throw new SyntaxError(`Non-${n} character`);u=u<<r|s,a+=r,a>=8&&(a-=8,o[c++]=255&u>>a)}if(a>=r||255&u<<8-a)throw new SyntaxError("Unexpected end of data");return o},encode$5=(e,t,r)=>{const n="="===t[t.length-1],i=(1<<r)-1;let s="",o=0,a=0;for(let n=0;n<e.length;++n)for(a=a<<8|e[n],o+=8;o>r;)o-=r,s+=t[i&a>>o];if(o&&(s+=t[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s},rfc4648=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>from$3({prefix:t,name:e,encode:e=>encode$5(e,n,r),decode:t=>decode$6(t,n,r,e)}),base58btc$8=baseX({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),base58flickr=baseX({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var base58=Object.freeze({__proto__:null,base58btc:base58btc$8,base58flickr:base58flickr});const base32$2=rfc4648({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),base32upper=rfc4648({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),base32pad=rfc4648({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),base32padupper=rfc4648({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),base32hex=rfc4648({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),base32hexupper=rfc4648({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),base32hexpad=rfc4648({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),base32hexpadupper=rfc4648({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),base32z=rfc4648({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var base32$3=Object.freeze({__proto__:null,base32:base32$2,base32upper:base32upper,base32pad:base32pad,base32padupper:base32padupper,base32hex:base32hex,base32hexupper:base32hexupper,base32hexpad:base32hexpad,base32hexpadupper:base32hexpadupper,base32z:base32z});class CID$3{constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this.byteOffset=n.byteOffset,this.byteLength=n.byteLength,this.asCID=this,this._baseCache=new Map,Object.defineProperties(this,{byteOffset:hidden,byteLength:hidden,code:readonly,version:readonly,multihash:readonly,bytes:readonly,_baseCache:hidden,asCID:hidden})}toV0(){if(0===this.version)return this;{const{code:e,multihash:t}=this;if(e!==DAG_PB_CODE)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==SHA_256_CODE)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return CID$3.createV0(t)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=create$8(e,t);return CID$3.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}equals(e){return e&&this.code===e.code&&this.version===e.version&&equals$2(this.multihash,e.multihash)}toString(e){const{bytes:t,version:r,_baseCache:n}=this;return 0===r?toStringV0(t,n,e||base58btc$8.encoder):toStringV1(t,n,e||base32$2.encoder)}toJSON(){return{code:this.code,version:this.version,hash:this.multihash.bytes}}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return"CID("+this.toString()+")"}static isCID(e){return deprecate$2(/^0\.0/,IS_CID_DEPRECATION),!(!e||!e[cidSymbol]&&e.asCID!==e)}get toBaseEncodedString(){throw new Error("Deprecated, use .toString()")}get codec(){throw new Error('"codec" property is deprecated, use integer "code" property instead')}get buffer(){throw new Error("Deprecated .buffer property, use .bytes to get Uint8Array instead")}get multibaseName(){throw new Error('"multibaseName" property is deprecated')}get prefix(){throw new Error('"prefix" property is deprecated')}static asCID(e){if(e instanceof CID$3)return e;if(null!=e&&e.asCID===e){const{version:t,code:r,multihash:n,bytes:i}=e;return new CID$3(t,r,n,i||encodeCID(t,r,n.bytes))}if(null!=e&&!0===e[cidSymbol]){const{version:t,multihash:r,code:n}=e,i=decode$7(r);return CID$3.create(t,n,i)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");switch(e){case 0:if(t!==DAG_PB_CODE)throw new Error(`Version 0 CID must use dag-pb (code: ${DAG_PB_CODE}) block encoding`);return new CID$3(e,t,r,r.bytes);case 1:{const n=encodeCID(e,t,r.bytes);return new CID$3(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return CID$3.create(0,DAG_PB_CODE,e)}static createV1(e,t){return CID$3.create(1,e,t)}static decode(e){const[t,r]=CID$3.decodeFirst(e);if(r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=CID$3.inspectBytes(e),r=t.size-t.multihashSize,n=coerce(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=n.subarray(t.multihashSize-t.digestSize),s=new Digest$1(t.multihashCode,t.digestSize,i,n);return[0===t.version?CID$3.createV0(s):CID$3.createV1(t.codec,s),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[r,n]=decode$8(e.subarray(t));return t+=n,r};let n=r(),i=DAG_PB_CODE;if(18===n?(n=0,t=0):1===n&&(i=r()),0!==n&&1!==n)throw new RangeError(`Invalid CID version ${n}`);const s=t,o=r(),a=r(),u=t+a;return{version:n,codec:i,multihashCode:o,digestSize:a,multihashSize:u-s,size:u}}static parse(e,t){const[r,n]=parseCIDtoBytes(e,t),i=CID$3.decode(n);return i._baseCache.set(r,e),i}}const parseCIDtoBytes=(e,t)=>{switch(e[0]){case"Q":{const r=t||base58btc$8;return[base58btc$8.prefix,r.decode(`${base58btc$8.prefix}${e}`)]}case base58btc$8.prefix:{const r=t||base58btc$8;return[base58btc$8.prefix,r.decode(e)]}case base32$2.prefix:{const r=t||base32$2;return[base32$2.prefix,r.decode(e)]}default:if(null==t)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}},toStringV0=(e,t,r)=>{const{prefix:n}=r;if(n!==base58btc$8.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);const i=t.get(n);if(null==i){const i=r.encode(e).slice(1);return t.set(n,i),i}return i},toStringV1=(e,t,r)=>{const{prefix:n}=r,i=t.get(n);if(null==i){const i=r.encode(e);return t.set(n,i),i}return i},DAG_PB_CODE=112,SHA_256_CODE=18,encodeCID=(e,t,r)=>{const n=encodingLength(e),i=n+encodingLength(t),s=new Uint8Array(i+r.byteLength);return encodeTo(e,s,0),encodeTo(t,s,n),s.set(r,i),s},cidSymbol=Symbol.for("@ipld/js-cid/CID"),readonly={writable:!1,configurable:!1,enumerable:!0},hidden={writable:!1,enumerable:!1,configurable:!1},version$2="0.0.0-dev",deprecate$2=(e,t)=>{if(!e.test(version$2))throw new Error(t);console.warn(t)},IS_CID_DEPRECATION="CID.isCID(v) is deprecated and will be removed in the next major release.\nFollowing code pattern:\n\nif (CID.isCID(value)) {\n  doSomethingWithCID(value)\n}\n\nIs replaced with:\n\nconst cid = CID.asCID(value)\nif (cid) {\n  // Make sure to use cid instead of value\n  doSomethingWithCID(cid)\n}\n";var cid=Object.freeze({__proto__:null,CID:CID$3}),require$$0$a=getAugmentedNamespace(cid),require$$1$8=getAugmentedNamespace(base32$3);const base36=baseX({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),base36upper=baseX({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var base36$1=Object.freeze({__proto__:null,base36:base36,base36upper:base36upper}),require$$2$3=getAugmentedNamespace(base36$1),require$$3$2=getAugmentedNamespace(base58);const base64$e=rfc4648({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),base64pad=rfc4648({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),base64url=rfc4648({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),base64urlpad=rfc4648({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var base64$f=Object.freeze({__proto__:null,base64:base64$e,base64pad:base64pad,base64url:base64url,base64urlpad:base64urlpad}),require$$4$5=getAugmentedNamespace(base64$f);const base16=rfc4648({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),base16upper=rfc4648({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var base16$1=Object.freeze({__proto__:null,base16:base16,base16upper:base16upper}),require$$5$1=getAugmentedNamespace(base16$1),require$$6$1=getAugmentedNamespace(digest),indexMinimal={},aspromise=asPromise;function asPromise(e,t){for(var r=new Array(arguments.length-1),n=0,i=2,s=!0;i<arguments.length;)r[n++]=arguments[i++];return new Promise((function(i,o){r[n]=function(e){if(s)if(s=!1,e)o(e);else{for(var t=new Array(arguments.length-1),r=0;r<t.length;)t[r++]=arguments[r];i.apply(null,t)}};try{e.apply(t||null,r)}catch(e){s&&(s=!1,o(e))}}))}var base64$d={};!function(e){var t=base64$d;t.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&"="===e.charAt(t);)++r;return Math.ceil(3*e.length)/4-r};for(var r=new Array(64),n=new Array(123),i=0;i<64;)n[r[i]=i<26?i+65:i<52?i+71:i<62?i-4:i-59|43]=i++;t.encode=function(e,t,n){for(var i,s=null,o=[],a=0,u=0;t<n;){var c=e[t++];switch(u){case 0:o[a++]=r[c>>2],i=(3&c)<<4,u=1;break;case 1:o[a++]=r[i|c>>4],i=(15&c)<<2,u=2;break;case 2:o[a++]=r[i|c>>6],o[a++]=r[63&c],u=0}a>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,o)),a=0)}return u&&(o[a++]=r[i],o[a++]=61,1===u&&(o[a++]=61)),s?(a&&s.push(String.fromCharCode.apply(String,o.slice(0,a))),s.join("")):String.fromCharCode.apply(String,o.slice(0,a))};var s="invalid encoding";t.decode=function(e,t,r){for(var i,o=r,a=0,u=0;u<e.length;){var c=e.charCodeAt(u++);if(61===c&&a>1)break;if(void 0===(c=n[c]))throw Error(s);switch(a){case 0:i=c,a=1;break;case 1:t[r++]=i<<2|(48&c)>>4,i=c,a=2;break;case 2:t[r++]=(15&i)<<4|(60&c)>>2,i=c,a=3;break;case 3:t[r++]=(3&i)<<6|c,a=0}}if(1===a)throw Error(s);return r-o},t.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}}();var eventemitter=EventEmitter$d;function EventEmitter$d(){this._listeners={}}EventEmitter$d.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this},EventEmitter$d.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var r=this._listeners[e],n=0;n<r.length;)r[n].fn===t?r.splice(n,1):++n;return this},EventEmitter$d.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],n=1;n<arguments.length;)r.push(arguments[n++]);for(n=0;n<t.length;)t[n].fn.apply(t[n++].ctx,r)}return this};var float=factory(factory);function factory(e){return"undefined"!=typeof Float32Array?function(){var t=new Float32Array([-0]),r=new Uint8Array(t.buffer),n=128===r[3];function i(e,n,i){t[0]=e,n[i]=r[0],n[i+1]=r[1],n[i+2]=r[2],n[i+3]=r[3]}function s(e,n,i){t[0]=e,n[i]=r[3],n[i+1]=r[2],n[i+2]=r[1],n[i+3]=r[0]}function o(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],t[0]}function a(e,n){return r[3]=e[n],r[2]=e[n+1],r[1]=e[n+2],r[0]=e[n+3],t[0]}e.writeFloatLE=n?i:s,e.writeFloatBE=n?s:i,e.readFloatLE=n?o:a,e.readFloatBE=n?a:o}():function(){function t(e,t,r,n){var i=t<0?1:0;if(i&&(t=-t),0===t)e(1/t>0?0:2147483648,r,n);else if(isNaN(t))e(2143289344,r,n);else if(t>34028234663852886e22)e((i<<31|2139095040)>>>0,r,n);else if(t<11754943508222875e-54)e((i<<31|Math.round(t/1401298464324817e-60))>>>0,r,n);else{var s=Math.floor(Math.log(t)/Math.LN2);e((i<<31|s+127<<23|8388607&Math.round(t*Math.pow(2,-s)*8388608))>>>0,r,n)}}function r(e,t,r){var n=e(t,r),i=2*(n>>31)+1,s=n>>>23&255,o=8388607&n;return 255===s?o?NaN:i*(1/0):0===s?1401298464324817e-60*i*o:i*Math.pow(2,s-150)*(o+8388608)}e.writeFloatLE=t.bind(null,writeUintLE$1),e.writeFloatBE=t.bind(null,writeUintBE$1),e.readFloatLE=r.bind(null,readUintLE$1),e.readFloatBE=r.bind(null,readUintBE$1)}(),"undefined"!=typeof Float64Array?function(){var t=new Float64Array([-0]),r=new Uint8Array(t.buffer),n=128===r[7];function i(e,n,i){t[0]=e,n[i]=r[0],n[i+1]=r[1],n[i+2]=r[2],n[i+3]=r[3],n[i+4]=r[4],n[i+5]=r[5],n[i+6]=r[6],n[i+7]=r[7]}function s(e,n,i){t[0]=e,n[i]=r[7],n[i+1]=r[6],n[i+2]=r[5],n[i+3]=r[4],n[i+4]=r[3],n[i+5]=r[2],n[i+6]=r[1],n[i+7]=r[0]}function o(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],r[4]=e[n+4],r[5]=e[n+5],r[6]=e[n+6],r[7]=e[n+7],t[0]}function a(e,n){return r[7]=e[n],r[6]=e[n+1],r[5]=e[n+2],r[4]=e[n+3],r[3]=e[n+4],r[2]=e[n+5],r[1]=e[n+6],r[0]=e[n+7],t[0]}e.writeDoubleLE=n?i:s,e.writeDoubleBE=n?s:i,e.readDoubleLE=n?o:a,e.readDoubleBE=n?a:o}():function(){function t(e,t,r,n,i,s){var o=n<0?1:0;if(o&&(n=-n),0===n)e(0,i,s+t),e(1/n>0?0:2147483648,i,s+r);else if(isNaN(n))e(0,i,s+t),e(2146959360,i,s+r);else if(n>17976931348623157e292)e(0,i,s+t),e((o<<31|2146435072)>>>0,i,s+r);else{var a;if(n<22250738585072014e-324)e((a=n/5e-324)>>>0,i,s+t),e((o<<31|a/4294967296)>>>0,i,s+r);else{var u=Math.floor(Math.log(n)/Math.LN2);1024===u&&(u=1023),e(4503599627370496*(a=n*Math.pow(2,-u))>>>0,i,s+t),e((o<<31|u+1023<<20|1048576*a&1048575)>>>0,i,s+r)}}}function r(e,t,r,n,i){var s=e(n,i+t),o=e(n,i+r),a=2*(o>>31)+1,u=o>>>20&2047,c=4294967296*(1048575&o)+s;return 2047===u?c?NaN:a*(1/0):0===u?5e-324*a*c:a*Math.pow(2,u-1075)*(c+4503599627370496)}e.writeDoubleLE=t.bind(null,writeUintLE$1,0,4),e.writeDoubleBE=t.bind(null,writeUintBE$1,4,0),e.readDoubleLE=r.bind(null,readUintLE$1,0,4),e.readDoubleBE=r.bind(null,readUintBE$1,4,0)}(),e}function writeUintLE$1(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function writeUintBE$1(e,t,r){t[r]=e>>>24,t[r+1]=e>>>16&255,t[r+2]=e>>>8&255,t[r+3]=255&e}function readUintLE$1(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function readUintBE$1(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}var inquire_1=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}var utf8$2={};!function(e){var t=utf8$2;t.length=function(e){for(var t=0,r=0,n=0;n<e.length;++n)(r=e.charCodeAt(n))<128?t+=1:r<2048?t+=2:55296==(64512&r)&&56320==(64512&e.charCodeAt(n+1))?(++n,t+=4):t+=3;return t},t.read=function(e,t,r){if(r-t<1)return"";for(var n,i=null,s=[],o=0;t<r;)(n=e[t++])<128?s[o++]=n:n>191&&n<224?s[o++]=(31&n)<<6|63&e[t++]:n>239&&n<365?(n=((7&n)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,s[o++]=55296+(n>>10),s[o++]=56320+(1023&n)):s[o++]=(15&n)<<12|(63&e[t++])<<6|63&e[t++],o>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,s)),o=0);return i?(o&&i.push(String.fromCharCode.apply(String,s.slice(0,o))),i.join("")):String.fromCharCode.apply(String,s.slice(0,o))},t.write=function(e,t,r){for(var n,i,s=r,o=0;o<e.length;++o)(n=e.charCodeAt(o))<128?t[r++]=n:n<2048?(t[r++]=n>>6|192,t[r++]=63&n|128):55296==(64512&n)&&56320==(64512&(i=e.charCodeAt(o+1)))?(n=65536+((1023&n)<<10)+(1023&i),++o,t[r++]=n>>18|240,t[r++]=n>>12&63|128,t[r++]=n>>6&63|128,t[r++]=63&n|128):(t[r++]=n>>12|224,t[r++]=n>>6&63|128,t[r++]=63&n|128);return r-s}}();var pool_1=pool;function pool(e,t,r){var n=r||8192,i=n>>>1,s=null,o=n;return function(r){if(r<1||r>i)return e(r);o+r>n&&(s=e(n),o=0);var a=t.call(s,o,o+=r);return 7&o&&(o=1+(7|o)),a}}var require$$4$4=getAugmentedNamespace(minimal$1),longbits=LongBits$2,util$h=require$$4$4;function LongBits$2(e,t){this.lo=e>>>0,this.hi=t>>>0}var zero=LongBits$2.zero=new LongBits$2(0,0);zero.toNumber=function(){return 0},zero.zzEncode=zero.zzDecode=function(){return this},zero.length=function(){return 1};var zeroHash=LongBits$2.zeroHash="\0\0\0\0\0\0\0\0";LongBits$2.fromNumber=function(e){if(0===e)return zero;var t=e<0;t&&(e=-e);var r=e>>>0,n=(e-r)/4294967296>>>0;return t&&(n=~n>>>0,r=~r>>>0,++r>4294967295&&(r=0,++n>4294967295&&(n=0))),new LongBits$2(r,n)},LongBits$2.from=function(e){if("number"==typeof e)return LongBits$2.fromNumber(e);if(util$h.isString(e)){if(!util$h.Long)return LongBits$2.fromNumber(parseInt(e,10));e=util$h.Long.fromString(e)}return e.low||e.high?new LongBits$2(e.low>>>0,e.high>>>0):zero},LongBits$2.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+4294967296*r)}return this.lo+4294967296*this.hi},LongBits$2.prototype.toLong=function(e){return util$h.Long?new util$h.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var charCodeAt=String.prototype.charCodeAt;LongBits$2.fromHash=function(e){return e===zeroHash?zero:new LongBits$2((charCodeAt.call(e,0)|charCodeAt.call(e,1)<<8|charCodeAt.call(e,2)<<16|charCodeAt.call(e,3)<<24)>>>0,(charCodeAt.call(e,4)|charCodeAt.call(e,5)<<8|charCodeAt.call(e,6)<<16|charCodeAt.call(e,7)<<24)>>>0)},LongBits$2.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},LongBits$2.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},LongBits$2.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},LongBits$2.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return 0===r?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10};var util$g=exports;function merge$4(e,t,r){for(var n=Object.keys(t),i=0;i<n.length;++i)void 0!==e[n[i]]&&r||(e[n[i]]=t[n[i]]);return e}function newError(e){function t(e,r){if(!(this instanceof t))return new t(e,r);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),r&&merge$4(this,r)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,"name",{get:function(){return e}}),t.prototype.toString=function(){return this.name+": "+this.message},t}util$g.asPromise=aspromise,util$g.base64=base64$d,util$g.EventEmitter=eventemitter,util$g.float=float,util$g.inquire=inquire_1,util$g.utf8=utf8$2,util$g.pool=pool_1,util$g.LongBits=longbits,util$g.isNode=Boolean(void 0!==global$1&&global$1&&global$1.process&&global$1.process.versions&&global$1.process.versions.node),util$g.global=util$g.isNode&&global$1||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||void 0,util$g.emptyArray=Object.freeze?Object.freeze([]):[],util$g.emptyObject=Object.freeze?Object.freeze({}):{},util$g.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},util$g.isString=function(e){return"string"==typeof e||e instanceof String},util$g.isObject=function(e){return e&&"object"==typeof e},util$g.isset=util$g.isSet=function(e,t){var r=e[t];return!(null==r||!e.hasOwnProperty(t))&&("object"!=typeof r||(Array.isArray(r)?r.length:Object.keys(r).length)>0)},util$g.Buffer=function(){try{var e=util$g.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),util$g._Buffer_from=null,util$g._Buffer_allocUnsafe=null,util$g.newBuffer=function(e){return"number"==typeof e?util$g.Buffer?util$g._Buffer_allocUnsafe(e):new util$g.Array(e):util$g.Buffer?util$g._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},util$g.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,util$g.Long=util$g.global.dcodeIO&&util$g.global.dcodeIO.Long||util$g.global.Long||util$g.inquire("long"),util$g.key2Re=/^true|false|0|1$/,util$g.key32Re=/^-?(?:0|[1-9][0-9]*)$/,util$g.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,util$g.longToHash=function(e){return e?util$g.LongBits.from(e).toHash():util$g.LongBits.zeroHash},util$g.longFromHash=function(e,t){var r=util$g.LongBits.fromHash(e);return util$g.Long?util$g.Long.fromBits(r.lo,r.hi,t):r.toNumber(Boolean(t))},util$g.merge=merge$4,util$g.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},util$g.newError=newError,util$g.ProtocolError=newError("ProtocolError"),util$g.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var e=Object.keys(this),r=e.length-1;r>-1;--r)if(1===t[e[r]]&&void 0!==this[e[r]]&&null!==this[e[r]])return e[r]}},util$g.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}},util$g.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},util$g._configure=function(){var e=util$g.Buffer;e?(util$g._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,r){return new e(t,r)},util$g._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):util$g._Buffer_from=util$g._Buffer_allocUnsafe=null};var writer=Writer$2,util$f=require$$4$4,BufferWriter$1,LongBits$1=util$f.LongBits,base64$c=util$f.base64,utf8$1=util$f.utf8;function Op(e,t,r){this.fn=e,this.len=t,this.next=void 0,this.val=r}function noop$4(){}function State(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function Writer$2(){this.len=0,this.head=new Op(noop$4,0,0),this.tail=this.head,this.states=null}var create$7=function(){return util$f.Buffer?function(){return(Writer$2.create=function(){return new BufferWriter$1})()}:function(){return new Writer$2}};function writeByte(e,t,r){t[r]=255&e}function writeVarint32(e,t,r){for(;e>127;)t[r++]=127&e|128,e>>>=7;t[r]=e}function VarintOp(e,t){this.len=e,this.next=void 0,this.val=t}function writeVarint64(e,t,r){for(;e.hi;)t[r++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=127&e.lo|128,e.lo=e.lo>>>7;t[r++]=e.lo}function writeFixed32(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}Writer$2.create=create$7(),Writer$2.alloc=function(e){return new util$f.Array(e)},util$f.Array!==Array&&(Writer$2.alloc=util$f.pool(Writer$2.alloc,util$f.Array.prototype.subarray)),Writer$2.prototype._push=function(e,t,r){return this.tail=this.tail.next=new Op(e,t,r),this.len+=t,this},VarintOp.prototype=Object.create(Op.prototype),VarintOp.prototype.fn=writeVarint32,Writer$2.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new VarintOp((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},Writer$2.prototype.int32=function(e){return e<0?this._push(writeVarint64,10,LongBits$1.fromNumber(e)):this.uint32(e)},Writer$2.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},Writer$2.prototype.uint64=function(e){var t=LongBits$1.from(e);return this._push(writeVarint64,t.length(),t)},Writer$2.prototype.int64=Writer$2.prototype.uint64,Writer$2.prototype.sint64=function(e){var t=LongBits$1.from(e).zzEncode();return this._push(writeVarint64,t.length(),t)},Writer$2.prototype.bool=function(e){return this._push(writeByte,1,e?1:0)},Writer$2.prototype.fixed32=function(e){return this._push(writeFixed32,4,e>>>0)},Writer$2.prototype.sfixed32=Writer$2.prototype.fixed32,Writer$2.prototype.fixed64=function(e){var t=LongBits$1.from(e);return this._push(writeFixed32,4,t.lo)._push(writeFixed32,4,t.hi)},Writer$2.prototype.sfixed64=Writer$2.prototype.fixed64,Writer$2.prototype.float=function(e){return this._push(util$f.float.writeFloatLE,4,e)},Writer$2.prototype.double=function(e){return this._push(util$f.float.writeDoubleLE,8,e)};var writeBytes=util$f.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var n=0;n<e.length;++n)t[r+n]=e[n]};Writer$2.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(writeByte,1,0);if(util$f.isString(e)){var r=Writer$2.alloc(t=base64$c.length(e));base64$c.decode(e,r,0),e=r}return this.uint32(t)._push(writeBytes,t,e)},Writer$2.prototype.string=function(e){var t=utf8$1.length(e);return t?this.uint32(t)._push(utf8$1.write,t,e):this._push(writeByte,1,0)},Writer$2.prototype.fork=function(){return this.states=new State(this),this.head=this.tail=new Op(noop$4,0,0),this.len=0,this},Writer$2.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Op(noop$4,0,0),this.len=0),this},Writer$2.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this},Writer$2.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t},Writer$2._configure=function(e){BufferWriter$1=e,Writer$2.create=create$7(),BufferWriter$1._configure()};var writer_buffer=BufferWriter,Writer$1=writer;(BufferWriter.prototype=Object.create(Writer$1.prototype)).constructor=BufferWriter;var util$e=require$$4$4;function BufferWriter(){Writer$1.call(this)}function writeStringBuffer(e,t,r){e.length<40?util$e.utf8.write(e,t,r):t.utf8Write?t.utf8Write(e,r):t.write(e,r)}BufferWriter._configure=function(){BufferWriter.alloc=util$e._Buffer_allocUnsafe,BufferWriter.writeBytesBuffer=util$e.Buffer&&util$e.Buffer.prototype instanceof Uint8Array&&"set"===util$e.Buffer.prototype.set.name?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var n=0;n<e.length;)t[r++]=e[n++]}},BufferWriter.prototype.bytes=function(e){util$e.isString(e)&&(e=util$e._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(BufferWriter.writeBytesBuffer,t,e),this},BufferWriter.prototype.string=function(e){var t=util$e.Buffer.byteLength(e);return this.uint32(t),t&&this._push(writeStringBuffer,t,e),this},BufferWriter._configure();var reader=Reader$3,util$d=require$$4$4,BufferReader$1,LongBits=util$d.LongBits,utf8=util$d.utf8;function indexOutOfRange(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function Reader$3(e){this.buf=e,this.pos=0,this.len=e.length}var create_array="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new Reader$3(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new Reader$3(e);throw Error("illegal buffer")},create$6=function(){return util$d.Buffer?function(e){return(Reader$3.create=function(e){return util$d.Buffer.isBuffer(e)?new BufferReader$1(e):create_array(e)})(e)}:create_array},value;function readLongVarint(){var e=new LongBits(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw indexOutOfRange(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw indexOutOfRange(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function readFixed32_end(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function readFixed64(){if(this.pos+8>this.len)throw indexOutOfRange(this,8);return new LongBits(readFixed32_end(this.buf,this.pos+=4),readFixed32_end(this.buf,this.pos+=4))}Reader$3.create=create$6(),Reader$3.prototype._slice=util$d.Array.prototype.subarray||util$d.Array.prototype.slice,Reader$3.prototype.uint32=(value=4294967295,function(){if(value=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return value;if((this.pos+=5)>this.len)throw this.pos=this.len,indexOutOfRange(this,10);return value}),Reader$3.prototype.int32=function(){return 0|this.uint32()},Reader$3.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},Reader$3.prototype.bool=function(){return 0!==this.uint32()},Reader$3.prototype.fixed32=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)},Reader$3.prototype.sfixed32=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return 0|readFixed32_end(this.buf,this.pos+=4)},Reader$3.prototype.float=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);var e=util$d.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},Reader$3.prototype.double=function(){if(this.pos+8>this.len)throw indexOutOfRange(this,4);var e=util$d.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},Reader$3.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw indexOutOfRange(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,r):t===r?new this.buf.constructor(0):this._slice.call(this.buf,t,r)},Reader$3.prototype.string=function(){var e=this.bytes();return utf8.read(e,0,e.length)},Reader$3.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw indexOutOfRange(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw indexOutOfRange(this)}while(128&this.buf[this.pos++]);return this},Reader$3.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},Reader$3._configure=function(e){BufferReader$1=e,Reader$3.create=create$6(),BufferReader$1._configure();var t=util$d.Long?"toLong":"toNumber";util$d.merge(Reader$3.prototype,{int64:function(){return readLongVarint.call(this)[t](!1)},uint64:function(){return readLongVarint.call(this)[t](!0)},sint64:function(){return readLongVarint.call(this).zzDecode()[t](!1)},fixed64:function(){return readFixed64.call(this)[t](!0)},sfixed64:function(){return readFixed64.call(this)[t](!1)}})};var reader_buffer=BufferReader,Reader$2=reader;(BufferReader.prototype=Object.create(Reader$2.prototype)).constructor=BufferReader;var util$c=require$$4$4;function BufferReader(e){Reader$2.call(this,e)}BufferReader._configure=function(){util$c.Buffer&&(BufferReader.prototype._slice=util$c.Buffer.prototype.slice)},BufferReader.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},BufferReader._configure();var rpc$1={},service=Service,util$b=require$$4$4;function Service(e,t,r){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");util$b.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(r)}(Service.prototype=Object.create(util$b.EventEmitter.prototype)).constructor=Service,Service.prototype.rpcCall=function e(t,r,n,i,s){if(!i)throw TypeError("request must be specified");var o=this;if(!s)return util$b.asPromise(e,o,t,r,n,i);if(o.rpcImpl)try{return o.rpcImpl(t,r[o.requestDelimited?"encodeDelimited":"encode"](i).finish(),(function(e,r){if(e)return o.emit("error",e,t),s(e);if(null!==r){if(!(r instanceof n))try{r=n[o.responseDelimited?"decodeDelimited":"decode"](r)}catch(e){return o.emit("error",e,t),s(e)}return o.emit("data",r,t),s(null,r)}o.end(!0)}))}catch(e){return o.emit("error",e,t),void setTimeout((function(){s(e)}),0)}else setTimeout((function(){s(Error("already ended"))}),0)},Service.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this},rpc$1.Service=service;var roots={};!function(e){var t=indexMinimal;function r(){t.util._configure(),t.Writer._configure(t.BufferWriter),t.Reader._configure(t.BufferReader)}t.build="minimal",t.Writer=writer,t.BufferWriter=writer_buffer,t.Reader=reader,t.BufferReader=reader_buffer,t.util=require$$4$4,t.rpc=rpc$1,t.roots=roots,t.configure=r,r()}();var minimal=indexMinimal,$protobuf$h=minimal,$Reader$h=$protobuf$h.Reader,$Writer$h=$protobuf$h.Writer,$util$h=$protobuf$h.util,$root$h=$protobuf$h.roots["libp2p-crypto-keys"]||($protobuf$h.roots["libp2p-crypto-keys"]={}),valuesById,values;$root$h.KeyType=(valuesById={},values=Object.create(valuesById),values[valuesById[0]="RSA"]=0,values[valuesById[1]="Ed25519"]=1,values[valuesById[2]="Secp256k1"]=2,values),$root$h.PublicKey=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.Type=0,e.prototype.Data=$util$h.newBuffer([]),e.encode=function(e,t){return t||(t=$Writer$h.create()),t.uint32(8).int32(e.Type),t.uint32(18).bytes(e.Data),t},e.decode=function(e,t){e instanceof $Reader$h||(e=$Reader$h.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root$h.PublicKey;e.pos<r;){var i=e.uint32();switch(i>>>3){case 1:n.Type=e.int32();break;case 2:n.Data=e.bytes();break;default:e.skipType(7&i)}}if(!n.hasOwnProperty("Type"))throw $util$h.ProtocolError("missing required 'Type'",{instance:n});if(!n.hasOwnProperty("Data"))throw $util$h.ProtocolError("missing required 'Data'",{instance:n});return n},e.fromObject=function(e){if(e instanceof $root$h.PublicKey)return e;var t=new $root$h.PublicKey;switch(e.Type){case"RSA":case 0:t.Type=0;break;case"Ed25519":case 1:t.Type=1;break;case"Secp256k1":case 2:t.Type=2}return null!=e.Data&&("string"==typeof e.Data?$util$h.base64.decode(e.Data,t.Data=$util$h.newBuffer($util$h.base64.length(e.Data)),0):e.Data.length&&(t.Data=e.Data)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.Type=t.enums===String?"RSA":0,t.bytes===String?r.Data="":(r.Data=[],t.bytes!==Array&&(r.Data=$util$h.newBuffer(r.Data)))),null!=e.Type&&e.hasOwnProperty("Type")&&(r.Type=t.enums===String?$root$h.KeyType[e.Type]:e.Type),null!=e.Data&&e.hasOwnProperty("Data")&&(r.Data=t.bytes===String?$util$h.base64.encode(e.Data,0,e.Data.length):t.bytes===Array?Array.prototype.slice.call(e.Data):e.Data),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf$h.util.toJSONOptions)},e}(),$root$h.PrivateKey=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.Type=0,e.prototype.Data=$util$h.newBuffer([]),e.encode=function(e,t){return t||(t=$Writer$h.create()),t.uint32(8).int32(e.Type),t.uint32(18).bytes(e.Data),t},e.decode=function(e,t){e instanceof $Reader$h||(e=$Reader$h.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root$h.PrivateKey;e.pos<r;){var i=e.uint32();switch(i>>>3){case 1:n.Type=e.int32();break;case 2:n.Data=e.bytes();break;default:e.skipType(7&i)}}if(!n.hasOwnProperty("Type"))throw $util$h.ProtocolError("missing required 'Type'",{instance:n});if(!n.hasOwnProperty("Data"))throw $util$h.ProtocolError("missing required 'Data'",{instance:n});return n},e.fromObject=function(e){if(e instanceof $root$h.PrivateKey)return e;var t=new $root$h.PrivateKey;switch(e.Type){case"RSA":case 0:t.Type=0;break;case"Ed25519":case 1:t.Type=1;break;case"Secp256k1":case 2:t.Type=2}return null!=e.Data&&("string"==typeof e.Data?$util$h.base64.decode(e.Data,t.Data=$util$h.newBuffer($util$h.base64.length(e.Data)),0):e.Data.length&&(t.Data=e.Data)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.Type=t.enums===String?"RSA":0,t.bytes===String?r.Data="":(r.Data=[],t.bytes!==Array&&(r.Data=$util$h.newBuffer(r.Data)))),null!=e.Type&&e.hasOwnProperty("Type")&&(r.Type=t.enums===String?$root$h.KeyType[e.Type]:e.Type),null!=e.Data&&e.hasOwnProperty("Data")&&(r.Data=t.bytes===String?$util$h.base64.encode(e.Data,0,e.Data.length):t.bytes===Array?Array.prototype.slice.call(e.Data):e.Data),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf$h.util.toJSONOptions)},e}();var keys$e=$root$h,forge$X={options:{usePureJavaScript:!1}},lookup$1=[],revLookup=[],Arr="undefined"!=typeof Uint8Array?Uint8Array:Array,inited=!1;function init$1(){inited=!0;for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=0,r=e.length;t<r;++t)lookup$1[t]=e[t],revLookup[e.charCodeAt(t)]=t;revLookup["-".charCodeAt(0)]=62,revLookup["_".charCodeAt(0)]=63}function toByteArray(e){var t,r,n,i,s,o;inited||init$1();var a=e.length;if(a%4>0)throw new Error("Invalid string. Length must be a multiple of 4");s="="===e[a-2]?2:"="===e[a-1]?1:0,o=new Arr(3*a/4-s),n=s>0?a-4:a;var u=0;for(t=0,r=0;t<n;t+=4,r+=3)i=revLookup[e.charCodeAt(t)]<<18|revLookup[e.charCodeAt(t+1)]<<12|revLookup[e.charCodeAt(t+2)]<<6|revLookup[e.charCodeAt(t+3)],o[u++]=i>>16&255,o[u++]=i>>8&255,o[u++]=255&i;return 2===s?(i=revLookup[e.charCodeAt(t)]<<2|revLookup[e.charCodeAt(t+1)]>>4,o[u++]=255&i):1===s&&(i=revLookup[e.charCodeAt(t)]<<10|revLookup[e.charCodeAt(t+1)]<<4|revLookup[e.charCodeAt(t+2)]>>2,o[u++]=i>>8&255,o[u++]=255&i),o}function tripletToBase64(e){return lookup$1[e>>18&63]+lookup$1[e>>12&63]+lookup$1[e>>6&63]+lookup$1[63&e]}function encodeChunk(e,t,r){for(var n,i=[],s=t;s<r;s+=3)n=(e[s]<<16)+(e[s+1]<<8)+e[s+2],i.push(tripletToBase64(n));return i.join("")}function fromByteArray(e){var t;inited||init$1();for(var r=e.length,n=r%3,i="",s=[],o=16383,a=0,u=r-n;a<u;a+=o)s.push(encodeChunk(e,a,a+o>u?u:a+o));return 1===n?(t=e[r-1],i+=lookup$1[t>>2],i+=lookup$1[t<<4&63],i+="=="):2===n&&(t=(e[r-2]<<8)+e[r-1],i+=lookup$1[t>>10],i+=lookup$1[t>>4&63],i+=lookup$1[t<<2&63],i+="="),s.push(i),s.join("")}function read$1(e,t,r,n,i){var s,o,a=8*i-n-1,u=(1<<a)-1,c=u>>1,l=-7,h=r?i-1:0,d=r?-1:1,f=e[t+h];for(h+=d,s=f&(1<<-l)-1,f>>=-l,l+=a;l>0;s=256*s+e[t+h],h+=d,l-=8);for(o=s&(1<<-l)-1,s>>=-l,l+=n;l>0;o=256*o+e[t+h],h+=d,l-=8);if(0===s)s=1-c;else{if(s===u)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,n),s-=c}return(f?-1:1)*o*Math.pow(2,s-n)}function write(e,t,r,n,i,s){var o,a,u,c=8*s-i-1,l=(1<<c)-1,h=l>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:s-1,p=n?1:-1,y=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=l):(o=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-o))<1&&(o--,u*=2),(t+=o+h>=1?d/u:d*Math.pow(2,1-h))*u>=2&&(o++,u/=2),o+h>=l?(a=0,o=l):o+h>=1?(a=(t*u-1)*Math.pow(2,i),o+=h):(a=t*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;e[r+f]=255&a,f+=p,a/=256,i-=8);for(o=o<<i|a,c+=i;c>0;e[r+f]=255&o,f+=p,o/=256,c-=8);e[r+f-p]|=128*y}var toString$5={}.toString,isArray$1=Array.isArray||function(e){return"[object Array]"==toString$5.call(e)},INSPECT_MAX_BYTES=50;Buffer$f.TYPED_ARRAY_SUPPORT=void 0===global$1.TYPED_ARRAY_SUPPORT||global$1.TYPED_ARRAY_SUPPORT;var _kMaxLength=kMaxLength();function kMaxLength(){return Buffer$f.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function createBuffer(e,t){if(kMaxLength()<t)throw new RangeError("Invalid typed array length");return Buffer$f.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=Buffer$f.prototype:(null===e&&(e=new Buffer$f(t)),e.length=t),e}function Buffer$f(e,t,r){if(!(Buffer$f.TYPED_ARRAY_SUPPORT||this instanceof Buffer$f))return new Buffer$f(e,t,r);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return allocUnsafe(this,e)}return from$2(this,e,t,r)}function from$2(e,t,r,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?fromArrayBuffer(e,t,r,n):"string"==typeof t?fromString$9(e,t,r):fromObject(e,t)}function assertSize(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function alloc(e,t,r,n){return assertSize(t),t<=0?createBuffer(e,t):void 0!==r?"string"==typeof n?createBuffer(e,t).fill(r,n):createBuffer(e,t).fill(r):createBuffer(e,t)}function allocUnsafe(e,t){if(assertSize(t),e=createBuffer(e,t<0?0:0|checked(t)),!Buffer$f.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function fromString$9(e,t,r){if("string"==typeof r&&""!==r||(r="utf8"),!Buffer$f.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|byteLength(t,r),i=(e=createBuffer(e,n)).write(t,r);return i!==n&&(e=e.slice(0,i)),e}function fromArrayLike(e,t){var r=t.length<0?0:0|checked(t.length);e=createBuffer(e,r);for(var n=0;n<r;n+=1)e[n]=255&t[n];return e}function fromArrayBuffer(e,t,r,n){if(t.byteLength,r<0||t.byteLength<r)throw new RangeError("'offset' is out of bounds");if(t.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");return t=void 0===r&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,r):new Uint8Array(t,r,n),Buffer$f.TYPED_ARRAY_SUPPORT?(e=t).__proto__=Buffer$f.prototype:e=fromArrayLike(e,t),e}function fromObject(e,t){if(internalIsBuffer(t)){var r=0|checked(t.length);return 0===(e=createBuffer(e,r)).length||t.copy(e,0,0,r),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||isnan(t.length)?createBuffer(e,0):fromArrayLike(e,t);if("Buffer"===t.type&&isArray$1(t.data))return fromArrayLike(e,t.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function checked(e){if(e>=kMaxLength())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+kMaxLength().toString(16)+" bytes");return 0|e}function SlowBuffer(e){return+e!=e&&(e=0),Buffer$f.alloc(+e)}function internalIsBuffer(e){return!(null==e||!e._isBuffer)}function byteLength(e,t){if(internalIsBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return utf8ToBytes(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return base64ToBytes(e).length;default:if(n)return utf8ToBytes(e).length;t=(""+t).toLowerCase(),n=!0}}function slowToString(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return hexSlice(this,t,r);case"utf8":case"utf-8":return utf8Slice(this,t,r);case"ascii":return asciiSlice(this,t,r);case"latin1":case"binary":return latin1Slice(this,t,r);case"base64":return base64Slice(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function swap(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function bidirectionalIndexOf(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=Buffer$f.from(t,n)),internalIsBuffer(t))return 0===t.length?-1:arrayIndexOf(e,t,r,n,i);if("number"==typeof t)return t&=255,Buffer$f.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):arrayIndexOf(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(e,t,r,n,i){var s,o=1,a=e.length,u=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;o=2,a/=2,u/=2,r/=2}function c(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){var l=-1;for(s=r;s<a;s++)if(c(e,s)===c(t,-1===l?0:s-l)){if(-1===l&&(l=s),s-l+1===u)return l*o}else-1!==l&&(s-=s-l),l=-1}else for(r+u>a&&(r=a-u),s=r;s>=0;s--){for(var h=!0,d=0;d<u;d++)if(c(e,s+d)!==c(t,d)){h=!1;break}if(h)return s}return-1}function hexWrite(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var s=t.length;if(s%2!=0)throw new TypeError("Invalid hex string");n>s/2&&(n=s/2);for(var o=0;o<n;++o){var a=parseInt(t.substr(2*o,2),16);if(isNaN(a))return o;e[r+o]=a}return o}function utf8Write(e,t,r,n){return blitBuffer(utf8ToBytes(t,e.length-r),e,r,n)}function asciiWrite(e,t,r,n){return blitBuffer(asciiToBytes(t),e,r,n)}function latin1Write(e,t,r,n){return asciiWrite(e,t,r,n)}function base64Write(e,t,r,n){return blitBuffer(base64ToBytes(t),e,r,n)}function ucs2Write(e,t,r,n){return blitBuffer(utf16leToBytes(t,e.length-r),e,r,n)}function base64Slice(e,t,r){return 0===t&&r===e.length?fromByteArray(e):fromByteArray(e.slice(t,r))}function utf8Slice(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var s,o,a,u,c=e[i],l=null,h=c>239?4:c>223?3:c>191?2:1;if(i+h<=r)switch(h){case 1:c<128&&(l=c);break;case 2:128==(192&(s=e[i+1]))&&(u=(31&c)<<6|63&s)>127&&(l=u);break;case 3:s=e[i+1],o=e[i+2],128==(192&s)&&128==(192&o)&&(u=(15&c)<<12|(63&s)<<6|63&o)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:s=e[i+1],o=e[i+2],a=e[i+3],128==(192&s)&&128==(192&o)&&128==(192&a)&&(u=(15&c)<<18|(63&s)<<12|(63&o)<<6|63&a)>65535&&u<1114112&&(l=u)}null===l?(l=65533,h=1):l>65535&&(l-=65536,n.push(l>>>10&1023|55296),l=56320|1023&l),n.push(l),i+=h}return decodeCodePointsArray(n)}Buffer$f.poolSize=8192,Buffer$f._augment=function(e){return e.__proto__=Buffer$f.prototype,e},Buffer$f.from=function(e,t,r){return from$2(null,e,t,r)},Buffer$f.TYPED_ARRAY_SUPPORT&&(Buffer$f.prototype.__proto__=Uint8Array.prototype,Buffer$f.__proto__=Uint8Array),Buffer$f.alloc=function(e,t,r){return alloc(null,e,t,r)},Buffer$f.allocUnsafe=function(e){return allocUnsafe(null,e)},Buffer$f.allocUnsafeSlow=function(e){return allocUnsafe(null,e)},Buffer$f.isBuffer=isBuffer$3,Buffer$f.compare=function(e,t){if(!internalIsBuffer(e)||!internalIsBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,i=0,s=Math.min(r,n);i<s;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},Buffer$f.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer$f.concat=function(e,t){if(!isArray$1(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return Buffer$f.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=Buffer$f.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var s=e[r];if(!internalIsBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(n,i),i+=s.length}return n},Buffer$f.byteLength=byteLength,Buffer$f.prototype._isBuffer=!0,Buffer$f.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)swap(this,t,t+1);return this},Buffer$f.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)swap(this,t,t+3),swap(this,t+1,t+2);return this},Buffer$f.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)swap(this,t,t+7),swap(this,t+1,t+6),swap(this,t+2,t+5),swap(this,t+3,t+4);return this},Buffer$f.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?utf8Slice(this,0,e):slowToString.apply(this,arguments)},Buffer$f.prototype.equals=function(e){if(!internalIsBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===Buffer$f.compare(this,e)},Buffer$f.prototype.inspect=function(){var e="",t=INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,t).match(/.{2}/g).join(" "),this.length>t&&(e+=" ... ")),"<Buffer "+e+">"},Buffer$f.prototype.compare=function(e,t,r,n,i){if(!internalIsBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(this===e)return 0;for(var s=(i>>>=0)-(n>>>=0),o=(r>>>=0)-(t>>>=0),a=Math.min(s,o),u=this.slice(n,i),c=e.slice(t,r),l=0;l<a;++l)if(u[l]!==c[l]){s=u[l],o=c[l];break}return s<o?-1:o<s?1:0},Buffer$f.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},Buffer$f.prototype.indexOf=function(e,t,r){return bidirectionalIndexOf(this,e,t,r,!0)},Buffer$f.prototype.lastIndexOf=function(e,t,r){return bidirectionalIndexOf(this,e,t,r,!1)},Buffer$f.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var s=!1;;)switch(n){case"hex":return hexWrite(this,e,t,r);case"utf8":case"utf-8":return utf8Write(this,e,t,r);case"ascii":return asciiWrite(this,e,t,r);case"latin1":case"binary":return latin1Write(this,e,t,r);case"base64":return base64Write(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,e,t,r);default:if(s)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),s=!0}},Buffer$f.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(e){var t=e.length;if(t<=MAX_ARGUMENTS_LENGTH)return String.fromCharCode.apply(String,e);for(var r="",n=0;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=MAX_ARGUMENTS_LENGTH));return r}function asciiSlice(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function latin1Slice(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function hexSlice(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",s=t;s<r;++s)i+=toHex$1(e[s]);return i}function utf16leSlice(e,t,r){for(var n=e.slice(t,r),i="",s=0;s<n.length;s+=2)i+=String.fromCharCode(n[s]+256*n[s+1]);return i}function checkOffset(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function checkInt(e,t,r,n,i,s){if(!internalIsBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<s)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function objectWriteUInt16(e,t,r,n){t<0&&(t=65535+t+1);for(var i=0,s=Math.min(e.length-r,2);i<s;++i)e[r+i]=(t&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function objectWriteUInt32(e,t,r,n){t<0&&(t=4294967295+t+1);for(var i=0,s=Math.min(e.length-r,4);i<s;++i)e[r+i]=t>>>8*(n?i:3-i)&255}function checkIEEE754(e,t,r,n,i,s){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function writeFloat(e,t,r,n,i){return i||checkIEEE754(e,t,r,4),write(e,t,r,n,23,4),r+4}function writeDouble(e,t,r,n,i){return i||checkIEEE754(e,t,r,8),write(e,t,r,n,52,8),r+8}Buffer$f.prototype.slice=function(e,t){var r,n=this.length;if((e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e),Buffer$f.TYPED_ARRAY_SUPPORT)(r=this.subarray(e,t)).__proto__=Buffer$f.prototype;else{var i=t-e;r=new Buffer$f(i,void 0);for(var s=0;s<i;++s)r[s]=this[s+e]}return r},Buffer$f.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||checkOffset(e,t,this.length);for(var n=this[e],i=1,s=0;++s<t&&(i*=256);)n+=this[e+s]*i;return n},Buffer$f.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||checkOffset(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},Buffer$f.prototype.readUInt8=function(e,t){return t||checkOffset(e,1,this.length),this[e]},Buffer$f.prototype.readUInt16LE=function(e,t){return t||checkOffset(e,2,this.length),this[e]|this[e+1]<<8},Buffer$f.prototype.readUInt16BE=function(e,t){return t||checkOffset(e,2,this.length),this[e]<<8|this[e+1]},Buffer$f.prototype.readUInt32LE=function(e,t){return t||checkOffset(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},Buffer$f.prototype.readUInt32BE=function(e,t){return t||checkOffset(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},Buffer$f.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||checkOffset(e,t,this.length);for(var n=this[e],i=1,s=0;++s<t&&(i*=256);)n+=this[e+s]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},Buffer$f.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||checkOffset(e,t,this.length);for(var n=t,i=1,s=this[e+--n];n>0&&(i*=256);)s+=this[e+--n]*i;return s>=(i*=128)&&(s-=Math.pow(2,8*t)),s},Buffer$f.prototype.readInt8=function(e,t){return t||checkOffset(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},Buffer$f.prototype.readInt16LE=function(e,t){t||checkOffset(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},Buffer$f.prototype.readInt16BE=function(e,t){t||checkOffset(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},Buffer$f.prototype.readInt32LE=function(e,t){return t||checkOffset(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},Buffer$f.prototype.readInt32BE=function(e,t){return t||checkOffset(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},Buffer$f.prototype.readFloatLE=function(e,t){return t||checkOffset(e,4,this.length),read$1(this,e,!0,23,4)},Buffer$f.prototype.readFloatBE=function(e,t){return t||checkOffset(e,4,this.length),read$1(this,e,!1,23,4)},Buffer$f.prototype.readDoubleLE=function(e,t){return t||checkOffset(e,8,this.length),read$1(this,e,!0,52,8)},Buffer$f.prototype.readDoubleBE=function(e,t){return t||checkOffset(e,8,this.length),read$1(this,e,!1,52,8)},Buffer$f.prototype.writeUIntLE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||checkInt(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,s=0;for(this[t]=255&e;++s<r&&(i*=256);)this[t+s]=e/i&255;return t+r},Buffer$f.prototype.writeUIntBE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||checkInt(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,s=1;for(this[t+i]=255&e;--i>=0&&(s*=256);)this[t+i]=e/s&255;return t+r},Buffer$f.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||checkInt(this,e,t,1,255,0),Buffer$f.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},Buffer$f.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||checkInt(this,e,t,2,65535,0),Buffer$f.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):objectWriteUInt16(this,e,t,!0),t+2},Buffer$f.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||checkInt(this,e,t,2,65535,0),Buffer$f.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):objectWriteUInt16(this,e,t,!1),t+2},Buffer$f.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||checkInt(this,e,t,4,4294967295,0),Buffer$f.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):objectWriteUInt32(this,e,t,!0),t+4},Buffer$f.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||checkInt(this,e,t,4,4294967295,0),Buffer$f.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):objectWriteUInt32(this,e,t,!1),t+4},Buffer$f.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);checkInt(this,e,t,r,i-1,-i)}var s=0,o=1,a=0;for(this[t]=255&e;++s<r&&(o*=256);)e<0&&0===a&&0!==this[t+s-1]&&(a=1),this[t+s]=(e/o>>0)-a&255;return t+r},Buffer$f.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);checkInt(this,e,t,r,i-1,-i)}var s=r-1,o=1,a=0;for(this[t+s]=255&e;--s>=0&&(o*=256);)e<0&&0===a&&0!==this[t+s+1]&&(a=1),this[t+s]=(e/o>>0)-a&255;return t+r},Buffer$f.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||checkInt(this,e,t,1,127,-128),Buffer$f.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},Buffer$f.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||checkInt(this,e,t,2,32767,-32768),Buffer$f.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):objectWriteUInt16(this,e,t,!0),t+2},Buffer$f.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||checkInt(this,e,t,2,32767,-32768),Buffer$f.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):objectWriteUInt16(this,e,t,!1),t+2},Buffer$f.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||checkInt(this,e,t,4,2147483647,-2147483648),Buffer$f.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):objectWriteUInt32(this,e,t,!0),t+4},Buffer$f.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||checkInt(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),Buffer$f.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):objectWriteUInt32(this,e,t,!1),t+4},Buffer$f.prototype.writeFloatLE=function(e,t,r){return writeFloat(this,e,t,!0,r)},Buffer$f.prototype.writeFloatBE=function(e,t,r){return writeFloat(this,e,t,!1,r)},Buffer$f.prototype.writeDoubleLE=function(e,t,r){return writeDouble(this,e,t,!0,r)},Buffer$f.prototype.writeDoubleBE=function(e,t,r){return writeDouble(this,e,t,!1,r)},Buffer$f.prototype.copy=function(e,t,r,n){if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i,s=n-r;if(this===e&&r<t&&t<n)for(i=s-1;i>=0;--i)e[i+t]=this[i+r];else if(s<1e3||!Buffer$f.TYPED_ARRAY_SUPPORT)for(i=0;i<s;++i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+s),t);return s},Buffer$f.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!Buffer$f.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var s;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(s=t;s<r;++s)this[s]=e;else{var o=internalIsBuffer(e)?e:utf8ToBytes(new Buffer$f(e,n).toString()),a=o.length;for(s=0;s<r-t;++s)this[s+t]=o[s%a]}return this};var INVALID_BASE64_RE=/[^+\/0-9A-Za-z-_]/g;function base64clean(e){if((e=stringtrim(e).replace(INVALID_BASE64_RE,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}function stringtrim(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function toHex$1(e){return e<16?"0"+e.toString(16):e.toString(16)}function utf8ToBytes(e,t){var r;t=t||1/0;for(var n=e.length,i=null,s=[],o=0;o<n;++o){if((r=e.charCodeAt(o))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&s.push(239,191,189);continue}if(o+1===n){(t-=3)>-1&&s.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&s.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&s.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;s.push(r)}else if(r<2048){if((t-=2)<0)break;s.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;s.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return s}function asciiToBytes(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}function utf16leToBytes(e,t){for(var r,n,i,s=[],o=0;o<e.length&&!((t-=2)<0);++o)n=(r=e.charCodeAt(o))>>8,i=r%256,s.push(i),s.push(n);return s}function base64ToBytes(e){return toByteArray(base64clean(e))}function blitBuffer(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}function isnan(e){return e!=e}function isBuffer$3(e){return null!=e&&(!!e._isBuffer||isFastBuffer(e)||isSlowBuffer(e))}function isFastBuffer(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}function isSlowBuffer(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&isFastBuffer(e.slice(0,0))}var _polyfillNode_buffer=Object.freeze({__proto__:null,Buffer:Buffer$f,INSPECT_MAX_BYTES:INSPECT_MAX_BYTES,SlowBuffer:SlowBuffer,isBuffer:isBuffer$3,kMaxLength:_kMaxLength}),api={};module.exports=api;var _reverseAlphabets={};function _encodeWithByteBuffer(e,t){var r=0,n=t.length,i=t.charAt(0),s=[0];for(r=0;r<e.length();++r){for(var o=0,a=e.at(r);o<s.length;++o)a+=s[o]<<8,s[o]=a%n,a=a/n|0;for(;a>0;)s.push(a%n),a=a/n|0}var u="";for(r=0;0===e.at(r)&&r<e.length()-1;++r)u+=i;for(r=s.length-1;r>=0;--r)u+=t[s[r]];return u}api.encode=function(e,t,r){if("string"!=typeof t)throw new TypeError('"alphabet" must be a string.');if(void 0!==r&&"number"!=typeof r)throw new TypeError('"maxline" must be a number.');var n="";if(e instanceof Uint8Array){var i=0,s=t.length,o=t.charAt(0),a=[0];for(i=0;i<e.length;++i){for(var u=0,c=e[i];u<a.length;++u)c+=a[u]<<8,a[u]=c%s,c=c/s|0;for(;c>0;)a.push(c%s),c=c/s|0}for(i=0;0===e[i]&&i<e.length-1;++i)n+=o;for(i=a.length-1;i>=0;--i)n+=t[a[i]]}else n=_encodeWithByteBuffer(e,t);if(r){var l=new RegExp(".{1,"+r+"}","g");n=n.match(l).join("\r\n")}return n},api.decode=function(e,t){if("string"!=typeof e)throw new TypeError('"input" must be a string.');if("string"!=typeof t)throw new TypeError('"alphabet" must be a string.');var r=_reverseAlphabets[t];if(!r){r=_reverseAlphabets[t]=[];for(var n=0;n<t.length;++n)r[t.charCodeAt(n)]=n}e=e.replace(/\s/g,"");var i=t.length,s=t.charAt(0),o=[0];for(n=0;n<e.length;n++){var a=r[e.charCodeAt(n)];if(void 0===a)return;for(var u=0,c=a;u<o.length;++u)c+=o[u]*i,o[u]=255&c,c>>=8;for(;c>0;)o.push(255&c),c>>=8}for(var l=0;e[l]===s&&l<e.length-1;++l)o.push(0);return void 0!==Buffer$f?Buffer$f.from(o.reverse()):new Uint8Array(o.reverse())};var baseN$1=Object.freeze({__proto__:null}),require$$1$7=getAugmentedNamespace(baseN$1),forge$W=forge$X,baseN=require$$1$7,util$9=module.exports=forge$W.util=forge$W.util||{};function _checkBitsParam(e){if(8!==e&&16!==e&&24!==e&&32!==e)throw new Error("Only 8, 16, 24, or 32 bits supported: "+e)}function ByteStringBuffer(e){if(this.data="",this.read=0,"string"==typeof e)this.data=e;else if(util$9.isArrayBuffer(e)||util$9.isArrayBufferView(e))if(void 0!==Buffer$f&&e instanceof Buffer$f)this.data=e.toString("binary");else{var t=new Uint8Array(e);try{this.data=String.fromCharCode.apply(null,t)}catch(e){for(var r=0;r<t.length;++r)this.putByte(t[r])}}else(e instanceof ByteStringBuffer||"object"==typeof e&&"string"==typeof e.data&&"number"==typeof e.read)&&(this.data=e.data,this.read=e.read);this._constructedStringLength=0}!function(){if(void 0!==process&&process.nextTick&&!process.browser)return util$9.nextTick=process.nextTick,void("function"==typeof setImmediate?util$9.setImmediate=setImmediate:util$9.setImmediate=util$9.nextTick);if("function"==typeof setImmediate)return util$9.setImmediate=function(){return setImmediate.apply(void 0,arguments)},void(util$9.nextTick=function(e){return setImmediate(e)});if(util$9.setImmediate=function(e){setTimeout(e,0)},"undefined"!=typeof window&&"function"==typeof window.postMessage){var e="forge.setImmediate",t=[];util$9.setImmediate=function(r){t.push(r),1===t.length&&window.postMessage(e,"*")},window.addEventListener("message",(function(r){if(r.source===window&&r.data===e){r.stopPropagation();var n=t.slice();t.length=0,n.forEach((function(e){e()}))}}),!0)}if("undefined"!=typeof MutationObserver){var r=Date.now(),n=!0,i=document.createElement("div");t=[];new MutationObserver((function(){var e=t.slice();t.length=0,e.forEach((function(e){e()}))})).observe(i,{attributes:!0});var s=util$9.setImmediate;util$9.setImmediate=function(e){Date.now()-r>15?(r=Date.now(),s(e)):(t.push(e),1===t.length&&i.setAttribute("a",n=!n))}}util$9.nextTick=util$9.setImmediate}(),util$9.isNodejs=void 0!==process&&process.versions&&process.versions.node,util$9.globalScope=util$9.isNodejs?global$1:"undefined"==typeof self?window:self,util$9.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},util$9.isArrayBuffer=function(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer},util$9.isArrayBufferView=function(e){return e&&util$9.isArrayBuffer(e.buffer)&&void 0!==e.byteLength},util$9.ByteBuffer=ByteStringBuffer,util$9.ByteStringBuffer=ByteStringBuffer;var _MAX_CONSTRUCTED_STRING_LENGTH=4096;function DataBuffer(e,t){t=t||{},this.read=t.readOffset||0,this.growSize=t.growSize||1024;var r=util$9.isArrayBuffer(e),n=util$9.isArrayBufferView(e);if(r||n)return this.data=r?new DataView(e):new DataView(e.buffer,e.byteOffset,e.byteLength),void(this.write="writeOffset"in t?t.writeOffset:this.data.byteLength);this.data=new DataView(new ArrayBuffer(0)),this.write=0,null!=e&&this.putBytes(e),"writeOffset"in t&&(this.write=t.writeOffset)}util$9.ByteStringBuffer.prototype._optimizeConstructedString=function(e){this._constructedStringLength+=e,this._constructedStringLength>_MAX_CONSTRUCTED_STRING_LENGTH&&(this.data.substr(0,1),this._constructedStringLength=0)},util$9.ByteStringBuffer.prototype.length=function(){return this.data.length-this.read},util$9.ByteStringBuffer.prototype.isEmpty=function(){return this.length()<=0},util$9.ByteStringBuffer.prototype.putByte=function(e){return this.putBytes(String.fromCharCode(e))},util$9.ByteStringBuffer.prototype.fillWithByte=function(e,t){e=String.fromCharCode(e);for(var r=this.data;t>0;)1&t&&(r+=e),(t>>>=1)>0&&(e+=e);return this.data=r,this._optimizeConstructedString(t),this},util$9.ByteStringBuffer.prototype.putBytes=function(e){return this.data+=e,this._optimizeConstructedString(e.length),this},util$9.ByteStringBuffer.prototype.putString=function(e){return this.putBytes(util$9.encodeUtf8(e))},util$9.ByteStringBuffer.prototype.putInt16=function(e){return this.putBytes(String.fromCharCode(e>>8&255)+String.fromCharCode(255&e))},util$9.ByteStringBuffer.prototype.putInt24=function(e){return this.putBytes(String.fromCharCode(e>>16&255)+String.fromCharCode(e>>8&255)+String.fromCharCode(255&e))},util$9.ByteStringBuffer.prototype.putInt32=function(e){return this.putBytes(String.fromCharCode(e>>24&255)+String.fromCharCode(e>>16&255)+String.fromCharCode(e>>8&255)+String.fromCharCode(255&e))},util$9.ByteStringBuffer.prototype.putInt16Le=function(e){return this.putBytes(String.fromCharCode(255&e)+String.fromCharCode(e>>8&255))},util$9.ByteStringBuffer.prototype.putInt24Le=function(e){return this.putBytes(String.fromCharCode(255&e)+String.fromCharCode(e>>8&255)+String.fromCharCode(e>>16&255))},util$9.ByteStringBuffer.prototype.putInt32Le=function(e){return this.putBytes(String.fromCharCode(255&e)+String.fromCharCode(e>>8&255)+String.fromCharCode(e>>16&255)+String.fromCharCode(e>>24&255))},util$9.ByteStringBuffer.prototype.putInt=function(e,t){_checkBitsParam(t);var r="";do{t-=8,r+=String.fromCharCode(e>>t&255)}while(t>0);return this.putBytes(r)},util$9.ByteStringBuffer.prototype.putSignedInt=function(e,t){return e<0&&(e+=2<<t-1),this.putInt(e,t)},util$9.ByteStringBuffer.prototype.putBuffer=function(e){return this.putBytes(e.getBytes())},util$9.ByteStringBuffer.prototype.getByte=function(){return this.data.charCodeAt(this.read++)},util$9.ByteStringBuffer.prototype.getInt16=function(){var e=this.data.charCodeAt(this.read)<<8^this.data.charCodeAt(this.read+1);return this.read+=2,e},util$9.ByteStringBuffer.prototype.getInt24=function(){var e=this.data.charCodeAt(this.read)<<16^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2);return this.read+=3,e},util$9.ByteStringBuffer.prototype.getInt32=function(){var e=this.data.charCodeAt(this.read)<<24^this.data.charCodeAt(this.read+1)<<16^this.data.charCodeAt(this.read+2)<<8^this.data.charCodeAt(this.read+3);return this.read+=4,e},util$9.ByteStringBuffer.prototype.getInt16Le=function(){var e=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8;return this.read+=2,e},util$9.ByteStringBuffer.prototype.getInt24Le=function(){var e=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16;return this.read+=3,e},util$9.ByteStringBuffer.prototype.getInt32Le=function(){var e=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16^this.data.charCodeAt(this.read+3)<<24;return this.read+=4,e},util$9.ByteStringBuffer.prototype.getInt=function(e){_checkBitsParam(e);var t=0;do{t=(t<<8)+this.data.charCodeAt(this.read++),e-=8}while(e>0);return t},util$9.ByteStringBuffer.prototype.getSignedInt=function(e){var t=this.getInt(e),r=2<<e-2;return t>=r&&(t-=r<<1),t},util$9.ByteStringBuffer.prototype.getBytes=function(e){var t;return e?(e=Math.min(this.length(),e),t=this.data.slice(this.read,this.read+e),this.read+=e):0===e?t="":(t=0===this.read?this.data:this.data.slice(this.read),this.clear()),t},util$9.ByteStringBuffer.prototype.bytes=function(e){return void 0===e?this.data.slice(this.read):this.data.slice(this.read,this.read+e)},util$9.ByteStringBuffer.prototype.at=function(e){return this.data.charCodeAt(this.read+e)},util$9.ByteStringBuffer.prototype.setAt=function(e,t){return this.data=this.data.substr(0,this.read+e)+String.fromCharCode(t)+this.data.substr(this.read+e+1),this},util$9.ByteStringBuffer.prototype.last=function(){return this.data.charCodeAt(this.data.length-1)},util$9.ByteStringBuffer.prototype.copy=function(){var e=util$9.createBuffer(this.data);return e.read=this.read,e},util$9.ByteStringBuffer.prototype.compact=function(){return this.read>0&&(this.data=this.data.slice(this.read),this.read=0),this},util$9.ByteStringBuffer.prototype.clear=function(){return this.data="",this.read=0,this},util$9.ByteStringBuffer.prototype.truncate=function(e){var t=Math.max(0,this.length()-e);return this.data=this.data.substr(this.read,t),this.read=0,this},util$9.ByteStringBuffer.prototype.toHex=function(){for(var e="",t=this.read;t<this.data.length;++t){var r=this.data.charCodeAt(t);r<16&&(e+="0"),e+=r.toString(16)}return e},util$9.ByteStringBuffer.prototype.toString=function(){return util$9.decodeUtf8(this.bytes())},util$9.DataBuffer=DataBuffer,util$9.DataBuffer.prototype.length=function(){return this.write-this.read},util$9.DataBuffer.prototype.isEmpty=function(){return this.length()<=0},util$9.DataBuffer.prototype.accommodate=function(e,t){if(this.length()>=e)return this;t=Math.max(t||this.growSize,e);var r=new Uint8Array(this.data.buffer,this.data.byteOffset,this.data.byteLength),n=new Uint8Array(this.length()+t);return n.set(r),this.data=new DataView(n.buffer),this},util$9.DataBuffer.prototype.putByte=function(e){return this.accommodate(1),this.data.setUint8(this.write++,e),this},util$9.DataBuffer.prototype.fillWithByte=function(e,t){this.accommodate(t);for(var r=0;r<t;++r)this.data.setUint8(e);return this},util$9.DataBuffer.prototype.putBytes=function(e,t){if(util$9.isArrayBufferView(e)){var r=(n=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)).byteLength-n.byteOffset;return this.accommodate(r),new Uint8Array(this.data.buffer,this.write).set(n),this.write+=r,this}if(util$9.isArrayBuffer(e)){var n=new Uint8Array(e);return this.accommodate(n.byteLength),new Uint8Array(this.data.buffer).set(n,this.write),this.write+=n.byteLength,this}if(e instanceof util$9.DataBuffer||"object"==typeof e&&"number"==typeof e.read&&"number"==typeof e.write&&util$9.isArrayBufferView(e.data)){n=new Uint8Array(e.data.byteLength,e.read,e.length());return this.accommodate(n.byteLength),new Uint8Array(e.data.byteLength,this.write).set(n),this.write+=n.byteLength,this}if(e instanceof util$9.ByteStringBuffer&&(e=e.data,t="binary"),t=t||"binary","string"==typeof e){var i;if("hex"===t)return this.accommodate(Math.ceil(e.length/2)),i=new Uint8Array(this.data.buffer,this.write),this.write+=util$9.binary.hex.decode(e,i,this.write),this;if("base64"===t)return this.accommodate(3*Math.ceil(e.length/4)),i=new Uint8Array(this.data.buffer,this.write),this.write+=util$9.binary.base64.decode(e,i,this.write),this;if("utf8"===t&&(e=util$9.encodeUtf8(e),t="binary"),"binary"===t||"raw"===t)return this.accommodate(e.length),i=new Uint8Array(this.data.buffer,this.write),this.write+=util$9.binary.raw.decode(i),this;if("utf16"===t)return this.accommodate(2*e.length),i=new Uint16Array(this.data.buffer,this.write),this.write+=util$9.text.utf16.encode(i),this;throw new Error("Invalid encoding: "+t)}throw Error("Invalid parameter: "+e)},util$9.DataBuffer.prototype.putBuffer=function(e){return this.putBytes(e),e.clear(),this},util$9.DataBuffer.prototype.putString=function(e){return this.putBytes(e,"utf16")},util$9.DataBuffer.prototype.putInt16=function(e){return this.accommodate(2),this.data.setInt16(this.write,e),this.write+=2,this},util$9.DataBuffer.prototype.putInt24=function(e){return this.accommodate(3),this.data.setInt16(this.write,e>>8&65535),this.data.setInt8(this.write,e>>16&255),this.write+=3,this},util$9.DataBuffer.prototype.putInt32=function(e){return this.accommodate(4),this.data.setInt32(this.write,e),this.write+=4,this},util$9.DataBuffer.prototype.putInt16Le=function(e){return this.accommodate(2),this.data.setInt16(this.write,e,!0),this.write+=2,this},util$9.DataBuffer.prototype.putInt24Le=function(e){return this.accommodate(3),this.data.setInt8(this.write,e>>16&255),this.data.setInt16(this.write,e>>8&65535,!0),this.write+=3,this},util$9.DataBuffer.prototype.putInt32Le=function(e){return this.accommodate(4),this.data.setInt32(this.write,e,!0),this.write+=4,this},util$9.DataBuffer.prototype.putInt=function(e,t){_checkBitsParam(t),this.accommodate(t/8);do{t-=8,this.data.setInt8(this.write++,e>>t&255)}while(t>0);return this},util$9.DataBuffer.prototype.putSignedInt=function(e,t){return _checkBitsParam(t),this.accommodate(t/8),e<0&&(e+=2<<t-1),this.putInt(e,t)},util$9.DataBuffer.prototype.getByte=function(){return this.data.getInt8(this.read++)},util$9.DataBuffer.prototype.getInt16=function(){var e=this.data.getInt16(this.read);return this.read+=2,e},util$9.DataBuffer.prototype.getInt24=function(){var e=this.data.getInt16(this.read)<<8^this.data.getInt8(this.read+2);return this.read+=3,e},util$9.DataBuffer.prototype.getInt32=function(){var e=this.data.getInt32(this.read);return this.read+=4,e},util$9.DataBuffer.prototype.getInt16Le=function(){var e=this.data.getInt16(this.read,!0);return this.read+=2,e},util$9.DataBuffer.prototype.getInt24Le=function(){var e=this.data.getInt8(this.read)^this.data.getInt16(this.read+1,!0)<<8;return this.read+=3,e},util$9.DataBuffer.prototype.getInt32Le=function(){var e=this.data.getInt32(this.read,!0);return this.read+=4,e},util$9.DataBuffer.prototype.getInt=function(e){_checkBitsParam(e);var t=0;do{t=(t<<8)+this.data.getInt8(this.read++),e-=8}while(e>0);return t},util$9.DataBuffer.prototype.getSignedInt=function(e){var t=this.getInt(e),r=2<<e-2;return t>=r&&(t-=r<<1),t},util$9.DataBuffer.prototype.getBytes=function(e){var t;return e?(e=Math.min(this.length(),e),t=this.data.slice(this.read,this.read+e),this.read+=e):0===e?t="":(t=0===this.read?this.data:this.data.slice(this.read),this.clear()),t},util$9.DataBuffer.prototype.bytes=function(e){return void 0===e?this.data.slice(this.read):this.data.slice(this.read,this.read+e)},util$9.DataBuffer.prototype.at=function(e){return this.data.getUint8(this.read+e)},util$9.DataBuffer.prototype.setAt=function(e,t){return this.data.setUint8(e,t),this},util$9.DataBuffer.prototype.last=function(){return this.data.getUint8(this.write-1)},util$9.DataBuffer.prototype.copy=function(){return new util$9.DataBuffer(this)},util$9.DataBuffer.prototype.compact=function(){if(this.read>0){var e=new Uint8Array(this.data.buffer,this.read),t=new Uint8Array(e.byteLength);t.set(e),this.data=new DataView(t),this.write-=this.read,this.read=0}return this},util$9.DataBuffer.prototype.clear=function(){return this.data=new DataView(new ArrayBuffer(0)),this.read=this.write=0,this},util$9.DataBuffer.prototype.truncate=function(e){return this.write=Math.max(0,this.length()-e),this.read=Math.min(this.read,this.write),this},util$9.DataBuffer.prototype.toHex=function(){for(var e="",t=this.read;t<this.data.byteLength;++t){var r=this.data.getUint8(t);r<16&&(e+="0"),e+=r.toString(16)}return e},util$9.DataBuffer.prototype.toString=function(e){var t=new Uint8Array(this.data,this.read,this.length());if("binary"===(e=e||"utf8")||"raw"===e)return util$9.binary.raw.encode(t);if("hex"===e)return util$9.binary.hex.encode(t);if("base64"===e)return util$9.binary.base64.encode(t);if("utf8"===e)return util$9.text.utf8.decode(t);if("utf16"===e)return util$9.text.utf16.decode(t);throw new Error("Invalid encoding: "+e)},util$9.createBuffer=function(e,t){return t=t||"raw",void 0!==e&&"utf8"===t&&(e=util$9.encodeUtf8(e)),new util$9.ByteBuffer(e)},util$9.fillString=function(e,t){for(var r="";t>0;)1&t&&(r+=e),(t>>>=1)>0&&(e+=e);return r},util$9.xorBytes=function(e,t,r){for(var n="",i="",s="",o=0,a=0;r>0;--r,++o)i=e.charCodeAt(o)^t.charCodeAt(o),a>=10&&(n+=s,s="",a=0),s+=String.fromCharCode(i),++a;return n+=s},util$9.hexToBytes=function(e){var t="",r=0;for(!0&e.length&&(r=1,t+=String.fromCharCode(parseInt(e[0],16)));r<e.length;r+=2)t+=String.fromCharCode(parseInt(e.substr(r,2),16));return t},util$9.bytesToHex=function(e){return util$9.createBuffer(e).toHex()},util$9.int32ToBytes=function(e){return String.fromCharCode(e>>24&255)+String.fromCharCode(e>>16&255)+String.fromCharCode(e>>8&255)+String.fromCharCode(255&e)};var _base64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_base64Idx=[62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,64,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],_base58="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";util$9.encode64=function(e,t){for(var r,n,i,s="",o="",a=0;a<e.length;)r=e.charCodeAt(a++),n=e.charCodeAt(a++),i=e.charCodeAt(a++),s+=_base64.charAt(r>>2),s+=_base64.charAt((3&r)<<4|n>>4),isNaN(n)?s+="==":(s+=_base64.charAt((15&n)<<2|i>>6),s+=isNaN(i)?"=":_base64.charAt(63&i)),t&&s.length>t&&(o+=s.substr(0,t)+"\r\n",s=s.substr(t));return o+=s},util$9.decode64=function(e){e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(var t,r,n,i,s="",o=0;o<e.length;)t=_base64Idx[e.charCodeAt(o++)-43],r=_base64Idx[e.charCodeAt(o++)-43],n=_base64Idx[e.charCodeAt(o++)-43],i=_base64Idx[e.charCodeAt(o++)-43],s+=String.fromCharCode(t<<2|r>>4),64!==n&&(s+=String.fromCharCode((15&r)<<4|n>>2),64!==i&&(s+=String.fromCharCode((3&n)<<6|i)));return s},util$9.encodeUtf8=function(e){return unescape(encodeURIComponent(e))},util$9.decodeUtf8=function(e){return decodeURIComponent(escape(e))},util$9.binary={raw:{},hex:{},base64:{},base58:{},baseN:{encode:baseN.encode,decode:baseN.decode}},util$9.binary.raw.encode=function(e){return String.fromCharCode.apply(null,e)},util$9.binary.raw.decode=function(e,t,r){var n=t;n||(n=new Uint8Array(e.length));for(var i=r=r||0,s=0;s<e.length;++s)n[i++]=e.charCodeAt(s);return t?i-r:n},util$9.binary.hex.encode=util$9.bytesToHex,util$9.binary.hex.decode=function(e,t,r){var n=t;n||(n=new Uint8Array(Math.ceil(e.length/2)));var i=0,s=r=r||0;for(1&e.length&&(i=1,n[s++]=parseInt(e[0],16));i<e.length;i+=2)n[s++]=parseInt(e.substr(i,2),16);return t?s-r:n},util$9.binary.base64.encode=function(e,t){for(var r,n,i,s="",o="",a=0;a<e.byteLength;)r=e[a++],n=e[a++],i=e[a++],s+=_base64.charAt(r>>2),s+=_base64.charAt((3&r)<<4|n>>4),isNaN(n)?s+="==":(s+=_base64.charAt((15&n)<<2|i>>6),s+=isNaN(i)?"=":_base64.charAt(63&i)),t&&s.length>t&&(o+=s.substr(0,t)+"\r\n",s=s.substr(t));return o+=s},util$9.binary.base64.decode=function(e,t,r){var n,i,s,o,a=t;a||(a=new Uint8Array(3*Math.ceil(e.length/4))),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(var u=0,c=r=r||0;u<e.length;)n=_base64Idx[e.charCodeAt(u++)-43],i=_base64Idx[e.charCodeAt(u++)-43],s=_base64Idx[e.charCodeAt(u++)-43],o=_base64Idx[e.charCodeAt(u++)-43],a[c++]=n<<2|i>>4,64!==s&&(a[c++]=(15&i)<<4|s>>2,64!==o&&(a[c++]=(3&s)<<6|o));return t?c-r:a.subarray(0,c)},util$9.binary.base58.encode=function(e,t){return util$9.binary.baseN.encode(e,_base58,t)},util$9.binary.base58.decode=function(e,t){return util$9.binary.baseN.decode(e,_base58,t)},util$9.text={utf8:{},utf16:{}},util$9.text.utf8.encode=function(e,t,r){e=util$9.encodeUtf8(e);var n=t;n||(n=new Uint8Array(e.length));for(var i=r=r||0,s=0;s<e.length;++s)n[i++]=e.charCodeAt(s);return t?i-r:n},util$9.text.utf8.decode=function(e){return util$9.decodeUtf8(String.fromCharCode.apply(null,e))},util$9.text.utf16.encode=function(e,t,r){var n=t;n||(n=new Uint8Array(2*e.length));for(var i=new Uint16Array(n.buffer),s=r=r||0,o=r,a=0;a<e.length;++a)i[o++]=e.charCodeAt(a),s+=2;return t?s-r:n},util$9.text.utf16.decode=function(e){return String.fromCharCode.apply(null,new Uint16Array(e.buffer))},util$9.deflate=function(e,t,r){if(t=util$9.decode64(e.deflate(util$9.encode64(t)).rval),r){var n=2;32&t.charCodeAt(1)&&(n=6),t=t.substring(n,t.length-4)}return t},util$9.inflate=function(e,t,r){var n=e.inflate(util$9.encode64(t)).rval;return null===n?null:util$9.decode64(n)};var _setStorageObject=function(e,t,r){if(!e)throw new Error("WebStorage not available.");var n;if(null===r?n=e.removeItem(t):(r=util$9.encode64(JSON.stringify(r)),n=e.setItem(t,r)),void 0!==n&&!0!==n.rval){var i=new Error(n.error.message);throw i.id=n.error.id,i.name=n.error.name,i}},_getStorageObject=function(e,t){if(!e)throw new Error("WebStorage not available.");var r=e.getItem(t);if(e.init)if(null===r.rval){if(r.error){var n=new Error(r.error.message);throw n.id=r.error.id,n.name=r.error.name,n}r=null}else r=r.rval;return null!==r&&(r=JSON.parse(util$9.decode64(r))),r},_setItem=function(e,t,r,n){var i=_getStorageObject(e,t);null===i&&(i={}),i[r]=n,_setStorageObject(e,t,i)},_getItem=function(e,t,r){var n=_getStorageObject(e,t);return null!==n&&(n=r in n?n[r]:null),n},_removeItem=function(e,t,r){var n=_getStorageObject(e,t);if(null!==n&&r in n){delete n[r];var i=!0;for(var s in n){i=!1;break}i&&(n=null),_setStorageObject(e,t,n)}},_clearItems=function(e,t){_setStorageObject(e,t,null)},_callStorageFunction=function(e,t,r){var n,i=null;void 0===r&&(r=["web","flash"]);var s=!1,o=null;for(var a in r){n=r[a];try{if("flash"===n||"both"===n){if(null===t[0])throw new Error("Flash local storage not available.");i=e.apply(this,t),s="flash"===n}"web"!==n&&"both"!==n||(t[0]=localStorage,i=e.apply(this,t),s=!0)}catch(e){o=e}if(s)break}if(!s)throw o;return i};util$9.setItem=function(e,t,r,n,i){_callStorageFunction(_setItem,arguments,i)},util$9.getItem=function(e,t,r,n){return _callStorageFunction(_getItem,arguments,n)},util$9.removeItem=function(e,t,r,n){_callStorageFunction(_removeItem,arguments,n)},util$9.clearItems=function(e,t,r){_callStorageFunction(_clearItems,arguments,r)},util$9.parseUrl=function(e){var t=/^(https?):\/\/([^:&^\/]*):?(\d*)(.*)$/g;t.lastIndex=0;var r=t.exec(e),n=null===r?null:{full:e,scheme:r[1],host:r[2],port:r[3],path:r[4]};return n&&(n.fullHost=n.host,n.port?(80!==n.port&&"http"===n.scheme||443!==n.port&&"https"===n.scheme)&&(n.fullHost+=":"+n.port):"http"===n.scheme?n.port=80:"https"===n.scheme&&(n.port=443),n.full=n.scheme+"://"+n.fullHost),n};var _queryVariables=null;util$9.getQueryVariables=function(e){var t,r=function(e){for(var t={},r=e.split("&"),n=0;n<r.length;n++){var i,s,o=r[n].indexOf("=");o>0?(i=r[n].substring(0,o),s=r[n].substring(o+1)):(i=r[n],s=null),i in t||(t[i]=[]),i in Object.prototype||null===s||t[i].push(unescape(s))}return t};return void 0===e?(null===_queryVariables&&(_queryVariables="undefined"!=typeof window&&window.location&&window.location.search?r(window.location.search.substring(1)):{}),t=_queryVariables):t=r(e),t},util$9.parseFragment=function(e){var t=e,r="",n=e.indexOf("?");n>0&&(t=e.substring(0,n),r=e.substring(n+1));var i=t.split("/");return i.length>0&&""===i[0]&&i.shift(),{pathString:t,queryString:r,path:i,query:""===r?{}:util$9.getQueryVariables(r)}},util$9.makeRequest=function(e){var t=util$9.parseFragment(e),r={path:t.pathString,query:t.queryString,getPath:function(e){return void 0===e?t.path:t.path[e]},getQuery:function(e,r){var n;return void 0===e?n=t.query:(n=t.query[e])&&void 0!==r&&(n=n[r]),n},getQueryLast:function(e,t){var n=r.getQuery(e);return n?n[n.length-1]:t}};return r},util$9.makeLink=function(e,t,r){e=jQuery.isArray(e)?e.join("/"):e;var n=jQuery.param(t||{});return r=r||"",e+(n.length>0?"?"+n:"")+(r.length>0?"#"+r:"")},util$9.isEmpty=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},util$9.format=function(e){for(var t,r,n=/%./g,i=0,s=[],o=0;t=n.exec(e);){(r=e.substring(o,n.lastIndex-2)).length>0&&s.push(r),o=n.lastIndex;var a=t[0][1];switch(a){case"s":case"o":i<arguments.length?s.push(arguments[1+i++]):s.push("<?>");break;case"%":s.push("%");break;default:s.push("<%"+a+"?>")}}return s.push(e.substring(o)),s.join("")},util$9.formatNumber=function(e,t,r,n){var i=e,s=isNaN(t=Math.abs(t))?2:t,o=void 0===r?",":r,a=void 0===n?".":n,u=i<0?"-":"",c=parseInt(i=Math.abs(+i||0).toFixed(s),10)+"",l=c.length>3?c.length%3:0;return u+(l?c.substr(0,l)+a:"")+c.substr(l).replace(/(\d{3})(?=\d)/g,"$1"+a)+(s?o+Math.abs(i-c).toFixed(s).slice(2):"")},util$9.formatSize=function(e){return e=e>=1073741824?util$9.formatNumber(e/1073741824,2,".","")+" GiB":e>=1048576?util$9.formatNumber(e/1048576,2,".","")+" MiB":e>=1024?util$9.formatNumber(e/1024,0)+" KiB":util$9.formatNumber(e,0)+" bytes"},util$9.bytesFromIP=function(e){return-1!==e.indexOf(".")?util$9.bytesFromIPv4(e):-1!==e.indexOf(":")?util$9.bytesFromIPv6(e):null},util$9.bytesFromIPv4=function(e){if(4!==(e=e.split(".")).length)return null;for(var t=util$9.createBuffer(),r=0;r<e.length;++r){var n=parseInt(e[r],10);if(isNaN(n))return null;t.putByte(n)}return t.getBytes()},util$9.bytesFromIPv6=function(e){for(var t=0,r=2*(8-(e=e.split(":").filter((function(e){return 0===e.length&&++t,!0}))).length+t),n=util$9.createBuffer(),i=0;i<8;++i)if(e[i]&&0!==e[i].length){var s=util$9.hexToBytes(e[i]);s.length<2&&n.putByte(0),n.putBytes(s)}else n.fillWithByte(0,r),r=0;return n.getBytes()},util$9.bytesToIP=function(e){return 4===e.length?util$9.bytesToIPv4(e):16===e.length?util$9.bytesToIPv6(e):null},util$9.bytesToIPv4=function(e){if(4!==e.length)return null;for(var t=[],r=0;r<e.length;++r)t.push(e.charCodeAt(r));return t.join(".")},util$9.bytesToIPv6=function(e){if(16!==e.length)return null;for(var t=[],r=[],n=0,i=0;i<e.length;i+=2){for(var s=util$9.bytesToHex(e[i]+e[i+1]);"0"===s[0]&&"0"!==s;)s=s.substr(1);if("0"===s){var o=r[r.length-1],a=t.length;o&&a===o.end+1?(o.end=a,o.end-o.start>r[n].end-r[n].start&&(n=r.length-1)):r.push({start:a,end:a})}t.push(s)}if(r.length>0){var u=r[n];u.end-u.start>0&&(t.splice(u.start,u.end-u.start+1,""),0===u.start&&t.unshift(""),7===u.end&&t.push(""))}return t.join(":")},util$9.estimateCores=function(e,t){if("function"==typeof e&&(t=e,e={}),e=e||{},"cores"in util$9&&!e.update)return t(null,util$9.cores);if("undefined"!=typeof navigator&&"hardwareConcurrency"in navigator&&navigator.hardwareConcurrency>0)return util$9.cores=navigator.hardwareConcurrency,t(null,util$9.cores);if("undefined"==typeof Worker)return util$9.cores=1,t(null,util$9.cores);if("undefined"==typeof Blob)return util$9.cores=2,t(null,util$9.cores);var r=URL.createObjectURL(new Blob(["(",function(){self.addEventListener("message",(function(e){var t=Date.now(),r=t+4;self.postMessage({st:t,et:r})}))}.toString(),")()"],{type:"application/javascript"}));!function e(n,i,s){if(0===i){var o=Math.floor(n.reduce((function(e,t){return e+t}),0)/n.length);return util$9.cores=Math.max(1,o),URL.revokeObjectURL(r),t(null,util$9.cores)}!function(e,t){for(var n=[],i=[],s=0;s<e;++s){var o=new Worker(r);o.addEventListener("message",(function(r){if(i.push(r.data),i.length===e){for(var s=0;s<e;++s)n[s].terminate();t(null,i)}})),n.push(o)}for(s=0;s<e;++s)n[s].postMessage(s)}(s,(function(t,r){n.push(function(e,t){for(var r=[],n=0;n<e;++n)for(var i=t[n],s=r[n]=[],o=0;o<e;++o)if(n!==o){var a=t[o];(i.st>a.st&&i.st<a.et||a.st>i.st&&a.st<i.et)&&s.push(o)}return r.reduce((function(e,t){return Math.max(e,t.length)}),0)}(s,r)),e(n,i-1,s)}))}([],5,16)};var util$a=Object.freeze({__proto__:null}),require$$1$6=getAugmentedNamespace(util$a),forge$V=forge$X;forge$V.pki=forge$V.pki||{};var oids$2=forge$V.pki.oids=forge$V.oids=forge$V.oids||{};function _IN(e,t){oids$2[e]=t,oids$2[t]=e}function _I_(e,t){oids$2[e]=t}_IN("1.2.840.113549.1.1.1","rsaEncryption"),_IN("1.2.840.113549.1.1.4","md5WithRSAEncryption"),_IN("1.2.840.113549.1.1.5","sha1WithRSAEncryption"),_IN("1.2.840.113549.1.1.7","RSAES-OAEP"),_IN("1.2.840.113549.1.1.8","mgf1"),_IN("1.2.840.113549.1.1.9","pSpecified"),_IN("1.2.840.113549.1.1.10","RSASSA-PSS"),_IN("1.2.840.113549.1.1.11","sha256WithRSAEncryption"),_IN("1.2.840.113549.1.1.12","sha384WithRSAEncryption"),_IN("1.2.840.113549.1.1.13","sha512WithRSAEncryption"),_IN("1.3.101.112","EdDSA25519"),_IN("1.2.840.10040.4.3","dsa-with-sha1"),_IN("1.3.14.3.2.7","desCBC"),_IN("1.3.14.3.2.26","sha1"),_IN("2.16.840.1.101.3.4.2.1","sha256"),_IN("2.16.840.1.101.3.4.2.2","sha384"),_IN("2.16.840.1.101.3.4.2.3","sha512"),_IN("1.2.840.113549.2.5","md5"),_IN("1.2.840.113549.1.7.1","data"),_IN("1.2.840.113549.1.7.2","signedData"),_IN("1.2.840.113549.1.7.3","envelopedData"),_IN("1.2.840.113549.1.7.4","signedAndEnvelopedData"),_IN("1.2.840.113549.1.7.5","digestedData"),_IN("1.2.840.113549.1.7.6","encryptedData"),_IN("1.2.840.113549.1.9.1","emailAddress"),_IN("1.2.840.113549.1.9.2","unstructuredName"),_IN("1.2.840.113549.1.9.3","contentType"),_IN("1.2.840.113549.1.9.4","messageDigest"),_IN("1.2.840.113549.1.9.5","signingTime"),_IN("1.2.840.113549.1.9.6","counterSignature"),_IN("1.2.840.113549.1.9.7","challengePassword"),_IN("1.2.840.113549.1.9.8","unstructuredAddress"),_IN("1.2.840.113549.1.9.14","extensionRequest"),_IN("1.2.840.113549.1.9.20","friendlyName"),_IN("1.2.840.113549.1.9.21","localKeyId"),_IN("1.2.840.113549.1.9.22.1","x509Certificate"),_IN("1.2.840.113549.1.12.10.1.1","keyBag"),_IN("1.2.840.113549.1.12.10.1.2","pkcs8ShroudedKeyBag"),_IN("1.2.840.113549.1.12.10.1.3","certBag"),_IN("1.2.840.113549.1.12.10.1.4","crlBag"),_IN("1.2.840.113549.1.12.10.1.5","secretBag"),_IN("1.2.840.113549.1.12.10.1.6","safeContentsBag"),_IN("1.2.840.113549.1.5.13","pkcs5PBES2"),_IN("1.2.840.113549.1.5.12","pkcs5PBKDF2"),_IN("1.2.840.113549.1.12.1.1","pbeWithSHAAnd128BitRC4"),_IN("1.2.840.113549.1.12.1.2","pbeWithSHAAnd40BitRC4"),_IN("1.2.840.113549.1.12.1.3","pbeWithSHAAnd3-KeyTripleDES-CBC"),_IN("1.2.840.113549.1.12.1.4","pbeWithSHAAnd2-KeyTripleDES-CBC"),_IN("1.2.840.113549.1.12.1.5","pbeWithSHAAnd128BitRC2-CBC"),_IN("1.2.840.113549.1.12.1.6","pbewithSHAAnd40BitRC2-CBC"),_IN("1.2.840.113549.2.7","hmacWithSHA1"),_IN("1.2.840.113549.2.8","hmacWithSHA224"),_IN("1.2.840.113549.2.9","hmacWithSHA256"),_IN("1.2.840.113549.2.10","hmacWithSHA384"),_IN("1.2.840.113549.2.11","hmacWithSHA512"),_IN("1.2.840.113549.3.7","des-EDE3-CBC"),_IN("2.16.840.1.101.3.4.1.2","aes128-CBC"),_IN("2.16.840.1.101.3.4.1.22","aes192-CBC"),_IN("2.16.840.1.101.3.4.1.42","aes256-CBC"),_IN("2.5.4.3","commonName"),_IN("2.5.4.5","serialName"),_IN("2.5.4.6","countryName"),_IN("2.5.4.7","localityName"),_IN("2.5.4.8","stateOrProvinceName"),_IN("2.5.4.9","streetAddress"),_IN("2.5.4.10","organizationName"),_IN("2.5.4.11","organizationalUnitName"),_IN("2.5.4.13","description"),_IN("2.5.4.15","businessCategory"),_IN("2.5.4.17","postalCode"),_IN("1.3.6.1.4.1.311.60.2.1.2","jurisdictionOfIncorporationStateOrProvinceName"),_IN("1.3.6.1.4.1.311.60.2.1.3","jurisdictionOfIncorporationCountryName"),_IN("2.16.840.1.113730.1.1","nsCertType"),_IN("2.16.840.1.113730.1.13","nsComment"),_I_("2.5.29.1","authorityKeyIdentifier"),_I_("2.5.29.2","keyAttributes"),_I_("2.5.29.3","certificatePolicies"),_I_("2.5.29.4","keyUsageRestriction"),_I_("2.5.29.5","policyMapping"),_I_("2.5.29.6","subtreesConstraint"),_I_("2.5.29.7","subjectAltName"),_I_("2.5.29.8","issuerAltName"),_I_("2.5.29.9","subjectDirectoryAttributes"),_I_("2.5.29.10","basicConstraints"),_I_("2.5.29.11","nameConstraints"),_I_("2.5.29.12","policyConstraints"),_I_("2.5.29.13","basicConstraints"),_IN("2.5.29.14","subjectKeyIdentifier"),_IN("2.5.29.15","keyUsage"),_I_("2.5.29.16","privateKeyUsagePeriod"),_IN("2.5.29.17","subjectAltName"),_IN("2.5.29.18","issuerAltName"),_IN("2.5.29.19","basicConstraints"),_I_("2.5.29.20","cRLNumber"),_I_("2.5.29.21","cRLReason"),_I_("2.5.29.22","expirationDate"),_I_("2.5.29.23","instructionCode"),_I_("2.5.29.24","invalidityDate"),_I_("2.5.29.25","cRLDistributionPoints"),_I_("2.5.29.26","issuingDistributionPoint"),_I_("2.5.29.27","deltaCRLIndicator"),_I_("2.5.29.28","issuingDistributionPoint"),_I_("2.5.29.29","certificateIssuer"),_I_("2.5.29.30","nameConstraints"),_IN("2.5.29.31","cRLDistributionPoints"),_IN("2.5.29.32","certificatePolicies"),_I_("2.5.29.33","policyMappings"),_I_("2.5.29.34","policyConstraints"),_IN("2.5.29.35","authorityKeyIdentifier"),_I_("2.5.29.36","policyConstraints"),_IN("2.5.29.37","extKeyUsage"),_I_("2.5.29.46","freshestCRL"),_I_("2.5.29.54","inhibitAnyPolicy"),_IN("1.3.6.1.4.1.11129.2.4.2","timestampList"),_IN("1.3.6.1.5.5.7.1.1","authorityInfoAccess"),_IN("1.3.6.1.5.5.7.3.1","serverAuth"),_IN("1.3.6.1.5.5.7.3.2","clientAuth"),_IN("1.3.6.1.5.5.7.3.3","codeSigning"),_IN("1.3.6.1.5.5.7.3.4","emailProtection"),_IN("1.3.6.1.5.5.7.3.8","timeStamping");var forge$U=forge$X,asn1$6=forge$U.asn1=forge$U.asn1||{};function _checkBufferLength(e,t,r){if(r>t){var n=new Error("Too few bytes to parse DER.");throw n.available=e.length(),n.remaining=t,n.requested=r,n}}asn1$6.Class={UNIVERSAL:0,APPLICATION:64,CONTEXT_SPECIFIC:128,PRIVATE:192},asn1$6.Type={NONE:0,BOOLEAN:1,INTEGER:2,BITSTRING:3,OCTETSTRING:4,NULL:5,OID:6,ODESC:7,EXTERNAL:8,REAL:9,ENUMERATED:10,EMBEDDED:11,UTF8:12,ROID:13,SEQUENCE:16,SET:17,PRINTABLESTRING:19,IA5STRING:22,UTCTIME:23,GENERALIZEDTIME:24,BMPSTRING:30},asn1$6.create=function(e,t,r,n,i){if(forge$U.util.isArray(n)){for(var s=[],o=0;o<n.length;++o)void 0!==n[o]&&s.push(n[o]);n=s}var a={tagClass:e,type:t,constructed:r,composed:r||forge$U.util.isArray(n),value:n};return i&&"bitStringContents"in i&&(a.bitStringContents=i.bitStringContents,a.original=asn1$6.copy(a)),a},asn1$6.copy=function(e,t){var r;if(forge$U.util.isArray(e)){r=[];for(var n=0;n<e.length;++n)r.push(asn1$6.copy(e[n],t));return r}return"string"==typeof e?e:(r={tagClass:e.tagClass,type:e.type,constructed:e.constructed,composed:e.composed,value:asn1$6.copy(e.value,t)},t&&!t.excludeBitStringContents&&(r.bitStringContents=e.bitStringContents),r)},asn1$6.equals=function(e,t,r){if(forge$U.util.isArray(e)){if(!forge$U.util.isArray(t))return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;++n)if(!asn1$6.equals(e[n],t[n]))return!1;return!0}if(typeof e!=typeof t)return!1;if("string"==typeof e)return e===t;var i=e.tagClass===t.tagClass&&e.type===t.type&&e.constructed===t.constructed&&e.composed===t.composed&&asn1$6.equals(e.value,t.value);return r&&r.includeBitStringContents&&(i=i&&e.bitStringContents===t.bitStringContents),i},asn1$6.getBerValueLength=function(e){var t=e.getByte();if(128!==t)return 128&t?e.getInt((127&t)<<3):t};var _getValueLength=function(e,t){var r=e.getByte();if(t--,128!==r){var n;if(128&r){var i=127&r;_checkBufferLength(e,t,i),n=e.getInt(i<<3)}else n=r;if(n<0)throw new Error("Negative length: "+n);return n}};function _fromDer(e,t,r,n){var i;_checkBufferLength(e,t,2);var s=e.getByte();t--;var o=192&s,a=31&s;i=e.length();var u,c,l=_getValueLength(e,t);if(t-=i-e.length(),void 0!==l&&l>t){if(n.strict){var h=new Error("Too few bytes to read ASN.1 value.");throw h.available=e.length(),h.remaining=t,h.requested=l,h}l=t}var d=32==(32&s);if(d)if(u=[],void 0===l)for(;;){if(_checkBufferLength(e,t,2),e.bytes(2)===String.fromCharCode(0,0)){e.getBytes(2),t-=2;break}i=e.length(),u.push(_fromDer(e,t,r+1,n)),t-=i-e.length()}else for(;l>0;)i=e.length(),u.push(_fromDer(e,l,r+1,n)),t-=i-e.length(),l-=i-e.length();if(void 0===u&&o===asn1$6.Class.UNIVERSAL&&a===asn1$6.Type.BITSTRING&&(c=e.bytes(l)),void 0===u&&n.decodeBitStrings&&o===asn1$6.Class.UNIVERSAL&&a===asn1$6.Type.BITSTRING&&l>1){var f=e.read,p=t,y=0;if(a===asn1$6.Type.BITSTRING&&(_checkBufferLength(e,t,1),y=e.getByte(),t--),0===y)try{i=e.length();var g=_fromDer(e,t,r+1,{verbose:n.verbose,strict:!0,decodeBitStrings:!0}),$=i-e.length();t-=$,a==asn1$6.Type.BITSTRING&&$++;var m=g.tagClass;$!==l||m!==asn1$6.Class.UNIVERSAL&&m!==asn1$6.Class.CONTEXT_SPECIFIC||(u=[g])}catch(e){}void 0===u&&(e.read=f,t=p)}if(void 0===u){if(void 0===l){if(n.strict)throw new Error("Non-constructed ASN.1 object of indefinite length.");l=t}if(a===asn1$6.Type.BMPSTRING)for(u="";l>0;l-=2)_checkBufferLength(e,t,2),u+=String.fromCharCode(e.getInt16()),t-=2;else u=e.getBytes(l)}var b=void 0===c?null:{bitStringContents:c};return asn1$6.create(o,a,d,u,b)}asn1$6.fromDer=function(e,t){return void 0===t&&(t={strict:!0,decodeBitStrings:!0}),"boolean"==typeof t&&(t={strict:t,decodeBitStrings:!0}),"strict"in t||(t.strict=!0),"decodeBitStrings"in t||(t.decodeBitStrings=!0),"string"==typeof e&&(e=forge$U.util.createBuffer(e)),_fromDer(e,e.length(),0,t)},asn1$6.toDer=function(e){var t=forge$U.util.createBuffer(),r=e.tagClass|e.type,n=forge$U.util.createBuffer(),i=!1;if("bitStringContents"in e&&(i=!0,e.original&&(i=asn1$6.equals(e,e.original))),i)n.putBytes(e.bitStringContents);else if(e.composed){e.constructed?r|=32:n.putByte(0);for(var s=0;s<e.value.length;++s)void 0!==e.value[s]&&n.putBuffer(asn1$6.toDer(e.value[s]))}else if(e.type===asn1$6.Type.BMPSTRING)for(s=0;s<e.value.length;++s)n.putInt16(e.value.charCodeAt(s));else e.type===asn1$6.Type.INTEGER&&e.value.length>1&&(0===e.value.charCodeAt(0)&&0==(128&e.value.charCodeAt(1))||255===e.value.charCodeAt(0)&&128==(128&e.value.charCodeAt(1)))?n.putBytes(e.value.substr(1)):n.putBytes(e.value);if(t.putByte(r),n.length()<=127)t.putByte(127&n.length());else{var o=n.length(),a="";do{a+=String.fromCharCode(255&o),o>>>=8}while(o>0);t.putByte(128|a.length);for(s=a.length-1;s>=0;--s)t.putByte(a.charCodeAt(s))}return t.putBuffer(n),t},asn1$6.oidToDer=function(e){var t,r,n,i,s=e.split("."),o=forge$U.util.createBuffer();o.putByte(40*parseInt(s[0],10)+parseInt(s[1],10));for(var a=2;a<s.length;++a){t=!0,r=[],n=parseInt(s[a],10);do{i=127&n,n>>>=7,t||(i|=128),r.push(i),t=!1}while(n>0);for(var u=r.length-1;u>=0;--u)o.putByte(r[u])}return o},asn1$6.derToOid=function(e){var t;"string"==typeof e&&(e=forge$U.util.createBuffer(e));var r=e.getByte();t=Math.floor(r/40)+"."+r%40;for(var n=0;e.length()>0;)n<<=7,128&(r=e.getByte())?n+=127&r:(t+="."+(n+r),n=0);return t},asn1$6.utcTimeToDate=function(e){var t=new Date,r=parseInt(e.substr(0,2),10);r=r>=50?1900+r:2e3+r;var n=parseInt(e.substr(2,2),10)-1,i=parseInt(e.substr(4,2),10),s=parseInt(e.substr(6,2),10),o=parseInt(e.substr(8,2),10),a=0;if(e.length>11){var u=e.charAt(10),c=10;"+"!==u&&"-"!==u&&(a=parseInt(e.substr(10,2),10),c+=2)}if(t.setUTCFullYear(r,n,i),t.setUTCHours(s,o,a,0),c&&("+"===(u=e.charAt(c))||"-"===u)){var l=60*parseInt(e.substr(c+1,2),10)+parseInt(e.substr(c+4,2),10);l*=6e4,"+"===u?t.setTime(+t-l):t.setTime(+t+l)}return t},asn1$6.generalizedTimeToDate=function(e){var t=new Date,r=parseInt(e.substr(0,4),10),n=parseInt(e.substr(4,2),10)-1,i=parseInt(e.substr(6,2),10),s=parseInt(e.substr(8,2),10),o=parseInt(e.substr(10,2),10),a=parseInt(e.substr(12,2),10),u=0,c=0,l=!1;"Z"===e.charAt(e.length-1)&&(l=!0);var h=e.length-5,d=e.charAt(h);"+"!==d&&"-"!==d||(c=60*parseInt(e.substr(h+1,2),10)+parseInt(e.substr(h+4,2),10),c*=6e4,"+"===d&&(c*=-1),l=!0);return"."===e.charAt(14)&&(u=1e3*parseFloat(e.substr(14),10)),l?(t.setUTCFullYear(r,n,i),t.setUTCHours(s,o,a,u),t.setTime(+t+c)):(t.setFullYear(r,n,i),t.setHours(s,o,a,u)),t},asn1$6.dateToUtcTime=function(e){if("string"==typeof e)return e;var t="",r=[];r.push((""+e.getUTCFullYear()).substr(2)),r.push(""+(e.getUTCMonth()+1)),r.push(""+e.getUTCDate()),r.push(""+e.getUTCHours()),r.push(""+e.getUTCMinutes()),r.push(""+e.getUTCSeconds());for(var n=0;n<r.length;++n)r[n].length<2&&(t+="0"),t+=r[n];return t+="Z"},asn1$6.dateToGeneralizedTime=function(e){if("string"==typeof e)return e;var t="",r=[];r.push(""+e.getUTCFullYear()),r.push(""+(e.getUTCMonth()+1)),r.push(""+e.getUTCDate()),r.push(""+e.getUTCHours()),r.push(""+e.getUTCMinutes()),r.push(""+e.getUTCSeconds());for(var n=0;n<r.length;++n)r[n].length<2&&(t+="0"),t+=r[n];return t+="Z"},asn1$6.integerToDer=function(e){var t=forge$U.util.createBuffer();if(e>=-128&&e<128)return t.putSignedInt(e,8);if(e>=-32768&&e<32768)return t.putSignedInt(e,16);if(e>=-8388608&&e<8388608)return t.putSignedInt(e,24);if(e>=-2147483648&&e<2147483648)return t.putSignedInt(e,32);var r=new Error("Integer too large; max is 32-bits.");throw r.integer=e,r},asn1$6.derToInteger=function(e){"string"==typeof e&&(e=forge$U.util.createBuffer(e));var t=8*e.length();if(t>32)throw new Error("Integer too large; max is 32-bits.");return e.getSignedInt(t)},asn1$6.validate=function(e,t,r,n){var i=!1;if(e.tagClass!==t.tagClass&&void 0!==t.tagClass||e.type!==t.type&&void 0!==t.type)n&&(e.tagClass!==t.tagClass&&n.push("["+t.name+'] Expected tag class "'+t.tagClass+'", got "'+e.tagClass+'"'),e.type!==t.type&&n.push("["+t.name+'] Expected type "'+t.type+'", got "'+e.type+'"'));else if(e.constructed===t.constructed||void 0===t.constructed){if(i=!0,t.value&&forge$U.util.isArray(t.value))for(var s=0,o=0;i&&o<t.value.length;++o)i=t.value[o].optional||!1,e.value[s]&&((i=asn1$6.validate(e.value[s],t.value[o],r,n))?++s:t.value[o].optional&&(i=!0)),!i&&n&&n.push("["+t.name+'] Tag class "'+t.tagClass+'", type "'+t.type+'" expected value length "'+t.value.length+'", got "'+e.value.length+'"');if(i&&r&&(t.capture&&(r[t.capture]=e.value),t.captureAsn1&&(r[t.captureAsn1]=e),t.captureBitStringContents&&"bitStringContents"in e&&(r[t.captureBitStringContents]=e.bitStringContents),t.captureBitStringValue&&"bitStringContents"in e))if(e.bitStringContents.length<2)r[t.captureBitStringValue]="";else{if(0!==e.bitStringContents.charCodeAt(0))throw new Error("captureBitStringValue only supported for zero unused bits");r[t.captureBitStringValue]=e.bitStringContents.slice(1)}}else n&&n.push("["+t.name+'] Expected constructed "'+t.constructed+'", got "'+e.constructed+'"');return i};var _nonLatinRegex=/[^\\u0000-\\u00ff]/;asn1$6.prettyPrint=function(e,t,r){var n="";r=r||2,(t=t||0)>0&&(n+="\n");for(var i="",s=0;s<t*r;++s)i+=" ";switch(n+=i+"Tag: ",e.tagClass){case asn1$6.Class.UNIVERSAL:n+="Universal:";break;case asn1$6.Class.APPLICATION:n+="Application:";break;case asn1$6.Class.CONTEXT_SPECIFIC:n+="Context-Specific:";break;case asn1$6.Class.PRIVATE:n+="Private:"}if(e.tagClass===asn1$6.Class.UNIVERSAL)switch(n+=e.type,e.type){case asn1$6.Type.NONE:n+=" (None)";break;case asn1$6.Type.BOOLEAN:n+=" (Boolean)";break;case asn1$6.Type.INTEGER:n+=" (Integer)";break;case asn1$6.Type.BITSTRING:n+=" (Bit string)";break;case asn1$6.Type.OCTETSTRING:n+=" (Octet string)";break;case asn1$6.Type.NULL:n+=" (Null)";break;case asn1$6.Type.OID:n+=" (Object Identifier)";break;case asn1$6.Type.ODESC:n+=" (Object Descriptor)";break;case asn1$6.Type.EXTERNAL:n+=" (External or Instance of)";break;case asn1$6.Type.REAL:n+=" (Real)";break;case asn1$6.Type.ENUMERATED:n+=" (Enumerated)";break;case asn1$6.Type.EMBEDDED:n+=" (Embedded PDV)";break;case asn1$6.Type.UTF8:n+=" (UTF8)";break;case asn1$6.Type.ROID:n+=" (Relative Object Identifier)";break;case asn1$6.Type.SEQUENCE:n+=" (Sequence)";break;case asn1$6.Type.SET:n+=" (Set)";break;case asn1$6.Type.PRINTABLESTRING:n+=" (Printable String)";break;case asn1$6.Type.IA5String:n+=" (IA5String (ASCII))";break;case asn1$6.Type.UTCTIME:n+=" (UTC time)";break;case asn1$6.Type.GENERALIZEDTIME:n+=" (Generalized time)";break;case asn1$6.Type.BMPSTRING:n+=" (BMP String)"}else n+=e.type;if(n+="\n",n+=i+"Constructed: "+e.constructed+"\n",e.composed){var o=0,a="";for(s=0;s<e.value.length;++s)void 0!==e.value[s]&&(o+=1,a+=asn1$6.prettyPrint(e.value[s],t+1,r),s+1<e.value.length&&(a+=","));n+=i+"Sub values: "+o+a}else{if(n+=i+"Value: ",e.type===asn1$6.Type.OID){var u=asn1$6.derToOid(e.value);n+=u,forge$U.pki&&forge$U.pki.oids&&u in forge$U.pki.oids&&(n+=" ("+forge$U.pki.oids[u]+") ")}if(e.type===asn1$6.Type.INTEGER)try{n+=asn1$6.derToInteger(e.value)}catch(t){n+="0x"+forge$U.util.bytesToHex(e.value)}else if(e.type===asn1$6.Type.BITSTRING){if(e.value.length>1?n+="0x"+forge$U.util.bytesToHex(e.value.slice(1)):n+="(none)",e.value.length>0){var c=e.value.charCodeAt(0);1==c?n+=" (1 unused bit shown)":c>1&&(n+=" ("+c+" unused bits shown)")}}else e.type===asn1$6.Type.OCTETSTRING?(_nonLatinRegex.test(e.value)||(n+="("+e.value+") "),n+="0x"+forge$U.util.bytesToHex(e.value)):e.type===asn1$6.Type.UTF8?n+=forge$U.util.decodeUtf8(e.value):e.type===asn1$6.Type.PRINTABLESTRING||e.type===asn1$6.Type.IA5String?n+=e.value:_nonLatinRegex.test(e.value)?n+="0x"+forge$U.util.bytesToHex(e.value):0===e.value.length?n+="[null]":n+=e.value}return n};var forge$T=forge$X;forge$T.cipher=forge$T.cipher||{},forge$T.cipher.algorithms=forge$T.cipher.algorithms||{},forge$T.cipher.createCipher=function(e,t){var r=e;if("string"==typeof r&&(r=forge$T.cipher.getAlgorithm(r))&&(r=r()),!r)throw new Error("Unsupported algorithm: "+e);return new forge$T.cipher.BlockCipher({algorithm:r,key:t,decrypt:!1})},forge$T.cipher.createDecipher=function(e,t){var r=e;if("string"==typeof r&&(r=forge$T.cipher.getAlgorithm(r))&&(r=r()),!r)throw new Error("Unsupported algorithm: "+e);return new forge$T.cipher.BlockCipher({algorithm:r,key:t,decrypt:!0})},forge$T.cipher.registerAlgorithm=function(e,t){e=e.toUpperCase(),forge$T.cipher.algorithms[e]=t},forge$T.cipher.getAlgorithm=function(e){return(e=e.toUpperCase())in forge$T.cipher.algorithms?forge$T.cipher.algorithms[e]:null};var BlockCipher=forge$T.cipher.BlockCipher=function(e){this.algorithm=e.algorithm,this.mode=this.algorithm.mode,this.blockSize=this.mode.blockSize,this._finish=!1,this._input=null,this.output=null,this._op=e.decrypt?this.mode.decrypt:this.mode.encrypt,this._decrypt=e.decrypt,this.algorithm.initialize(e)};BlockCipher.prototype.start=function(e){e=e||{};var t={};for(var r in e)t[r]=e[r];t.decrypt=this._decrypt,this._finish=!1,this._input=forge$T.util.createBuffer(),this.output=e.output||forge$T.util.createBuffer(),this.mode.start(t)},BlockCipher.prototype.update=function(e){for(e&&this._input.putBuffer(e);!this._op.call(this.mode,this._input,this.output,this._finish)&&!this._finish;);this._input.compact()},BlockCipher.prototype.finish=function(e){!e||"ECB"!==this.mode.name&&"CBC"!==this.mode.name||(this.mode.pad=function(t){return e(this.blockSize,t,!1)},this.mode.unpad=function(t){return e(this.blockSize,t,!0)});var t={};return t.decrypt=this._decrypt,t.overflow=this._input.length()%this.blockSize,!(!this._decrypt&&this.mode.pad&&!this.mode.pad(this._input,t))&&(this._finish=!0,this.update(),!(this._decrypt&&this.mode.unpad&&!this.mode.unpad(this.output,t))&&!(this.mode.afterFinish&&!this.mode.afterFinish(this.output,t)))};var forge$S=forge$X;forge$S.cipher=forge$S.cipher||{};var modes=forge$S.cipher.modes=forge$S.cipher.modes||{};function transformIV(e,t){if("string"==typeof e&&(e=forge$S.util.createBuffer(e)),forge$S.util.isArray(e)&&e.length>4){var r=e;e=forge$S.util.createBuffer();for(var n=0;n<r.length;++n)e.putByte(r[n])}if(e.length()<t)throw new Error("Invalid IV length; got "+e.length()+" bytes and expected "+t+" bytes.");if(!forge$S.util.isArray(e)){var i=[],s=t/4;for(n=0;n<s;++n)i.push(e.getInt32());e=i}return e}function inc32(e){e[e.length-1]=e[e.length-1]+1&4294967295}function from64To32(e){return[e/4294967296|0,4294967295&e]}modes.ecb=function(e){e=e||{},this.name="ECB",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints)},modes.ecb.prototype.start=function(e){},modes.ecb.prototype.encrypt=function(e,t,r){if(e.length()<this.blockSize&&!(r&&e.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=e.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(n=0;n<this._ints;++n)t.putInt32(this._outBlock[n])},modes.ecb.prototype.decrypt=function(e,t,r){if(e.length()<this.blockSize&&!(r&&e.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=e.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(n=0;n<this._ints;++n)t.putInt32(this._outBlock[n])},modes.ecb.prototype.pad=function(e,t){var r=e.length()===this.blockSize?this.blockSize:this.blockSize-e.length();return e.fillWithByte(r,r),!0},modes.ecb.prototype.unpad=function(e,t){if(t.overflow>0)return!1;var r=e.length(),n=e.at(r-1);return!(n>this.blockSize<<2)&&(e.truncate(n),!0)},modes.cbc=function(e){e=e||{},this.name="CBC",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints)},modes.cbc.prototype.start=function(e){if(null===e.iv){if(!this._prev)throw new Error("Invalid IV parameter.");this._iv=this._prev.slice(0)}else{if(!("iv"in e))throw new Error("Invalid IV parameter.");this._iv=transformIV(e.iv,this.blockSize),this._prev=this._iv.slice(0)}},modes.cbc.prototype.encrypt=function(e,t,r){if(e.length()<this.blockSize&&!(r&&e.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=this._prev[n]^e.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(n=0;n<this._ints;++n)t.putInt32(this._outBlock[n]);this._prev=this._outBlock},modes.cbc.prototype.decrypt=function(e,t,r){if(e.length()<this.blockSize&&!(r&&e.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=e.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(n=0;n<this._ints;++n)t.putInt32(this._prev[n]^this._outBlock[n]);this._prev=this._inBlock.slice(0)},modes.cbc.prototype.pad=function(e,t){var r=e.length()===this.blockSize?this.blockSize:this.blockSize-e.length();return e.fillWithByte(r,r),!0},modes.cbc.prototype.unpad=function(e,t){if(t.overflow>0)return!1;var r=e.length(),n=e.at(r-1);return!(n>this.blockSize<<2)&&(e.truncate(n),!0)},modes.cfb=function(e){e=e||{},this.name="CFB",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialBlock=new Array(this._ints),this._partialOutput=forge$S.util.createBuffer(),this._partialBytes=0},modes.cfb.prototype.start=function(e){if(!("iv"in e))throw new Error("Invalid IV parameter.");this._iv=transformIV(e.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0},modes.cfb.prototype.encrypt=function(e,t,r){var n=e.length();if(0===n)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&n>=this.blockSize)for(var i=0;i<this._ints;++i)this._inBlock[i]=e.getInt32()^this._outBlock[i],t.putInt32(this._inBlock[i]);else{var s=(this.blockSize-n)%this.blockSize;s>0&&(s=this.blockSize-s),this._partialOutput.clear();for(i=0;i<this._ints;++i)this._partialBlock[i]=e.getInt32()^this._outBlock[i],this._partialOutput.putInt32(this._partialBlock[i]);if(s>0)e.read-=this.blockSize;else for(i=0;i<this._ints;++i)this._inBlock[i]=this._partialBlock[i];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),s>0&&!r)return t.putBytes(this._partialOutput.getBytes(s-this._partialBytes)),this._partialBytes=s,!0;t.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0}},modes.cfb.prototype.decrypt=function(e,t,r){var n=e.length();if(0===n)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&n>=this.blockSize)for(var i=0;i<this._ints;++i)this._inBlock[i]=e.getInt32(),t.putInt32(this._inBlock[i]^this._outBlock[i]);else{var s=(this.blockSize-n)%this.blockSize;s>0&&(s=this.blockSize-s),this._partialOutput.clear();for(i=0;i<this._ints;++i)this._partialBlock[i]=e.getInt32(),this._partialOutput.putInt32(this._partialBlock[i]^this._outBlock[i]);if(s>0)e.read-=this.blockSize;else for(i=0;i<this._ints;++i)this._inBlock[i]=this._partialBlock[i];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),s>0&&!r)return t.putBytes(this._partialOutput.getBytes(s-this._partialBytes)),this._partialBytes=s,!0;t.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0}},modes.ofb=function(e){e=e||{},this.name="OFB",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialOutput=forge$S.util.createBuffer(),this._partialBytes=0},modes.ofb.prototype.start=function(e){if(!("iv"in e))throw new Error("Invalid IV parameter.");this._iv=transformIV(e.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0},modes.ofb.prototype.encrypt=function(e,t,r){var n=e.length();if(0===e.length())return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&n>=this.blockSize)for(var i=0;i<this._ints;++i)t.putInt32(e.getInt32()^this._outBlock[i]),this._inBlock[i]=this._outBlock[i];else{var s=(this.blockSize-n)%this.blockSize;s>0&&(s=this.blockSize-s),this._partialOutput.clear();for(i=0;i<this._ints;++i)this._partialOutput.putInt32(e.getInt32()^this._outBlock[i]);if(s>0)e.read-=this.blockSize;else for(i=0;i<this._ints;++i)this._inBlock[i]=this._outBlock[i];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),s>0&&!r)return t.putBytes(this._partialOutput.getBytes(s-this._partialBytes)),this._partialBytes=s,!0;t.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0}},modes.ofb.prototype.decrypt=modes.ofb.prototype.encrypt,modes.ctr=function(e){e=e||{},this.name="CTR",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialOutput=forge$S.util.createBuffer(),this._partialBytes=0},modes.ctr.prototype.start=function(e){if(!("iv"in e))throw new Error("Invalid IV parameter.");this._iv=transformIV(e.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0},modes.ctr.prototype.encrypt=function(e,t,r){var n=e.length();if(0===n)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&n>=this.blockSize)for(var i=0;i<this._ints;++i)t.putInt32(e.getInt32()^this._outBlock[i]);else{var s=(this.blockSize-n)%this.blockSize;s>0&&(s=this.blockSize-s),this._partialOutput.clear();for(i=0;i<this._ints;++i)this._partialOutput.putInt32(e.getInt32()^this._outBlock[i]);if(s>0&&(e.read-=this.blockSize),this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),s>0&&!r)return t.putBytes(this._partialOutput.getBytes(s-this._partialBytes)),this._partialBytes=s,!0;t.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0}inc32(this._inBlock)},modes.ctr.prototype.decrypt=modes.ctr.prototype.encrypt,modes.gcm=function(e){e=e||{},this.name="GCM",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints),this._partialOutput=forge$S.util.createBuffer(),this._partialBytes=0,this._R=3774873600},modes.gcm.prototype.start=function(e){if(!("iv"in e))throw new Error("Invalid IV parameter.");var t,r=forge$S.util.createBuffer(e.iv);if(this._cipherLength=0,t="additionalData"in e?forge$S.util.createBuffer(e.additionalData):forge$S.util.createBuffer(),this._tagLength="tagLength"in e?e.tagLength:128,this._tag=null,e.decrypt&&(this._tag=forge$S.util.createBuffer(e.tag).getBytes(),this._tag.length!==this._tagLength/8))throw new Error("Authentication tag does not match tag length.");this._hashBlock=new Array(this._ints),this.tag=null,this._hashSubkey=new Array(this._ints),this.cipher.encrypt([0,0,0,0],this._hashSubkey),this.componentBits=4,this._m=this.generateHashTable(this._hashSubkey,this.componentBits);var n=r.length();if(12===n)this._j0=[r.getInt32(),r.getInt32(),r.getInt32(),1];else{for(this._j0=[0,0,0,0];r.length()>0;)this._j0=this.ghash(this._hashSubkey,this._j0,[r.getInt32(),r.getInt32(),r.getInt32(),r.getInt32()]);this._j0=this.ghash(this._hashSubkey,this._j0,[0,0].concat(from64To32(8*n)))}this._inBlock=this._j0.slice(0),inc32(this._inBlock),this._partialBytes=0,t=forge$S.util.createBuffer(t),this._aDataLength=from64To32(8*t.length());var i=t.length()%this.blockSize;for(i&&t.fillWithByte(0,this.blockSize-i),this._s=[0,0,0,0];t.length()>0;)this._s=this.ghash(this._hashSubkey,this._s,[t.getInt32(),t.getInt32(),t.getInt32(),t.getInt32()])},modes.gcm.prototype.encrypt=function(e,t,r){var n=e.length();if(0===n)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&n>=this.blockSize){for(var i=0;i<this._ints;++i)t.putInt32(this._outBlock[i]^=e.getInt32());this._cipherLength+=this.blockSize}else{var s=(this.blockSize-n)%this.blockSize;s>0&&(s=this.blockSize-s),this._partialOutput.clear();for(i=0;i<this._ints;++i)this._partialOutput.putInt32(e.getInt32()^this._outBlock[i]);if(s<=0||r){if(r){var o=n%this.blockSize;this._cipherLength+=o,this._partialOutput.truncate(this.blockSize-o)}else this._cipherLength+=this.blockSize;for(i=0;i<this._ints;++i)this._outBlock[i]=this._partialOutput.getInt32();this._partialOutput.read-=this.blockSize}if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),s>0&&!r)return e.read-=this.blockSize,t.putBytes(this._partialOutput.getBytes(s-this._partialBytes)),this._partialBytes=s,!0;t.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0}this._s=this.ghash(this._hashSubkey,this._s,this._outBlock),inc32(this._inBlock)},modes.gcm.prototype.decrypt=function(e,t,r){var n=e.length();if(n<this.blockSize&&!(r&&n>0))return!0;this.cipher.encrypt(this._inBlock,this._outBlock),inc32(this._inBlock),this._hashBlock[0]=e.getInt32(),this._hashBlock[1]=e.getInt32(),this._hashBlock[2]=e.getInt32(),this._hashBlock[3]=e.getInt32(),this._s=this.ghash(this._hashSubkey,this._s,this._hashBlock);for(var i=0;i<this._ints;++i)t.putInt32(this._outBlock[i]^this._hashBlock[i]);n<this.blockSize?this._cipherLength+=n%this.blockSize:this._cipherLength+=this.blockSize},modes.gcm.prototype.afterFinish=function(e,t){var r=!0;t.decrypt&&t.overflow&&e.truncate(this.blockSize-t.overflow),this.tag=forge$S.util.createBuffer();var n=this._aDataLength.concat(from64To32(8*this._cipherLength));this._s=this.ghash(this._hashSubkey,this._s,n);var i=[];this.cipher.encrypt(this._j0,i);for(var s=0;s<this._ints;++s)this.tag.putInt32(this._s[s]^i[s]);return this.tag.truncate(this.tag.length()%(this._tagLength/8)),t.decrypt&&this.tag.bytes()!==this._tag&&(r=!1),r},modes.gcm.prototype.multiply=function(e,t){for(var r=[0,0,0,0],n=t.slice(0),i=0;i<128;++i){e[i/32|0]&1<<31-i%32&&(r[0]^=n[0],r[1]^=n[1],r[2]^=n[2],r[3]^=n[3]),this.pow(n,n)}return r},modes.gcm.prototype.pow=function(e,t){for(var r=1&e[3],n=3;n>0;--n)t[n]=e[n]>>>1|(1&e[n-1])<<31;t[0]=e[0]>>>1,r&&(t[0]^=this._R)},modes.gcm.prototype.tableMultiply=function(e){for(var t=[0,0,0,0],r=0;r<32;++r){var n=e[r/8|0]>>>4*(7-r%8)&15,i=this._m[r][n];t[0]^=i[0],t[1]^=i[1],t[2]^=i[2],t[3]^=i[3]}return t},modes.gcm.prototype.ghash=function(e,t,r){return t[0]^=r[0],t[1]^=r[1],t[2]^=r[2],t[3]^=r[3],this.tableMultiply(t)},modes.gcm.prototype.generateHashTable=function(e,t){for(var r=8/t,n=4*r,i=16*r,s=new Array(i),o=0;o<i;++o){var a=[0,0,0,0],u=(n-1-o%n)*t;a[o/n|0]=1<<t-1<<u,s[o]=this.generateSubHashTable(this.multiply(a,e),t)}return s},modes.gcm.prototype.generateSubHashTable=function(e,t){var r=1<<t,n=r>>>1,i=new Array(r);i[n]=e.slice(0);for(var s=n>>>1;s>0;)this.pow(i[2*s],i[s]=[]),s>>=1;for(s=2;s<n;){for(var o=1;o<s;++o){var a=i[s],u=i[o];i[s+o]=[a[0]^u[0],a[1]^u[1],a[2]^u[2],a[3]^u[3]]}s*=2}for(i[0]=[0,0,0,0],s=n+1;s<r;++s){var c=i[s^n];i[s]=[e[0]^c[0],e[1]^c[1],e[2]^c[2],e[3]^c[3]]}return i};var forge$R=forge$X;function registerAlgorithm$1(e,t){forge$R.cipher.registerAlgorithm(e,(function(){return new forge$R.aes.Algorithm(e,t)}))}forge$R.aes=forge$R.aes||{},forge$R.aes.startEncrypting=function(e,t,r,n){var i=_createCipher$1({key:e,output:r,decrypt:!1,mode:n});return i.start(t),i},forge$R.aes.createEncryptionCipher=function(e,t){return _createCipher$1({key:e,output:null,decrypt:!1,mode:t})},forge$R.aes.startDecrypting=function(e,t,r,n){var i=_createCipher$1({key:e,output:r,decrypt:!0,mode:n});return i.start(t),i},forge$R.aes.createDecryptionCipher=function(e,t){return _createCipher$1({key:e,output:null,decrypt:!0,mode:t})},forge$R.aes.Algorithm=function(e,t){init||initialize();var r=this;r.name=e,r.mode=new t({blockSize:16,cipher:{encrypt:function(e,t){return _updateBlock$1(r._w,e,t,!1)},decrypt:function(e,t){return _updateBlock$1(r._w,e,t,!0)}}}),r._init=!1},forge$R.aes.Algorithm.prototype.initialize=function(e){if(!this._init){var t,r=e.key;if("string"!=typeof r||16!==r.length&&24!==r.length&&32!==r.length){if(forge$R.util.isArray(r)&&(16===r.length||24===r.length||32===r.length)){t=r,r=forge$R.util.createBuffer();for(var n=0;n<t.length;++n)r.putByte(t[n])}}else r=forge$R.util.createBuffer(r);if(!forge$R.util.isArray(r)){t=r,r=[];var i=t.length();if(16===i||24===i||32===i){i>>>=2;for(n=0;n<i;++n)r.push(t.getInt32())}}if(!forge$R.util.isArray(r)||4!==r.length&&6!==r.length&&8!==r.length)throw new Error("Invalid key parameter.");var s=this.mode.name,o=-1!==["CFB","OFB","CTR","GCM"].indexOf(s);this._w=_expandKey(r,e.decrypt&&!o),this._init=!0}},forge$R.aes._expandKey=function(e,t){return init||initialize(),_expandKey(e,t)},forge$R.aes._updateBlock=_updateBlock$1,registerAlgorithm$1("AES-ECB",forge$R.cipher.modes.ecb),registerAlgorithm$1("AES-CBC",forge$R.cipher.modes.cbc),registerAlgorithm$1("AES-CFB",forge$R.cipher.modes.cfb),registerAlgorithm$1("AES-OFB",forge$R.cipher.modes.ofb),registerAlgorithm$1("AES-CTR",forge$R.cipher.modes.ctr),registerAlgorithm$1("AES-GCM",forge$R.cipher.modes.gcm);var init=!1,Nb=4,sbox,isbox,rcon,mix,imix;function initialize(){init=!0,rcon=[0,1,2,4,8,16,32,64,128,27,54];for(var e=new Array(256),t=0;t<128;++t)e[t]=t<<1,e[t+128]=t+128<<1^283;sbox=new Array(256),isbox=new Array(256),mix=new Array(4),imix=new Array(4);for(t=0;t<4;++t)mix[t]=new Array(256),imix[t]=new Array(256);var r,n,i,s,o,a,u,c=0,l=0;for(t=0;t<256;++t){s=(s=l^l<<1^l<<2^l<<3^l<<4)>>8^255&s^99,sbox[c]=s,isbox[s]=c,a=(o=e[s])<<24^s<<16^s<<8^s^o,u=((r=e[c])^(n=e[r])^(i=e[n]))<<24^(c^i)<<16^(c^n^i)<<8^c^r^i;for(var h=0;h<4;++h)mix[h][c]=a,imix[h][s]=u,a=a<<24|a>>>8,u=u<<24|u>>>8;0===c?c=l=1:(c=r^e[e[e[r^i]]],l^=e[e[l]])}}function _expandKey(e,t){for(var r,n=e.slice(0),i=1,s=n.length,o=Nb*(s+6+1),a=s;a<o;++a)r=n[a-1],a%s==0?(r=sbox[r>>>16&255]<<24^sbox[r>>>8&255]<<16^sbox[255&r]<<8^sbox[r>>>24]^rcon[i]<<24,i++):s>6&&a%s==4&&(r=sbox[r>>>24]<<24^sbox[r>>>16&255]<<16^sbox[r>>>8&255]<<8^sbox[255&r]),n[a]=n[a-s]^r;if(t){for(var u,c=imix[0],l=imix[1],h=imix[2],d=imix[3],f=n.slice(0),p=(a=0,(o=n.length)-Nb);a<o;a+=Nb,p-=Nb)if(0===a||a===o-Nb)f[a]=n[p],f[a+1]=n[p+3],f[a+2]=n[p+2],f[a+3]=n[p+1];else for(var y=0;y<Nb;++y)u=n[p+y],f[a+(3&-y)]=c[sbox[u>>>24]]^l[sbox[u>>>16&255]]^h[sbox[u>>>8&255]]^d[sbox[255&u]];n=f}return n}function _updateBlock$1(e,t,r,n){var i,s,o,a,u,c,l,h,d,f,p,y,g=e.length/4-1;n?(i=imix[0],s=imix[1],o=imix[2],a=imix[3],u=isbox):(i=mix[0],s=mix[1],o=mix[2],a=mix[3],u=sbox),c=t[0]^e[0],l=t[n?3:1]^e[1],h=t[2]^e[2],d=t[n?1:3]^e[3];for(var $=3,m=1;m<g;++m)f=i[c>>>24]^s[l>>>16&255]^o[h>>>8&255]^a[255&d]^e[++$],p=i[l>>>24]^s[h>>>16&255]^o[d>>>8&255]^a[255&c]^e[++$],y=i[h>>>24]^s[d>>>16&255]^o[c>>>8&255]^a[255&l]^e[++$],d=i[d>>>24]^s[c>>>16&255]^o[l>>>8&255]^a[255&h]^e[++$],c=f,l=p,h=y;r[0]=u[c>>>24]<<24^u[l>>>16&255]<<16^u[h>>>8&255]<<8^u[255&d]^e[++$],r[n?3:1]=u[l>>>24]<<24^u[h>>>16&255]<<16^u[d>>>8&255]<<8^u[255&c]^e[++$],r[2]=u[h>>>24]<<24^u[d>>>16&255]<<16^u[c>>>8&255]<<8^u[255&l]^e[++$],r[n?1:3]=u[d>>>24]<<24^u[c>>>16&255]<<16^u[l>>>8&255]<<8^u[255&h]^e[++$]}function _createCipher$1(e){var t,r="AES-"+((e=e||{}).mode||"CBC").toUpperCase(),n=(t=e.decrypt?forge$R.cipher.createDecipher(r,e.key):forge$R.cipher.createCipher(r,e.key)).start;return t.start=function(e,r){var i=null;r instanceof forge$R.util.ByteBuffer&&(i=r,r={}),(r=r||{}).output=i,r.iv=e,n.call(t,r)},t}var forge$Q=forge$X;function registerAlgorithm(e,t){forge$Q.cipher.registerAlgorithm(e,(function(){return new forge$Q.des.Algorithm(e,t)}))}forge$Q.des=forge$Q.des||{},forge$Q.des.startEncrypting=function(e,t,r,n){var i=_createCipher({key:e,output:r,decrypt:!1,mode:n||(null===t?"ECB":"CBC")});return i.start(t),i},forge$Q.des.createEncryptionCipher=function(e,t){return _createCipher({key:e,output:null,decrypt:!1,mode:t})},forge$Q.des.startDecrypting=function(e,t,r,n){var i=_createCipher({key:e,output:r,decrypt:!0,mode:n||(null===t?"ECB":"CBC")});return i.start(t),i},forge$Q.des.createDecryptionCipher=function(e,t){return _createCipher({key:e,output:null,decrypt:!0,mode:t})},forge$Q.des.Algorithm=function(e,t){var r=this;r.name=e,r.mode=new t({blockSize:8,cipher:{encrypt:function(e,t){return _updateBlock(r._keys,e,t,!1)},decrypt:function(e,t){return _updateBlock(r._keys,e,t,!0)}}}),r._init=!1},forge$Q.des.Algorithm.prototype.initialize=function(e){if(!this._init){var t=forge$Q.util.createBuffer(e.key);if(0===this.name.indexOf("3DES")&&24!==t.length())throw new Error("Invalid Triple-DES key size: "+8*t.length());this._keys=_createKeys(t),this._init=!0}},registerAlgorithm("DES-ECB",forge$Q.cipher.modes.ecb),registerAlgorithm("DES-CBC",forge$Q.cipher.modes.cbc),registerAlgorithm("DES-CFB",forge$Q.cipher.modes.cfb),registerAlgorithm("DES-OFB",forge$Q.cipher.modes.ofb),registerAlgorithm("DES-CTR",forge$Q.cipher.modes.ctr),registerAlgorithm("3DES-ECB",forge$Q.cipher.modes.ecb),registerAlgorithm("3DES-CBC",forge$Q.cipher.modes.cbc),registerAlgorithm("3DES-CFB",forge$Q.cipher.modes.cfb),registerAlgorithm("3DES-OFB",forge$Q.cipher.modes.ofb),registerAlgorithm("3DES-CTR",forge$Q.cipher.modes.ctr);var spfunction1=[16843776,0,65536,16843780,16842756,66564,4,65536,1024,16843776,16843780,1024,16778244,16842756,16777216,4,1028,16778240,16778240,66560,66560,16842752,16842752,16778244,65540,16777220,16777220,65540,0,1028,66564,16777216,65536,16843780,4,16842752,16843776,16777216,16777216,1024,16842756,65536,66560,16777220,1024,4,16778244,66564,16843780,65540,16842752,16778244,16777220,1028,66564,16843776,1028,16778240,16778240,0,65540,66560,0,16842756],spfunction2=[-2146402272,-2147450880,32768,1081376,1048576,32,-2146435040,-2147450848,-2147483616,-2146402272,-2146402304,-2147483648,-2147450880,1048576,32,-2146435040,1081344,1048608,-2147450848,0,-2147483648,32768,1081376,-2146435072,1048608,-2147483616,0,1081344,32800,-2146402304,-2146435072,32800,0,1081376,-2146435040,1048576,-2147450848,-2146435072,-2146402304,32768,-2146435072,-2147450880,32,-2146402272,1081376,32,32768,-2147483648,32800,-2146402304,1048576,-2147483616,1048608,-2147450848,-2147483616,1048608,1081344,0,-2147450880,32800,-2147483648,-2146435040,-2146402272,1081344],spfunction3=[520,134349312,0,134348808,134218240,0,131592,134218240,131080,134217736,134217736,131072,134349320,131080,134348800,520,134217728,8,134349312,512,131584,134348800,134348808,131592,134218248,131584,131072,134218248,8,134349320,512,134217728,134349312,134217728,131080,520,131072,134349312,134218240,0,512,131080,134349320,134218240,134217736,512,0,134348808,134218248,131072,134217728,134349320,8,131592,131584,134217736,134348800,134218248,520,134348800,131592,8,134348808,131584],spfunction4=[8396801,8321,8321,128,8396928,8388737,8388609,8193,0,8396800,8396800,8396929,129,0,8388736,8388609,1,8192,8388608,8396801,128,8388608,8193,8320,8388737,1,8320,8388736,8192,8396928,8396929,129,8388736,8388609,8396800,8396929,129,0,0,8396800,8320,8388736,8388737,1,8396801,8321,8321,128,8396929,129,1,8192,8388609,8193,8396928,8388737,8193,8320,8388608,8396801,128,8388608,8192,8396928],spfunction5=[256,34078976,34078720,1107296512,524288,256,1073741824,34078720,1074266368,524288,33554688,1074266368,1107296512,1107820544,524544,1073741824,33554432,1074266112,1074266112,0,1073742080,1107820800,1107820800,33554688,1107820544,1073742080,0,1107296256,34078976,33554432,1107296256,524544,524288,1107296512,256,33554432,1073741824,34078720,1107296512,1074266368,33554688,1073741824,1107820544,34078976,1074266368,256,33554432,1107820544,1107820800,524544,1107296256,1107820800,34078720,0,1074266112,1107296256,524544,33554688,1073742080,524288,0,1074266112,34078976,1073742080],spfunction6=[536870928,541065216,16384,541081616,541065216,16,541081616,4194304,536887296,4210704,4194304,536870928,4194320,536887296,536870912,16400,0,4194320,536887312,16384,4210688,536887312,16,541065232,541065232,0,4210704,541081600,16400,4210688,541081600,536870912,536887296,16,541065232,4210688,541081616,4194304,16400,536870928,4194304,536887296,536870912,16400,536870928,541081616,4210688,541065216,4210704,541081600,0,541065232,16,16384,541065216,4210704,16384,4194320,536887312,0,541081600,536870912,4194320,536887312],spfunction7=[2097152,69206018,67110914,0,2048,67110914,2099202,69208064,69208066,2097152,0,67108866,2,67108864,69206018,2050,67110912,2099202,2097154,67110912,67108866,69206016,69208064,2097154,69206016,2048,2050,69208066,2099200,2,67108864,2099200,67108864,2099200,2097152,67110914,67110914,69206018,69206018,2,2097154,67108864,67110912,2097152,69208064,2050,2099202,69208064,2050,67108866,69208066,69206016,2099200,0,2,69208066,0,2099202,69206016,2048,67108866,67110912,2048,2097154],spfunction8=[268439616,4096,262144,268701760,268435456,268439616,64,268435456,262208,268697600,268701760,266240,268701696,266304,4096,64,268697600,268435520,268439552,4160,266240,262208,268697664,268701696,4160,0,0,268697664,268435520,268439552,266304,262144,266304,262144,268701696,4096,64,268697664,4096,266304,268439552,64,268435520,268697600,268697664,268435456,262144,268439616,0,268701760,262208,268435520,268697600,268439552,268439616,0,268701760,266240,266240,4160,4160,262208,268435456,268701696];function _createKeys(e){for(var t,r=[0,4,536870912,536870916,65536,65540,536936448,536936452,512,516,536871424,536871428,66048,66052,536936960,536936964],n=[0,1,1048576,1048577,67108864,67108865,68157440,68157441,256,257,1048832,1048833,67109120,67109121,68157696,68157697],i=[0,8,2048,2056,16777216,16777224,16779264,16779272,0,8,2048,2056,16777216,16777224,16779264,16779272],s=[0,2097152,134217728,136314880,8192,2105344,134225920,136323072,131072,2228224,134348800,136445952,139264,2236416,134356992,136454144],o=[0,262144,16,262160,0,262144,16,262160,4096,266240,4112,266256,4096,266240,4112,266256],a=[0,1024,32,1056,0,1024,32,1056,33554432,33555456,33554464,33555488,33554432,33555456,33554464,33555488],u=[0,268435456,524288,268959744,2,268435458,524290,268959746,0,268435456,524288,268959744,2,268435458,524290,268959746],c=[0,65536,2048,67584,536870912,536936448,536872960,536938496,131072,196608,133120,198656,537001984,537067520,537004032,537069568],l=[0,262144,0,262144,2,262146,2,262146,33554432,33816576,33554432,33816576,33554434,33816578,33554434,33816578],h=[0,268435456,8,268435464,0,268435456,8,268435464,1024,268436480,1032,268436488,1024,268436480,1032,268436488],d=[0,32,0,32,1048576,1048608,1048576,1048608,8192,8224,8192,8224,1056768,1056800,1056768,1056800],f=[0,16777216,512,16777728,2097152,18874368,2097664,18874880,67108864,83886080,67109376,83886592,69206016,85983232,69206528,85983744],p=[0,4096,134217728,134221824,524288,528384,134742016,134746112,16,4112,134217744,134221840,524304,528400,134742032,134746128],y=[0,4,256,260,0,4,256,260,1,5,257,261,1,5,257,261],g=e.length()>8?3:1,$=[],m=[0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0],b=0,v=0;v<g;v++){var _=e.getInt32(),w=e.getInt32();_^=(t=252645135&(_>>>4^w))<<4,_^=t=65535&((w^=t)>>>-16^_),_^=(t=858993459&(_>>>2^(w^=t<<-16)))<<2,_^=t=65535&((w^=t)>>>-16^_),_^=(t=1431655765&(_>>>1^(w^=t<<-16)))<<1,_^=t=16711935&((w^=t)>>>8^_),t=(_^=(t=1431655765&(_>>>1^(w^=t<<8)))<<1)<<8|(w^=t)>>>20&240,_=w<<24|w<<8&16711680|w>>>8&65280|w>>>24&240,w=t;for(var E=0;E<m.length;++E){m[E]?(_=_<<2|_>>>26,w=w<<2|w>>>26):(_=_<<1|_>>>27,w=w<<1|w>>>27);var S=r[(_&=-15)>>>28]|n[_>>>24&15]|i[_>>>20&15]|s[_>>>16&15]|o[_>>>12&15]|a[_>>>8&15]|u[_>>>4&15],A=c[(w&=-15)>>>28]|l[w>>>24&15]|h[w>>>20&15]|d[w>>>16&15]|f[w>>>12&15]|p[w>>>8&15]|y[w>>>4&15];t=65535&(A>>>16^S),$[b++]=S^t,$[b++]=A^t<<16}}return $}function _updateBlock(e,t,r,n){var i,s,o=32===e.length?3:9;i=3===o?n?[30,-2,-2]:[0,32,2]:n?[94,62,-2,32,64,2,30,-2,-2]:[0,32,2,62,30,-2,64,96,2];var a=t[0],u=t[1];a^=(s=252645135&(a>>>4^u))<<4,a^=(s=65535&(a>>>16^(u^=s)))<<16,a^=s=858993459&((u^=s)>>>2^a),a^=s=16711935&((u^=s<<2)>>>8^a),a=(a^=(s=1431655765&(a>>>1^(u^=s<<8)))<<1)<<1|a>>>31,u=(u^=s)<<1|u>>>31;for(var c=0;c<o;c+=3){for(var l=i[c+1],h=i[c+2],d=i[c];d!=l;d+=h){var f=u^e[d],p=(u>>>4|u<<28)^e[d+1];s=a,a=u,u=s^(spfunction2[f>>>24&63]|spfunction4[f>>>16&63]|spfunction6[f>>>8&63]|spfunction8[63&f]|spfunction1[p>>>24&63]|spfunction3[p>>>16&63]|spfunction5[p>>>8&63]|spfunction7[63&p])}s=a,a=u,u=s}u=u>>>1|u<<31,u^=s=1431655765&((a=a>>>1|a<<31)>>>1^u),u^=(s=16711935&(u>>>8^(a^=s<<1)))<<8,u^=(s=858993459&(u>>>2^(a^=s)))<<2,u^=s=65535&((a^=s)>>>16^u),u^=s=252645135&((a^=s<<16)>>>4^u),a^=s<<4,r[0]=a,r[1]=u}function _createCipher(e){var t,r="DES-"+((e=e||{}).mode||"CBC").toUpperCase(),n=(t=e.decrypt?forge$Q.cipher.createDecipher(r,e.key):forge$Q.cipher.createCipher(r,e.key)).start;return t.start=function(e,r){var i=null;r instanceof forge$Q.util.ByteBuffer&&(i=r,r={}),(r=r||{}).output=i,r.iv=e,n.call(t,r)},t}var forge$P=forge$X;forge$P.md=forge$P.md||{},forge$P.md.algorithms=forge$P.md.algorithms||{};var forge$O=forge$X,hmac$b=forge$O.hmac=forge$O.hmac||{};hmac$b.create=function(){var e=null,t=null,r=null,n=null,i={start:function(i,s){if(null!==i)if("string"==typeof i){if(!((i=i.toLowerCase())in forge$O.md.algorithms))throw new Error('Unknown hash algorithm "'+i+'"');t=forge$O.md.algorithms[i].create()}else t=i;if(null===s)s=e;else{if("string"==typeof s)s=forge$O.util.createBuffer(s);else if(forge$O.util.isArray(s)){var o=s;s=forge$O.util.createBuffer();for(var a=0;a<o.length;++a)s.putByte(o[a])}var u=s.length();u>t.blockLength&&(t.start(),t.update(s.bytes()),s=t.digest()),r=forge$O.util.createBuffer(),n=forge$O.util.createBuffer(),u=s.length();for(a=0;a<u;++a){o=s.at(a);r.putByte(54^o),n.putByte(92^o)}if(u<t.blockLength)for(o=t.blockLength-u,a=0;a<o;++a)r.putByte(54),n.putByte(92);e=s,r=r.bytes(),n=n.bytes()}t.start(),t.update(r)},update:function(e){t.update(e)},getMac:function(){var e=t.digest().bytes();return t.start(),t.update(n),t.update(e),t.digest()}};return i.digest=i.getMac,i};var _polyfillNode_crypto={},_polyfillNode_crypto$1=Object.freeze({__proto__:null,default:_polyfillNode_crypto}),require$$0$9=getAugmentedNamespace(_polyfillNode_crypto$1),forge$N=forge$X,pkcs5=forge$N.pkcs5=forge$N.pkcs5||{},crypto$h;forge$N.util.isNodejs&&!forge$N.options.usePureJavaScript&&(crypto$h=require$$0$9),module.exports=forge$N.pbkdf2=pkcs5.pbkdf2=function(e,t,r,n,i,s){if("function"==typeof i&&(s=i,i=null),forge$N.util.isNodejs&&!forge$N.options.usePureJavaScript&&crypto$h.pbkdf2&&(null===i||"object"!=typeof i)&&(crypto$h.pbkdf2Sync.length>4||!i||"sha1"===i))return"string"!=typeof i&&(i="sha1"),e=Buffer$f.from(e,"binary"),t=Buffer$f.from(t,"binary"),s?4===crypto$h.pbkdf2Sync.length?crypto$h.pbkdf2(e,t,r,n,(function(e,t){if(e)return s(e);s(null,t.toString("binary"))})):crypto$h.pbkdf2(e,t,r,n,i,(function(e,t){if(e)return s(e);s(null,t.toString("binary"))})):4===crypto$h.pbkdf2Sync.length?crypto$h.pbkdf2Sync(e,t,r,n).toString("binary"):crypto$h.pbkdf2Sync(e,t,r,n,i).toString("binary");if(null==i&&(i="sha1"),"string"==typeof i){if(!(i in forge$N.md.algorithms))throw new Error("Unknown hash algorithm: "+i);i=forge$N.md[i].create()}var o=i.digestLength;if(n>4294967295*o){var a=new Error("Derived key is too long.");if(s)return s(a);throw a}var u=Math.ceil(n/o),c=n-(u-1)*o,l=forge$N.hmac.create();l.start(i,e);var h,d,f,p="";if(!s){for(var y=1;y<=u;++y){l.start(null,null),l.update(t),l.update(forge$N.util.int32ToBytes(y)),h=f=l.digest().getBytes();for(var g=2;g<=r;++g)l.start(null,null),l.update(f),d=l.digest().getBytes(),h=forge$N.util.xorBytes(h,d,o),f=d;p+=y<u?h:h.substr(0,c)}return p}y=1;function $(){if(y>u)return s(null,p);l.start(null,null),l.update(t),l.update(forge$N.util.int32ToBytes(y)),h=f=l.digest().getBytes(),g=2,m()}function m(){if(g<=r)return l.start(null,null),l.update(f),d=l.digest().getBytes(),h=forge$N.util.xorBytes(h,d,o),f=d,++g,forge$N.util.setImmediate(m);p+=y<u?h:h.substr(0,c),++y,$()}$()};var pbkdf2$2=Object.freeze({__proto__:null}),require$$0$8=getAugmentedNamespace(pbkdf2$2),forge$M=forge$X,pem=forge$M.pem=forge$M.pem||{};function foldHeader(e){for(var t=e.name+": ",r=[],n=function(e,t){return" "+t},i=0;i<e.values.length;++i)r.push(e.values[i].replace(/^(\S+\r\n)/,n));t+=r.join(",")+"\r\n";var s=0,o=-1;for(i=0;i<t.length;++i,++s)if(s>65&&-1!==o){var a=t[o];","===a?(++o,t=t.substr(0,o)+"\r\n "+t.substr(o)):t=t.substr(0,o)+"\r\n"+a+t.substr(o+1),s=i-o-1,o=-1,++i}else" "!==t[i]&&"\t"!==t[i]&&","!==t[i]||(o=i);return t}function ltrim(e){return e.replace(/^\s+/,"")}pem.encode=function(e,t){t=t||{};var r,n="-----BEGIN "+e.type+"-----\r\n";if(e.procType&&(n+=foldHeader(r={name:"Proc-Type",values:[String(e.procType.version),e.procType.type]})),e.contentDomain&&(n+=foldHeader(r={name:"Content-Domain",values:[e.contentDomain]})),e.dekInfo&&(r={name:"DEK-Info",values:[e.dekInfo.algorithm]},e.dekInfo.parameters&&r.values.push(e.dekInfo.parameters),n+=foldHeader(r)),e.headers)for(var i=0;i<e.headers.length;++i)n+=foldHeader(e.headers[i]);return e.procType&&(n+="\r\n"),n+=forge$M.util.encode64(e.body,t.maxline||64)+"\r\n",n+="-----END "+e.type+"-----\r\n"},pem.decode=function(e){for(var t,r=[],n=/\s*-----BEGIN ([A-Z0-9- ]+)-----\r?\n?([\x21-\x7e\s]+?(?:\r?\n\r?\n))?([:A-Za-z0-9+\/=\s]+?)-----END \1-----/g,i=/([\x21-\x7e]+):\s*([\x21-\x7e\s^:]+)/,s=/\r?\n/;t=n.exec(e);){var o={type:t[1],procType:null,contentDomain:null,dekInfo:null,headers:[],body:forge$M.util.decode64(t[3])};if(r.push(o),t[2]){for(var a=t[2].split(s),u=0;t&&u<a.length;){for(var c=a[u].replace(/\s+$/,""),l=u+1;l<a.length;++l){var h=a[l];if(!/\s/.test(h[0]))break;c+=h,u=l}if(t=c.match(i)){for(var d={name:t[1],values:[]},f=t[2].split(","),p=0;p<f.length;++p)d.values.push(ltrim(f[p]));if(o.procType)if(o.contentDomain||"Content-Domain"!==d.name)if(o.dekInfo||"DEK-Info"!==d.name)o.headers.push(d);else{if(0===d.values.length)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must have at least one subfield.');o.dekInfo={algorithm:f[0],parameters:f[1]||null}}else o.contentDomain=f[0]||"";else{if("Proc-Type"!==d.name)throw new Error('Invalid PEM formatted message. The first encapsulated header must be "Proc-Type".');if(2!==d.values.length)throw new Error('Invalid PEM formatted message. The "Proc-Type" header must have two subfields.');o.procType={version:f[0],type:f[1]}}}++u}if("ENCRYPTED"===o.procType&&!o.dekInfo)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must be present if "Proc-Type" is "ENCRYPTED".')}}if(0===r.length)throw new Error("Invalid PEM formatted message.");return r};var forge$L=forge$X,sha256$s=forge$L.sha256=forge$L.sha256||{};forge$L.md.sha256=forge$L.md.algorithms.sha256=sha256$s,sha256$s.create=function(){_initialized$2||_init$2();var e=null,t=forge$L.util.createBuffer(),r=new Array(64),n={algorithm:"sha256",blockLength:64,digestLength:32,messageLength:0,fullMessageLength:null,messageLengthSize:8,start:function(){n.messageLength=0,n.fullMessageLength=n.messageLength64=[];for(var r=n.messageLengthSize/4,i=0;i<r;++i)n.fullMessageLength.push(0);return t=forge$L.util.createBuffer(),e={h0:1779033703,h1:3144134277,h2:1013904242,h3:2773480762,h4:1359893119,h5:2600822924,h6:528734635,h7:1541459225},n}};return n.start(),n.update=function(i,s){"utf8"===s&&(i=forge$L.util.encodeUtf8(i));var o=i.length;n.messageLength+=o,o=[o/4294967296>>>0,o>>>0];for(var a=n.fullMessageLength.length-1;a>=0;--a)n.fullMessageLength[a]+=o[1],o[1]=o[0]+(n.fullMessageLength[a]/4294967296>>>0),n.fullMessageLength[a]=n.fullMessageLength[a]>>>0,o[0]=o[1]/4294967296>>>0;return t.putBytes(i),_update$2(e,r,t),(t.read>2048||0===t.length())&&t.compact(),n},n.digest=function(){var i=forge$L.util.createBuffer();i.putBytes(t.bytes());var s,o=n.fullMessageLength[n.fullMessageLength.length-1]+n.messageLengthSize&n.blockLength-1;i.putBytes(_padding$2.substr(0,n.blockLength-o));for(var a=8*n.fullMessageLength[0],u=0;u<n.fullMessageLength.length-1;++u)a+=(s=8*n.fullMessageLength[u+1])/4294967296>>>0,i.putInt32(a>>>0),a=s>>>0;i.putInt32(a);var c={h0:e.h0,h1:e.h1,h2:e.h2,h3:e.h3,h4:e.h4,h5:e.h5,h6:e.h6,h7:e.h7};_update$2(c,r,i);var l=forge$L.util.createBuffer();return l.putInt32(c.h0),l.putInt32(c.h1),l.putInt32(c.h2),l.putInt32(c.h3),l.putInt32(c.h4),l.putInt32(c.h5),l.putInt32(c.h6),l.putInt32(c.h7),l},n};var _padding$2=null,_initialized$2=!1,_k$1=null;function _init$2(){_padding$2=String.fromCharCode(128),_padding$2+=forge$L.util.fillString(String.fromCharCode(0),64),_k$1=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],_initialized$2=!0}function _update$2(e,t,r){for(var n,i,s,o,a,u,c,l,h,d,f,p,y,g=r.length();g>=64;){for(a=0;a<16;++a)t[a]=r.getInt32();for(;a<64;++a)n=((n=t[a-2])>>>17|n<<15)^(n>>>19|n<<13)^n>>>10,i=((i=t[a-15])>>>7|i<<25)^(i>>>18|i<<14)^i>>>3,t[a]=n+t[a-7]+i+t[a-16]|0;for(u=e.h0,c=e.h1,l=e.h2,h=e.h3,d=e.h4,f=e.h5,p=e.h6,y=e.h7,a=0;a<64;++a)s=(u>>>2|u<<30)^(u>>>13|u<<19)^(u>>>22|u<<10),o=u&c|l&(u^c),n=y+((d>>>6|d<<26)^(d>>>11|d<<21)^(d>>>25|d<<7))+(p^d&(f^p))+_k$1[a]+t[a],y=p,p=f,f=d,d=h+n>>>0,h=l,l=c,c=u,u=n+(i=s+o)>>>0;e.h0=e.h0+u|0,e.h1=e.h1+c|0,e.h2=e.h2+l|0,e.h3=e.h3+h|0,e.h4=e.h4+d|0,e.h5=e.h5+f|0,e.h6=e.h6+p|0,e.h7=e.h7+y|0,g-=64}}var forge$K=forge$X,_crypto$1=null;!forge$K.util.isNodejs||forge$K.options.usePureJavaScript||process.versions["node-webkit"]||(_crypto$1=require$$0$9);var prng=module.exports=forge$K.prng=forge$K.prng||{};prng.create=function(e){for(var t={plugin:e,key:null,seed:null,time:null,reseeds:0,generated:0,keyBytes:""},r=e.md,n=new Array(32),i=0;i<32;++i)n[i]=r.create();function s(){if(t.pools[0].messageLength>=32)return o();var e=32-t.pools[0].messageLength<<5;t.collect(t.seedFileSync(e)),o()}function o(){t.reseeds=4294967295===t.reseeds?0:t.reseeds+1;var e=t.plugin.md.create();e.update(t.keyBytes);for(var r=1,n=0;n<32;++n)t.reseeds%r==0&&(e.update(t.pools[n].digest().getBytes()),t.pools[n].start()),r<<=1;t.keyBytes=e.digest().getBytes(),e.start(),e.update(t.keyBytes);var i=e.digest().getBytes();t.key=t.plugin.formatKey(t.keyBytes),t.seed=t.plugin.formatSeed(i),t.generated=0}function a(e){var t=null,r=forge$K.util.globalScope,n=r.crypto||r.msCrypto;n&&n.getRandomValues&&(t=function(e){return n.getRandomValues(e)});var i=forge$K.util.createBuffer();if(t)for(;i.length()<e;){var s=Math.max(1,Math.min(e-i.length(),65536)/4),o=new Uint32Array(Math.floor(s));try{t(o);for(var a=0;a<o.length;++a)i.putInt32(o[a])}catch(e){if(!("undefined"!=typeof QuotaExceededError&&e instanceof QuotaExceededError))throw e}}if(i.length()<e)for(var u,c,l,h=Math.floor(65536*Math.random());i.length()<e;){c=16807*(65535&h),c+=(32767&(u=16807*(h>>16)))<<16,h=4294967295&(c=(2147483647&(c+=u>>15))+(c>>31));for(a=0;a<3;++a)l=h>>>(a<<3),l^=Math.floor(256*Math.random()),i.putByte(String.fromCharCode(255&l))}return i.getBytes(e)}return t.pools=n,t.pool=0,t.generate=function(e,r){if(!r)return t.generateSync(e);var n=t.plugin.cipher,i=t.plugin.increment,s=t.plugin.formatKey,a=t.plugin.formatSeed,u=forge$K.util.createBuffer();t.key=null,function c(l){if(l)return r(l);if(u.length()>=e)return r(null,u.getBytes(e));t.generated>1048575&&(t.key=null);if(null===t.key)return forge$K.util.nextTick((function(){!function(e){if(t.pools[0].messageLength>=32)return o(),e();var r=32-t.pools[0].messageLength<<5;t.seedFile(r,(function(r,n){if(r)return e(r);t.collect(n),o(),e()}))}(c)}));var h=n(t.key,t.seed);t.generated+=h.length,u.putBytes(h),t.key=s(n(t.key,i(t.seed))),t.seed=a(n(t.key,t.seed)),forge$K.util.setImmediate(c)}()},t.generateSync=function(e){var r=t.plugin.cipher,n=t.plugin.increment,i=t.plugin.formatKey,o=t.plugin.formatSeed;t.key=null;for(var a=forge$K.util.createBuffer();a.length()<e;){t.generated>1048575&&(t.key=null),null===t.key&&s();var u=r(t.key,t.seed);t.generated+=u.length,a.putBytes(u),t.key=i(r(t.key,n(t.seed))),t.seed=o(r(t.key,t.seed))}return a.getBytes(e)},_crypto$1?(t.seedFile=function(e,t){_crypto$1.randomBytes(e,(function(e,r){if(e)return t(e);t(null,r.toString())}))},t.seedFileSync=function(e){return _crypto$1.randomBytes(e).toString()}):(t.seedFile=function(e,t){try{t(null,a(e))}catch(e){t(e)}},t.seedFileSync=a),t.collect=function(e){for(var r=e.length,n=0;n<r;++n)t.pools[t.pool].update(e.substr(n,1)),t.pool=31===t.pool?0:t.pool+1},t.collectInt=function(e,r){for(var n="",i=0;i<r;i+=8)n+=String.fromCharCode(e>>i&255);t.collect(n)},t.registerWorker=function(e){if(e===self)t.seedFile=function(e,t){self.addEventListener("message",(function e(r){var n=r.data;n.forge&&n.forge.prng&&(self.removeEventListener("message",e),t(n.forge.prng.err,n.forge.prng.bytes))})),self.postMessage({forge:{prng:{needed:e}}})};else{e.addEventListener("message",(function(r){var n=r.data;n.forge&&n.forge.prng&&t.seedFile(n.forge.prng.needed,(function(t,r){e.postMessage({forge:{prng:{err:t,bytes:r}}})}))}))}},t};var forge$J=forge$X;forge$J.random&&forge$J.random.getBytes||function(e){var t={},r=new Array(4),n=forge$J.util.createBuffer();function i(){var e=forge$J.prng.create(t);return e.getBytes=function(t,r){return e.generate(t,r)},e.getBytesSync=function(t){return e.generate(t)},e}t.formatKey=function(e){var t=forge$J.util.createBuffer(e);return(e=new Array(4))[0]=t.getInt32(),e[1]=t.getInt32(),e[2]=t.getInt32(),e[3]=t.getInt32(),forge$J.aes._expandKey(e,!1)},t.formatSeed=function(e){var t=forge$J.util.createBuffer(e);return(e=new Array(4))[0]=t.getInt32(),e[1]=t.getInt32(),e[2]=t.getInt32(),e[3]=t.getInt32(),e},t.cipher=function(e,t){return forge$J.aes._updateBlock(e,t,r,!1),n.putInt32(r[0]),n.putInt32(r[1]),n.putInt32(r[2]),n.putInt32(r[3]),n.getBytes()},t.increment=function(e){return++e[3],e},t.md=forge$J.md.sha256;var s=i(),o=null,a=forge$J.util.globalScope,u=a.crypto||a.msCrypto;if(u&&u.getRandomValues&&(o=function(e){return u.getRandomValues(e)}),!forge$J.util.isNodejs&&!o){if(s.collectInt(+new Date,32),"undefined"!=typeof navigator){var c="";for(var l in navigator)try{"string"==typeof navigator[l]&&(c+=navigator[l])}catch(e){}s.collect(c),c=null}e&&(e().mousemove((function(e){s.collectInt(e.clientX,16),s.collectInt(e.clientY,16)})),e().keypress((function(e){s.collectInt(e.charCode,8)})))}if(forge$J.random)for(var l in s)forge$J.random[l]=s[l];else forge$J.random=s;forge$J.random.createInstance=i}("undefined"!=typeof jQuery?jQuery:null);var forge$I=forge$X,piTable=[217,120,249,196,25,221,181,237,40,233,253,121,74,160,216,157,198,126,55,131,43,118,83,142,98,76,100,136,68,139,251,162,23,154,89,245,135,179,79,19,97,69,109,141,9,129,125,50,189,143,64,235,134,183,123,11,240,149,33,34,92,107,78,130,84,214,101,147,206,96,178,28,115,86,192,20,167,140,241,220,18,117,202,31,59,190,228,209,66,61,212,48,163,60,182,38,111,191,14,218,70,105,7,87,39,242,29,155,188,148,67,3,248,17,199,246,144,239,62,231,6,195,213,47,200,102,30,215,8,232,234,222,128,82,238,247,132,170,114,172,53,77,106,42,150,26,210,113,90,21,73,116,75,159,208,94,4,24,164,236,194,224,65,110,15,81,203,204,36,145,175,80,161,244,112,57,153,124,58,133,35,184,180,122,252,2,54,91,37,85,151,49,45,93,250,152,227,138,146,174,5,223,41,16,103,108,186,201,211,0,230,207,225,158,168,44,99,22,1,63,88,226,137,169,13,56,52,27,171,51,255,176,187,72,12,95,185,177,205,46,197,243,219,71,229,165,156,119,10,166,32,104,254,127,193,173],s$1=[1,2,3,5],rol=function(e,t){return e<<t&65535|(65535&e)>>16-t},ror=function(e,t){return(65535&e)>>t|e<<16-t&65535};forge$I.rc2=forge$I.rc2||{},forge$I.rc2.expandKey=function(e,t){"string"==typeof e&&(e=forge$I.util.createBuffer(e)),t=t||128;var r,n=e,i=e.length(),s=t,o=Math.ceil(s/8),a=255>>(7&s);for(r=i;r<128;r++)n.putByte(piTable[n.at(r-1)+n.at(r-i)&255]);for(n.setAt(128-o,piTable[n.at(128-o)&a]),r=127-o;r>=0;r--)n.setAt(r,piTable[n.at(r+1)^n.at(r+o)]);return n};var createCipher=function(e,t,r){var n,i,s,o,a=!1,u=null,c=null,l=null,h=[];for(e=forge$I.rc2.expandKey(e,t),s=0;s<64;s++)h.push(e.getInt16Le());r?(n=function(e){for(s=0;s<4;s++)e[s]+=h[o]+(e[(s+3)%4]&e[(s+2)%4])+(~e[(s+3)%4]&e[(s+1)%4]),e[s]=rol(e[s],s$1[s]),o++},i=function(e){for(s=0;s<4;s++)e[s]+=h[63&e[(s+3)%4]]}):(n=function(e){for(s=3;s>=0;s--)e[s]=ror(e[s],s$1[s]),e[s]-=h[o]+(e[(s+3)%4]&e[(s+2)%4])+(~e[(s+3)%4]&e[(s+1)%4]),o--},i=function(e){for(s=3;s>=0;s--)e[s]-=h[63&e[(s+3)%4]]});var d=function(e){var t=[];for(s=0;s<4;s++){var n=u.getInt16Le();null!==l&&(r?n^=l.getInt16Le():l.putInt16Le(n)),t.push(65535&n)}o=r?0:63;for(var i=0;i<e.length;i++)for(var a=0;a<e[i][0];a++)e[i][1](t);for(s=0;s<4;s++)null!==l&&(r?l.putInt16Le(t[s]):t[s]^=l.getInt16Le()),c.putInt16Le(t[s])},f=null;return f={start:function(e,t){e&&"string"==typeof e&&(e=forge$I.util.createBuffer(e)),a=!1,u=forge$I.util.createBuffer(),c=t||new forge$I.util.createBuffer,l=e,f.output=c},update:function(e){for(a||u.putBuffer(e);u.length()>=8;)d([[5,n],[1,i],[6,n],[1,i],[5,n]])},finish:function(e){var t=!0;if(r)if(e)t=e(8,u,!r);else{var n=8===u.length()?8:8-u.length();u.fillWithByte(n,n)}if(t&&(a=!0,f.update()),!r&&(t=0===u.length()))if(e)t=e(8,c,!r);else{var i=c.length(),s=c.at(i-1);s>i?t=!1:c.truncate(s)}return t}},f};forge$I.rc2.startEncrypting=function(e,t,r){var n=forge$I.rc2.createEncryptionCipher(e,128);return n.start(t,r),n},forge$I.rc2.createEncryptionCipher=function(e,t){return createCipher(e,t,!0)},forge$I.rc2.startDecrypting=function(e,t,r){var n=forge$I.rc2.createDecryptionCipher(e,128);return n.start(t,r),n},forge$I.rc2.createDecryptionCipher=function(e,t){return createCipher(e,t,!1)};var forge$H=forge$X,dbits;function BigInteger$3(e,t,r){this.data=[],null!=e&&("number"==typeof e?this.fromNumber(e,t,r):null==t&&"string"!=typeof e?this.fromString(e,256):this.fromString(e,t))}function nbi(){return new BigInteger$3(null)}function am1(e,t,r,n,i,s){for(;--s>=0;){var o=t*this.data[e++]+r.data[n]+i;i=Math.floor(o/67108864),r.data[n++]=67108863&o}return i}function am2(e,t,r,n,i,s){for(var o=32767&t,a=t>>15;--s>=0;){var u=32767&this.data[e],c=this.data[e++]>>15,l=a*u+c*o;i=((u=o*u+((32767&l)<<15)+r.data[n]+(1073741823&i))>>>30)+(l>>>15)+a*c+(i>>>30),r.data[n++]=1073741823&u}return i}function am3(e,t,r,n,i,s){for(var o=16383&t,a=t>>14;--s>=0;){var u=16383&this.data[e],c=this.data[e++]>>14,l=a*u+c*o;i=((u=o*u+((16383&l)<<14)+r.data[n]+i)>>28)+(l>>14)+a*c,r.data[n++]=268435455&u}return i}forge$H.jsbn=forge$H.jsbn||{},forge$H.jsbn.BigInteger=BigInteger$3,"undefined"==typeof navigator?(BigInteger$3.prototype.am=am3,dbits=28):"Microsoft Internet Explorer"==navigator.appName?(BigInteger$3.prototype.am=am2,dbits=30):"Netscape"!=navigator.appName?(BigInteger$3.prototype.am=am1,dbits=26):(BigInteger$3.prototype.am=am3,dbits=28),BigInteger$3.prototype.DB=dbits,BigInteger$3.prototype.DM=(1<<dbits)-1,BigInteger$3.prototype.DV=1<<dbits;var BI_FP=52;BigInteger$3.prototype.FV=Math.pow(2,BI_FP),BigInteger$3.prototype.F1=BI_FP-dbits,BigInteger$3.prototype.F2=2*dbits-BI_FP;var BI_RM="0123456789abcdefghijklmnopqrstuvwxyz",BI_RC=new Array,rr,vv;for(rr="0".charCodeAt(0),vv=0;vv<=9;++vv)BI_RC[rr++]=vv;for(rr="a".charCodeAt(0),vv=10;vv<36;++vv)BI_RC[rr++]=vv;for(rr="A".charCodeAt(0),vv=10;vv<36;++vv)BI_RC[rr++]=vv;function int2char(e){return BI_RM.charAt(e)}function intAt(e,t){var r=BI_RC[e.charCodeAt(t)];return null==r?-1:r}function bnpCopyTo(e){for(var t=this.t-1;t>=0;--t)e.data[t]=this.data[t];e.t=this.t,e.s=this.s}function bnpFromInt(e){this.t=1,this.s=e<0?-1:0,e>0?this.data[0]=e:e<-1?this.data[0]=e+this.DV:this.t=0}function nbv(e){var t=nbi();return t.fromInt(e),t}function bnpFromString(e,t){var r;if(16==t)r=4;else if(8==t)r=3;else if(256==t)r=8;else if(2==t)r=1;else if(32==t)r=5;else{if(4!=t)return void this.fromRadix(e,t);r=2}this.t=0,this.s=0;for(var n=e.length,i=!1,s=0;--n>=0;){var o=8==r?255&e[n]:intAt(e,n);o<0?"-"==e.charAt(n)&&(i=!0):(i=!1,0==s?this.data[this.t++]=o:s+r>this.DB?(this.data[this.t-1]|=(o&(1<<this.DB-s)-1)<<s,this.data[this.t++]=o>>this.DB-s):this.data[this.t-1]|=o<<s,(s+=r)>=this.DB&&(s-=this.DB))}8==r&&0!=(128&e[0])&&(this.s=-1,s>0&&(this.data[this.t-1]|=(1<<this.DB-s)-1<<s)),this.clamp(),i&&BigInteger$3.ZERO.subTo(this,this)}function bnpClamp(){for(var e=this.s&this.DM;this.t>0&&this.data[this.t-1]==e;)--this.t}function bnToString(e){if(this.s<0)return"-"+this.negate().toString(e);var t;if(16==e)t=4;else if(8==e)t=3;else if(2==e)t=1;else if(32==e)t=5;else{if(4!=e)return this.toRadix(e);t=2}var r,n=(1<<t)-1,i=!1,s="",o=this.t,a=this.DB-o*this.DB%t;if(o-- >0)for(a<this.DB&&(r=this.data[o]>>a)>0&&(i=!0,s=int2char(r));o>=0;)a<t?(r=(this.data[o]&(1<<a)-1)<<t-a,r|=this.data[--o]>>(a+=this.DB-t)):(r=this.data[o]>>(a-=t)&n,a<=0&&(a+=this.DB,--o)),r>0&&(i=!0),i&&(s+=int2char(r));return i?s:"0"}function bnNegate(){var e=nbi();return BigInteger$3.ZERO.subTo(this,e),e}function bnAbs(){return this.s<0?this.negate():this}function bnCompareTo(e){var t=this.s-e.s;if(0!=t)return t;var r=this.t;if(0!=(t=r-e.t))return this.s<0?-t:t;for(;--r>=0;)if(0!=(t=this.data[r]-e.data[r]))return t;return 0}function nbits(e){var t,r=1;return 0!=(t=e>>>16)&&(e=t,r+=16),0!=(t=e>>8)&&(e=t,r+=8),0!=(t=e>>4)&&(e=t,r+=4),0!=(t=e>>2)&&(e=t,r+=2),0!=(t=e>>1)&&(e=t,r+=1),r}function bnBitLength(){return this.t<=0?0:this.DB*(this.t-1)+nbits(this.data[this.t-1]^this.s&this.DM)}function bnpDLShiftTo(e,t){var r;for(r=this.t-1;r>=0;--r)t.data[r+e]=this.data[r];for(r=e-1;r>=0;--r)t.data[r]=0;t.t=this.t+e,t.s=this.s}function bnpDRShiftTo(e,t){for(var r=e;r<this.t;++r)t.data[r-e]=this.data[r];t.t=Math.max(this.t-e,0),t.s=this.s}function bnpLShiftTo(e,t){var r,n=e%this.DB,i=this.DB-n,s=(1<<i)-1,o=Math.floor(e/this.DB),a=this.s<<n&this.DM;for(r=this.t-1;r>=0;--r)t.data[r+o+1]=this.data[r]>>i|a,a=(this.data[r]&s)<<n;for(r=o-1;r>=0;--r)t.data[r]=0;t.data[o]=a,t.t=this.t+o+1,t.s=this.s,t.clamp()}function bnpRShiftTo(e,t){t.s=this.s;var r=Math.floor(e/this.DB);if(r>=this.t)t.t=0;else{var n=e%this.DB,i=this.DB-n,s=(1<<n)-1;t.data[0]=this.data[r]>>n;for(var o=r+1;o<this.t;++o)t.data[o-r-1]|=(this.data[o]&s)<<i,t.data[o-r]=this.data[o]>>n;n>0&&(t.data[this.t-r-1]|=(this.s&s)<<i),t.t=this.t-r,t.clamp()}}function bnpSubTo(e,t){for(var r=0,n=0,i=Math.min(e.t,this.t);r<i;)n+=this.data[r]-e.data[r],t.data[r++]=n&this.DM,n>>=this.DB;if(e.t<this.t){for(n-=e.s;r<this.t;)n+=this.data[r],t.data[r++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;r<e.t;)n-=e.data[r],t.data[r++]=n&this.DM,n>>=this.DB;n-=e.s}t.s=n<0?-1:0,n<-1?t.data[r++]=this.DV+n:n>0&&(t.data[r++]=n),t.t=r,t.clamp()}function bnpMultiplyTo(e,t){var r=this.abs(),n=e.abs(),i=r.t;for(t.t=i+n.t;--i>=0;)t.data[i]=0;for(i=0;i<n.t;++i)t.data[i+r.t]=r.am(0,n.data[i],t,i,0,r.t);t.s=0,t.clamp(),this.s!=e.s&&BigInteger$3.ZERO.subTo(t,t)}function bnpSquareTo(e){for(var t=this.abs(),r=e.t=2*t.t;--r>=0;)e.data[r]=0;for(r=0;r<t.t-1;++r){var n=t.am(r,t.data[r],e,2*r,0,1);(e.data[r+t.t]+=t.am(r+1,2*t.data[r],e,2*r+1,n,t.t-r-1))>=t.DV&&(e.data[r+t.t]-=t.DV,e.data[r+t.t+1]=1)}e.t>0&&(e.data[e.t-1]+=t.am(r,t.data[r],e,2*r,0,1)),e.s=0,e.clamp()}function bnpDivRemTo(e,t,r){var n=e.abs();if(!(n.t<=0)){var i=this.abs();if(i.t<n.t)return null!=t&&t.fromInt(0),void(null!=r&&this.copyTo(r));null==r&&(r=nbi());var s=nbi(),o=this.s,a=e.s,u=this.DB-nbits(n.data[n.t-1]);u>0?(n.lShiftTo(u,s),i.lShiftTo(u,r)):(n.copyTo(s),i.copyTo(r));var c=s.t,l=s.data[c-1];if(0!=l){var h=l*(1<<this.F1)+(c>1?s.data[c-2]>>this.F2:0),d=this.FV/h,f=(1<<this.F1)/h,p=1<<this.F2,y=r.t,g=y-c,$=null==t?nbi():t;for(s.dlShiftTo(g,$),r.compareTo($)>=0&&(r.data[r.t++]=1,r.subTo($,r)),BigInteger$3.ONE.dlShiftTo(c,$),$.subTo(s,s);s.t<c;)s.data[s.t++]=0;for(;--g>=0;){var m=r.data[--y]==l?this.DM:Math.floor(r.data[y]*d+(r.data[y-1]+p)*f);if((r.data[y]+=s.am(0,m,r,g,0,c))<m)for(s.dlShiftTo(g,$),r.subTo($,r);r.data[y]<--m;)r.subTo($,r)}null!=t&&(r.drShiftTo(c,t),o!=a&&BigInteger$3.ZERO.subTo(t,t)),r.t=c,r.clamp(),u>0&&r.rShiftTo(u,r),o<0&&BigInteger$3.ZERO.subTo(r,r)}}}function bnMod(e){var t=nbi();return this.abs().divRemTo(e,null,t),this.s<0&&t.compareTo(BigInteger$3.ZERO)>0&&e.subTo(t,t),t}function Classic(e){this.m=e}function cConvert(e){return e.s<0||e.compareTo(this.m)>=0?e.mod(this.m):e}function cRevert(e){return e}function cReduce(e){e.divRemTo(this.m,null,e)}function cMulTo(e,t,r){e.multiplyTo(t,r),this.reduce(r)}function cSqrTo(e,t){e.squareTo(t),this.reduce(t)}function bnpInvDigit(){if(this.t<1)return 0;var e=this.data[0];if(0==(1&e))return 0;var t=3&e;return(t=(t=(t=(t=t*(2-(15&e)*t)&15)*(2-(255&e)*t)&255)*(2-((65535&e)*t&65535))&65535)*(2-e*t%this.DV)%this.DV)>0?this.DV-t:-t}function Montgomery(e){this.m=e,this.mp=e.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function montConvert(e){var t=nbi();return e.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),e.s<0&&t.compareTo(BigInteger$3.ZERO)>0&&this.m.subTo(t,t),t}function montRevert(e){var t=nbi();return e.copyTo(t),this.reduce(t),t}function montReduce(e){for(;e.t<=this.mt2;)e.data[e.t++]=0;for(var t=0;t<this.m.t;++t){var r=32767&e.data[t],n=r*this.mpl+((r*this.mph+(e.data[t]>>15)*this.mpl&this.um)<<15)&e.DM;for(r=t+this.m.t,e.data[r]+=this.m.am(0,n,e,t,0,this.m.t);e.data[r]>=e.DV;)e.data[r]-=e.DV,e.data[++r]++}e.clamp(),e.drShiftTo(this.m.t,e),e.compareTo(this.m)>=0&&e.subTo(this.m,e)}function montSqrTo(e,t){e.squareTo(t),this.reduce(t)}function montMulTo(e,t,r){e.multiplyTo(t,r),this.reduce(r)}function bnpIsEven(){return 0==(this.t>0?1&this.data[0]:this.s)}function bnpExp(e,t){if(e>4294967295||e<1)return BigInteger$3.ONE;var r=nbi(),n=nbi(),i=t.convert(this),s=nbits(e)-1;for(i.copyTo(r);--s>=0;)if(t.sqrTo(r,n),(e&1<<s)>0)t.mulTo(n,i,r);else{var o=r;r=n,n=o}return t.revert(r)}function bnModPowInt(e,t){var r;return r=e<256||t.isEven()?new Classic(t):new Montgomery(t),this.exp(e,r)}function bnClone(){var e=nbi();return this.copyTo(e),e}function bnIntValue(){if(this.s<0){if(1==this.t)return this.data[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this.data[0];if(0==this.t)return 0}return(this.data[1]&(1<<32-this.DB)-1)<<this.DB|this.data[0]}function bnByteValue(){return 0==this.t?this.s:this.data[0]<<24>>24}function bnShortValue(){return 0==this.t?this.s:this.data[0]<<16>>16}function bnpChunkSize(e){return Math.floor(Math.LN2*this.DB/Math.log(e))}function bnSigNum(){return this.s<0?-1:this.t<=0||1==this.t&&this.data[0]<=0?0:1}function bnpToRadix(e){if(null==e&&(e=10),0==this.signum()||e<2||e>36)return"0";var t=this.chunkSize(e),r=Math.pow(e,t),n=nbv(r),i=nbi(),s=nbi(),o="";for(this.divRemTo(n,i,s);i.signum()>0;)o=(r+s.intValue()).toString(e).substr(1)+o,i.divRemTo(n,i,s);return s.intValue().toString(e)+o}function bnpFromRadix(e,t){this.fromInt(0),null==t&&(t=10);for(var r=this.chunkSize(t),n=Math.pow(t,r),i=!1,s=0,o=0,a=0;a<e.length;++a){var u=intAt(e,a);u<0?"-"==e.charAt(a)&&0==this.signum()&&(i=!0):(o=t*o+u,++s>=r&&(this.dMultiply(n),this.dAddOffset(o,0),s=0,o=0))}s>0&&(this.dMultiply(Math.pow(t,s)),this.dAddOffset(o,0)),i&&BigInteger$3.ZERO.subTo(this,this)}function bnpFromNumber(e,t,r){if("number"==typeof t)if(e<2)this.fromInt(1);else for(this.fromNumber(e,r),this.testBit(e-1)||this.bitwiseTo(BigInteger$3.ONE.shiftLeft(e-1),op_or,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(t);)this.dAddOffset(2,0),this.bitLength()>e&&this.subTo(BigInteger$3.ONE.shiftLeft(e-1),this);else{var n=new Array,i=7&e;n.length=1+(e>>3),t.nextBytes(n),i>0?n[0]&=(1<<i)-1:n[0]=0,this.fromString(n,256)}}function bnToByteArray(){var e=this.t,t=new Array;t[0]=this.s;var r,n=this.DB-e*this.DB%8,i=0;if(e-- >0)for(n<this.DB&&(r=this.data[e]>>n)!=(this.s&this.DM)>>n&&(t[i++]=r|this.s<<this.DB-n);e>=0;)n<8?(r=(this.data[e]&(1<<n)-1)<<8-n,r|=this.data[--e]>>(n+=this.DB-8)):(r=this.data[e]>>(n-=8)&255,n<=0&&(n+=this.DB,--e)),0!=(128&r)&&(r|=-256),0==i&&(128&this.s)!=(128&r)&&++i,(i>0||r!=this.s)&&(t[i++]=r);return t}function bnEquals(e){return 0==this.compareTo(e)}function bnMin(e){return this.compareTo(e)<0?this:e}function bnMax(e){return this.compareTo(e)>0?this:e}function bnpBitwiseTo(e,t,r){var n,i,s=Math.min(e.t,this.t);for(n=0;n<s;++n)r.data[n]=t(this.data[n],e.data[n]);if(e.t<this.t){for(i=e.s&this.DM,n=s;n<this.t;++n)r.data[n]=t(this.data[n],i);r.t=this.t}else{for(i=this.s&this.DM,n=s;n<e.t;++n)r.data[n]=t(i,e.data[n]);r.t=e.t}r.s=t(this.s,e.s),r.clamp()}function op_and(e,t){return e&t}function bnAnd(e){var t=nbi();return this.bitwiseTo(e,op_and,t),t}function op_or(e,t){return e|t}function bnOr(e){var t=nbi();return this.bitwiseTo(e,op_or,t),t}function op_xor(e,t){return e^t}function bnXor(e){var t=nbi();return this.bitwiseTo(e,op_xor,t),t}function op_andnot(e,t){return e&~t}function bnAndNot(e){var t=nbi();return this.bitwiseTo(e,op_andnot,t),t}function bnNot(){for(var e=nbi(),t=0;t<this.t;++t)e.data[t]=this.DM&~this.data[t];return e.t=this.t,e.s=~this.s,e}function bnShiftLeft(e){var t=nbi();return e<0?this.rShiftTo(-e,t):this.lShiftTo(e,t),t}function bnShiftRight(e){var t=nbi();return e<0?this.lShiftTo(-e,t):this.rShiftTo(e,t),t}function lbit(e){if(0==e)return-1;var t=0;return 0==(65535&e)&&(e>>=16,t+=16),0==(255&e)&&(e>>=8,t+=8),0==(15&e)&&(e>>=4,t+=4),0==(3&e)&&(e>>=2,t+=2),0==(1&e)&&++t,t}function bnGetLowestSetBit(){for(var e=0;e<this.t;++e)if(0!=this.data[e])return e*this.DB+lbit(this.data[e]);return this.s<0?this.t*this.DB:-1}function cbit(e){for(var t=0;0!=e;)e&=e-1,++t;return t}function bnBitCount(){for(var e=0,t=this.s&this.DM,r=0;r<this.t;++r)e+=cbit(this.data[r]^t);return e}function bnTestBit(e){var t=Math.floor(e/this.DB);return t>=this.t?0!=this.s:0!=(this.data[t]&1<<e%this.DB)}function bnpChangeBit(e,t){var r=BigInteger$3.ONE.shiftLeft(e);return this.bitwiseTo(r,t,r),r}function bnSetBit(e){return this.changeBit(e,op_or)}function bnClearBit(e){return this.changeBit(e,op_andnot)}function bnFlipBit(e){return this.changeBit(e,op_xor)}function bnpAddTo(e,t){for(var r=0,n=0,i=Math.min(e.t,this.t);r<i;)n+=this.data[r]+e.data[r],t.data[r++]=n&this.DM,n>>=this.DB;if(e.t<this.t){for(n+=e.s;r<this.t;)n+=this.data[r],t.data[r++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;r<e.t;)n+=e.data[r],t.data[r++]=n&this.DM,n>>=this.DB;n+=e.s}t.s=n<0?-1:0,n>0?t.data[r++]=n:n<-1&&(t.data[r++]=this.DV+n),t.t=r,t.clamp()}function bnAdd(e){var t=nbi();return this.addTo(e,t),t}function bnSubtract(e){var t=nbi();return this.subTo(e,t),t}function bnMultiply(e){var t=nbi();return this.multiplyTo(e,t),t}function bnDivide(e){var t=nbi();return this.divRemTo(e,t,null),t}function bnRemainder(e){var t=nbi();return this.divRemTo(e,null,t),t}function bnDivideAndRemainder(e){var t=nbi(),r=nbi();return this.divRemTo(e,t,r),new Array(t,r)}function bnpDMultiply(e){this.data[this.t]=this.am(0,e-1,this,0,0,this.t),++this.t,this.clamp()}function bnpDAddOffset(e,t){if(0!=e){for(;this.t<=t;)this.data[this.t++]=0;for(this.data[t]+=e;this.data[t]>=this.DV;)this.data[t]-=this.DV,++t>=this.t&&(this.data[this.t++]=0),++this.data[t]}}function NullExp(){}function nNop(e){return e}function nMulTo(e,t,r){e.multiplyTo(t,r)}function nSqrTo(e,t){e.squareTo(t)}function bnPow(e){return this.exp(e,new NullExp)}function bnpMultiplyLowerTo(e,t,r){var n,i=Math.min(this.t+e.t,t);for(r.s=0,r.t=i;i>0;)r.data[--i]=0;for(n=r.t-this.t;i<n;++i)r.data[i+this.t]=this.am(0,e.data[i],r,i,0,this.t);for(n=Math.min(e.t,t);i<n;++i)this.am(0,e.data[i],r,i,0,t-i);r.clamp()}function bnpMultiplyUpperTo(e,t,r){--t;var n=r.t=this.t+e.t-t;for(r.s=0;--n>=0;)r.data[n]=0;for(n=Math.max(t-this.t,0);n<e.t;++n)r.data[this.t+n-t]=this.am(t-n,e.data[n],r,0,0,this.t+n-t);r.clamp(),r.drShiftTo(1,r)}function Barrett(e){this.r2=nbi(),this.q3=nbi(),BigInteger$3.ONE.dlShiftTo(2*e.t,this.r2),this.mu=this.r2.divide(e),this.m=e}function barrettConvert(e){if(e.s<0||e.t>2*this.m.t)return e.mod(this.m);if(e.compareTo(this.m)<0)return e;var t=nbi();return e.copyTo(t),this.reduce(t),t}function barrettRevert(e){return e}function barrettReduce(e){for(e.drShiftTo(this.m.t-1,this.r2),e.t>this.m.t+1&&(e.t=this.m.t+1,e.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);e.compareTo(this.r2)<0;)e.dAddOffset(1,this.m.t+1);for(e.subTo(this.r2,e);e.compareTo(this.m)>=0;)e.subTo(this.m,e)}function barrettSqrTo(e,t){e.squareTo(t),this.reduce(t)}function barrettMulTo(e,t,r){e.multiplyTo(t,r),this.reduce(r)}function bnModPow(e,t){var r,n,i=e.bitLength(),s=nbv(1);if(i<=0)return s;r=i<18?1:i<48?3:i<144?4:i<768?5:6,n=i<8?new Classic(t):t.isEven()?new Barrett(t):new Montgomery(t);var o=new Array,a=3,u=r-1,c=(1<<r)-1;if(o[1]=n.convert(this),r>1){var l=nbi();for(n.sqrTo(o[1],l);a<=c;)o[a]=nbi(),n.mulTo(l,o[a-2],o[a]),a+=2}var h,d,f=e.t-1,p=!0,y=nbi();for(i=nbits(e.data[f])-1;f>=0;){for(i>=u?h=e.data[f]>>i-u&c:(h=(e.data[f]&(1<<i+1)-1)<<u-i,f>0&&(h|=e.data[f-1]>>this.DB+i-u)),a=r;0==(1&h);)h>>=1,--a;if((i-=a)<0&&(i+=this.DB,--f),p)o[h].copyTo(s),p=!1;else{for(;a>1;)n.sqrTo(s,y),n.sqrTo(y,s),a-=2;a>0?n.sqrTo(s,y):(d=s,s=y,y=d),n.mulTo(y,o[h],s)}for(;f>=0&&0==(e.data[f]&1<<i);)n.sqrTo(s,y),d=s,s=y,y=d,--i<0&&(i=this.DB-1,--f)}return n.revert(s)}function bnGCD(e){var t=this.s<0?this.negate():this.clone(),r=e.s<0?e.negate():e.clone();if(t.compareTo(r)<0){var n=t;t=r,r=n}var i=t.getLowestSetBit(),s=r.getLowestSetBit();if(s<0)return t;for(i<s&&(s=i),s>0&&(t.rShiftTo(s,t),r.rShiftTo(s,r));t.signum()>0;)(i=t.getLowestSetBit())>0&&t.rShiftTo(i,t),(i=r.getLowestSetBit())>0&&r.rShiftTo(i,r),t.compareTo(r)>=0?(t.subTo(r,t),t.rShiftTo(1,t)):(r.subTo(t,r),r.rShiftTo(1,r));return s>0&&r.lShiftTo(s,r),r}function bnpModInt(e){if(e<=0)return 0;var t=this.DV%e,r=this.s<0?e-1:0;if(this.t>0)if(0==t)r=this.data[0]%e;else for(var n=this.t-1;n>=0;--n)r=(t*r+this.data[n])%e;return r}function bnModInverse(e){var t=e.isEven();if(this.isEven()&&t||0==e.signum())return BigInteger$3.ZERO;for(var r=e.clone(),n=this.clone(),i=nbv(1),s=nbv(0),o=nbv(0),a=nbv(1);0!=r.signum();){for(;r.isEven();)r.rShiftTo(1,r),t?(i.isEven()&&s.isEven()||(i.addTo(this,i),s.subTo(e,s)),i.rShiftTo(1,i)):s.isEven()||s.subTo(e,s),s.rShiftTo(1,s);for(;n.isEven();)n.rShiftTo(1,n),t?(o.isEven()&&a.isEven()||(o.addTo(this,o),a.subTo(e,a)),o.rShiftTo(1,o)):a.isEven()||a.subTo(e,a),a.rShiftTo(1,a);r.compareTo(n)>=0?(r.subTo(n,r),t&&i.subTo(o,i),s.subTo(a,s)):(n.subTo(r,n),t&&o.subTo(i,o),a.subTo(s,a))}return 0!=n.compareTo(BigInteger$3.ONE)?BigInteger$3.ZERO:a.compareTo(e)>=0?a.subtract(e):a.signum()<0?(a.addTo(e,a),a.signum()<0?a.add(e):a):a}Classic.prototype.convert=cConvert,Classic.prototype.revert=cRevert,Classic.prototype.reduce=cReduce,Classic.prototype.mulTo=cMulTo,Classic.prototype.sqrTo=cSqrTo,Montgomery.prototype.convert=montConvert,Montgomery.prototype.revert=montRevert,Montgomery.prototype.reduce=montReduce,Montgomery.prototype.mulTo=montMulTo,Montgomery.prototype.sqrTo=montSqrTo,BigInteger$3.prototype.copyTo=bnpCopyTo,BigInteger$3.prototype.fromInt=bnpFromInt,BigInteger$3.prototype.fromString=bnpFromString,BigInteger$3.prototype.clamp=bnpClamp,BigInteger$3.prototype.dlShiftTo=bnpDLShiftTo,BigInteger$3.prototype.drShiftTo=bnpDRShiftTo,BigInteger$3.prototype.lShiftTo=bnpLShiftTo,BigInteger$3.prototype.rShiftTo=bnpRShiftTo,BigInteger$3.prototype.subTo=bnpSubTo,BigInteger$3.prototype.multiplyTo=bnpMultiplyTo,BigInteger$3.prototype.squareTo=bnpSquareTo,BigInteger$3.prototype.divRemTo=bnpDivRemTo,BigInteger$3.prototype.invDigit=bnpInvDigit,BigInteger$3.prototype.isEven=bnpIsEven,BigInteger$3.prototype.exp=bnpExp,BigInteger$3.prototype.toString=bnToString,BigInteger$3.prototype.negate=bnNegate,BigInteger$3.prototype.abs=bnAbs,BigInteger$3.prototype.compareTo=bnCompareTo,BigInteger$3.prototype.bitLength=bnBitLength,BigInteger$3.prototype.mod=bnMod,BigInteger$3.prototype.modPowInt=bnModPowInt,BigInteger$3.ZERO=nbv(0),BigInteger$3.ONE=nbv(1),NullExp.prototype.convert=nNop,NullExp.prototype.revert=nNop,NullExp.prototype.mulTo=nMulTo,NullExp.prototype.sqrTo=nSqrTo,Barrett.prototype.convert=barrettConvert,Barrett.prototype.revert=barrettRevert,Barrett.prototype.reduce=barrettReduce,Barrett.prototype.mulTo=barrettMulTo,Barrett.prototype.sqrTo=barrettSqrTo;var lowprimes=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509],lplim=(1<<26)/lowprimes[lowprimes.length-1];function bnIsProbablePrime(e){var t,r=this.abs();if(1==r.t&&r.data[0]<=lowprimes[lowprimes.length-1]){for(t=0;t<lowprimes.length;++t)if(r.data[0]==lowprimes[t])return!0;return!1}if(r.isEven())return!1;for(t=1;t<lowprimes.length;){for(var n=lowprimes[t],i=t+1;i<lowprimes.length&&n<lplim;)n*=lowprimes[i++];for(n=r.modInt(n);t<i;)if(n%lowprimes[t++]==0)return!1}return r.millerRabin(e)}function bnpMillerRabin(e){var t=this.subtract(BigInteger$3.ONE),r=t.getLowestSetBit();if(r<=0)return!1;for(var n,i=t.shiftRight(r),s=bnGetPrng(),o=0;o<e;++o){do{n=new BigInteger$3(this.bitLength(),s)}while(n.compareTo(BigInteger$3.ONE)<=0||n.compareTo(t)>=0);var a=n.modPow(i,this);if(0!=a.compareTo(BigInteger$3.ONE)&&0!=a.compareTo(t)){for(var u=1;u++<r&&0!=a.compareTo(t);)if(0==(a=a.modPowInt(2,this)).compareTo(BigInteger$3.ONE))return!1;if(0!=a.compareTo(t))return!1}}return!0}function bnGetPrng(){return{nextBytes:function(e){for(var t=0;t<e.length;++t)e[t]=Math.floor(256*Math.random())}}}BigInteger$3.prototype.chunkSize=bnpChunkSize,BigInteger$3.prototype.toRadix=bnpToRadix,BigInteger$3.prototype.fromRadix=bnpFromRadix,BigInteger$3.prototype.fromNumber=bnpFromNumber,BigInteger$3.prototype.bitwiseTo=bnpBitwiseTo,BigInteger$3.prototype.changeBit=bnpChangeBit,BigInteger$3.prototype.addTo=bnpAddTo,BigInteger$3.prototype.dMultiply=bnpDMultiply,BigInteger$3.prototype.dAddOffset=bnpDAddOffset,BigInteger$3.prototype.multiplyLowerTo=bnpMultiplyLowerTo,BigInteger$3.prototype.multiplyUpperTo=bnpMultiplyUpperTo,BigInteger$3.prototype.modInt=bnpModInt,BigInteger$3.prototype.millerRabin=bnpMillerRabin,BigInteger$3.prototype.clone=bnClone,BigInteger$3.prototype.intValue=bnIntValue,BigInteger$3.prototype.byteValue=bnByteValue,BigInteger$3.prototype.shortValue=bnShortValue,BigInteger$3.prototype.signum=bnSigNum,BigInteger$3.prototype.toByteArray=bnToByteArray,BigInteger$3.prototype.equals=bnEquals,BigInteger$3.prototype.min=bnMin,BigInteger$3.prototype.max=bnMax,BigInteger$3.prototype.and=bnAnd,BigInteger$3.prototype.or=bnOr,BigInteger$3.prototype.xor=bnXor,BigInteger$3.prototype.andNot=bnAndNot,BigInteger$3.prototype.not=bnNot,BigInteger$3.prototype.shiftLeft=bnShiftLeft,BigInteger$3.prototype.shiftRight=bnShiftRight,BigInteger$3.prototype.getLowestSetBit=bnGetLowestSetBit,BigInteger$3.prototype.bitCount=bnBitCount,BigInteger$3.prototype.testBit=bnTestBit,BigInteger$3.prototype.setBit=bnSetBit,BigInteger$3.prototype.clearBit=bnClearBit,BigInteger$3.prototype.flipBit=bnFlipBit,BigInteger$3.prototype.add=bnAdd,BigInteger$3.prototype.subtract=bnSubtract,BigInteger$3.prototype.multiply=bnMultiply,BigInteger$3.prototype.divide=bnDivide,BigInteger$3.prototype.remainder=bnRemainder,BigInteger$3.prototype.divideAndRemainder=bnDivideAndRemainder,BigInteger$3.prototype.modPow=bnModPow,BigInteger$3.prototype.modInverse=bnModInverse,BigInteger$3.prototype.pow=bnPow,BigInteger$3.prototype.gcd=bnGCD,BigInteger$3.prototype.isProbablePrime=bnIsProbablePrime;var forge$G=forge$X,sha1=forge$G.sha1=forge$G.sha1||{};forge$G.md.sha1=forge$G.md.algorithms.sha1=sha1,sha1.create=function(){_initialized$1||_init$1();var e=null,t=forge$G.util.createBuffer(),r=new Array(80),n={algorithm:"sha1",blockLength:64,digestLength:20,messageLength:0,fullMessageLength:null,messageLengthSize:8,start:function(){n.messageLength=0,n.fullMessageLength=n.messageLength64=[];for(var r=n.messageLengthSize/4,i=0;i<r;++i)n.fullMessageLength.push(0);return t=forge$G.util.createBuffer(),e={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878,h4:3285377520},n}};return n.start(),n.update=function(i,s){"utf8"===s&&(i=forge$G.util.encodeUtf8(i));var o=i.length;n.messageLength+=o,o=[o/4294967296>>>0,o>>>0];for(var a=n.fullMessageLength.length-1;a>=0;--a)n.fullMessageLength[a]+=o[1],o[1]=o[0]+(n.fullMessageLength[a]/4294967296>>>0),n.fullMessageLength[a]=n.fullMessageLength[a]>>>0,o[0]=o[1]/4294967296>>>0;return t.putBytes(i),_update$1(e,r,t),(t.read>2048||0===t.length())&&t.compact(),n},n.digest=function(){var i=forge$G.util.createBuffer();i.putBytes(t.bytes());var s,o=n.fullMessageLength[n.fullMessageLength.length-1]+n.messageLengthSize&n.blockLength-1;i.putBytes(_padding$1.substr(0,n.blockLength-o));for(var a=8*n.fullMessageLength[0],u=0;u<n.fullMessageLength.length-1;++u)a+=(s=8*n.fullMessageLength[u+1])/4294967296>>>0,i.putInt32(a>>>0),a=s>>>0;i.putInt32(a);var c={h0:e.h0,h1:e.h1,h2:e.h2,h3:e.h3,h4:e.h4};_update$1(c,r,i);var l=forge$G.util.createBuffer();return l.putInt32(c.h0),l.putInt32(c.h1),l.putInt32(c.h2),l.putInt32(c.h3),l.putInt32(c.h4),l},n};var _padding$1=null,_initialized$1=!1;function _init$1(){_padding$1=String.fromCharCode(128),_padding$1+=forge$G.util.fillString(String.fromCharCode(0),64),_initialized$1=!0}function _update$1(e,t,r){for(var n,i,s,o,a,u,c,l=r.length();l>=64;){for(i=e.h0,s=e.h1,o=e.h2,a=e.h3,u=e.h4,c=0;c<16;++c)n=r.getInt32(),t[c]=n,n=(i<<5|i>>>27)+(a^s&(o^a))+u+1518500249+n,u=a,a=o,o=(s<<30|s>>>2)>>>0,s=i,i=n;for(;c<20;++c)n=(n=t[c-3]^t[c-8]^t[c-14]^t[c-16])<<1|n>>>31,t[c]=n,n=(i<<5|i>>>27)+(a^s&(o^a))+u+1518500249+n,u=a,a=o,o=(s<<30|s>>>2)>>>0,s=i,i=n;for(;c<32;++c)n=(n=t[c-3]^t[c-8]^t[c-14]^t[c-16])<<1|n>>>31,t[c]=n,n=(i<<5|i>>>27)+(s^o^a)+u+1859775393+n,u=a,a=o,o=(s<<30|s>>>2)>>>0,s=i,i=n;for(;c<40;++c)n=(n=t[c-6]^t[c-16]^t[c-28]^t[c-32])<<2|n>>>30,t[c]=n,n=(i<<5|i>>>27)+(s^o^a)+u+1859775393+n,u=a,a=o,o=(s<<30|s>>>2)>>>0,s=i,i=n;for(;c<60;++c)n=(n=t[c-6]^t[c-16]^t[c-28]^t[c-32])<<2|n>>>30,t[c]=n,n=(i<<5|i>>>27)+(s&o|a&(s^o))+u+2400959708+n,u=a,a=o,o=(s<<30|s>>>2)>>>0,s=i,i=n;for(;c<80;++c)n=(n=t[c-6]^t[c-16]^t[c-28]^t[c-32])<<2|n>>>30,t[c]=n,n=(i<<5|i>>>27)+(s^o^a)+u+3395469782+n,u=a,a=o,o=(s<<30|s>>>2)>>>0,s=i,i=n;e.h0=e.h0+i|0,e.h1=e.h1+s|0,e.h2=e.h2+o|0,e.h3=e.h3+a|0,e.h4=e.h4+u|0,l-=64}}var forge$F=forge$X,pkcs1=forge$F.pkcs1=forge$F.pkcs1||{};function rsa_mgf1(e,t,r){r||(r=forge$F.md.sha1.create());for(var n="",i=Math.ceil(t/r.digestLength),s=0;s<i;++s){var o=String.fromCharCode(s>>24&255,s>>16&255,s>>8&255,255&s);r.start(),r.update(e+o),n+=r.digest().getBytes()}return n.substring(0,t)}pkcs1.encode_rsa_oaep=function(e,t,r){var n,i,s,o;"string"==typeof r?(n=r,i=arguments[3]||void 0,s=arguments[4]||void 0):r&&(n=r.label||void 0,i=r.seed||void 0,s=r.md||void 0,r.mgf1&&r.mgf1.md&&(o=r.mgf1.md)),s?s.start():s=forge$F.md.sha1.create(),o||(o=s);var a=Math.ceil(e.n.bitLength()/8),u=a-2*s.digestLength-2;if(t.length>u)throw(p=new Error("RSAES-OAEP input message length is too long.")).length=t.length,p.maxLength=u,p;n||(n=""),s.update(n,"raw");for(var c=s.digest(),l="",h=u-t.length,d=0;d<h;d++)l+="\0";var f=c.getBytes()+l+""+t;if(i){if(i.length!==s.digestLength){var p;throw(p=new Error("Invalid RSAES-OAEP seed. The seed length must match the digest length.")).seedLength=i.length,p.digestLength=s.digestLength,p}}else i=forge$F.random.getBytes(s.digestLength);var y=rsa_mgf1(i,a-s.digestLength-1,o),g=forge$F.util.xorBytes(f,y,f.length),$=rsa_mgf1(g,s.digestLength,o),m=forge$F.util.xorBytes(i,$,i.length);return"\0"+m+g},pkcs1.decode_rsa_oaep=function(e,t,r){var n,i,s;"string"==typeof r?(n=r,i=arguments[3]||void 0):r&&(n=r.label||void 0,i=r.md||void 0,r.mgf1&&r.mgf1.md&&(s=r.mgf1.md));var o=Math.ceil(e.n.bitLength()/8);if(t.length!==o)throw(g=new Error("RSAES-OAEP encoded message length is invalid.")).length=t.length,g.expectedLength=o,g;if(void 0===i?i=forge$F.md.sha1.create():i.start(),s||(s=i),o<2*i.digestLength+2)throw new Error("RSAES-OAEP key is too short for the hash function.");n||(n=""),i.update(n,"raw");for(var a=i.digest().getBytes(),u=t.charAt(0),c=t.substring(1,i.digestLength+1),l=t.substring(1+i.digestLength),h=rsa_mgf1(l,i.digestLength,s),d=forge$F.util.xorBytes(c,h,c.length),f=rsa_mgf1(d,o-i.digestLength-1,s),p=forge$F.util.xorBytes(l,f,l.length),y=p.substring(0,i.digestLength),g="\0"!==u,$=0;$<i.digestLength;++$)g|=a.charAt($)!==y.charAt($);for(var m=1,b=i.digestLength,v=i.digestLength;v<p.length;v++){var _=p.charCodeAt(v),w=1&_^1,E=m?65534:0;g|=_&E,b+=m&=w}if(g||1!==p.charCodeAt(b))throw new Error("Invalid RSAES-OAEP padding.");return p.substring(b+1)};var forge$E=forge$X;!function(){if(!forge$E.prime){var e=forge$E.prime=forge$E.prime||{},t=forge$E.jsbn.BigInteger,r=[6,4,2,4,2,4,6,2],n=new t(null);n.fromInt(30);var i=function(e,t){return e|t};e.generateProbablePrime=function(e,r,n){"function"==typeof r&&(n=r,r={});var i=(r=r||{}).algorithm||"PRIMEINC";"string"==typeof i&&(i={name:i}),i.options=i.options||{};var o=r.prng||forge$E.random,u={nextBytes:function(e){for(var t=o.getBytesSync(e.length),r=0;r<e.length;++r)e[r]=t.charCodeAt(r)}};if("PRIMEINC"===i.name)return function(e,r,n,i){if("workers"in n)return function(e,r,n,i){if("undefined"==typeof Worker)return s(e,r,n,i);var o=a(e,r),u=n.workers,c=n.workLoad||100,l=30*c/8,h=n.workerScript||"forge/prime.worker.js";if(-1===u)return forge$E.util.estimateCores((function(e,t){e&&(t=2),u=t-1,d()}));function d(){u=Math.max(1,u);for(var n=[],s=0;s<u;++s)n[s]=new Worker(h);for(s=0;s<u;++s)n[s].addEventListener("message",f);var d=!1;function f(s){if(!d){var u=s.data;if(u.found){for(var h=0;h<n.length;++h)n[h].terminate();return d=!0,i(null,new t(u.prime,16))}o.bitLength()>e&&(o=a(e,r));var f=o.toString(16);s.target.postMessage({hex:f,workLoad:c}),o.dAddOffset(l,0)}}}d()}(e,r,n,i);return s(e,r,n,i)}(e,u,i.options,n);throw new Error("Invalid prime generation algorithm: "+i.name)}}function s(e,t,r,n){var i=a(e,t),s=function(e){return e<=100?27:e<=150?18:e<=200?15:e<=250?12:e<=300?9:e<=350?8:e<=400?7:e<=500?6:e<=600?5:e<=800?4:e<=1250?3:2}(i.bitLength());"millerRabinTests"in r&&(s=r.millerRabinTests);var u=10;"maxBlockTime"in r&&(u=r.maxBlockTime),o(i,e,t,0,s,u,n)}function o(e,t,n,i,s,u,c){var l=+new Date;do{if(e.bitLength()>t&&(e=a(t,n)),e.isProbablePrime(s))return c(null,e);e.dAddOffset(r[i++%8],0)}while(u<0||+new Date-l<u);forge$E.util.setImmediate((function(){o(e,t,n,i,s,u,c)}))}function a(e,r){var s=new t(e,r),o=e-1;return s.testBit(o)||s.bitwiseTo(t.ONE.shiftLeft(o),i,s),s.dAddOffset(31-s.mod(n).byteValue(),0),s}}();var forge$D=forge$X;if(void 0===BigInteger$2)var BigInteger$2=forge$D.jsbn.BigInteger;var _crypto=forge$D.util.isNodejs?require$$0$9:null,asn1$5=forge$D.asn1,util$8=forge$D.util;forge$D.pki=forge$D.pki||{},forge$D.pki.rsa=forge$D.rsa=forge$D.rsa||{};var pki$3=forge$D.pki,GCD_30_DELTA=[6,4,2,4,2,4,6,2],privateKeyValidator$1={name:"PrivateKeyInfo",tagClass:asn1$5.Class.UNIVERSAL,type:asn1$5.Type.SEQUENCE,constructed:!0,value:[{name:"PrivateKeyInfo.version",tagClass:asn1$5.Class.UNIVERSAL,type:asn1$5.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"PrivateKeyInfo.privateKeyAlgorithm",tagClass:asn1$5.Class.UNIVERSAL,type:asn1$5.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:asn1$5.Class.UNIVERSAL,type:asn1$5.Type.OID,constructed:!1,capture:"privateKeyOid"}]},{name:"PrivateKeyInfo",tagClass:asn1$5.Class.UNIVERSAL,type:asn1$5.Type.OCTETSTRING,constructed:!1,capture:"privateKey"}]},rsaPrivateKeyValidator={name:"RSAPrivateKey",tagClass:asn1$5.Class.UNIVERSAL,type:asn1$5.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPrivateKey.version",tagClass:asn1$5.Class.UNIVERSAL,type:asn1$5.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"RSAPrivateKey.modulus",tagClass:asn1$5.Class.UNIVERSAL,type:asn1$5.Type.INTEGER,constructed:!1,capture:"privateKeyModulus"},{name:"RSAPrivateKey.publicExponent",tagClass:asn1$5.Class.UNIVERSAL,type:asn1$5.Type.INTEGER,constructed:!1,capture:"privateKeyPublicExponent"},{name:"RSAPrivateKey.privateExponent",tagClass:asn1$5.Class.UNIVERSAL,type:asn1$5.Type.INTEGER,constructed:!1,capture:"privateKeyPrivateExponent"},{name:"RSAPrivateKey.prime1",tagClass:asn1$5.Class.UNIVERSAL,type:asn1$5.Type.INTEGER,constructed:!1,capture:"privateKeyPrime1"},{name:"RSAPrivateKey.prime2",tagClass:asn1$5.Class.UNIVERSAL,type:asn1$5.Type.INTEGER,constructed:!1,capture:"privateKeyPrime2"},{name:"RSAPrivateKey.exponent1",tagClass:asn1$5.Class.UNIVERSAL,type:asn1$5.Type.INTEGER,constructed:!1,capture:"privateKeyExponent1"},{name:"RSAPrivateKey.exponent2",tagClass:asn1$5.Class.UNIVERSAL,type:asn1$5.Type.INTEGER,constructed:!1,capture:"privateKeyExponent2"},{name:"RSAPrivateKey.coefficient",tagClass:asn1$5.Class.UNIVERSAL,type:asn1$5.Type.INTEGER,constructed:!1,capture:"privateKeyCoefficient"}]},rsaPublicKeyValidator={name:"RSAPublicKey",tagClass:asn1$5.Class.UNIVERSAL,type:asn1$5.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPublicKey.modulus",tagClass:asn1$5.Class.UNIVERSAL,type:asn1$5.Type.INTEGER,constructed:!1,capture:"publicKeyModulus"},{name:"RSAPublicKey.exponent",tagClass:asn1$5.Class.UNIVERSAL,type:asn1$5.Type.INTEGER,constructed:!1,capture:"publicKeyExponent"}]},publicKeyValidator$2=forge$D.pki.rsa.publicKeyValidator={name:"SubjectPublicKeyInfo",tagClass:asn1$5.Class.UNIVERSAL,type:asn1$5.Type.SEQUENCE,constructed:!0,captureAsn1:"subjectPublicKeyInfo",value:[{name:"SubjectPublicKeyInfo.AlgorithmIdentifier",tagClass:asn1$5.Class.UNIVERSAL,type:asn1$5.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:asn1$5.Class.UNIVERSAL,type:asn1$5.Type.OID,constructed:!1,capture:"publicKeyOid"}]},{name:"SubjectPublicKeyInfo.subjectPublicKey",tagClass:asn1$5.Class.UNIVERSAL,type:asn1$5.Type.BITSTRING,constructed:!1,value:[{name:"SubjectPublicKeyInfo.subjectPublicKey.RSAPublicKey",tagClass:asn1$5.Class.UNIVERSAL,type:asn1$5.Type.SEQUENCE,constructed:!0,optional:!0,captureAsn1:"rsaPublicKey"}]}]},emsaPkcs1v15encode=function(e){var t;if(!(e.algorithm in pki$3.oids)){var r=new Error("Unknown message digest algorithm.");throw r.algorithm=e.algorithm,r}t=pki$3.oids[e.algorithm];var n=asn1$5.oidToDer(t).getBytes(),i=asn1$5.create(asn1$5.Class.UNIVERSAL,asn1$5.Type.SEQUENCE,!0,[]),s=asn1$5.create(asn1$5.Class.UNIVERSAL,asn1$5.Type.SEQUENCE,!0,[]);s.value.push(asn1$5.create(asn1$5.Class.UNIVERSAL,asn1$5.Type.OID,!1,n)),s.value.push(asn1$5.create(asn1$5.Class.UNIVERSAL,asn1$5.Type.NULL,!1,""));var o=asn1$5.create(asn1$5.Class.UNIVERSAL,asn1$5.Type.OCTETSTRING,!1,e.digest().getBytes());return i.value.push(s),i.value.push(o),asn1$5.toDer(i).getBytes()},_modPow=function(e,t,r){if(r)return e.modPow(t.e,t.n);if(!t.p||!t.q)return e.modPow(t.d,t.n);var n;t.dP||(t.dP=t.d.mod(t.p.subtract(BigInteger$2.ONE))),t.dQ||(t.dQ=t.d.mod(t.q.subtract(BigInteger$2.ONE))),t.qInv||(t.qInv=t.q.modInverse(t.p));do{n=new BigInteger$2(forge$D.util.bytesToHex(forge$D.random.getBytes(t.n.bitLength()/8)),16)}while(n.compareTo(t.n)>=0||!n.gcd(t.n).equals(BigInteger$2.ONE));for(var i=(e=e.multiply(n.modPow(t.e,t.n)).mod(t.n)).mod(t.p).modPow(t.dP,t.p),s=e.mod(t.q).modPow(t.dQ,t.q);i.compareTo(s)<0;)i=i.add(t.p);var o=i.subtract(s).multiply(t.qInv).mod(t.p).multiply(t.q).add(s);return o=o.multiply(n.modInverse(t.n)).mod(t.n)};function _encodePkcs1_v1_5(e,t,r){var n=forge$D.util.createBuffer(),i=Math.ceil(t.n.bitLength()/8);if(e.length>i-11){var s=new Error("Message is too long for PKCS#1 v1.5 padding.");throw s.length=e.length,s.max=i-11,s}n.putByte(0),n.putByte(r);var o,a=i-3-e.length;if(0===r||1===r){o=0===r?0:255;for(var u=0;u<a;++u)n.putByte(o)}else for(;a>0;){var c=0,l=forge$D.random.getBytes(a);for(u=0;u<a;++u)0===(o=l.charCodeAt(u))?++c:n.putByte(o);a=c}return n.putByte(0),n.putBytes(e),n}function _decodePkcs1_v1_5(e,t,r,n){var i=Math.ceil(t.n.bitLength()/8),s=forge$D.util.createBuffer(e),o=s.getByte(),a=s.getByte();if(0!==o||r&&0!==a&&1!==a||!r&&2!=a||r&&0===a&&void 0===n)throw new Error("Encryption block is invalid.");var u=0;if(0===a){u=i-3-n;for(var c=0;c<u;++c)if(0!==s.getByte())throw new Error("Encryption block is invalid.")}else if(1===a)for(u=0;s.length()>1;){if(255!==s.getByte()){--s.read;break}++u}else if(2===a)for(u=0;s.length()>1;){if(0===s.getByte()){--s.read;break}++u}if(0!==s.getByte()||u!==i-3-s.length())throw new Error("Encryption block is invalid.");return s.getBytes()}function _generateKeyPair(e,t,r){"function"==typeof t&&(r=t,t={});var n={algorithm:{name:(t=t||{}).algorithm||"PRIMEINC",options:{workers:t.workers||2,workLoad:t.workLoad||100,workerScript:t.workerScript}}};function i(){s(e.pBits,(function(t,n){return t?r(t):(e.p=n,null!==e.q?o(t,e.q):void s(e.qBits,o))}))}function s(e,t){forge$D.prime.generateProbablePrime(e,n,t)}function o(t,n){if(t)return r(t);if(e.q=n,e.p.compareTo(e.q)<0){var a=e.p;e.p=e.q,e.q=a}if(0!==e.p.subtract(BigInteger$2.ONE).gcd(e.e).compareTo(BigInteger$2.ONE))return e.p=null,void i();if(0!==e.q.subtract(BigInteger$2.ONE).gcd(e.e).compareTo(BigInteger$2.ONE))return e.q=null,void s(e.qBits,o);if(e.p1=e.p.subtract(BigInteger$2.ONE),e.q1=e.q.subtract(BigInteger$2.ONE),e.phi=e.p1.multiply(e.q1),0!==e.phi.gcd(e.e).compareTo(BigInteger$2.ONE))return e.p=e.q=null,void i();if(e.n=e.p.multiply(e.q),e.n.bitLength()!==e.bits)return e.q=null,void s(e.qBits,o);var u=e.e.modInverse(e.phi);e.keys={privateKey:pki$3.rsa.setPrivateKey(e.n,e.e,u,e.p,e.q,u.mod(e.p1),u.mod(e.q1),e.q.modInverse(e.p)),publicKey:pki$3.rsa.setPublicKey(e.n,e.e)},r(null,e.keys)}"prng"in t&&(n.prng=t.prng),i()}function _bnToBytes(e){var t=e.toString(16);t[0]>="8"&&(t="00"+t);var r=forge$D.util.hexToBytes(t);return r.length>1&&(0===r.charCodeAt(0)&&0==(128&r.charCodeAt(1))||255===r.charCodeAt(0)&&128==(128&r.charCodeAt(1)))?r.substr(1):r}function _getMillerRabinTests(e){return e<=100?27:e<=150?18:e<=200?15:e<=250?12:e<=300?9:e<=350?8:e<=400?7:e<=500?6:e<=600?5:e<=800?4:e<=1250?3:2}function _detectNodeCrypto(e){return forge$D.util.isNodejs&&"function"==typeof _crypto[e]}function _detectSubtleCrypto(e){return void 0!==util$8.globalScope&&"object"==typeof util$8.globalScope.crypto&&"object"==typeof util$8.globalScope.crypto.subtle&&"function"==typeof util$8.globalScope.crypto.subtle[e]}function _detectSubtleMsCrypto(e){return void 0!==util$8.globalScope&&"object"==typeof util$8.globalScope.msCrypto&&"object"==typeof util$8.globalScope.msCrypto.subtle&&"function"==typeof util$8.globalScope.msCrypto.subtle[e]}function _intToUint8Array(e){for(var t=forge$D.util.hexToBytes(e.toString(16)),r=new Uint8Array(t.length),n=0;n<t.length;++n)r[n]=t.charCodeAt(n);return r}pki$3.rsa.encrypt=function(e,t,r){var n,i=r,s=Math.ceil(t.n.bitLength()/8);!1!==r&&!0!==r?(i=2===r,n=_encodePkcs1_v1_5(e,t,r)):(n=forge$D.util.createBuffer()).putBytes(e);for(var o=new BigInteger$2(n.toHex(),16),a=_modPow(o,t,i).toString(16),u=forge$D.util.createBuffer(),c=s-Math.ceil(a.length/2);c>0;)u.putByte(0),--c;return u.putBytes(forge$D.util.hexToBytes(a)),u.getBytes()},pki$3.rsa.decrypt=function(e,t,r,n){var i=Math.ceil(t.n.bitLength()/8);if(e.length!==i){var s=new Error("Encrypted message length is invalid.");throw s.length=e.length,s.expected=i,s}var o=new BigInteger$2(forge$D.util.createBuffer(e).toHex(),16);if(o.compareTo(t.n)>=0)throw new Error("Encrypted message is invalid.");for(var a=_modPow(o,t,r).toString(16),u=forge$D.util.createBuffer(),c=i-Math.ceil(a.length/2);c>0;)u.putByte(0),--c;return u.putBytes(forge$D.util.hexToBytes(a)),!1!==n?_decodePkcs1_v1_5(u.getBytes(),t,r):u.getBytes()},pki$3.rsa.createKeyPairGenerationState=function(e,t,r){"string"==typeof e&&(e=parseInt(e,10)),e=e||2048;var n,i=(r=r||{}).prng||forge$D.random,s={nextBytes:function(e){for(var t=i.getBytesSync(e.length),r=0;r<e.length;++r)e[r]=t.charCodeAt(r)}},o=r.algorithm||"PRIMEINC";if("PRIMEINC"!==o)throw new Error("Invalid key generation algorithm: "+o);return(n={algorithm:o,state:0,bits:e,rng:s,eInt:t||65537,e:new BigInteger$2(null),p:null,q:null,qBits:e>>1,pBits:e-(e>>1),pqState:0,num:null,keys:null}).e.fromInt(n.eInt),n},pki$3.rsa.stepKeyPairGenerationState=function(e,t){"algorithm"in e||(e.algorithm="PRIMEINC");var r=new BigInteger$2(null);r.fromInt(30);for(var n,i=0,s=function(e,t){return e|t},o=+new Date,a=0;null===e.keys&&(t<=0||a<t);){if(0===e.state){var u=null===e.p?e.pBits:e.qBits,c=u-1;0===e.pqState?(e.num=new BigInteger$2(u,e.rng),e.num.testBit(c)||e.num.bitwiseTo(BigInteger$2.ONE.shiftLeft(c),s,e.num),e.num.dAddOffset(31-e.num.mod(r).byteValue(),0),i=0,++e.pqState):1===e.pqState?e.num.bitLength()>u?e.pqState=0:e.num.isProbablePrime(_getMillerRabinTests(e.num.bitLength()))?++e.pqState:e.num.dAddOffset(GCD_30_DELTA[i++%8],0):2===e.pqState?e.pqState=0===e.num.subtract(BigInteger$2.ONE).gcd(e.e).compareTo(BigInteger$2.ONE)?3:0:3===e.pqState&&(e.pqState=0,null===e.p?e.p=e.num:e.q=e.num,null!==e.p&&null!==e.q&&++e.state,e.num=null)}else if(1===e.state)e.p.compareTo(e.q)<0&&(e.num=e.p,e.p=e.q,e.q=e.num),++e.state;else if(2===e.state)e.p1=e.p.subtract(BigInteger$2.ONE),e.q1=e.q.subtract(BigInteger$2.ONE),e.phi=e.p1.multiply(e.q1),++e.state;else if(3===e.state)0===e.phi.gcd(e.e).compareTo(BigInteger$2.ONE)?++e.state:(e.p=null,e.q=null,e.state=0);else if(4===e.state)e.n=e.p.multiply(e.q),e.n.bitLength()===e.bits?++e.state:(e.q=null,e.state=0);else if(5===e.state){var l=e.e.modInverse(e.phi);e.keys={privateKey:pki$3.rsa.setPrivateKey(e.n,e.e,l,e.p,e.q,l.mod(e.p1),l.mod(e.q1),e.q.modInverse(e.p)),publicKey:pki$3.rsa.setPublicKey(e.n,e.e)}}a+=(n=+new Date)-o,o=n}return null!==e.keys},pki$3.rsa.generateKeyPair=function(e,t,r,n){if(1===arguments.length?"object"==typeof e?(r=e,e=void 0):"function"==typeof e&&(n=e,e=void 0):2===arguments.length?"number"==typeof e?"function"==typeof t?(n=t,t=void 0):"number"!=typeof t&&(r=t,t=void 0):(r=e,n=t,e=void 0,t=void 0):3===arguments.length&&("number"==typeof t?"function"==typeof r&&(n=r,r=void 0):(n=r,r=t,t=void 0)),r=r||{},void 0===e&&(e=r.bits||2048),void 0===t&&(t=r.e||65537),!r.prng&&e>=256&&e<=16384&&(65537===t||3===t))if(n){if(_detectNodeCrypto("generateKeyPair"))return _crypto.generateKeyPair("rsa",{modulusLength:e,publicExponent:t,publicKeyEncoding:{type:"spki",format:"pem"},privateKeyEncoding:{type:"pkcs8",format:"pem"}},(function(e,t,r){if(e)return n(e);n(null,{privateKey:pki$3.privateKeyFromPem(r),publicKey:pki$3.publicKeyFromPem(t)})}));if(_detectSubtleCrypto("generateKey")&&_detectSubtleCrypto("exportKey"))return util$8.globalScope.crypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:_intToUint8Array(t),hash:{name:"SHA-256"}},!0,["sign","verify"]).then((function(e){return util$8.globalScope.crypto.subtle.exportKey("pkcs8",e.privateKey)})).then(void 0,(function(e){n(e)})).then((function(e){if(e){var t=pki$3.privateKeyFromAsn1(asn1$5.fromDer(forge$D.util.createBuffer(e)));n(null,{privateKey:t,publicKey:pki$3.setRsaPublicKey(t.n,t.e)})}}));if(_detectSubtleMsCrypto("generateKey")&&_detectSubtleMsCrypto("exportKey")){var i=util$8.globalScope.msCrypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:_intToUint8Array(t),hash:{name:"SHA-256"}},!0,["sign","verify"]);return i.oncomplete=function(e){var t=e.target.result,r=util$8.globalScope.msCrypto.subtle.exportKey("pkcs8",t.privateKey);r.oncomplete=function(e){var t=e.target.result,r=pki$3.privateKeyFromAsn1(asn1$5.fromDer(forge$D.util.createBuffer(t)));n(null,{privateKey:r,publicKey:pki$3.setRsaPublicKey(r.n,r.e)})},r.onerror=function(e){n(e)}},void(i.onerror=function(e){n(e)})}}else if(_detectNodeCrypto("generateKeyPairSync")){var s=_crypto.generateKeyPairSync("rsa",{modulusLength:e,publicExponent:t,publicKeyEncoding:{type:"spki",format:"pem"},privateKeyEncoding:{type:"pkcs8",format:"pem"}});return{privateKey:pki$3.privateKeyFromPem(s.privateKey),publicKey:pki$3.publicKeyFromPem(s.publicKey)}}var o=pki$3.rsa.createKeyPairGenerationState(e,t,r);if(!n)return pki$3.rsa.stepKeyPairGenerationState(o,0),o.keys;_generateKeyPair(o,r,n)},pki$3.setRsaPublicKey=pki$3.rsa.setPublicKey=function(e,t){var r={n:e,e:t,encrypt:function(e,t,n){if("string"==typeof t?t=t.toUpperCase():void 0===t&&(t="RSAES-PKCS1-V1_5"),"RSAES-PKCS1-V1_5"===t)t={encode:function(e,t,r){return _encodePkcs1_v1_5(e,t,2).getBytes()}};else if("RSA-OAEP"===t||"RSAES-OAEP"===t)t={encode:function(e,t){return forge$D.pkcs1.encode_rsa_oaep(t,e,n)}};else if(-1!==["RAW","NONE","NULL",null].indexOf(t))t={encode:function(e){return e}};else if("string"==typeof t)throw new Error('Unsupported encryption scheme: "'+t+'".');var i=t.encode(e,r,!0);return pki$3.rsa.encrypt(i,r,!0)},verify:function(e,t,n){"string"==typeof n?n=n.toUpperCase():void 0===n&&(n="RSASSA-PKCS1-V1_5"),"RSASSA-PKCS1-V1_5"===n?n={verify:function(e,t){return t=_decodePkcs1_v1_5(t,r,!0),e===asn1$5.fromDer(t).value[1].value}}:"NONE"!==n&&"NULL"!==n&&null!==n||(n={verify:function(e,t){return e===(t=_decodePkcs1_v1_5(t,r,!0))}});var i=pki$3.rsa.decrypt(t,r,!0,!1);return n.verify(e,i,r.n.bitLength())}};return r},pki$3.setRsaPrivateKey=pki$3.rsa.setPrivateKey=function(e,t,r,n,i,s,o,a){var u={n:e,e:t,d:r,p:n,q:i,dP:s,dQ:o,qInv:a,decrypt:function(e,t,r){"string"==typeof t?t=t.toUpperCase():void 0===t&&(t="RSAES-PKCS1-V1_5");var n=pki$3.rsa.decrypt(e,u,!1,!1);if("RSAES-PKCS1-V1_5"===t)t={decode:_decodePkcs1_v1_5};else if("RSA-OAEP"===t||"RSAES-OAEP"===t)t={decode:function(e,t){return forge$D.pkcs1.decode_rsa_oaep(t,e,r)}};else{if(-1===["RAW","NONE","NULL",null].indexOf(t))throw new Error('Unsupported encryption scheme: "'+t+'".');t={decode:function(e){return e}}}return t.decode(n,u,!1)},sign:function(e,t){var r=!1;"string"==typeof t&&(t=t.toUpperCase()),void 0===t||"RSASSA-PKCS1-V1_5"===t?(t={encode:emsaPkcs1v15encode},r=1):"NONE"!==t&&"NULL"!==t&&null!==t||(t={encode:function(){return e}},r=1);var n=t.encode(e,u.n.bitLength());return pki$3.rsa.encrypt(n,u,r)}};return u},pki$3.wrapRsaPrivateKey=function(e){return asn1$5.create(asn1$5.Class.UNIVERSAL,asn1$5.Type.SEQUENCE,!0,[asn1$5.create(asn1$5.Class.UNIVERSAL,asn1$5.Type.INTEGER,!1,asn1$5.integerToDer(0).getBytes()),asn1$5.create(asn1$5.Class.UNIVERSAL,asn1$5.Type.SEQUENCE,!0,[asn1$5.create(asn1$5.Class.UNIVERSAL,asn1$5.Type.OID,!1,asn1$5.oidToDer(pki$3.oids.rsaEncryption).getBytes()),asn1$5.create(asn1$5.Class.UNIVERSAL,asn1$5.Type.NULL,!1,"")]),asn1$5.create(asn1$5.Class.UNIVERSAL,asn1$5.Type.OCTETSTRING,!1,asn1$5.toDer(e).getBytes())])},pki$3.privateKeyFromAsn1=function(e){var t,r,n,i,s,o,a,u,c={},l=[];if(asn1$5.validate(e,privateKeyValidator$1,c,l)&&(e=asn1$5.fromDer(forge$D.util.createBuffer(c.privateKey))),c={},l=[],!asn1$5.validate(e,rsaPrivateKeyValidator,c,l)){var h=new Error("Cannot read private key. ASN.1 object does not contain an RSAPrivateKey.");throw h.errors=l,h}return t=forge$D.util.createBuffer(c.privateKeyModulus).toHex(),r=forge$D.util.createBuffer(c.privateKeyPublicExponent).toHex(),n=forge$D.util.createBuffer(c.privateKeyPrivateExponent).toHex(),i=forge$D.util.createBuffer(c.privateKeyPrime1).toHex(),s=forge$D.util.createBuffer(c.privateKeyPrime2).toHex(),o=forge$D.util.createBuffer(c.privateKeyExponent1).toHex(),a=forge$D.util.createBuffer(c.privateKeyExponent2).toHex(),u=forge$D.util.createBuffer(c.privateKeyCoefficient).toHex(),pki$3.setRsaPrivateKey(new BigInteger$2(t,16),new BigInteger$2(r,16),new BigInteger$2(n,16),new BigInteger$2(i,16),new BigInteger$2(s,16),new BigInteger$2(o,16),new BigInteger$2(a,16),new BigInteger$2(u,16))},pki$3.privateKeyToAsn1=pki$3.privateKeyToRSAPrivateKey=function(e){return asn1$5.create(asn1$5.Class.UNIVERSAL,asn1$5.Type.SEQUENCE,!0,[asn1$5.create(asn1$5.Class.UNIVERSAL,asn1$5.Type.INTEGER,!1,asn1$5.integerToDer(0).getBytes()),asn1$5.create(asn1$5.Class.UNIVERSAL,asn1$5.Type.INTEGER,!1,_bnToBytes(e.n)),asn1$5.create(asn1$5.Class.UNIVERSAL,asn1$5.Type.INTEGER,!1,_bnToBytes(e.e)),asn1$5.create(asn1$5.Class.UNIVERSAL,asn1$5.Type.INTEGER,!1,_bnToBytes(e.d)),asn1$5.create(asn1$5.Class.UNIVERSAL,asn1$5.Type.INTEGER,!1,_bnToBytes(e.p)),asn1$5.create(asn1$5.Class.UNIVERSAL,asn1$5.Type.INTEGER,!1,_bnToBytes(e.q)),asn1$5.create(asn1$5.Class.UNIVERSAL,asn1$5.Type.INTEGER,!1,_bnToBytes(e.dP)),asn1$5.create(asn1$5.Class.UNIVERSAL,asn1$5.Type.INTEGER,!1,_bnToBytes(e.dQ)),asn1$5.create(asn1$5.Class.UNIVERSAL,asn1$5.Type.INTEGER,!1,_bnToBytes(e.qInv))])},pki$3.publicKeyFromAsn1=function(e){var t={},r=[];if(asn1$5.validate(e,publicKeyValidator$2,t,r)){var n,i=asn1$5.derToOid(t.publicKeyOid);if(i!==pki$3.oids.rsaEncryption)throw(n=new Error("Cannot read public key. Unknown OID.")).oid=i,n;e=t.rsaPublicKey}if(r=[],!asn1$5.validate(e,rsaPublicKeyValidator,t,r))throw(n=new Error("Cannot read public key. ASN.1 object does not contain an RSAPublicKey.")).errors=r,n;var s=forge$D.util.createBuffer(t.publicKeyModulus).toHex(),o=forge$D.util.createBuffer(t.publicKeyExponent).toHex();return pki$3.setRsaPublicKey(new BigInteger$2(s,16),new BigInteger$2(o,16))},pki$3.publicKeyToAsn1=pki$3.publicKeyToSubjectPublicKeyInfo=function(e){return asn1$5.create(asn1$5.Class.UNIVERSAL,asn1$5.Type.SEQUENCE,!0,[asn1$5.create(asn1$5.Class.UNIVERSAL,asn1$5.Type.SEQUENCE,!0,[asn1$5.create(asn1$5.Class.UNIVERSAL,asn1$5.Type.OID,!1,asn1$5.oidToDer(pki$3.oids.rsaEncryption).getBytes()),asn1$5.create(asn1$5.Class.UNIVERSAL,asn1$5.Type.NULL,!1,"")]),asn1$5.create(asn1$5.Class.UNIVERSAL,asn1$5.Type.BITSTRING,!1,[pki$3.publicKeyToRSAPublicKey(e)])])},pki$3.publicKeyToRSAPublicKey=function(e){return asn1$5.create(asn1$5.Class.UNIVERSAL,asn1$5.Type.SEQUENCE,!0,[asn1$5.create(asn1$5.Class.UNIVERSAL,asn1$5.Type.INTEGER,!1,_bnToBytes(e.n)),asn1$5.create(asn1$5.Class.UNIVERSAL,asn1$5.Type.INTEGER,!1,_bnToBytes(e.e))])};var forge$C=forge$X;if(void 0===BigInteger$1)var BigInteger$1=forge$C.jsbn.BigInteger;var asn1$4=forge$C.asn1,pki$2=forge$C.pki=forge$C.pki||{};pki$2.pbe=forge$C.pbe=forge$C.pbe||{};var oids$1=pki$2.oids,encryptedPrivateKeyValidator={name:"EncryptedPrivateKeyInfo",tagClass:asn1$4.Class.UNIVERSAL,type:asn1$4.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedPrivateKeyInfo.encryptionAlgorithm",tagClass:asn1$4.Class.UNIVERSAL,type:asn1$4.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:asn1$4.Class.UNIVERSAL,type:asn1$4.Type.OID,constructed:!1,capture:"encryptionOid"},{name:"AlgorithmIdentifier.parameters",tagClass:asn1$4.Class.UNIVERSAL,type:asn1$4.Type.SEQUENCE,constructed:!0,captureAsn1:"encryptionParams"}]},{name:"EncryptedPrivateKeyInfo.encryptedData",tagClass:asn1$4.Class.UNIVERSAL,type:asn1$4.Type.OCTETSTRING,constructed:!1,capture:"encryptedData"}]},PBES2AlgorithmsValidator={name:"PBES2Algorithms",tagClass:asn1$4.Class.UNIVERSAL,type:asn1$4.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc",tagClass:asn1$4.Class.UNIVERSAL,type:asn1$4.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc.oid",tagClass:asn1$4.Class.UNIVERSAL,type:asn1$4.Type.OID,constructed:!1,capture:"kdfOid"},{name:"PBES2Algorithms.params",tagClass:asn1$4.Class.UNIVERSAL,type:asn1$4.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.params.salt",tagClass:asn1$4.Class.UNIVERSAL,type:asn1$4.Type.OCTETSTRING,constructed:!1,capture:"kdfSalt"},{name:"PBES2Algorithms.params.iterationCount",tagClass:asn1$4.Class.UNIVERSAL,type:asn1$4.Type.INTEGER,constructed:!1,capture:"kdfIterationCount"},{name:"PBES2Algorithms.params.keyLength",tagClass:asn1$4.Class.UNIVERSAL,type:asn1$4.Type.INTEGER,constructed:!1,optional:!0,capture:"keyLength"},{name:"PBES2Algorithms.params.prf",tagClass:asn1$4.Class.UNIVERSAL,type:asn1$4.Type.SEQUENCE,constructed:!0,optional:!0,value:[{name:"PBES2Algorithms.params.prf.algorithm",tagClass:asn1$4.Class.UNIVERSAL,type:asn1$4.Type.OID,constructed:!1,capture:"prfOid"}]}]}]},{name:"PBES2Algorithms.encryptionScheme",tagClass:asn1$4.Class.UNIVERSAL,type:asn1$4.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.encryptionScheme.oid",tagClass:asn1$4.Class.UNIVERSAL,type:asn1$4.Type.OID,constructed:!1,capture:"encOid"},{name:"PBES2Algorithms.encryptionScheme.iv",tagClass:asn1$4.Class.UNIVERSAL,type:asn1$4.Type.OCTETSTRING,constructed:!1,capture:"encIv"}]}]},pkcs12PbeParamsValidator={name:"pkcs-12PbeParams",tagClass:asn1$4.Class.UNIVERSAL,type:asn1$4.Type.SEQUENCE,constructed:!0,value:[{name:"pkcs-12PbeParams.salt",tagClass:asn1$4.Class.UNIVERSAL,type:asn1$4.Type.OCTETSTRING,constructed:!1,capture:"salt"},{name:"pkcs-12PbeParams.iterations",tagClass:asn1$4.Class.UNIVERSAL,type:asn1$4.Type.INTEGER,constructed:!1,capture:"iterations"}]};function hash$4(e,t){return e.start().update(t).digest().getBytes()}function prfOidToMessageDigest(e){var t;if(e){if(!(t=pki$2.oids[asn1$4.derToOid(e)])){var r=new Error("Unsupported PRF OID.");throw r.oid=e,r.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],r}}else t="hmacWithSHA1";return prfAlgorithmToMessageDigest(t)}function prfAlgorithmToMessageDigest(e){var t=forge$C.md;switch(e){case"hmacWithSHA224":t=forge$C.md.sha512;case"hmacWithSHA1":case"hmacWithSHA256":case"hmacWithSHA384":case"hmacWithSHA512":e=e.substr(8).toLowerCase();break;default:var r=new Error("Unsupported PRF algorithm.");throw r.algorithm=e,r.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],r}if(!t||!(e in t))throw new Error("Unknown hash algorithm: "+e);return t[e].create()}function createPbkdf2Params(e,t,r,n){var i=asn1$4.create(asn1$4.Class.UNIVERSAL,asn1$4.Type.SEQUENCE,!0,[asn1$4.create(asn1$4.Class.UNIVERSAL,asn1$4.Type.OCTETSTRING,!1,e),asn1$4.create(asn1$4.Class.UNIVERSAL,asn1$4.Type.INTEGER,!1,t.getBytes())]);return"hmacWithSHA1"!==n&&i.value.push(asn1$4.create(asn1$4.Class.UNIVERSAL,asn1$4.Type.INTEGER,!1,forge$C.util.hexToBytes(r.toString(16))),asn1$4.create(asn1$4.Class.UNIVERSAL,asn1$4.Type.SEQUENCE,!0,[asn1$4.create(asn1$4.Class.UNIVERSAL,asn1$4.Type.OID,!1,asn1$4.oidToDer(pki$2.oids[n]).getBytes()),asn1$4.create(asn1$4.Class.UNIVERSAL,asn1$4.Type.NULL,!1,"")])),i}pki$2.encryptPrivateKeyInfo=function(e,t,r){(r=r||{}).saltSize=r.saltSize||8,r.count=r.count||2048,r.algorithm=r.algorithm||"aes128",r.prfAlgorithm=r.prfAlgorithm||"sha1";var n,i,s,o=forge$C.random.getBytesSync(r.saltSize),a=r.count,u=asn1$4.integerToDer(a);if(0===r.algorithm.indexOf("aes")||"des"===r.algorithm){var c,l,h;switch(r.algorithm){case"aes128":n=16,c=16,l=oids$1["aes128-CBC"],h=forge$C.aes.createEncryptionCipher;break;case"aes192":n=24,c=16,l=oids$1["aes192-CBC"],h=forge$C.aes.createEncryptionCipher;break;case"aes256":n=32,c=16,l=oids$1["aes256-CBC"],h=forge$C.aes.createEncryptionCipher;break;case"des":n=8,c=8,l=oids$1.desCBC,h=forge$C.des.createEncryptionCipher;break;default:throw($=new Error("Cannot encrypt private key. Unknown encryption algorithm.")).algorithm=r.algorithm,$}var d="hmacWith"+r.prfAlgorithm.toUpperCase(),f=prfAlgorithmToMessageDigest(d),p=forge$C.pkcs5.pbkdf2(t,o,a,n,f),y=forge$C.random.getBytesSync(c);(m=h(p)).start(y),m.update(asn1$4.toDer(e)),m.finish(),s=m.output.getBytes();var g=createPbkdf2Params(o,u,n,d);i=asn1$4.create(asn1$4.Class.UNIVERSAL,asn1$4.Type.SEQUENCE,!0,[asn1$4.create(asn1$4.Class.UNIVERSAL,asn1$4.Type.OID,!1,asn1$4.oidToDer(oids$1.pkcs5PBES2).getBytes()),asn1$4.create(asn1$4.Class.UNIVERSAL,asn1$4.Type.SEQUENCE,!0,[asn1$4.create(asn1$4.Class.UNIVERSAL,asn1$4.Type.SEQUENCE,!0,[asn1$4.create(asn1$4.Class.UNIVERSAL,asn1$4.Type.OID,!1,asn1$4.oidToDer(oids$1.pkcs5PBKDF2).getBytes()),g]),asn1$4.create(asn1$4.Class.UNIVERSAL,asn1$4.Type.SEQUENCE,!0,[asn1$4.create(asn1$4.Class.UNIVERSAL,asn1$4.Type.OID,!1,asn1$4.oidToDer(l).getBytes()),asn1$4.create(asn1$4.Class.UNIVERSAL,asn1$4.Type.OCTETSTRING,!1,y)])])])}else{var $;if("3des"!==r.algorithm)throw($=new Error("Cannot encrypt private key. Unknown encryption algorithm.")).algorithm=r.algorithm,$;n=24;var m,b=new forge$C.util.ByteBuffer(o);p=pki$2.pbe.generatePkcs12Key(t,b,1,a,n),y=pki$2.pbe.generatePkcs12Key(t,b,2,a,n);(m=forge$C.des.createEncryptionCipher(p)).start(y),m.update(asn1$4.toDer(e)),m.finish(),s=m.output.getBytes(),i=asn1$4.create(asn1$4.Class.UNIVERSAL,asn1$4.Type.SEQUENCE,!0,[asn1$4.create(asn1$4.Class.UNIVERSAL,asn1$4.Type.OID,!1,asn1$4.oidToDer(oids$1["pbeWithSHAAnd3-KeyTripleDES-CBC"]).getBytes()),asn1$4.create(asn1$4.Class.UNIVERSAL,asn1$4.Type.SEQUENCE,!0,[asn1$4.create(asn1$4.Class.UNIVERSAL,asn1$4.Type.OCTETSTRING,!1,o),asn1$4.create(asn1$4.Class.UNIVERSAL,asn1$4.Type.INTEGER,!1,u.getBytes())])])}return asn1$4.create(asn1$4.Class.UNIVERSAL,asn1$4.Type.SEQUENCE,!0,[i,asn1$4.create(asn1$4.Class.UNIVERSAL,asn1$4.Type.OCTETSTRING,!1,s)])},pki$2.decryptPrivateKeyInfo=function(e,t){var r=null,n={},i=[];if(!asn1$4.validate(e,encryptedPrivateKeyValidator,n,i)){var s=new Error("Cannot read encrypted private key. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw s.errors=i,s}var o=asn1$4.derToOid(n.encryptionOid),a=pki$2.pbe.getCipher(o,n.encryptionParams,t),u=forge$C.util.createBuffer(n.encryptedData);return a.update(u),a.finish()&&(r=asn1$4.fromDer(a.output)),r},pki$2.encryptedPrivateKeyToPem=function(e,t){var r={type:"ENCRYPTED PRIVATE KEY",body:asn1$4.toDer(e).getBytes()};return forge$C.pem.encode(r,{maxline:t})},pki$2.encryptedPrivateKeyFromPem=function(e){var t=forge$C.pem.decode(e)[0];if("ENCRYPTED PRIVATE KEY"!==t.type){var r=new Error('Could not convert encrypted private key from PEM; PEM header type is "ENCRYPTED PRIVATE KEY".');throw r.headerType=t.type,r}if(t.procType&&"ENCRYPTED"===t.procType.type)throw new Error("Could not convert encrypted private key from PEM; PEM is encrypted.");return asn1$4.fromDer(t.body)},pki$2.encryptRsaPrivateKey=function(e,t,r){if(!(r=r||{}).legacy){var n=pki$2.wrapRsaPrivateKey(pki$2.privateKeyToAsn1(e));return n=pki$2.encryptPrivateKeyInfo(n,t,r),pki$2.encryptedPrivateKeyToPem(n)}var i,s,o,a;switch(r.algorithm){case"aes128":i="AES-128-CBC",o=16,s=forge$C.random.getBytesSync(16),a=forge$C.aes.createEncryptionCipher;break;case"aes192":i="AES-192-CBC",o=24,s=forge$C.random.getBytesSync(16),a=forge$C.aes.createEncryptionCipher;break;case"aes256":i="AES-256-CBC",o=32,s=forge$C.random.getBytesSync(16),a=forge$C.aes.createEncryptionCipher;break;case"3des":i="DES-EDE3-CBC",o=24,s=forge$C.random.getBytesSync(8),a=forge$C.des.createEncryptionCipher;break;case"des":i="DES-CBC",o=8,s=forge$C.random.getBytesSync(8),a=forge$C.des.createEncryptionCipher;break;default:var u=new Error('Could not encrypt RSA private key; unsupported encryption algorithm "'+r.algorithm+'".');throw u.algorithm=r.algorithm,u}var c=a(forge$C.pbe.opensslDeriveBytes(t,s.substr(0,8),o));c.start(s),c.update(asn1$4.toDer(pki$2.privateKeyToAsn1(e))),c.finish();var l={type:"RSA PRIVATE KEY",procType:{version:"4",type:"ENCRYPTED"},dekInfo:{algorithm:i,parameters:forge$C.util.bytesToHex(s).toUpperCase()},body:c.output.getBytes()};return forge$C.pem.encode(l)},pki$2.decryptRsaPrivateKey=function(e,t){var r=null,n=forge$C.pem.decode(e)[0];if("ENCRYPTED PRIVATE KEY"!==n.type&&"PRIVATE KEY"!==n.type&&"RSA PRIVATE KEY"!==n.type)throw(o=new Error('Could not convert private key from PEM; PEM header type is not "ENCRYPTED PRIVATE KEY", "PRIVATE KEY", or "RSA PRIVATE KEY".')).headerType=o,o;if(n.procType&&"ENCRYPTED"===n.procType.type){var i,s;switch(n.dekInfo.algorithm){case"DES-CBC":i=8,s=forge$C.des.createDecryptionCipher;break;case"DES-EDE3-CBC":i=24,s=forge$C.des.createDecryptionCipher;break;case"AES-128-CBC":i=16,s=forge$C.aes.createDecryptionCipher;break;case"AES-192-CBC":i=24,s=forge$C.aes.createDecryptionCipher;break;case"AES-256-CBC":i=32,s=forge$C.aes.createDecryptionCipher;break;case"RC2-40-CBC":i=5,s=function(e){return forge$C.rc2.createDecryptionCipher(e,40)};break;case"RC2-64-CBC":i=8,s=function(e){return forge$C.rc2.createDecryptionCipher(e,64)};break;case"RC2-128-CBC":i=16,s=function(e){return forge$C.rc2.createDecryptionCipher(e,128)};break;default:var o;throw(o=new Error('Could not decrypt private key; unsupported encryption algorithm "'+n.dekInfo.algorithm+'".')).algorithm=n.dekInfo.algorithm,o}var a=forge$C.util.hexToBytes(n.dekInfo.parameters),u=s(forge$C.pbe.opensslDeriveBytes(t,a.substr(0,8),i));if(u.start(a),u.update(forge$C.util.createBuffer(n.body)),!u.finish())return r;r=u.output.getBytes()}else r=n.body;return null!==(r="ENCRYPTED PRIVATE KEY"===n.type?pki$2.decryptPrivateKeyInfo(asn1$4.fromDer(r),t):asn1$4.fromDer(r))&&(r=pki$2.privateKeyFromAsn1(r)),r},pki$2.pbe.generatePkcs12Key=function(e,t,r,n,i,s){var o,a;if(null==s){if(!("sha1"in forge$C.md))throw new Error('"sha1" hash algorithm unavailable.');s=forge$C.md.sha1.create()}var u=s.digestLength,c=s.blockLength,l=new forge$C.util.ByteBuffer,h=new forge$C.util.ByteBuffer;if(null!=e){for(a=0;a<e.length;a++)h.putInt16(e.charCodeAt(a));h.putInt16(0)}var d=h.length(),f=t.length(),p=new forge$C.util.ByteBuffer;p.fillWithByte(r,c);var y=c*Math.ceil(f/c),g=new forge$C.util.ByteBuffer;for(a=0;a<y;a++)g.putByte(t.at(a%f));var $=c*Math.ceil(d/c),m=new forge$C.util.ByteBuffer;for(a=0;a<$;a++)m.putByte(h.at(a%d));var b=g;b.putBuffer(m);for(var v=Math.ceil(i/u),_=1;_<=v;_++){var w=new forge$C.util.ByteBuffer;w.putBytes(p.bytes()),w.putBytes(b.bytes());for(var E=0;E<n;E++)s.start(),s.update(w.getBytes()),w=s.digest();var S=new forge$C.util.ByteBuffer;for(a=0;a<c;a++)S.putByte(w.at(a%u));var A=Math.ceil(f/c)+Math.ceil(d/c),T=new forge$C.util.ByteBuffer;for(o=0;o<A;o++){var I=new forge$C.util.ByteBuffer(b.getBytes(c)),P=511;for(a=S.length()-1;a>=0;a--)P>>=8,P+=S.at(a)+I.at(a),I.setAt(a,255&P);T.putBuffer(I)}b=T,l.putBuffer(w)}return l.truncate(l.length()-i),l},pki$2.pbe.getCipher=function(e,t,r){switch(e){case pki$2.oids.pkcs5PBES2:return pki$2.pbe.getCipherForPBES2(e,t,r);case pki$2.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:case pki$2.oids["pbewithSHAAnd40BitRC2-CBC"]:return pki$2.pbe.getCipherForPKCS12PBE(e,t,r);default:var n=new Error("Cannot read encrypted PBE data block. Unsupported OID.");throw n.oid=e,n.supportedOids=["pkcs5PBES2","pbeWithSHAAnd3-KeyTripleDES-CBC","pbewithSHAAnd40BitRC2-CBC"],n}},pki$2.pbe.getCipherForPBES2=function(e,t,r){var n,i={},s=[];if(!asn1$4.validate(t,PBES2AlgorithmsValidator,i,s))throw(n=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.")).errors=s,n;if((e=asn1$4.derToOid(i.kdfOid))!==pki$2.oids.pkcs5PBKDF2)throw(n=new Error("Cannot read encrypted private key. Unsupported key derivation function OID.")).oid=e,n.supportedOids=["pkcs5PBKDF2"],n;if((e=asn1$4.derToOid(i.encOid))!==pki$2.oids["aes128-CBC"]&&e!==pki$2.oids["aes192-CBC"]&&e!==pki$2.oids["aes256-CBC"]&&e!==pki$2.oids["des-EDE3-CBC"]&&e!==pki$2.oids.desCBC)throw(n=new Error("Cannot read encrypted private key. Unsupported encryption scheme OID.")).oid=e,n.supportedOids=["aes128-CBC","aes192-CBC","aes256-CBC","des-EDE3-CBC","desCBC"],n;var o,a,u=i.kdfSalt,c=forge$C.util.createBuffer(i.kdfIterationCount);switch(c=c.getInt(c.length()<<3),pki$2.oids[e]){case"aes128-CBC":o=16,a=forge$C.aes.createDecryptionCipher;break;case"aes192-CBC":o=24,a=forge$C.aes.createDecryptionCipher;break;case"aes256-CBC":o=32,a=forge$C.aes.createDecryptionCipher;break;case"des-EDE3-CBC":o=24,a=forge$C.des.createDecryptionCipher;break;case"desCBC":o=8,a=forge$C.des.createDecryptionCipher}var l=prfOidToMessageDigest(i.prfOid),h=forge$C.pkcs5.pbkdf2(r,u,c,o,l),d=i.encIv,f=a(h);return f.start(d),f},pki$2.pbe.getCipherForPKCS12PBE=function(e,t,r){var n={},i=[];if(!asn1$4.validate(t,pkcs12PbeParamsValidator,n,i))throw(l=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.")).errors=i,l;var s,o,a,u=forge$C.util.createBuffer(n.salt),c=forge$C.util.createBuffer(n.iterations);switch(c=c.getInt(c.length()<<3),e){case pki$2.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:s=24,o=8,a=forge$C.des.startDecrypting;break;case pki$2.oids["pbewithSHAAnd40BitRC2-CBC"]:s=5,o=8,a=function(e,t){var r=forge$C.rc2.createDecryptionCipher(e,40);return r.start(t,null),r};break;default:var l;throw(l=new Error("Cannot read PKCS #12 PBE data block. Unsupported OID.")).oid=e,l}var h=prfOidToMessageDigest(n.prfOid),d=pki$2.pbe.generatePkcs12Key(r,u,1,c,s,h);return h.start(),a(d,pki$2.pbe.generatePkcs12Key(r,u,2,c,o,h))},pki$2.pbe.opensslDeriveBytes=function(e,t,r,n){if(null==n){if(!("md5"in forge$C.md))throw new Error('"md5" hash algorithm unavailable.');n=forge$C.md.md5.create()}null===t&&(t="");for(var i=[hash$4(n,e+t)],s=16,o=1;s<r;++o,s+=16)i.push(hash$4(n,i[o-1]+e+t));return i.join("").substr(0,r)};const identity$8=from$3({prefix:"\0",name:"identity",encode:e=>toString$6(e),decode:e=>fromString$a(e)});var identityBase=Object.freeze({__proto__:null,identity:identity$8});const base2=rfc4648({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var base2$1=Object.freeze({__proto__:null,base2:base2});const base8=rfc4648({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var base8$1=Object.freeze({__proto__:null,base8:base8});const base10=baseX({prefix:"9",name:"base10",alphabet:"0123456789"});var base10$1=Object.freeze({__proto__:null,base10:base10});const from$1=({name:e,code:t,encode:r})=>new Hasher(e,t,r);class Hasher{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}async digest(e){if(e instanceof Uint8Array){const t=await this.encode(e);return create$8(this.code,t)}throw Error("Unknown type, must be binary type")}}const sha$1=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),sha256$r=from$1({name:"sha2-256",code:18,encode:sha$1("SHA-256")}),sha512$2=from$1({name:"sha2-512",code:19,encode:sha$1("SHA-512")});var sha2Browser=Object.freeze({__proto__:null,sha256:sha256$r,sha512:sha512$2});const identity$6=from$1({name:"identity",code:0,encode:e=>coerce(e)});var identity$7=Object.freeze({__proto__:null,identity:identity$6});new TextEncoder,new TextDecoder;const bases={...identityBase,...base2$1,...base8$1,...base10$1,...base16$1,...base32$3,...base36$1,...base58,...base64$f};function createCodec(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}const string=createCodec("utf8","u",(e=>"u"+new TextDecoder("utf8").decode(e)),(e=>(new TextEncoder).encode(e.substring(1)))),ascii=createCodec("ascii","a",(e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}),(e=>{e=e.substring(1);const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t})),BASES={utf8:string,"utf-8":string,hex:bases.base16,latin1:ascii,ascii:ascii,binary:ascii,...bases};function fromString$7(e,t="utf8"){const r=BASES[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return r.decoder.decode(`${r.prefix}${e}`)}var fromString$8=Object.freeze({__proto__:null,fromString:fromString$7}),require$$3$1=getAugmentedNamespace(fromString$8);function concat$6(e,t){t||(t=e.reduce(((e,t)=>e+t.length),0));const r=new Uint8Array(t);let n=0;for(const t of e)r.set(t,n),n+=t.length;return r}var concat$7=Object.freeze({__proto__:null,concat:concat$6}),require$$2$2=getAugmentedNamespace(concat$7),webcrypto$t={get:(e=globalThis)=>{const t=e.crypto;if(!t||!t.subtle)throw Object.assign(new Error("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p-crypto/blob/master/README.md#web-crypto-api"),{code:"ERR_MISSING_WEB_CRYPTO"});return t}};const{concat:concat$5}=require$$2$2,{fromString:fromString$6}=require$$3$1,webcrypto$s=webcrypto$t;function create$5({algorithm:e="AES-GCM",nonceLength:t=12,keyLength:r=16,digest:n="SHA-256",saltLength:i=16,iterations:s=32767}={}){const o=webcrypto$s.get();return r*=8,{encrypt:async function(a,u){const c=o.getRandomValues(new Uint8Array(i)),l=o.getRandomValues(new Uint8Array(t)),h={name:e,iv:l},d={name:"PBKDF2",salt:c,iterations:s,hash:{name:n}},f=await o.subtle.importKey("raw",fromString$6(u),{name:"PBKDF2"},!1,["deriveKey","deriveBits"]),p=await o.subtle.deriveKey(d,f,{name:e,length:r},!0,["encrypt"]),y=await o.subtle.encrypt(h,p,a);return concat$5([c,h.iv,new Uint8Array(y)])},decrypt:async function(a,u){const c=a.slice(0,i),l=a.slice(i,i+t),h=a.slice(i+t),d={name:e,iv:l},f={name:"PBKDF2",salt:c,iterations:s,hash:{name:n}},p=await o.subtle.importKey("raw",fromString$6(u),{name:"PBKDF2"},!1,["deriveKey","deriveBits"]),y=await o.subtle.deriveKey(f,p,{name:e,length:r},!0,["decrypt"]),g=await o.subtle.decrypt(d,y,h);return new Uint8Array(g)}}}var aesGcm_browser$5={create:create$5};const{base64:base64$b}=require$$4$5,ciphers$d=aesGcm_browser$5;var importer$b={import:async function(e,t){const r=base64$b.decode(e),n=ciphers$d.create();return await n.decrypt(r,t)}},require$$4$3=getAugmentedNamespace(sha2Browser);function equals(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}var equals$1=Object.freeze({__proto__:null,equals:equals}),require$$10$1=getAugmentedNamespace(equals$1);function toString$3(e,t="utf8"){const r=BASES[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return r.encoder.encode(e).substring(1)}var toString$4=Object.freeze({__proto__:null,toString:toString$3}),require$$1$5=getAugmentedNamespace(toString$4),forge$B=forge$X,sha512$1=forge$B.sha512=forge$B.sha512||{};forge$B.md.sha512=forge$B.md.algorithms.sha512=sha512$1;var sha384=forge$B.sha384=forge$B.sha512.sha384=forge$B.sha512.sha384||{};sha384.create=function(){return sha512$1.create("SHA-384")},forge$B.md.sha384=forge$B.md.algorithms.sha384=sha384,forge$B.sha512.sha256=forge$B.sha512.sha256||{create:function(){return sha512$1.create("SHA-512/256")}},forge$B.md["sha512/256"]=forge$B.md.algorithms["sha512/256"]=forge$B.sha512.sha256,forge$B.sha512.sha224=forge$B.sha512.sha224||{create:function(){return sha512$1.create("SHA-512/224")}},forge$B.md["sha512/224"]=forge$B.md.algorithms["sha512/224"]=forge$B.sha512.sha224,sha512$1.create=function(e){if(_initialized||_init(),void 0===e&&(e="SHA-512"),!(e in _states))throw new Error("Invalid SHA-512 algorithm: "+e);for(var t=_states[e],r=null,n=forge$B.util.createBuffer(),i=new Array(80),s=0;s<80;++s)i[s]=new Array(2);var o=64;switch(e){case"SHA-384":o=48;break;case"SHA-512/256":o=32;break;case"SHA-512/224":o=28}var a={algorithm:e.replace("-","").toLowerCase(),blockLength:128,digestLength:o,messageLength:0,fullMessageLength:null,messageLengthSize:16,start:function(){a.messageLength=0,a.fullMessageLength=a.messageLength128=[];for(var e=a.messageLengthSize/4,i=0;i<e;++i)a.fullMessageLength.push(0);n=forge$B.util.createBuffer(),r=new Array(t.length);for(i=0;i<t.length;++i)r[i]=t[i].slice(0);return a}};return a.start(),a.update=function(e,t){"utf8"===t&&(e=forge$B.util.encodeUtf8(e));var s=e.length;a.messageLength+=s,s=[s/4294967296>>>0,s>>>0];for(var o=a.fullMessageLength.length-1;o>=0;--o)a.fullMessageLength[o]+=s[1],s[1]=s[0]+(a.fullMessageLength[o]/4294967296>>>0),a.fullMessageLength[o]=a.fullMessageLength[o]>>>0,s[0]=s[1]/4294967296>>>0;return n.putBytes(e),_update(r,i,n),(n.read>2048||0===n.length())&&n.compact(),a},a.digest=function(){var t=forge$B.util.createBuffer();t.putBytes(n.bytes());var s,o=a.fullMessageLength[a.fullMessageLength.length-1]+a.messageLengthSize&a.blockLength-1;t.putBytes(_padding.substr(0,a.blockLength-o));for(var u=8*a.fullMessageLength[0],c=0;c<a.fullMessageLength.length-1;++c)u+=(s=8*a.fullMessageLength[c+1])/4294967296>>>0,t.putInt32(u>>>0),u=s>>>0;t.putInt32(u);var l=new Array(r.length);for(c=0;c<r.length;++c)l[c]=r[c].slice(0);_update(l,i,t);var h,d=forge$B.util.createBuffer();h="SHA-512"===e?l.length:"SHA-384"===e?l.length-2:l.length-4;for(c=0;c<h;++c)d.putInt32(l[c][0]),c===h-1&&"SHA-512/224"===e||d.putInt32(l[c][1]);return d},a};var _padding=null,_initialized=!1,_k=null,_states=null;function _init(){_padding=String.fromCharCode(128),_padding+=forge$B.util.fillString(String.fromCharCode(0),128),_k=[[1116352408,3609767458],[1899447441,602891725],[3049323471,3964484399],[3921009573,2173295548],[961987163,4081628472],[1508970993,3053834265],[2453635748,2937671579],[2870763221,3664609560],[3624381080,2734883394],[310598401,1164996542],[607225278,1323610764],[1426881987,3590304994],[1925078388,4068182383],[2162078206,991336113],[2614888103,633803317],[3248222580,3479774868],[3835390401,2666613458],[4022224774,944711139],[264347078,2341262773],[604807628,2007800933],[770255983,1495990901],[1249150122,1856431235],[1555081692,3175218132],[1996064986,2198950837],[2554220882,3999719339],[2821834349,766784016],[2952996808,2566594879],[3210313671,3203337956],[3336571891,1034457026],[3584528711,2466948901],[113926993,3758326383],[338241895,168717936],[666307205,1188179964],[773529912,1546045734],[1294757372,1522805485],[1396182291,2643833823],[1695183700,2343527390],[1986661051,1014477480],[2177026350,1206759142],[2456956037,344077627],[2730485921,1290863460],[2820302411,3158454273],[3259730800,3505952657],[3345764771,106217008],[3516065817,3606008344],[3600352804,1432725776],[4094571909,1467031594],[275423344,851169720],[430227734,3100823752],[506948616,1363258195],[659060556,3750685593],[883997877,3785050280],[958139571,3318307427],[1322822218,3812723403],[1537002063,2003034995],[1747873779,3602036899],[1955562222,1575990012],[2024104815,1125592928],[2227730452,2716904306],[2361852424,442776044],[2428436474,593698344],[2756734187,3733110249],[3204031479,2999351573],[3329325298,3815920427],[3391569614,3928383900],[3515267271,566280711],[3940187606,3454069534],[4118630271,4000239992],[116418474,1914138554],[174292421,2731055270],[289380356,3203993006],[460393269,320620315],[685471733,587496836],[852142971,1086792851],[1017036298,365543100],[1126000580,2618297676],[1288033470,3409855158],[1501505948,4234509866],[1607167915,987167468],[1816402316,1246189591]],(_states={})["SHA-512"]=[[1779033703,4089235720],[3144134277,2227873595],[1013904242,4271175723],[2773480762,1595750129],[1359893119,2917565137],[2600822924,725511199],[528734635,4215389547],[1541459225,327033209]],_states["SHA-384"]=[[3418070365,3238371032],[1654270250,914150663],[2438529370,812702999],[355462360,4144912697],[1731405415,4290775857],[2394180231,1750603025],[3675008525,1694076839],[1203062813,3204075428]],_states["SHA-512/256"]=[[573645204,4230739756],[2673172387,3360449730],[596883563,1867755857],[2520282905,1497426621],[2519219938,2827943907],[3193839141,1401305490],[721525244,746961066],[246885852,2177182882]],_states["SHA-512/224"]=[[2352822216,424955298],[1944164710,2312950998],[502970286,855612546],[1738396948,1479516111],[258812777,2077511080],[2011393907,79989058],[1067287976,1780299464],[286451373,2446758561]],_initialized=!0}function _update(e,t,r){for(var n,i,s,o,a,u,c,l,h,d,f,p,y,g,$,m,b,v,_,w,E,S,A,T,I,P,R,C,B,k,K,O,N,D=r.length();D>=128;){for(R=0;R<16;++R)t[R][0]=r.getInt32()>>>0,t[R][1]=r.getInt32()>>>0;for(;R<80;++R)n=(((C=(k=t[R-2])[0])>>>19|(B=k[1])<<13)^(B>>>29|C<<3)^C>>>6)>>>0,i=((C<<13|B>>>19)^(B<<3|C>>>29)^(C<<26|B>>>6))>>>0,s=(((C=(O=t[R-15])[0])>>>1|(B=O[1])<<31)^(C>>>8|B<<24)^C>>>7)>>>0,o=((C<<31|B>>>1)^(C<<24|B>>>8)^(C<<25|B>>>7))>>>0,K=t[R-7],N=t[R-16],B=i+K[1]+o+N[1],t[R][0]=n+K[0]+s+N[0]+(B/4294967296>>>0)>>>0,t[R][1]=B>>>0;for(f=e[0][0],p=e[0][1],y=e[1][0],g=e[1][1],$=e[2][0],m=e[2][1],b=e[3][0],v=e[3][1],_=e[4][0],w=e[4][1],E=e[5][0],S=e[5][1],A=e[6][0],T=e[6][1],I=e[7][0],P=e[7][1],R=0;R<80;++R)c=((_>>>14|w<<18)^(_>>>18|w<<14)^(w>>>9|_<<23))>>>0,l=(A^_&(E^A))>>>0,a=((f>>>28|p<<4)^(p>>>2|f<<30)^(p>>>7|f<<25))>>>0,u=((f<<4|p>>>28)^(p<<30|f>>>2)^(p<<25|f>>>7))>>>0,h=(f&y|$&(f^y))>>>0,d=(p&g|m&(p^g))>>>0,B=P+(((_<<18|w>>>14)^(_<<14|w>>>18)^(w<<23|_>>>9))>>>0)+((T^w&(S^T))>>>0)+_k[R][1]+t[R][1],n=I+c+l+_k[R][0]+t[R][0]+(B/4294967296>>>0)>>>0,i=B>>>0,s=a+h+((B=u+d)/4294967296>>>0)>>>0,o=B>>>0,I=A,P=T,A=E,T=S,E=_,S=w,_=b+n+((B=v+i)/4294967296>>>0)>>>0,w=B>>>0,b=$,v=m,$=y,m=g,y=f,g=p,f=n+s+((B=i+o)/4294967296>>>0)>>>0,p=B>>>0;B=e[0][1]+p,e[0][0]=e[0][0]+f+(B/4294967296>>>0)>>>0,e[0][1]=B>>>0,B=e[1][1]+g,e[1][0]=e[1][0]+y+(B/4294967296>>>0)>>>0,e[1][1]=B>>>0,B=e[2][1]+m,e[2][0]=e[2][0]+$+(B/4294967296>>>0)>>>0,e[2][1]=B>>>0,B=e[3][1]+v,e[3][0]=e[3][0]+b+(B/4294967296>>>0)>>>0,e[3][1]=B>>>0,B=e[4][1]+w,e[4][0]=e[4][0]+_+(B/4294967296>>>0)>>>0,e[4][1]=B>>>0,B=e[5][1]+S,e[5][0]=e[5][0]+E+(B/4294967296>>>0)>>>0,e[5][1]=B>>>0,B=e[6][1]+T,e[6][0]=e[6][0]+A+(B/4294967296>>>0)>>>0,e[6][1]=B>>>0,B=e[7][1]+P,e[7][0]=e[7][0]+I+(B/4294967296>>>0)>>>0,e[7][1]=B>>>0,D-=128}}var rsaBrowser$5={};const MAX_BYTES$1=65536;function randomBytes$e(e){const t=new Uint8Array(e);let r=0;if(e>0)if(e>MAX_BYTES$1)for(;r<e;)r+MAX_BYTES$1>e?(crypto.getRandomValues(t.subarray(r,r+(e-r))),r+=e-r):(crypto.getRandomValues(t.subarray(r,r+MAX_BYTES$1)),r+=MAX_BYTES$1);else crypto.getRandomValues(t);return t}var random_browser=randomBytes$e;const randomBytes$d=random_browser,errcode$15=errCode$m;var randomBytes_1$5=function(e){if(isNaN(e)||e<=0)throw errcode$15(new Error("random bytes length must be a Number bigger than 0"),"ERR_INVALID_LENGTH");return randomBytes$d(e)},rsaUtils$5={},util$7={};!function(e){const t=forge$X,{fromString:r}=require$$3$1,{toString:n}=require$$1$5,{concat:i}=require$$2$2;e.bigIntegerToUintBase64url=(e,t)=>{let r=Uint8Array.from(e.abs().toByteArray());if(r=0===r[0]?r.slice(1):r,null!=t){if(r.length>t)throw new Error("byte array longer than desired length");r=i([new Uint8Array(t-r.length),r])}return n(r,"base64url")},e.base64urlToBigInteger=r=>{const i=e.base64urlToBuffer(r);return new t.jsbn.BigInteger(n(i,"base16"),16)},e.base64urlToBuffer=(e,t)=>{let n=r(e,"base64urlpad");if(null!=t){if(n.length>t)throw new Error("byte array longer than desired length");n=i([new Uint8Array(t-n.length),n])}return n}}(util$7);const forge$A=forge$X,{bigIntegerToUintBase64url:bigIntegerToUintBase64url$5,base64urlToBigInteger:base64urlToBigInteger$b}=util$7,{fromString:uint8ArrayFromString$w}=require$$3$1,{toString:uint8ArrayToString$D}=require$$1$5;rsaUtils$5.pkcs1ToJwk=function(e){const t=forge$A.asn1.fromDer(uint8ArrayToString$D(e,"ascii")),r=forge$A.pki.privateKeyFromAsn1(t);return{kty:"RSA",n:bigIntegerToUintBase64url$5(r.n),e:bigIntegerToUintBase64url$5(r.e),d:bigIntegerToUintBase64url$5(r.d),p:bigIntegerToUintBase64url$5(r.p),q:bigIntegerToUintBase64url$5(r.q),dp:bigIntegerToUintBase64url$5(r.dP),dq:bigIntegerToUintBase64url$5(r.dQ),qi:bigIntegerToUintBase64url$5(r.qInv),alg:"RS256",kid:"2011-04-29"}},rsaUtils$5.jwkToPkcs1=function(e){const t=forge$A.pki.privateKeyToAsn1({n:base64urlToBigInteger$b(e.n),e:base64urlToBigInteger$b(e.e),d:base64urlToBigInteger$b(e.d),p:base64urlToBigInteger$b(e.p),q:base64urlToBigInteger$b(e.q),dP:base64urlToBigInteger$b(e.dp),dQ:base64urlToBigInteger$b(e.dq),qInv:base64urlToBigInteger$b(e.qi)});return uint8ArrayFromString$w(forge$A.asn1.toDer(t).getBytes(),"ascii")},rsaUtils$5.pkixToJwk=function(e){const t=forge$A.asn1.fromDer(uint8ArrayToString$D(e,"ascii")),r=forge$A.pki.publicKeyFromAsn1(t);return{kty:"RSA",n:bigIntegerToUintBase64url$5(r.n),e:bigIntegerToUintBase64url$5(r.e),alg:"RS256",kid:"2011-04-29"}},rsaUtils$5.jwkToPkix=function(e){const t=forge$A.pki.publicKeyToAsn1({n:base64urlToBigInteger$b(e.n),e:base64urlToBigInteger$b(e.e)});return uint8ArrayFromString$w(forge$A.asn1.toDer(t).getBytes(),"ascii")};const forge$z=forge$X,{base64urlToBigInteger:base64urlToBigInteger$a}=util$7;function convert$7(e,t){return t.map((t=>base64urlToBigInteger$a(e[t])))}function jwk2priv$b(e){return forge$z.pki.setRsaPrivateKey(...convert$7(e,["n","e","d","p","q","dp","dq","qi"]))}function jwk2pub$b(e){return forge$z.pki.setRsaPublicKey(...convert$7(e,["n","e"]))}var jwk2pem$5={jwk2pub:jwk2pub$b,jwk2priv:jwk2priv$b};const webcrypto$r=webcrypto$t,randomBytes$c=randomBytes_1$5,{toString:uint8ArrayToString$C}=require$$1$5,{fromString:uint8ArrayFromString$v}=require$$3$1;function exportKey$5(e){return Promise.all([webcrypto$r.get().subtle.exportKey("jwk",e.privateKey),webcrypto$r.get().subtle.exportKey("jwk",e.publicKey)])}function derivePublicFromPrivate$5(e){return webcrypto$r.get().subtle.importKey("jwk",{kty:e.kty,n:e.n,e:e.e},{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])}rsaBrowser$5.utils=rsaUtils$5,rsaBrowser$5.generateKey=async function(e){const t=await webcrypto$r.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),r=await exportKey$5(t);return{privateKey:r[0],publicKey:r[1]}},rsaBrowser$5.unmarshalPrivateKey=async function(e){const t=[await webcrypto$r.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),await derivePublicFromPrivate$5(e)],r=await exportKey$5({privateKey:t[0],publicKey:t[1]});return{privateKey:r[0],publicKey:r[1]}},rsaBrowser$5.getRandomValues=randomBytes$c,rsaBrowser$5.hashAndSign=async function(e,t){const r=await webcrypto$r.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),n=await webcrypto$r.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},r,Uint8Array.from(t));return new Uint8Array(n,n.byteOffset,n.byteLength)},rsaBrowser$5.hashAndVerify=async function(e,t,r){const n=await webcrypto$r.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return webcrypto$r.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},n,t,r)};const{jwk2pub:jwk2pub$a,jwk2priv:jwk2priv$a}=jwk2pem$5;function convertKey$5(e,t,r,n){const i=t?jwk2pub$a(e):jwk2priv$a(e),s=n(uint8ArrayToString$C(Uint8Array.from(r),"ascii"),i);return uint8ArrayFromString$v(s,"ascii")}rsaBrowser$5.encrypt=function(e,t){return convertKey$5(e,!0,t,((e,t)=>t.encrypt(e)))},rsaBrowser$5.decrypt=function(e,t){return convertKey$5(e,!1,t,((e,t)=>t.decrypt(e)))};const{base64:base64$a}=require$$4$5,ciphers$c=aesGcm_browser$5;var exporter$n={export:async function(e,t){const r=ciphers$c.create(),n=await r.encrypt(e,t);return base64$a.encode(n)}};const{sha256:sha256$q}=require$$4$3,errcode$14=errCode$m,{equals:uint8ArrayEquals$p}=require$$10$1,{toString:uint8ArrayToString$B}=require$$1$5,forge$y=forge$X,crypto$g=rsaBrowser$5,pbm$b=keys$e,exporter$m=exporter$n;class RsaPublicKey$5{constructor(e){this._key=e}async verify(e,t){return crypto$g.hashAndVerify(this._key,t,e)}marshal(){return crypto$g.utils.jwkToPkix(this._key)}get bytes(){return pbm$b.PublicKey.encode({Type:pbm$b.KeyType.RSA,Data:this.marshal()}).finish()}encrypt(e){return crypto$g.encrypt(this._key,e)}equals(e){return uint8ArrayEquals$p(this.bytes,e.bytes)}async hash(){const{bytes:e}=await sha256$q.digest(this.bytes);return e}}class RsaPrivateKey$5{constructor(e,t){this._key=e,this._publicKey=t}genSecret(){return crypto$g.getRandomValues(16)}async sign(e){return crypto$g.hashAndSign(this._key,e)}get public(){if(!this._publicKey)throw errcode$14(new Error("public key not provided"),"ERR_PUBKEY_NOT_PROVIDED");return new RsaPublicKey$5(this._publicKey)}decrypt(e){return crypto$g.decrypt(this._key,e)}marshal(){return crypto$g.utils.jwkToPkcs1(this._key)}get bytes(){return pbm$b.PrivateKey.encode({Type:pbm$b.KeyType.RSA,Data:this.marshal()}).finish()}equals(e){return uint8ArrayEquals$p(this.bytes,e.bytes)}async hash(){const{bytes:e}=await sha256$q.digest(this.bytes);return e}async id(){const e=await this.public.hash();return uint8ArrayToString$B(e,"base58btc")}async export(e,t="pkcs-8"){if("pkcs-8"===t){const t=new forge$y.util.ByteBuffer(this.marshal()),r=forge$y.asn1.fromDer(t),n=forge$y.pki.privateKeyFromAsn1(r),i={algorithm:"aes256",count:1e4,saltSize:16,prfAlgorithm:"sha512"};return forge$y.pki.encryptRsaPrivateKey(n,e,i)}if("libp2p-key"===t)return exporter$m.export(this.bytes,e);throw errcode$14(new Error(`export format '${t}' is not supported`),"ERR_INVALID_EXPORT_FORMAT")}}async function unmarshalRsaPrivateKey$5(e){const t=crypto$g.utils.pkcs1ToJwk(e),r=await crypto$g.unmarshalPrivateKey(t);return new RsaPrivateKey$5(r.privateKey,r.publicKey)}function unmarshalRsaPublicKey$5(e){const t=crypto$g.utils.pkixToJwk(e);return new RsaPublicKey$5(t)}async function fromJwk$5(e){const t=await crypto$g.unmarshalPrivateKey(e);return new RsaPrivateKey$5(t.privateKey,t.publicKey)}async function generateKeyPair$h(e){const t=await crypto$g.generateKey(e);return new RsaPrivateKey$5(t.privateKey,t.publicKey)}var rsaClass$5={RsaPublicKey:RsaPublicKey$5,RsaPrivateKey:RsaPrivateKey$5,unmarshalRsaPublicKey:unmarshalRsaPublicKey$5,unmarshalRsaPrivateKey:unmarshalRsaPrivateKey$5,generateKeyPair:generateKeyPair$h,fromJwk:fromJwk$5},require$$13=getAugmentedNamespace(identity$7),ed25519$7={},ed25519$6={exports:{}};!function(e,t){
/*! noble-ed25519 - MIT License (c) Paul Miller (paulmillr.com) */
Object.defineProperty(t,"__esModule",{value:!0}),t.utils=t.verify=t.sign=t.getPublicKey=t.SignResult=t.Signature=t.Point=t.ExtendedPoint=t.CURVE=void 0;const r={a:-1n,d:37095705934669439343138083508754565189542113879843219016388785533085940283555n,P:2n**255n-19n,n:2n**252n+27742317777372353535851937790883648493n,h:8n,Gx:15112221349535400772501151409588531511454012693041857206046113283949847762202n,Gy:46316835694926478169428394003475163141307993866256225615783033603165251855960n};t.CURVE=r;const n=32,i=19681161376707505956807079304988542015446066515923890162744021073123829784752n,s=25063068953384623474111414158702152701244531502492656460079210482610430750235n,o=54469307008909316920995813868745141605393597292927456921205312896311721017578n,a=1159843021668779879193775521855586647937357759715417654439879720876111806838n,u=40440834346308536858101042469323190826248399146238708352240133220865137265952n;class c{constructor(e,t,r,n){this.x=e,this.y=t,this.z=r,this.t=n}static fromAffine(e){if(!(e instanceof h))throw new TypeError("ExtendedPoint#fromAffine: expected Point");return e.equals(h.ZERO)?c.ZERO:new c(e.x,e.y,1n,_(e.x*e.y))}static toAffineBatch(e){const t=function(e,t=r.P){const n=e.length,i=new Array(n);let s=1n;for(let r=0;r<n;r++)0n!==e[r]&&(i[r]=s,s=_(s*e[r],t));s=w(s,t);for(let r=n-1;r>=0;r--){if(0n===e[r])continue;let n=_(s*e[r],t);e[r]=_(s*i[r],t),s=n}return e}(e.map((e=>e.z)));return e.map(((e,r)=>e.toAffine(t[r])))}static normalizeZ(e){return this.toAffineBatch(e).map(this.fromAffine)}static fromRistrettoHash(e){const t=v(e.slice(0,n)),r=this.calcElligatorRistrettoMap(t),i=v(e.slice(n,64)),s=this.calcElligatorRistrettoMap(i);return r.add(s)}static calcElligatorRistrettoMap(e){const{d:t}=r,n=_(i*e*e),o=_((n+1n)*a);let l=-1n;const h=_((l-t*n)*_(n+t));let{isValid:d,value:f}=S(o,h),p=_(f*e);$(p)||(p=_(-p)),d||(f=p),d||(l=n);const y=_(l*(n-1n)*u-h),g=f*f,m=_((f+f)*h),b=_(y*s),v=_(1n-g),w=_(1n+g);return new c(_(m*w),_(v*b),_(b*w),_(m*v))}static fromRistrettoBytes(e){const{a:t,d:i}=r,s="ExtendedPoint.fromRistrettoBytes: Cannot convert bytes to Ristretto Point",o=v(e);if(!function(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}(g(o,n),e)||$(o))throw new Error(s);const a=_(o*o),u=_(1n+t*a),l=_(1n-t*a),h=_(u*u),d=_(l*l),f=_(t*i*h-d),{isValid:p,value:y}=A(_(f*d)),m=_(y*l),b=_(y*m*f);let w=_((o+o)*m);$(w)&&(w=_(-w));const E=_(u*b),S=_(w*E);if(!p||$(S)||0n===E)throw new Error(s);return new c(w,E,1n,S)}toRistrettoBytes(){let{x:e,y:t,z:r,t:s}=this;const a=_((r+t)*(r-t)),u=_(e*t),{value:c}=A(_(a*u**2n)),l=_(c*a),h=_(c*u),d=_(l*h*s);let f;$(s*d)?([e,t]=[_(t*i),_(e*i)],f=_(l*o)):f=h,$(e*d)&&(t=_(-t));let p=_((r-t)*f);return $(p)&&(p=_(-p)),g(p,n)}equals(e){const t=e,[r,n,i,s]=[this.t,t.t,this.z,t.z];return _(r*s)===_(n*i)}negate(){return new c(_(-this.x),this.y,this.z,_(-this.t))}double(){const e=this.x,t=this.y,n=this.z,{a:i}=r,s=_(e**2n),o=_(t**2n),a=_(2n*n**2n),u=_(i*s),l=_((e+t)**2n-s-o),h=_(u+o),d=_(h-a),f=_(u-o),p=_(l*d),y=_(h*f),g=_(l*f),$=_(d*h);return new c(p,y,$,g)}add(e){const t=this.x,r=this.y,n=this.z,i=this.t,s=e.x,o=e.y,a=e.z,u=e.t,l=_((r-t)*(o+s)),h=_((r+t)*(o-s)),d=_(h-l);if(0n===d)return this.double();const f=_(2n*n*u),p=_(2n*i*a),y=_(p+f),g=_(h+l),$=_(p-f),m=_(y*d),b=_(g*$),v=_(y*$),w=_(d*g);return new c(m,b,w,v)}subtract(e){return this.add(e.negate())}multiplyUnsafe(e){if(!m(e))throw new TypeError("Point#multiply: expected number or bigint");let t=_(BigInt(e),r.n);if(1n===t)return this;let n=c.ZERO,i=this;for(;t>0n;)1n&t&&(n=n.add(i)),i=i.double(),t>>=1n;return n}precomputeWindow(e){const t=256/e+1;let r=[],n=this,i=n;for(let s=0;s<t;s++){i=n,r.push(i);for(let t=1;t<2**(e-1);t++)i=i.add(n),r.push(i);n=i.double()}return r}wNAF(e,t){!t&&this.equals(c.BASE)&&(t=h.BASE);const r=t&&t._WINDOW_SIZE||1;if(256%r)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let n=t&&l.get(t);n||(n=this.precomputeWindow(r),t&&1!==r&&(n=c.normalizeZ(n),l.set(t,n)));let i=c.ZERO,s=c.ZERO;const o=256/r+1,a=2**(r-1),u=BigInt(2**r-1),d=2**r,f=BigInt(r);for(let t=0;t<o;t++){const r=t*a;let o=Number(e&u);if(e>>=f,o>a&&(o-=d,e+=1n),0===o)s=s.add(t%2?n[r].negate():n[r]);else{const e=n[r+Math.abs(o)-1];i=i.add(o<0?e.negate():e)}}return[i,s]}multiply(e,t){if(!m(e))throw new TypeError("Point#multiply: expected number or bigint");const n=_(BigInt(e),r.n);return c.normalizeZ(this.wNAF(n,t))[0]}toAffine(e=w(this.z)){const t=_(this.x*e),r=_(this.y*e);return new h(t,r)}}t.ExtendedPoint=c,c.BASE=new c(r.Gx,r.Gy,1n,_(r.Gx*r.Gy)),c.ZERO=new c(0n,1n,1n,0n);const l=new WeakMap;class h{constructor(e,t){this.x=e,this.y=t}_setWindowSize(e){this._WINDOW_SIZE=e,l.delete(this)}static fromHex(e){const{d:t,P:n}=r,i=e instanceof Uint8Array?e:p(e);if(32!==i.length)throw new Error("Point.fromHex: expected 32 bytes");const s=i[31],o=-129&s,a=0!=(128&s),u=b(Uint8Array.from(Array.from(i.slice(0,31)).concat(o)));if(u>=n)throw new Error("Point.fromHex expects hex <= Fp");const c=_(u*u),l=_(c-1n),d=_(t*c+1n);let{isValid:f,value:y}=S(l,d);if(!f)throw new Error("Point.fromHex: invalid y coordinate");return a!==(1n===(1n&y))&&(y=_(-y)),new h(y,u)}static async fromPrivateKey(e){const r=await t.utils.sha512(R(e));return h.BASE.multiply(I(r))}toRawBytes(){const e=y(this.y),t=new Uint8Array(n);for(let r=e.length-2,i=0;i<n&&r>=0;r-=2,i++)t[i]=Number.parseInt(e[r]+e[r+1],16);const r=1n&this.x?128:0;return t[31]|=r,t}toHex(){return f(this.toRawBytes())}toX25519(){return _((1n+this.y)*w(1n-this.y))}equals(e){return this.x===e.x&&this.y===e.y}negate(){return new h(_(-this.x),this.y)}add(e){return c.fromAffine(this).add(c.fromAffine(e)).toAffine()}subtract(e){return this.add(e.negate())}multiply(e){return c.fromAffine(this).multiply(e,this).toAffine()}}t.Point=h,h.BASE=new h(r.Gx,r.Gy),h.ZERO=new h(0n,1n);class d{constructor(e,t){this.r=e,this.s=t}static fromHex(e){e=P(e);const t=h.fromHex(e.slice(0,32)),n=b(e.slice(32));if(!(0<(i=n)&&i<r.n))throw new Error("Signature.fromHex expects s <= CURVE.n");var i;return new d(t,n)}toRawBytes(){const e=p(y(this.s)).reverse(),t=new Uint8Array(n);t.set(e);const r=new Uint8Array(64);return r.set(this.r.toRawBytes()),r.set(t,32),r}toHex(){return f(this.toRawBytes())}}function f(e){let t="";for(let r=0;r<e.length;r++)t+=e[r].toString(16).padStart(2,"0");return t}function p(e){if("string"!=typeof e)throw new TypeError("hexToBytes: expected string, got "+typeof e);if(e.length%2)throw new Error("hexToBytes: received invalid unpadded hex");const t=new Uint8Array(e.length/2);for(let r=0;r<t.length;r++){const n=2*r;t[r]=Number.parseInt(e.slice(n,n+2),16)}return t}function y(e){const t=e.toString(16);return 1&t.length?`0${t}`:t}function g(e,t=32){return p(y(e).padStart(2*t,"0")).reverse()}function $(e){return 1n===(1n&_(e))}function m(e){return"bigint"==typeof e&&e>0n||!!("number"==typeof e&&e>0&&Number.isSafeInteger(e))}function b(e){let t=0n;for(let r=0;r<e.length;r++)t+=BigInt(e[r])<<8n*BigInt(r);return t}function v(e){return _(b(e)&2n**255n-1n)}function _(e,t=r.P){const n=e%t;return n>=0n?n:t+n}function w(e,t=r.P){if(0n===e||t<=0n)throw new Error(`invert: expected positive integers, got n=${e} mod=${t}`);let n=_(e,t),i=t,[s,o,a,u]=[0n,1n,1n,0n];for(;0n!==n;){const e=i/n,t=i%n,r=s-a*e,c=o-u*e;[i,n]=[n,t],[s,o]=[a,u],[a,u]=[r,c]}if(1n!==i)throw new Error("invert: does not exist");return _(s,t)}function E(e,t){const{P:n}=r;let i=e;for(;t-- >0n;)i*=i,i%=n;return i}function S(e,t){const n=_(t*t*t),s=_(n*n*t);let o=_(e*n*function(e){const{P:t}=r,n=e*e%t*e%t,i=E(n,2n)*n%t,s=E(i,1n)*e%t,o=E(s,5n)*s%t,a=E(o,10n)*o%t,u=E(a,20n)*a%t,c=E(u,40n)*u%t,l=E(c,80n)*c%t,h=E(l,80n)*c%t,d=E(h,10n)*o%t;return E(d,2n)*e%t}(e*s));const a=_(t*o*o),u=o,c=_(o*i),l=a===e,h=a===_(-e),d=a===_(-e*i);return l&&(o=u),(h||d)&&(o=c),$(o)&&(o=_(-o)),{isValid:l||h,value:o}}function A(e){return S(1n,e)}async function T(...e){const n=function(...e){if(1===e.length)return e[0];const t=e.reduce(((e,t)=>e+t.length),0),r=new Uint8Array(t);for(let t=0,n=0;t<e.length;t++){const i=e[t];r.set(i,n),n+=i.length}return r}(...e);return _(b(await t.utils.sha512(n)),r.n)}function I(e){const t=e.slice(0,n);return t[0]&=248,t[31]&=127,t[31]|=64,_(b(t),r.n)}function P(e){return e instanceof Uint8Array?e:p(e)}function R(e){let t;if("bigint"==typeof e||"number"==typeof e&&Number.isSafeInteger(e)){if(t=BigInt(e),t<0n||t>2n**256n)throw new Error("Expected 32 bytes of private key");e=t.toString(16).padStart(64,"0")}if("string"==typeof e){if(64!==e.length)throw new Error("Expected 32 bytes of private key");return p(e)}if(e instanceof Uint8Array){if(32!==e.length)throw new Error("Expected 32 bytes of private key");return e}throw new TypeError("Expected valid private key")}t.Signature=d,t.SignResult=d,t.getPublicKey=async function(e){const t=await h.fromPrivateKey(e);return"string"==typeof e?t.toHex():t.toRawBytes()},t.sign=async function(e,i){const s=await t.utils.sha512(R(i)),o=I(s),a=h.BASE.multiply(o),u=P(e),c=await T((l=s,l.slice(n)),u);var l;const f=h.BASE.multiply(c),p=_(c+await T(f.toRawBytes(),a.toRawBytes(),u)*o,r.n),y=new d(f,p);return"string"==typeof e?y.toHex():y.toRawBytes()},t.verify=async function(e,t,r){t=P(t),r instanceof h||(r=h.fromHex(r)),e instanceof d||(e=d.fromHex(e));const n=await T(e.r.toRawBytes(),r.toRawBytes(),t),i=c.fromAffine(r).multiplyUnsafe(n),s=c.BASE.multiply(e.s);return c.fromAffine(e.r).add(i).subtract(s).multiplyUnsafe(8n).equals(c.ZERO)},h.BASE._setWindowSize(8);const C=(()=>{const e="object"==typeof self&&"crypto"in self?self.crypto:void 0;return{node:"function"==typeof commonjsRequire&&!e?require$$0$9:void 0,web:e}})();t.utils={TORSION_SUBGROUP:["0100000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac037a","0000000000000000000000000000000000000000000000000000000000000080","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc05","ecffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7f","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc85","0000000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac03fa"],randomBytes:(e=32)=>{if(C.web)return C.web.getRandomValues(new Uint8Array(e));if(C.node){const{randomBytes:t}=C.node;return new Uint8Array(t(e).buffer)}throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>{let e=1024;for(;e--;){const e=t.utils.randomBytes(32),n=b(e);if(n>1n&&n<r.n)return e}throw new Error("Valid private key was not found in 1024 iterations. PRNG is broken")},sha512:async e=>{if(C.web){const t=await C.web.subtle.digest("SHA-512",e.buffer);return new Uint8Array(t)}if(C.node)return Uint8Array.from(C.node.createHash("sha512").update(e).digest());throw new Error("The environment doesn't have sha512 function")},precompute(e=8,t=h.BASE){const r=t.equals(h.BASE)?t:new h(t.x,t.y);return r._setWindowSize(e),r.multiply(1n),r}}}(0,ed25519$6.exports),function(e){const t=ed25519$6.exports;function r(t,r){const n=new Uint8Array(e.privateKeyLength);for(let e=0;e<32;e++)n[e]=t[e],n[32+e]=r[e];return n}e.publicKeyLength=32,e.privateKeyLength=64,e.generateKey=async function(){const e=t.utils.randomPrivateKey(),n=await t.getPublicKey(e);return{privateKey:r(e,n),publicKey:n}},e.generateKeyFromSeed=async function(e){if(32!==e.length)throw new TypeError('"seed" must be 32 bytes in length.');if(!(e instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, or Uint8Array.');const n=e,i=await t.getPublicKey(n);return{privateKey:r(n,i),publicKey:i}},e.hashAndSign=function(e,r){const n=e.slice(0,32);return t.sign(r,n)},e.hashAndVerify=function(e,r,n){return t.verify(r,n,e)}}(ed25519$7);const errcode$13=errCode$m,{equals:uint8ArrayEquals$o}=require$$10$1,{sha256:sha256$p}=require$$4$3,{base58btc:base58btc$7}=require$$3$2,{identity:identity$5}=require$$13,crypto$f=ed25519$7,pbm$a=keys$e,exporter$l=exporter$n;class Ed25519PublicKey$5{constructor(e){this._key=ensureKey$5(e,crypto$f.publicKeyLength)}async verify(e,t){return crypto$f.hashAndVerify(this._key,t,e)}marshal(){return this._key}get bytes(){return pbm$a.PublicKey.encode({Type:pbm$a.KeyType.Ed25519,Data:this.marshal()}).finish()}equals(e){return uint8ArrayEquals$o(this.bytes,e.bytes)}async hash(){const{bytes:e}=await sha256$p.digest(this.bytes);return e}}class Ed25519PrivateKey$5{constructor(e,t){this._key=ensureKey$5(e,crypto$f.privateKeyLength),this._publicKey=ensureKey$5(t,crypto$f.publicKeyLength)}async sign(e){return crypto$f.hashAndSign(this._key,e)}get public(){return new Ed25519PublicKey$5(this._publicKey)}marshal(){return this._key}get bytes(){return pbm$a.PrivateKey.encode({Type:pbm$a.KeyType.Ed25519,Data:this.marshal()}).finish()}equals(e){return uint8ArrayEquals$o(this.bytes,e.bytes)}async hash(){const{bytes:e}=await sha256$p.digest(this.bytes);return e}async id(){const e=await identity$5.digest(this.public.bytes);return base58btc$7.encode(e.bytes).substring(1)}async export(e,t="libp2p-key"){if("libp2p-key"===t)return exporter$l.export(this.bytes,e);throw errcode$13(new Error(`export format '${t}' is not supported`),"ERR_INVALID_EXPORT_FORMAT")}}function unmarshalEd25519PrivateKey$5(e){if(e.length>crypto$f.privateKeyLength){const t=(e=ensureKey$5(e,crypto$f.privateKeyLength+crypto$f.publicKeyLength)).slice(0,crypto$f.privateKeyLength),r=e.slice(crypto$f.privateKeyLength,e.length);return new Ed25519PrivateKey$5(t,r)}const t=(e=ensureKey$5(e,crypto$f.privateKeyLength)).slice(0,crypto$f.privateKeyLength),r=e.slice(crypto$f.publicKeyLength);return new Ed25519PrivateKey$5(t,r)}function unmarshalEd25519PublicKey$5(e){return e=ensureKey$5(e,crypto$f.publicKeyLength),new Ed25519PublicKey$5(e)}async function generateKeyPair$g(){const{privateKey:e,publicKey:t}=await crypto$f.generateKey();return new Ed25519PrivateKey$5(e,t)}async function generateKeyPairFromSeed$b(e){const{privateKey:t,publicKey:r}=await crypto$f.generateKeyFromSeed(e);return new Ed25519PrivateKey$5(t,r)}function ensureKey$5(e,t){if((e=Uint8Array.from(e||[])).length!==t)throw errcode$13(new Error(`Key must be a Uint8Array of length ${t}, got ${e.length}`),"ERR_INVALID_KEY_TYPE");return e}var ed25519Class$5={Ed25519PublicKey:Ed25519PublicKey$5,Ed25519PrivateKey:Ed25519PrivateKey$5,unmarshalEd25519PrivateKey:unmarshalEd25519PrivateKey$5,unmarshalEd25519PublicKey:unmarshalEd25519PublicKey$5,generateKeyPair:generateKeyPair$g,generateKeyPairFromSeed:generateKeyPairFromSeed$b},secp256k1$6={exports:{}};!function(e,t){
/*! noble-secp256k1 - MIT License (c) Paul Miller (paulmillr.com) */
Object.defineProperty(t,"__esModule",{value:!0}),t.utils=t.schnorr=t.verify=t.signSync=t.sign=t.getSharedSecret=t.recoverPublicKey=t.getPublicKey=t.SignResult=t.Signature=t.Point=t.CURVE=void 0;const r={a:0n,b:7n,P:2n**256n-2n**32n-977n,n:2n**256n-432420386565659656852420866394968145599n,h:1n,Gx:55066263022277343669578718895168534326250603453777594175500187360389116729240n,Gy:32670510020758816978083085130507043184471273380659243275938904335757337482424n,beta:0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501een};function n(e){const{a:t,b:n}=r;return _(e**3n+t*e+n)}t.CURVE=r;const i=0n===r.a;class s{constructor(e,t,r){this.x=e,this.y=t,this.z=r}static fromAffine(e){if(!(e instanceof a))throw new TypeError("JacobianPoint#fromAffine: expected Point");return new s(e.x,e.y,1n)}static toAffineBatch(e){const t=function(e,t=r.P){const n=e.length,i=new Array(n);let s=1n;for(let r=0;r<n;r++)0n!==e[r]&&(i[r]=s,s=_(s*e[r],t));s=E(s,t);for(let r=n-1;r>=0;r--){if(0n===e[r])continue;const n=_(s*e[r],t);e[r]=_(s*i[r],t),s=n}return e}(e.map((e=>e.z)));return e.map(((e,r)=>e.toAffine(t[r])))}static normalizeZ(e){return s.toAffineBatch(e).map(s.fromAffine)}equals(e){const t=this,r=e,n=_(t.z*t.z),i=_(t.z*n),s=_(r.z*r.z),o=_(r.z*s);return _(t.x*s)===_(n*r.x)&&_(t.y*o)===_(i*r.y)}negate(){return new s(this.x,_(-this.y),this.z)}double(){const e=this.x,t=this.y,r=this.z,n=_(e**2n),i=_(t**2n),o=_(i**2n),a=_(2n*(_(_((e+i)**2n))-n-o)),u=_(3n*n),c=_(u**2n),l=_(c-2n*a),h=_(u*(a-l)-8n*o),d=_(2n*t*r);return new s(l,h,d)}add(e){if(!(e instanceof s))throw new TypeError("JacobianPoint#add: expected JacobianPoint");const t=this.x,r=this.y,n=this.z,i=e.x,o=e.y,a=e.z;if(0n===i||0n===o)return this;if(0n===t||0n===r)return e;const u=_(n**2n),c=_(a**2n),l=_(t*c),h=_(i*u),d=_(r*a*c),f=_(_(o*n)*u),p=_(h-l),y=_(f-d);if(0n===p)return 0n===y?this.double():s.ZERO;const g=_(p**2n),$=_(p*g),m=_(l*g),b=_(y**2n-$-2n*m),v=_(y*(m-b)-d*$),w=_(n*a*p);return new s(b,v,w)}subtract(e){return this.add(e.negate())}multiplyUnsafe(e){if(!v(e))throw new TypeError("Point#multiply: expected valid scalar");let t=_(BigInt(e),r.n);if(!i){let e=s.ZERO,r=this;for(;t>0n;)1n&t&&(e=e.add(r)),r=r.double(),t>>=1n;return e}let[n,o,a,u]=T(t),c=s.ZERO,l=s.ZERO,h=this;for(;o>0n||u>0n;)1n&o&&(c=c.add(h)),1n&u&&(l=l.add(h)),h=h.double(),o>>=1n,u>>=1n;return n&&(c=c.negate()),a&&(l=l.negate()),l=new s(_(l.x*r.beta),l.y,l.z),c.add(l)}precomputeWindow(e){const t=i?128/e+1:256/e+1;let r=[],n=this,s=n;for(let i=0;i<t;i++){s=n,r.push(s);for(let t=1;t<2**(e-1);t++)s=s.add(n),r.push(s);n=s.double()}return r}wNAF(e,t){!t&&this.equals(s.BASE)&&(t=a.BASE);const r=t&&t._WINDOW_SIZE||1;if(256%r)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let n=t&&o.get(t);n||(n=this.precomputeWindow(r),t&&1!==r&&(n=s.normalizeZ(n),o.set(t,n)));let u=s.ZERO,c=s.ZERO;const l=i?128/r+1:256/r+1,h=2**(r-1),d=BigInt(2**r-1),f=2**r,p=BigInt(r);for(let t=0;t<l;t++){const r=t*h;let i=Number(e&d);if(e>>=p,i>h&&(i-=f,e+=1n),0===i)c=c.add(t%2?n[r].negate():n[r]);else{const e=n[r+Math.abs(i)-1];u=u.add(i<0?e.negate():e)}}return[u,c]}multiply(e,t){if(!v(e))throw new TypeError("Point#multiply: expected valid scalar");let n,o,a=_(BigInt(e),r.n);if(i){const[e,i,u,c]=T(a);let l,h,d,f;[l,d]=this.wNAF(i,t),[h,f]=this.wNAF(c,t),e&&(l=l.negate()),u&&(h=h.negate()),h=new s(_(h.x*r.beta),h.y,h.z),[n,o]=[l.add(h),d.add(f)]}else[n,o]=this.wNAF(a,t);return s.normalizeZ([n,o])[0]}toAffine(e=E(this.z)){const t=e**2n,r=_(this.x*t),n=_(this.y*t*e);return new a(r,n)}}s.BASE=new s(r.Gx,r.Gy,1n),s.ZERO=new s(0n,1n,0n);const o=new WeakMap;class a{constructor(e,t){this.x=e,this.y=t}_setWindowSize(e){this._WINDOW_SIZE=e,o.delete(this)}static fromCompressedHex(e){const t=32===e.length,i=m(t?e:e.slice(1));let s=function(e){const{P:t}=r,n=e*e*e%t,i=n*n*e%t,s=w(i,3n)*i%t,o=w(s,3n)*i%t,a=w(o,2n)*n%t,u=w(a,11n)*a%t,c=w(u,22n)*u%t,l=w(c,44n)*c%t,h=w(l,88n)*l%t,d=w(h,44n)*c%t,f=w(d,3n)*i%t,p=w(f,23n)*u%t,y=w(p,6n)*n%t;return w(y,2n)}(n(i));const o=1n===(1n&s);if(t)o&&(s=_(-s));else{1==(1&e[0])!==o&&(s=_(-s))}const u=new a(i,s);return u.assertValidity(),u}static fromUncompressedHex(e){const t=m(e.slice(1,33)),r=m(e.slice(33)),n=new a(t,r);return n.assertValidity(),n}static fromHex(e){const t=$(e),r=t[0];if(32===t.length||33===t.length&&(2===r||3===r))return this.fromCompressedHex(t);if(65===t.length&&4===r)return this.fromUncompressedHex(t);throw new Error(`Point.fromHex: received invalid point. Expected 32-33 compressed bytes or 65 uncompressed bytes, not ${t.length}`)}static fromPrivateKey(e){return a.BASE.multiply(C(e))}static fromSignature(e,t,n){let i=e instanceof Uint8Array?m(e):y(e);const o=k(t),{r:u,s:c}=o;if(0!==n&&1!==n)throw new Error("Cannot recover signature: invalid yParity bit");const l=2+(1&n),h=a.fromHex(`0${l}${d(u)}`),f=s.fromAffine(h).multiplyUnsafe(c),p=s.BASE.multiply(i),g=E(u,r.n),$=f.subtract(p).multiplyUnsafe(g).toAffine();return $.assertValidity(),$}toRawBytes(e=!1){return g(this.toHex(e))}toHex(e=!1){const t=d(this.x);return e?`${1n&this.y?"03":"02"}${t}`:`04${t}${d(this.y)}`}toHexX(){return this.toHex(!0).slice(2)}toRawX(){return this.toRawBytes(!0).slice(1)}assertValidity(){const e="Point is not on elliptic curve",{P:t}=r,{x:i,y:s}=this;if(0n===i||0n===s||i>=t||s>=t)throw new Error(e);if((_(s*s)-n(i))%t!==0n)throw new Error(e)}equals(e){return this.x===e.x&&this.y===e.y}negate(){return new a(this.x,_(-this.y))}double(){return s.fromAffine(this).double().toAffine()}add(e){return s.fromAffine(this).add(s.fromAffine(e)).toAffine()}subtract(e){return this.add(e.negate())}multiply(e){return s.fromAffine(this).multiply(e,this).toAffine()}}function u(e){return Number.parseInt(e[0],16)>=8?"00"+e:e}t.Point=a,a.BASE=new a(r.Gx,r.Gy),a.ZERO=new a(0n,0n);class c{constructor(e,t){this.r=e,this.s=t}static fromCompact(e){if("string"!=typeof e&&!(e instanceof Uint8Array))throw new TypeError("Signature.fromCompact: Expected string or Uint8Array");const t=e instanceof Uint8Array?h(e):e;if(128!==t.length)throw new Error("Signature.fromCompact: Expected 64-byte hex");const r=new c(y(t.slice(0,64)),y(t.slice(64,128)));return r.assertValidity(),r}static fromDER(e){const t="Signature.fromDER";if("string"!=typeof e&&!(e instanceof Uint8Array))throw new TypeError(`${t}: Expected string or Uint8Array`);const r=e instanceof Uint8Array?h(e):e,n=b(r.slice(2,4));if("30"!==r.slice(0,2)||n!==r.length-4||"02"!==r.slice(4,6))throw new Error(`${t}: Invalid signature ${r}`);const i=b(r.slice(6,8)),s=8+i,o=r.slice(8,s);if(o.startsWith("00")&&b(o.slice(2,4))<=127)throw new Error(`${t}: Invalid r with trailing length`);const a=y(o);if("02"!==r.slice(s,s+2))throw new Error(`${t}: Invalid r-s separator`);const u=b(r.slice(s+2,s+4)),l=n-u-i-10;if(l>0||-4===l)throw new Error(`${t}: Invalid total length`);if(u>n-i-4)throw new Error(`${t}: Invalid s`);const d=s+4,f=r.slice(d,d+u);if(f.startsWith("00")&&b(f.slice(2,4))<=127)throw new Error(`${t}: Invalid s with trailing length`);const p=y(f),g=new c(a,p);return g.assertValidity(),g}static fromHex(e){return this.fromDER(e)}assertValidity(){const{r:e,s:t}=this;if(!P(e))throw new Error("Invalid Signature: r must be 0 < r < n");if(!P(t))throw new Error("Invalid Signature: s must be 0 < s < n")}toDERRawBytes(e=!1){return g(this.toDERHex(e))}toDERHex(e=!1){const t=u(p(this.s));if(e)return t;const r=u(p(this.r)),n=p(r.length/2),i=p(t.length/2);return`30${p(r.length/2+t.length/2+4)}02${n}${r}02${i}${t}`}toRawBytes(){return this.toDERRawBytes()}toHex(){return this.toDERHex()}toCompactRawBytes(){return g(this.toCompactHex())}toCompactHex(){return d(this.r)+d(this.s)}}function l(...e){if(1===e.length)return e[0];const t=e.reduce(((e,t)=>e+t.length),0),r=new Uint8Array(t);for(let t=0,n=0;t<e.length;t++){const i=e[t];r.set(i,n),n+=i.length}return r}function h(e){let t="";for(let r=0;r<e.length;r++)t+=e[r].toString(16).padStart(2,"0");return t}function d(e){return e.toString(16).padStart(64,"0")}function f(e){return g(d(e))}function p(e){const t=e.toString(16);return 1&t.length?`0${t}`:t}function y(e){if("string"!=typeof e)throw new TypeError("hexToNumber: expected string, got "+typeof e);return BigInt(`0x${e}`)}function g(e){if("string"!=typeof e)throw new TypeError("hexToBytes: expected string, got "+typeof e);if(e.length%2)throw new Error("hexToBytes: received invalid unpadded hex");const t=new Uint8Array(e.length/2);for(let r=0;r<t.length;r++){const n=2*r;t[r]=Number.parseInt(e.slice(n,n+2),16)}return t}function $(e){return e instanceof Uint8Array?e:g(e)}function m(e){return y(h(e))}function b(e){return 2*Number.parseInt(e,16)}function v(e){return"bigint"==typeof e&&e>0n||!!("number"==typeof e&&e>0&&Number.isSafeInteger(e))}function _(e,t=r.P){const n=e%t;return n>=0?n:t+n}function w(e,t){const{P:n}=r;let i=e;for(;t-- >0n;)i*=i,i%=n;return i}function E(e,t=r.P){if(0n===e||t<=0n)throw new Error(`invert: expected positive integers, got n=${e} mod=${t}`);let n=_(e,t),i=t,[s,o,a,u]=[0n,1n,1n,0n];for(;0n!==n;){const e=i/n,t=i%n,r=s-a*e,c=o-u*e;[i,n]=[n,t],[s,o]=[a,u],[a,u]=[r,c]}if(1n!==i)throw new Error("invert: does not exist");return _(s,t)}t.Signature=c,t.SignResult=c;const S=(e,t)=>(e+t/2n)/t,A=2n**128n;function T(e){const{n:t}=r,n=0x3086d221a7d46bcde86c90e49284eb15n,i=-0xe4437ed6010e88286f547fa90abfe4c3n,s=n,o=S(s*e,t),a=S(-i*e,t);let u=_(e-o*n-0x114ca50f7a8e2f3f657c1108d9d44cfd8n*a,t),c=_(-o*i-a*s,t);const l=u>A,h=c>A;if(l&&(u=t-u),h&&(c=t-c),u>A||c>A)throw new Error("splitScalarEndo: Endomorphism failed");return[l,u,h,c]}function I(e,t){if(null==e)throw new Error(`sign: expected valid msgHash, not "${e}"`);const r=f("string"==typeof e?y(e):m(e));return[r,m(r),f(t),new Uint8Array(32).fill(1),new Uint8Array(32).fill(0),Uint8Array.from([0]),Uint8Array.from([1])]}function P(e){return 0<e&&e<r.n}function R(e,t,n){const i=m(e);if(!P(i))return;const s=r.n,o=a.BASE.multiply(i),u=_(o.x,s),c=_(E(i,s)*(t+u*n),s);return 0n!==u&&0n!==c?[o,u,c]:void 0}function C(e){let t;if("bigint"==typeof e)t=e;else if("number"==typeof e&&Number.isSafeInteger(e)&&e>0)t=BigInt(e);else if("string"==typeof e){if(64!==e.length)throw new Error("Expected 32 bytes of private key");t=y(e)}else{if(!(e instanceof Uint8Array))throw new TypeError("Expected valid private key");if(32!==e.length)throw new Error("Expected 32 bytes of private key");t=m(e)}if(!P(t))throw new Error("Expected private key: 0 < key < n");return t}function B(e){return e instanceof a?(e.assertValidity(),e):a.fromHex(e)}function k(e){return e instanceof c?(e.assertValidity(),e):c.fromDER(e)}function K(e){const t=e instanceof Uint8Array,r="string"==typeof e,n=(t||r)&&e.length;return t?33===n||65===n:r?66===n||130===n:e instanceof a}function O(e,t,n=!1){const[i,s,o]=e;let{canonical:a,der:u,recovered:l}=t,h=(i.x===s?0:2)|Number(1n&i.y),d=o;o>r.n>>1n&&a&&(d=r.n-o,h^=1);const f=new c(s,d);f.assertValidity();const p=!1===u?f.toCompactHex():f.toDERHex(),y=n?p:g(p);return l?[y,h]:y}async function N(e,...r){const n=new Uint8Array(e.split("").map((e=>e.charCodeAt(0)))),i=await t.utils.sha256(n);return m(await t.utils.sha256(l(i,i,...r)))}async function D(e,t,n){const i=f(e);return _(await N("BIP0340/challenge",i,t.toRawX(),n),r.n)}function M(e){return 0n===_(e.y,2n)}t.getPublicKey=function(e,t=!1){const r=a.fromPrivateKey(e);return"string"==typeof e?r.toHex(t):r.toRawBytes(t)},t.recoverPublicKey=function(e,t,r){const n=a.fromSignature(e,t,r);return"string"==typeof e?n.toHex():n.toRawBytes()},t.getSharedSecret=function(e,t,r=!1){if(K(e))throw new TypeError("getSharedSecret: first arg must be private key");if(!K(t))throw new TypeError("getSharedSecret: second arg must be public key");const n=B(t);n.assertValidity();const i=n.multiply(C(e));return"string"==typeof e?i.toHex(r):i.toRawBytes(r)},t.sign=async function(e,r,n={}){return O(await async function(e,r){const n=C(r);let[i,s,o,a,u,c,l]=I(e,n);const h=t.utils.hmacSha256;u=await h(u,a,c,o,i),a=await h(u,a),u=await h(u,a,l,o,i),a=await h(u,a);for(let e=0;e<1e3;e++){a=await h(u,a);let e=R(a,s,n);if(e)return e;u=await h(u,a,c),a=await h(u,a)}throw new TypeError("secp256k1: Tried 1,000 k values for sign(), all were invalid")}(e,r),n,"string"==typeof e)},t.signSync=function(e,r,n={}){return O(function(e,r){const n=C(r);let[i,s,o,a,u,c,l]=I(e,n);const h=t.utils.hmacSha256Sync;if(!h)throw new Error("utils.hmacSha256Sync is undefined, you need to set it");if(u=h(u,a,c,o,i),u instanceof Promise)throw new Error("To use sync sign(), ensure utils.hmacSha256 is sync");a=h(u,a),u=h(u,a,l,o,i),a=h(u,a);for(let e=0;e<1e3;e++){a=h(u,a);let e=R(a,s,n);if(e)return e;u=h(u,a,c),a=h(u,a)}throw new TypeError("secp256k1: Tried 1,000 k values for sign(), all were invalid")}(e,r),n,"string"==typeof e)},t.verify=function(e,t,n){const{n:i}=r;let o;try{o=k(e)}catch(e){return!1}const{r:a,s:u}=o,c=function(e){"string"!=typeof e&&(e=h(e));let t=y(e||"0");const n=e.length/2*8-256;return n>0&&(t>>=BigInt(n)),t>=r.n&&(t-=r.n),t}(t);if(0n===c)return!1;const l=s.fromAffine(B(n)),d=E(u,i),f=_(c*d,i),p=_(a*d,i),g=s.BASE.multiply(f),$=l.multiplyUnsafe(p);return _(g.add($).toAffine().x,i)===a};class L{constructor(e,t){if(this.r=e,this.s=t,e<=0n||t<=0n||e>=r.P||t>=r.n)throw new Error("Invalid signature")}static fromHex(e){const t=$(e);if(64!==t.length)throw new TypeError(`SchnorrSignature.fromHex: expected 64 bytes, not ${t.length}`);const r=m(t.slice(0,32)),n=m(t.slice(32));return new L(r,n)}toHex(){return d(this.r)+d(this.s)}toRawBytes(){return g(this.toHex())}}async function x(e,t,r){const n=e instanceof L?e:L.fromHex(e),i="string"==typeof t?g(t):t,s=B(r),o=await D(n.r,s,i),u=a.fromPrivateKey(n.s),c=s.multiply(o),l=u.subtract(c);return!(l.equals(a.BASE)||!M(l)||l.x!==n.r)}t.schnorr={Signature:L,getPublicKey:function(e){const t=a.fromPrivateKey(e);return"string"==typeof e?t.toHexX():t.toRawX()},sign:async function(e,n,i=t.utils.randomBytes()){if(null==e)throw new TypeError(`sign: Expected valid message, not "${e}"`);n||(n=0n);const{n:s}=r,o=$(e),u=C(n),c=$(i);if(32!==c.length)throw new TypeError("sign: Expected 32 bytes of aux randomness");const l=a.fromPrivateKey(u),h=M(l)?u:s-u,d=h^await N("BIP0340/aux",c),p=_(await N("BIP0340/nonce",f(d),l.toRawX(),o),s);if(0n===p)throw new Error("sign: Creation of signature failed. k is zero");const y=a.fromPrivateKey(p),g=M(y)?p:s-p,m=await D(y.x,l,o),b=new L(y.x,_(g+m*h,s));if(!await x(b.toRawBytes(),o,l.toRawX()))throw new Error("sign: Invalid signature produced");return"string"==typeof e?b.toHex():b.toRawBytes()},verify:x},a.BASE._setWindowSize(8);const U=(()=>{const e="object"==typeof self&&"crypto"in self?self.crypto:void 0;return{node:"function"==typeof commonjsRequire&&!e?require$$0$9:void 0,web:e}})();t.utils={isValidPrivateKey(e){try{return C(e),!0}catch(e){return!1}},randomBytes:(e=32)=>{if(U.web)return U.web.getRandomValues(new Uint8Array(e));if(U.node){const{randomBytes:t}=U.node;return new Uint8Array(t(e).buffer)}throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>{let e=8;for(;e--;){const e=t.utils.randomBytes(32),r=m(e);if(P(r)&&1n!==r)return e}throw new Error("Valid private key was not found in 8 iterations. PRNG is broken")},sha256:async e=>{if(U.web){const t=await U.web.subtle.digest("SHA-256",e.buffer);return new Uint8Array(t)}if(U.node){const{createHash:t}=U.node;return Uint8Array.from(t("sha256").update(e).digest())}throw new Error("The environment doesn't have sha256 function")},hmacSha256:async(e,...t)=>{if(U.web){const r=await U.web.subtle.importKey("raw",e,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),n=l(...t),i=await U.web.subtle.sign("HMAC",r,n);return new Uint8Array(i)}if(U.node){const{createHmac:r}=U.node,n=r("sha256",e);for(let e of t)n.update(e);return Uint8Array.from(n.digest())}throw new Error("The environment doesn't have hmac-sha256 function")},sha256Sync:void 0,hmacSha256Sync:void 0,precompute(e=8,t=a.BASE){const r=t===a.BASE?t:new a(t.x,t.y);return r._setWindowSize(e),r.multiply(3n),r}}}(0,secp256k1$6.exports);const errcode$12=errCode$m,secp$4=secp256k1$6.exports,{sha256:sha256$o}=require$$4$3;var secp256k1$5=()=>({generateKey:function(){return secp$4.utils.randomPrivateKey()},privateKeyLength:32,hashAndSign:async function(e,t){const{digest:r}=await sha256$o.digest(t);try{return await secp$4.sign(r,e)}catch(e){throw errcode$12(e,"ERR_INVALID_INPUT")}},hashAndVerify:async function(e,t,r){try{const{digest:n}=await sha256$o.digest(r);return secp$4.verify(t,n,e)}catch(e){throw errcode$12(e,"ERR_INVALID_INPUT")}},compressPublicKey:function(e){return secp$4.Point.fromHex(e).toRawBytes(!0)},decompressPublicKey:function(e){return secp$4.Point.fromHex(e).toRawBytes(!1)},validatePrivateKey:function(e){try{secp$4.getPublicKey(e,!0)}catch(e){throw errcode$12(e,"ERR_INVALID_PRIVATE_KEY")}},validatePublicKey:function(e){try{secp$4.Point.fromHex(e)}catch(e){throw errcode$12(e,"ERR_INVALID_PUBLIC_KEY")}},computePublicKey:function(e){try{return secp$4.getPublicKey(e,!0)}catch(e){throw errcode$12(e,"ERR_INVALID_PRIVATE_KEY")}}});const{sha256:sha256$n}=require$$4$3,errcode$11=errCode$m,{equals:uint8ArrayEquals$n}=require$$10$1,{toString:uint8ArrayToString$A}=require$$1$5,exporter$k=exporter$n;var secp256k1Class$5=(e,t,r)=>{r=r||secp256k1$5();class n{constructor(e){r.validatePublicKey(e),this._key=e}verify(e,t){return r.hashAndVerify(this._key,t,e)}marshal(){return r.compressPublicKey(this._key)}get bytes(){return e.PublicKey.encode({Type:e.KeyType.Secp256k1,Data:this.marshal()}).finish()}equals(e){return uint8ArrayEquals$n(this.bytes,e.bytes)}async hash(){const{bytes:e}=await sha256$n.digest(this.bytes);return e}}class i{constructor(e,t){this._key=e,this._publicKey=t||r.computePublicKey(e),r.validatePrivateKey(this._key),r.validatePublicKey(this._publicKey)}sign(e){return r.hashAndSign(this._key,e)}get public(){return new n(this._publicKey)}marshal(){return this._key}get bytes(){return e.PrivateKey.encode({Type:e.KeyType.Secp256k1,Data:this.marshal()}).finish()}equals(e){return uint8ArrayEquals$n(this.bytes,e.bytes)}async hash(){const{bytes:e}=await sha256$n.digest(this.bytes);return e}async id(){const e=await this.public.hash();return uint8ArrayToString$A(e,"base58btc")}async export(e,t="libp2p-key"){if("libp2p-key"===t)return exporter$k.export(this.bytes,e);throw errcode$11(new Error(`export format '${t}' is not supported`),"ERR_INVALID_EXPORT_FORMAT")}}return{Secp256k1PublicKey:n,Secp256k1PrivateKey:i,unmarshalSecp256k1PrivateKey:function(e){return new i(e)},unmarshalSecp256k1PublicKey:function(e){return new n(e)},generateKeyPair:async function(){const e=await r.generateKey();return new i(e)}}},indexBrowser$5={},lengths$b={SHA1:20,SHA256:32,SHA512:64};const webcrypto$q=webcrypto$t,lengths$a=lengths$b,hashTypes$5={SHA1:"SHA-1",SHA256:"SHA-256",SHA512:"SHA-512"},sign$6=async(e,t)=>{const r=await webcrypto$q.get().subtle.sign({name:"HMAC"},e,t);return new Uint8Array(r,r.byteOffset,r.byteLength)};indexBrowser$5.create=async function(e,t){const r=hashTypes$5[e],n=await webcrypto$q.get().subtle.importKey("raw",t,{name:"HMAC",hash:{name:r}},!1,["sign"]);return{digest:async e=>sign$6(n,e),length:lengths$a[e]}};const errcode$10=errCode$m,{concat:uint8ArrayConcat$e}=require$$2$2,{fromString:uint8ArrayFromString$u}=require$$3$1,hmac$a=indexBrowser$5,cipherMap$5={"AES-128":{ivSize:16,keySize:16},"AES-256":{ivSize:16,keySize:32},Blowfish:{ivSize:8,cipherKeySize:32}};var keyStretcher$5=async(e,t,r)=>{const n=cipherMap$5[e];if(!n){const t=Object.keys(cipherMap$5).join(" / ");throw errcode$10(new Error(`unknown cipher type '${e}'. Must be ${t}`),"ERR_INVALID_CIPHER_TYPE")}if(!t)throw errcode$10(new Error("missing hash type"),"ERR_MISSING_HASH_TYPE");const i=n.keySize,s=n.ivSize,o=uint8ArrayFromString$u("key expansion"),a=2*(s+i+20),u=await hmac$a.create(t,r);let c=await u.digest(o);const l=[];let h=0;for(;h<a;){const e=await u.digest(uint8ArrayConcat$e([c,o]));let t=e.length;h+t>a&&(t=a-h),l.push(e),h+=t,c=await u.digest(c)}const d=a/2,f=uint8ArrayConcat$e(l),p=f.slice(0,d),y=f.slice(d,a),g=e=>({iv:e.slice(0,s),cipherKey:e.slice(s,s+i),macKey:e.slice(s+i)});return{k1:g(p),k2:g(y)}},ecdhBrowser$5={};const errcode$$=errCode$m;var validateCurveType$b=function(e,t){if(!e.includes(t)){const r=e.join(" / ");throw errcode$$(new Error(`Unknown curve: ${t}. Must be ${r}`),"ERR_INVALID_CURVE")}};const errcode$_=errCode$m,webcrypto$p=webcrypto$t,{base64urlToBuffer:base64urlToBuffer$5}=util$7,validateCurveType$a=validateCurveType$b,{toString:uint8ArrayToString$z}=require$$1$5,{concat:uint8ArrayConcat$d}=require$$2$2,{equals:uint8ArrayEquals$m}=require$$10$1,bits$5={"P-256":256,"P-384":384,"P-521":521};ecdhBrowser$5.generateEphmeralKeyPair=async function(e){validateCurveType$a(Object.keys(bits$5),e);const t=await webcrypto$p.get().subtle.generateKey({name:"ECDH",namedCurve:e},!0,["deriveBits"]);return{key:marshalPublicKey$b(await webcrypto$p.get().subtle.exportKey("jwk",t.publicKey)),genSharedKey:async(r,n)=>{let i;i=n?await webcrypto$p.get().subtle.importKey("jwk",unmarshalPrivateKey$b(e,n),{name:"ECDH",namedCurve:e},!1,["deriveBits"]):t.privateKey;const s=[await webcrypto$p.get().subtle.importKey("jwk",unmarshalPublicKey$b(e,r),{name:"ECDH",namedCurve:e},!1,[]),i],o=await webcrypto$p.get().subtle.deriveBits({name:"ECDH",namedCurve:e,public:s[0]},s[1],bits$5[e]);return new Uint8Array(o,o.byteOffset,o.byteLength)}}};const curveLengths$5={"P-256":32,"P-384":48,"P-521":66};function marshalPublicKey$b(e){const t=curveLengths$5[e.crv];return uint8ArrayConcat$d([Uint8Array.from([4]),base64urlToBuffer$5(e.x,t),base64urlToBuffer$5(e.y,t)],1+2*t)}function unmarshalPublicKey$b(e,t){const r=curveLengths$5[e];if(uint8ArrayEquals$m(!t.slice(0,1),Uint8Array.from([4])))throw errcode$_(new Error("Cannot unmarshal public key - invalid key format"),"ERR_INVALID_KEY_FORMAT");return{kty:"EC",crv:e,x:uint8ArrayToString$z(t.slice(1,r+1),"base64url"),y:uint8ArrayToString$z(t.slice(1+r),"base64url"),ext:!0}}const unmarshalPrivateKey$b=(e,t)=>({...unmarshalPublicKey$b(e,t.public),d:uint8ArrayToString$z(t.private,"base64url")}),ecdh$5=ecdhBrowser$5;var ephemeralKeys$5=async e=>ecdh$5.generateEphmeralKeyPair(e);const keysPBM$5=keys$e,forge$x=forge$X,errcode$Z=errCode$m,{fromString:uint8ArrayFromString$t}=require$$3$1,importer$a=importer$b,supportedKeys$5={rsa:rsaClass$5,ed25519:ed25519Class$5,secp256k1:secp256k1Class$5(keysPBM$5)},ErrMissingSecp256K1$5={message:"secp256k1 support requires libp2p-crypto-secp256k1 package",code:"ERR_MISSING_PACKAGE"};function typeToKey$5(e){const t=supportedKeys$5[e.toLowerCase()];if(!t){const t=Object.keys(supportedKeys$5).join(" / ");throw errcode$Z(new Error(`invalid or unsupported key type ${e}. Must be ${t}`),"ERR_UNSUPPORTED_KEY_TYPE")}return t}const generateKeyPair$f=async(e,t)=>typeToKey$5(e).generateKeyPair(t),generateKeyPairFromSeed$a=async(e,t,r)=>{const n=typeToKey$5(e);if("ed25519"!==e.toLowerCase())throw errcode$Z(new Error("Seed key derivation is unimplemented for RSA or secp256k1"),"ERR_UNSUPPORTED_KEY_DERIVATION_TYPE");return n.generateKeyPairFromSeed(t,r)},unmarshalPublicKey$a=e=>{const t=keysPBM$5.PublicKey.decode(e),r=t.Data;switch(t.Type){case keysPBM$5.KeyType.RSA:return supportedKeys$5.rsa.unmarshalRsaPublicKey(r);case keysPBM$5.KeyType.Ed25519:return supportedKeys$5.ed25519.unmarshalEd25519PublicKey(r);case keysPBM$5.KeyType.Secp256k1:if(supportedKeys$5.secp256k1)return supportedKeys$5.secp256k1.unmarshalSecp256k1PublicKey(r);throw errcode$Z(new Error(ErrMissingSecp256K1$5.message),ErrMissingSecp256K1$5.code);default:typeToKey$5(t.Type)}},marshalPublicKey$a=(e,t)=>(typeToKey$5(t=(t||"rsa").toLowerCase()),e.bytes),unmarshalPrivateKey$a=async e=>{const t=keysPBM$5.PrivateKey.decode(e),r=t.Data;switch(t.Type){case keysPBM$5.KeyType.RSA:return supportedKeys$5.rsa.unmarshalRsaPrivateKey(r);case keysPBM$5.KeyType.Ed25519:return supportedKeys$5.ed25519.unmarshalEd25519PrivateKey(r);case keysPBM$5.KeyType.Secp256k1:if(supportedKeys$5.secp256k1)return supportedKeys$5.secp256k1.unmarshalSecp256k1PrivateKey(r);throw errcode$Z(new Error(ErrMissingSecp256K1$5.message),ErrMissingSecp256K1$5.code);default:typeToKey$5(t.Type)}},marshalPrivateKey$5=(e,t)=>(typeToKey$5(t=(t||"rsa").toLowerCase()),e.bytes),importKey$5=async(e,t)=>{try{const r=await importer$a.import(e,t);return unmarshalPrivateKey$a(r)}catch(e){}const r=forge$x.pki.decryptRsaPrivateKey(e,t);if(null===r)throw errcode$Z(new Error("Cannot read the key, most likely the password is wrong or not a RSA key"),"ERR_CANNOT_DECRYPT_PEM");let n=forge$x.asn1.toDer(forge$x.pki.privateKeyToAsn1(r));return n=uint8ArrayFromString$t(n.getBytes(),"ascii"),supportedKeys$5.rsa.unmarshalRsaPrivateKey(n)};var keys$d={supportedKeys:supportedKeys$5,keysPBM:keysPBM$5,keyStretcher:keyStretcher$5,generateEphemeralKeyPair:ephemeralKeys$5,generateKeyPair:generateKeyPair$f,generateKeyPairFromSeed:generateKeyPairFromSeed$a,unmarshalPublicKey:unmarshalPublicKey$a,marshalPublicKey:marshalPublicKey$a,unmarshalPrivateKey:unmarshalPrivateKey$a,marshalPrivateKey:marshalPrivateKey$5,import:importKey$5},classIs={exports:{}};function withIs$2(e,{className:t,symbolName:r}){const n=Symbol.for(r),i={[t]:class extends e{constructor(...e){super(...e),Object.defineProperty(this,n,{value:!0})}get[Symbol.toStringTag](){return t}}}[t];return i[`is${t}`]=e=>!(!e||!e[n]),i}function withIsProto(e,{className:t,symbolName:r,withoutNew:n}){const i=Symbol.for(r),s={[t]:function(...t){if(n&&!(this instanceof s))return new s(...t);const r=e.call(this,...t)||this;return r&&!r[i]&&Object.defineProperty(r,i,{value:!0}),r}}[t];return s.prototype=Object.create(e.prototype),s.prototype.constructor=s,Object.defineProperty(s.prototype,Symbol.toStringTag,{get:()=>t}),s[`is${t}`]=e=>!(!e||!e[i]),s}classIs.exports=withIs$2,classIs.exports.proto=withIsProto;var $protobuf$g=minimal,$Reader$g=$protobuf$g.Reader,$Writer$g=$protobuf$g.Writer,$util$g=$protobuf$g.util,$root$g=$protobuf$g.roots["libp2p-peer-id"]||($protobuf$g.roots["libp2p-peer-id"]={});$root$g.PeerIdProto=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.id=$util$g.newBuffer([]),e.prototype.pubKey=$util$g.newBuffer([]),e.prototype.privKey=$util$g.newBuffer([]),e.encode=function(e,t){return t||(t=$Writer$g.create()),t.uint32(10).bytes(e.id),null!=e.pubKey&&Object.hasOwnProperty.call(e,"pubKey")&&t.uint32(18).bytes(e.pubKey),null!=e.privKey&&Object.hasOwnProperty.call(e,"privKey")&&t.uint32(26).bytes(e.privKey),t},e.decode=function(e,t){e instanceof $Reader$g||(e=$Reader$g.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root$g.PeerIdProto;e.pos<r;){var i=e.uint32();switch(i>>>3){case 1:n.id=e.bytes();break;case 2:n.pubKey=e.bytes();break;case 3:n.privKey=e.bytes();break;default:e.skipType(7&i)}}if(!n.hasOwnProperty("id"))throw $util$g.ProtocolError("missing required 'id'",{instance:n});return n},e.fromObject=function(e){if(e instanceof $root$g.PeerIdProto)return e;var t=new $root$g.PeerIdProto;return null!=e.id&&("string"==typeof e.id?$util$g.base64.decode(e.id,t.id=$util$g.newBuffer($util$g.base64.length(e.id)),0):e.id.length&&(t.id=e.id)),null!=e.pubKey&&("string"==typeof e.pubKey?$util$g.base64.decode(e.pubKey,t.pubKey=$util$g.newBuffer($util$g.base64.length(e.pubKey)),0):e.pubKey.length&&(t.pubKey=e.pubKey)),null!=e.privKey&&("string"==typeof e.privKey?$util$g.base64.decode(e.privKey,t.privKey=$util$g.newBuffer($util$g.base64.length(e.privKey)),0):e.privKey.length&&(t.privKey=e.privKey)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(t.bytes===String?r.id="":(r.id=[],t.bytes!==Array&&(r.id=$util$g.newBuffer(r.id))),t.bytes===String?r.pubKey="":(r.pubKey=[],t.bytes!==Array&&(r.pubKey=$util$g.newBuffer(r.pubKey))),t.bytes===String?r.privKey="":(r.privKey=[],t.bytes!==Array&&(r.privKey=$util$g.newBuffer(r.privKey)))),null!=e.id&&e.hasOwnProperty("id")&&(r.id=t.bytes===String?$util$g.base64.encode(e.id,0,e.id.length):t.bytes===Array?Array.prototype.slice.call(e.id):e.id),null!=e.pubKey&&e.hasOwnProperty("pubKey")&&(r.pubKey=t.bytes===String?$util$g.base64.encode(e.pubKey,0,e.pubKey.length):t.bytes===Array?Array.prototype.slice.call(e.pubKey):e.pubKey),null!=e.privKey&&e.hasOwnProperty("privKey")&&(r.privKey=t.bytes===String?$util$g.base64.encode(e.privKey,0,e.privKey.length):t.bytes===Array?Array.prototype.slice.call(e.privKey):e.privKey),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf$g.util.toJSONOptions)},e}();var proto$4=$root$g;!function(e,t){const{CID:r}=require$$0$a,n=require$$1$8,i=require$$2$3,s=require$$3$2,o=require$$4$5,{base58btc:a}=require$$3$2,{base32:u}=require$$1$8,{base16:c}=require$$5$1,l=require$$6$1,h=keys$d,d=classIs.exports,{PeerIdProto:f}=proto$4,{equals:p}=require$$10$1,{fromString:y}=require$$3$1,{toString:g}=require$$1$5,{identity:$}=require$$13,m={...n,...i,...s,...o},b=Object.keys(m).reduce(((e,t)=>e.or(m[t])),u.decoder);const v=d(class{constructor(e,t,r){if(!(e instanceof Uint8Array))throw new Error("invalid id provided");if(t&&r&&!p(t.public.bytes,r.bytes))throw new Error("inconsistent arguments");this._id=e,this._idB58String=a.encode(this.id).substring(1),this._privKey=t,this._pubKey=r}get id(){return this._id}set id(e){throw new Error("Id is immutable")}get privKey(){return this._privKey}set privKey(e){this._privKey=e}get pubKey(){if(this._pubKey)return this._pubKey;if(this._privKey)return this._privKey.public;try{const e=l.decode(this.id);e.code===$.code&&(this._pubKey=h.unmarshalPublicKey(e.digest))}catch(e){}return this._pubKey}set pubKey(e){this._pubKey=e}marshalPubKey(){if(this.pubKey)return h.marshalPublicKey(this.pubKey)}marshalPrivKey(){if(this.privKey)return h.marshalPrivateKey(this.privKey)}marshal(e){return f.encode({id:this.toBytes(),pubKey:this.marshalPubKey(),privKey:e?null:this.marshalPrivKey()}).finish()}toPrint(){let e=this.toB58String();e.startsWith("Qm")&&(e=e.slice(2));let t=6;return e.length<t&&(t=e.length),"<peer.ID "+e.substr(0,t)+">"}toJSON(){return{id:this.toB58String(),privKey:S(this.marshalPrivKey()),pubKey:S(this.marshalPubKey())}}toHexString(){return c.encode(this.id).substring(1)}toBytes(){return this.id}toB58String(){return this._idB58String}toString(){if(!this._idCIDString){const e=r.createV1(114,l.decode(this.id));Object.defineProperty(this,"_idCIDString",{value:e.toString(),enumerable:!1})}return this._idCIDString}equals(e){if(e instanceof Uint8Array)return p(this.id,e);if(e.id)return p(this.id,e.id);throw new Error("not valid Id")}isEqual(e){return this.equals(e)}isValid(){return Boolean(this.privKey&&this.privKey.public&&this.privKey.public.bytes&&this.pubKey.bytes instanceof Uint8Array&&p(this.privKey.public.bytes,this.pubKey.bytes))}hasInlinePublicKey(){try{if(l.decode(this.id).code===$.code)return!0}catch(e){}return!1}},{className:"PeerId",symbolName:"@libp2p/js-peer-id/PeerId"});t=e.exports=v;const _=e=>e.bytes.length<=42?l.create($.code,e.bytes).bytes:e.hash(),w=async(e,t)=>{const r=await _(t);return new v(r,e,t)};t.create=async e=>{(e=e||{}).bits=e.bits||2048,e.keyType=e.keyType||"RSA";const t=await h.generateKeyPair(e.keyType,e.bits);return w(t,t.public)},t.createFromHexString=e=>new v(c.decode("f"+e)),t.createFromBytes=e=>{try{const n=r.decode(e);if(!E(n))throw new Error("Supplied PeerID CID is invalid");return t.createFromCID(n)}catch{if(l.decode(e).code!==$.code)throw new Error("Supplied PeerID CID is invalid");return new v(e)}},t.createFromB58String=e=>t.createFromBytes(a.decode("z"+e));const E=e=>114===e.code||112===e.code;function S(e){if(e)return g(e,"base64pad")}t.createFromCID=e=>{if(!(e=r.asCID(e))||!E(e))throw new Error("Supplied PeerID CID is invalid");return new v(e.multihash.bytes)},t.createFromPubKey=async e=>{let t=e;if("string"==typeof t&&(t=y(e,"base64pad")),!(t instanceof Uint8Array))throw new Error("Supplied key is neither a base64 string nor a Uint8Array");const r=await h.unmarshalPublicKey(t);return w(void 0,r)},t.createFromPrivKey=async e=>{if("string"==typeof e&&(e=y(e,"base64pad")),!(e instanceof Uint8Array))throw new Error("Supplied key is neither a base64 string nor a Uint8Array");const t=await h.unmarshalPrivateKey(e);return w(t,t.public)},t.createFromJSON=async e=>{const t=a.decode("z"+e.id),r=e.privKey&&y(e.privKey,"base64pad"),n=e.pubKey&&y(e.pubKey,"base64pad"),i=n&&await h.unmarshalPublicKey(n);if(!r)return new v(t,void 0,i);const s=await h.unmarshalPrivateKey(r),o=await _(s.public);let u;if(i&&(u=await _(i)),i&&!p(o,u))throw new Error("Public and private key do not match");if(t&&!p(o,t))throw new Error("Id and private key do not match");return new v(t,s,i)},t.createFromProtobuf=async e=>{"string"==typeof e&&(e=y(e,"base16"));let t,r,{id:n,privKey:i,pubKey:s}=f.decode(e);if(i=!!i&&await h.unmarshalPrivateKey(i),s=!!s&&await h.unmarshalPublicKey(s),i&&(r=await _(i.public)),s&&(t=await _(s)),i){if(s&&!p(r,t))throw new Error("Public and private key do not match");return new v(r,i,i.public)}if(s)return new v(t,void 0,s);if(n)return new v(n);throw new Error("Protobuf did not contain any usable key material")},t.parse=e=>("1"!==e.charAt(0)&&"Q"!==e.charAt(0)||(e=`z${e}`),t.createFromBytes(b.decode(e))),t.isPeerId=e=>Boolean("object"==typeof e&&e._id&&e._idB58String)}(src$q,src$q.exports);const word="[a-fA-F\\d:]",b=e=>e&&e.includeBoundaries?`(?:(?<=\\s|^)(?=${word})|(?<=${word})(?=\\s|$))`:"",v4="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",v6seg="[a-fA-F\\d]{1,4}",v6$1=`\n(?:\n(?:${v6seg}:){7}(?:${v6seg}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8\n(?:${v6seg}:){6}(?:${v4}|:${v6seg}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4\n(?:${v6seg}:){5}(?::${v4}|(?::${v6seg}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4\n(?:${v6seg}:){4}(?:(?::${v6seg}){0,1}:${v4}|(?::${v6seg}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4\n(?:${v6seg}:){3}(?:(?::${v6seg}){0,2}:${v4}|(?::${v6seg}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4\n(?:${v6seg}:){2}(?:(?::${v6seg}){0,3}:${v4}|(?::${v6seg}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4\n(?:${v6seg}:){1}(?:(?::${v6seg}){0,4}:${v4}|(?::${v6seg}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4\n(?::(?:(?::${v6seg}){0,5}:${v4}|(?::${v6seg}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4\n)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1\n`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),v46Exact=new RegExp(`(?:^${v4}$)|(?:^${v6$1}$)`),v4exact=new RegExp(`^${v4}$`),v6exact=new RegExp(`^${v6$1}$`),ip$2=e=>e&&e.exact?v46Exact:new RegExp(`(?:${b(e)}${v4}${b(e)})|(?:${b(e)}${v6$1}${b(e)})`,"g");ip$2.v4=e=>e&&e.exact?v4exact:new RegExp(`${b(e)}${v4}${b(e)}`,"g"),ip$2.v6=e=>e&&e.exact?v6exact:new RegExp(`${b(e)}${v6$1}${b(e)}`,"g");var ipRegex$1=ip$2;const ipRegex=ipRegex$1,isIp$1=e=>ipRegex({exact:!0}).test(e);isIp$1.v4=e=>ipRegex.v4({exact:!0}).test(e),isIp$1.v6=e=>ipRegex.v6({exact:!0}).test(e),isIp$1.version=e=>isIp$1(e)?isIp$1.v4(e)?4:6:void 0;var isIp_1=isIp$1;const isIp=isIp_1,{toString:uint8ArrayToString$y}=require$$1$5,isIP=isIp,isV4=isIp.v4,isV6=isIp.v6,toBytes=function(e,t,r){let n;if(r=~~r,isV4(e))n=t||new Uint8Array(r+4),e.split(/\./g).map((function(e){n[r++]=255&parseInt(e,10)}));else if(isV6(e)){const i=e.split(":",8);let s;for(s=0;s<i.length;s++){let e;isV4(i[s])&&(e=toBytes(i[s]),i[s]=uint8ArrayToString$y(e.slice(0,2),"base16")),e&&++s<8&&i.splice(s,0,uint8ArrayToString$y(e.slice(2,4),"base16"))}if(""===i[0])for(;i.length<8;)i.unshift("0");else if(""===i[i.length-1])for(;i.length<8;)i.push("0");else if(i.length<8){for(s=0;s<i.length&&""!==i[s];s++);const e=[s,"1"];for(s=9-i.length;s>0;s--)e.push("0");i.splice.apply(i,e)}for(n=t||new Uint8Array(r+16),s=0;s<i.length;s++){const e=parseInt(i[s],16);n[r++]=e>>8&255,n[r++]=255&e}}if(!n)throw Error("Invalid ip address: "+e);return n},toString$2=function(e,t,r){t=~~t,r=r||e.length-t;const n=[];let i;const s=new DataView(e.buffer);if(4===r){for(let i=0;i<r;i++)n.push(e[t+i]);i=n.join(".")}else if(16===r){for(let e=0;e<r;e+=2)n.push(s.getUint16(t+e).toString(16));i=n.join(":"),i=i.replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3"),i=i.replace(/:{3,4}/,"::")}return i};var ip$1={isIP:isIP,isV4:isV4,isV6:isV6,toBytes:toBytes,toString:toString$2};function Protocols$1(e){if("number"==typeof e){if(Protocols$1.codes[e])return Protocols$1.codes[e];throw new Error("no protocol with code: "+e)}if("string"==typeof e){if(Protocols$1.names[e])return Protocols$1.names[e];throw new Error("no protocol with name: "+e)}throw new Error("invalid protocol id type: "+e)}const V=-1;function p(e,t,r,n,i){return{code:e,size:t,name:r,resolvable:Boolean(n),path:Boolean(i)}}Protocols$1.lengthPrefixedVarSize=V,Protocols$1.V=V,Protocols$1.table=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,V,"ip6zone"],[53,V,"dns","resolvable"],[54,V,"dns4","resolvable"],[55,V,"dns6","resolvable"],[56,V,"dnsaddr","resolvable"],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,V,"unix",!1,"path"],[421,V,"ipfs"],[421,V,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,V,"garlic64"],[460,0,"quic"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,V,"memory"]],Protocols$1.names={},Protocols$1.codes={},Protocols$1.table.map((e=>{const t=p.apply(null,e);return Protocols$1.codes[t.code]=t,Protocols$1.names[t.name]=t,null})),Protocols$1.object=p;var protocolsTable=Protocols$1,encode_1=encode$4,MSB$1=128,REST$1=127,MSBALL=~REST$1,INT=Math.pow(2,31);function encode$4(e,t,r){if(Number.MAX_SAFE_INTEGER&&e>Number.MAX_SAFE_INTEGER)throw encode$4.bytes=0,new RangeError("Could not encode varint");t=t||[];for(var n=r=r||0;e>=INT;)t[r++]=255&e|MSB$1,e/=128;for(;e&MSBALL;)t[r++]=255&e|MSB$1,e>>>=7;return t[r]=0|e,encode$4.bytes=r-n+1,t}var decode$5=read,MSB=128,REST=127;function read(e,t){var r,n=0,i=0,s=t=t||0,o=e.length;do{if(s>=o||i>49)throw read.bytes=0,new RangeError("Could not decode varint");r=e[s++],n+=i<28?(r&REST)<<i:(r&REST)*Math.pow(2,i),i+=7}while(r>=MSB);return read.bytes=s-t,n}var N1=Math.pow(2,7),N2=Math.pow(2,14),N3=Math.pow(2,21),N4=Math.pow(2,28),N5=Math.pow(2,35),N6=Math.pow(2,42),N7=Math.pow(2,49),N8=Math.pow(2,56),N9=Math.pow(2,63),length$1=function(e){return e<N1?1:e<N2?2:e<N3?3:e<N4?4:e<N5?5:e<N6?6:e<N7?7:e<N8?8:e<N9?9:10},varint$6={encode:encode_1,decode:decode$5,encodingLength:length$1};const ip=ip$1,protocols$3=protocolsTable,{CID:CID$2}=require$$0$a,{base32:base32$1}=require$$1$8,{base58btc:base58btc$6}=require$$3$2,Digest=require$$6$1,varint$5=varint$6,{toString:uint8ArrayToString$x}=require$$1$5,{fromString:uint8ArrayFromString$s}=require$$3$1,{concat:uint8ArrayConcat$c}=require$$2$2;var convert$6=Convert;function Convert(e,t){return t instanceof Uint8Array?Convert.toString(e,t):Convert.toBytes(e,t)}function ip2bytes(e){if(!ip.isIP(e))throw new Error("invalid ip address");return ip.toBytes(e)}function bytes2ip(e){const t=ip.toString(e);if(!t||!ip.isIP(t))throw new Error("invalid ip address");return t}function port2bytes(e){const t=new ArrayBuffer(2);return new DataView(t).setUint16(0,e),new Uint8Array(t)}function bytes2port(e){return new DataView(e.buffer).getUint16(e.byteOffset)}function str2bytes(e){const t=uint8ArrayFromString$s(e),r=Uint8Array.from(varint$5.encode(t.length));return uint8ArrayConcat$c([r,t],r.length+t.length)}function bytes2str(e){const t=varint$5.decode(e);if((e=e.slice(varint$5.decode.bytes)).length!==t)throw new Error("inconsistent lengths");return uint8ArrayToString$x(e)}function mh2bytes(e){let t;t="Q"===e[0]||"1"===e[0]?Digest.decode(base58btc$6.decode(`z${e}`)).bytes:CID$2.parse(e).multihash.bytes;const r=Uint8Array.from(varint$5.encode(t.length));return uint8ArrayConcat$c([r,t],r.length+t.length)}function bytes2mh(e){const t=varint$5.decode(e),r=e.slice(varint$5.decode.bytes);if(r.length!==t)throw new Error("inconsistent lengths");return uint8ArrayToString$x(r,"base58btc")}function onion2bytes(e){const t=e.split(":");if(2!==t.length)throw new Error("failed to parse onion addr: "+t+" does not contain a port number");if(16!==t[0].length)throw new Error("failed to parse onion addr: "+t[0]+" not a Tor onion address.");const r=base32$1.decode("b"+t[0]),n=parseInt(t[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=port2bytes(n);return uint8ArrayConcat$c([r,i],r.length+i.length)}function onion32bytes(e){const t=e.split(":");if(2!==t.length)throw new Error("failed to parse onion addr: "+t+" does not contain a port number");if(56!==t[0].length)throw new Error("failed to parse onion addr: "+t[0]+" not a Tor onion3 address.");const r=base32$1.decode("b"+t[0]),n=parseInt(t[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=port2bytes(n);return uint8ArrayConcat$c([r,i],r.length+i.length)}function bytes2onion(e){const t=e.slice(0,e.length-2),r=e.slice(e.length-2);return uint8ArrayToString$x(t,"base32")+":"+bytes2port(r)}Convert.toString=function(e,t){switch(protocols$3(e).code){case 4:case 41:return bytes2ip(t);case 6:case 273:case 33:case 132:return bytes2port(t).toString();case 53:case 54:case 55:case 56:case 400:case 777:return bytes2str(t);case 421:return bytes2mh(t);case 444:case 445:return bytes2onion(t);default:return uint8ArrayToString$x(t,"base16")}},Convert.toBytes=function(e,t){switch(protocols$3(e).code){case 4:case 41:return ip2bytes(t);case 6:case 273:case 33:case 132:return port2bytes(parseInt(t,10));case 53:case 54:case 55:case 56:case 400:case 777:return str2bytes(t);case 421:return mh2bytes(t);case 444:return onion2bytes(t);case 445:return onion32bytes(t);default:return uint8ArrayFromString$s(t,"base16")}};const convert$5=convert$6,protocols$2=protocolsTable,varint$4=varint$6,{concat:uint8ArrayConcat$b}=require$$2$2,{toString:uint8ArrayToString$w}=require$$1$5;var codec$1={stringToStringTuples:stringToStringTuples,stringTuplesToString:stringTuplesToString,tuplesToStringTuples:tuplesToStringTuples,stringTuplesToTuples:stringTuplesToTuples,bytesToTuples:bytesToTuples,tuplesToBytes:tuplesToBytes,bytesToString:bytesToString,stringToBytes:stringToBytes,fromString:fromString$5,fromBytes:fromBytes,validateBytes:validateBytes,isValidBytes:isValidBytes,cleanPath:cleanPath,ParseError:ParseError,protoFromTuple:protoFromTuple,sizeForAddr:sizeForAddr};function stringToStringTuples(e){const t=[],r=e.split("/").slice(1);if(1===r.length&&""===r[0])return[];for(let n=0;n<r.length;n++){const i=r[n],s=protocols$2(i);if(0!==s.size){if(n++,n>=r.length)throw ParseError("invalid address: "+e);if(s.path){t.push([i,cleanPath(r.slice(n).join("/"))]);break}t.push([i,r[n]])}else t.push([i])}return t}function stringTuplesToString(e){const t=[];return e.map((e=>{const r=protoFromTuple(e);return t.push(r.name),e.length>1&&t.push(e[1]),null})),cleanPath(t.join("/"))}function stringTuplesToTuples(e){return e.map((e=>{Array.isArray(e)||(e=[e]);const t=protoFromTuple(e);return e.length>1?[t.code,convert$5.toBytes(t.code,e[1])]:[t.code]}))}function tuplesToStringTuples(e){return e.map((e=>{const t=protoFromTuple(e);return e[1]?[t.code,convert$5.toString(t.code,e[1])]:[t.code]}))}function tuplesToBytes(e){return fromBytes(uint8ArrayConcat$b(e.map((e=>{const t=protoFromTuple(e);let r=Uint8Array.from(varint$4.encode(t.code));return e.length>1&&(r=uint8ArrayConcat$b([r,e[1]])),r}))))}function sizeForAddr(e,t){if(e.size>0)return e.size/8;if(0===e.size)return 0;return varint$4.decode(t)+varint$4.decode.bytes}function bytesToTuples(e){const t=[];let r=0;for(;r<e.length;){const n=varint$4.decode(e,r),i=varint$4.decode.bytes,s=sizeForAddr(protocols$2(n),e.slice(r+i));if(0===s){t.push([n]),r+=i;continue}const o=e.slice(r+i,r+i+s);if(r+=s+i,r>e.length)throw ParseError("Invalid address Uint8Array: "+uint8ArrayToString$w(e,"base16"));t.push([n,o])}return t}function bytesToString(e){return stringTuplesToString(tuplesToStringTuples(bytesToTuples(e)))}function stringToBytes(e){return tuplesToBytes(stringTuplesToTuples(stringToStringTuples(e=cleanPath(e))))}function fromString$5(e){return stringToBytes(e)}function fromBytes(e){const t=validateBytes(e);if(t)throw t;return Uint8Array.from(e)}function validateBytes(e){try{bytesToTuples(e)}catch(e){return e}}function isValidBytes(e){return void 0===validateBytes(e)}function cleanPath(e){return"/"+e.trim().split("/").filter((e=>e)).join("/")}function ParseError(e){return new Error("Error parsing address: "+e)}function protoFromTuple(e){return protocols$2(e[0])}const codec=codec$1,protocols$1=protocolsTable,varint$3=varint$6,{CID:CID$1}=require$$0$a,{base58btc:base58btc$5}=require$$3$2,errCode$l=errCode$m,inspect$2=Symbol.for("nodejs.util.inspect.custom"),{toString:uint8ArrayToString$v}=require$$1$5,{equals:uint8ArrayEquals$l}=require$$10$1,resolvers$1=new Map,symbol$5=Symbol.for("@multiformats/js-multiaddr/multiaddr");class Multiaddr$j{constructor(e){if(null==e&&(e=""),Object.defineProperty(this,symbol$5,{value:!0}),e instanceof Uint8Array)this.bytes=codec.fromBytes(e);else if("string"==typeof e){if(e.length>0&&"/"!==e.charAt(0))throw new Error(`multiaddr "${e}" must start with a "/"`);this.bytes=codec.fromString(e)}else{if(!Multiaddr$j.isMultiaddr(e))throw new Error("addr must be a string, Buffer, or another Multiaddr");this.bytes=codec.fromBytes(e.bytes)}}toString(){return codec.bytesToString(this.bytes)}toJSON(){return this.toString()}toOptions(){const e={},t=this.toString().split("/");return e.family="ip4"===t[1]?4:6,e.host=t[2],e.transport=t[3],e.port=parseInt(t[4]),e}protos(){return this.protoCodes().map((e=>Object.assign({},protocols$1(e))))}protoCodes(){const e=[],t=this.bytes;let r=0;for(;r<t.length;){const n=varint$3.decode(t,r),i=varint$3.decode.bytes,s=protocols$1(n);r+=codec.sizeForAddr(s,t.slice(r+i))+i,e.push(n)}return e}protoNames(){return this.protos().map((e=>e.name))}tuples(){return codec.bytesToTuples(this.bytes)}stringTuples(){const e=codec.bytesToTuples(this.bytes);return codec.tuplesToStringTuples(e)}encapsulate(e){return e=new Multiaddr$j(e),new Multiaddr$j(this.toString()+e.toString())}decapsulate(e){const t=e.toString(),r=this.toString(),n=r.lastIndexOf(t);if(n<0)throw new Error("Address "+this+" does not contain subaddress: "+e);return new Multiaddr$j(r.slice(0,n))}decapsulateCode(e){const t=this.tuples();for(let r=t.length-1;r>=0;r--)if(t[r][0]===e)return new Multiaddr$j(codec.tuplesToBytes(t.slice(0,r)));return this}getPeerId(){try{const e=this.stringTuples().filter((e=>e[0]===protocols$1.names.ipfs.code)),t=e.pop();if(t&&t[1]){const e=t[1];return"Q"===e[0]||"1"===e[0]?uint8ArrayToString$v(base58btc$5.decode(`z${e}`),"base58btc"):uint8ArrayToString$v(CID$1.parse(e).multihash.bytes,"base58btc")}return null}catch(e){return null}}getPath(){let e=null;try{e=this.stringTuples().filter((e=>!!protocols$1(e[0]).path))[0][1],e||(e=null)}catch(t){e=null}return e}equals(e){return uint8ArrayEquals$l(this.bytes,e.bytes)}async resolve(){const e=this.protos().find((e=>e.resolvable));if(!e)return[this];const t=resolvers$1.get(e.name);if(!t)throw errCode$l(new Error(`no available resolver for ${e.name}`),"ERR_NO_AVAILABLE_RESOLVER");return(await t(this)).map((e=>new Multiaddr$j(e)))}nodeAddress(){const e=this.protoCodes(),t=this.protoNames(),r=this.toString().split("/").slice(1);if(r.length<4)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6}/{address}/{tcp, udp}/{port}".');if(4!==e[0]&&41!==e[0]&&54!==e[0]&&55!==e[0])throw new Error(`no protocol with name: "'${t[0]}'". Must have a valid family name: "{ip4, ip6, dns4, dns6}".`);if("tcp"!==r[2]&&"udp"!==r[2])throw new Error(`no protocol with name: "'${t[1]}'". Must have a valid transport protocol: "{tcp, udp}".`);return{family:41===e[0]||55===e[0]?6:4,address:r[1],port:parseInt(r[3])}}isThinWaistAddress(e){const t=(e||this).protos();return 2===t.length&&((4===t[0].code||41===t[0].code)&&(6===t[1].code||273===t[1].code))}static fromNodeAddress(e,t){if(!e)throw new Error("requires node address object");if(!t)throw new Error("requires transport protocol");let r;switch(e.family){case 4:r="ip4";break;case 6:r="ip6";break;default:throw Error(`Invalid addr family. Got '${e.family}' instead of 4 or 6`)}return new Multiaddr$j("/"+[r,e.address,t,e.port].join("/"))}static isName(e){return!!Multiaddr$j.isMultiaddr(e)&&e.protos().some((e=>e.resolvable))}static isMultiaddr(e){return e instanceof Multiaddr$j||Boolean(e&&e[symbol$5])}[inspect$2](){return"<Multiaddr "+uint8ArrayToString$v(this.bytes,"base16")+" - "+codec.bytesToString(this.bytes)+">"}inspect(){return"<Multiaddr "+uint8ArrayToString$v(this.bytes,"base16")+" - "+codec.bytesToString(this.bytes)+">"}}function multiaddr(e){return new Multiaddr$j(e)}Multiaddr$j.protocols=protocols$1,Multiaddr$j.resolvers=resolvers$1;var src$o={Multiaddr:Multiaddr$j,multiaddr:multiaddr,protocols:protocols$1,resolvers:resolvers$1};const filter$2=async function*(e,t){for await(const r of e)await t(r)&&(yield r)};var itFilter=filter$2;const map$3=async function*(e,t){for await(const r of e)yield t(r)};var itMap=map$3;const take$2=async function*(e,t){let r=0;if(!(t<1))for await(const n of e)if(yield n,r++,r===t)return};var itTake=take$2;const errCode$k=errCode$m,filter$1=itFilter,map$2=itMap,take$1=itTake;function storeAddresses$2(e,t){return map$2(e,(e=>(t.addressBook.add(e.id,e.multiaddrs),e)))}function uniquePeers$2(e){const t=new Set;return filter$1(e,(e=>!t.has(e.id.toString())&&(t.add(e.id.toString()),!0)))}async function*requirePeers$2(e,t=1){let r=0;for await(const t of e)r++,yield t;if(r<t)throw errCode$k(new Error("not found"),"NOT_FOUND")}function maybeLimitSource$1(e,t){return t?take$1(e,t):e}var utils$x={storeAddresses:storeAddresses$2,uniquePeers:uniquePeers$2,requirePeers:requirePeers$2,maybeLimitSource:maybeLimitSource$1},src$n={},browser$7={exports:{}};const{AbortController:AbortController$5,AbortSignal:AbortSignal}="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0;let impl;browser$7.exports=AbortController$5,browser$7.exports.AbortSignal=AbortSignal,browser$7.exports.default=AbortController$5,impl=globalThis.AbortController&&globalThis.AbortSignal?globalThis:browser$7.exports,src$n.AbortSignal=impl.AbortSignal,src$n.AbortController=impl.AbortController;var timeBrowser=function(){return Date.now()};const getTime=timeBrowser;class Retimer{constructor(e,t,r){const n=this;this._started=getTime(),this._rescheduled=0,this._scheduled=t,this._args=r,this._triggered=!1,this._timerWrapper=()=>{n._rescheduled>0?(n._scheduled=n._rescheduled-(getTime()-n._started),n._schedule(n._scheduled)):(n._triggered=!0,e.apply(null,n._args))},this._timer=setTimeout(this._timerWrapper,t)}reschedule(e){e||(e=this._scheduled);const t=getTime();t+e-(this._started+this._scheduled)<0?(clearTimeout(this._timer),this._schedule(e)):this._triggered?this._schedule(e):(this._started=t,this._rescheduled=e)}_schedule(e){this._triggered=!1,this._started=getTime(),this._rescheduled=0,this._scheduled=e,this._timer=setTimeout(this._timerWrapper,e)}clear(){clearTimeout(this._timer)}}function retimer$4(){if("function"!=typeof arguments[0])throw new Error("callback needed");if("number"!=typeof arguments[1])throw new Error("timeout needed");let e;if(arguments.length>0){e=new Array(arguments.length-2);for(var t=0;t<e.length;t++)e[t]=arguments[t+2]}return new Retimer(arguments[0],arguments[1],e)}var retimer_1=retimer$4;const{AbortController:AbortController$4}=src$n,retimer$3=retimer_1;class TimeoutController$2 extends AbortController$4{constructor(e){super(),this._ms=e,this._timer=retimer$3((()=>this.abort()),e),Object.setPrototypeOf(this,TimeoutController$2.prototype)}abort(){return this._timer.clear(),super.abort()}clear(){this._timer.clear()}reset(){this._timer.clear(),this._timer=retimer$3((()=>this.abort()),this._ms)}}var timeoutAbortController={TimeoutController:TimeoutController$2},fixedSize=class{constructor(e){if(!(e>0)||0!=(e-1&e))throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(void 0!==e)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return void 0===this.buffer[this.btm]}};const FixedFIFO=fixedSize;var fastFifo=class{constructor(e){this.hwm=e||16,this.head=new FixedFIFO(this.hwm),this.tail=this.head}push(e){if(!this.head.push(e)){const t=this.head;this.head=t.next=new FixedFIFO(2*this.head.buffer.length),this.head.push(e)}}shift(){const e=this.tail.shift();if(void 0===e&&this.tail.next){const e=this.tail.next;return this.tail.next=null,this.tail=e,this.tail.shift()}return e}isEmpty(){return this.head.isEmpty()}};const FIFO$1=fastFifo;var itPushable=e=>{let t;"function"==typeof(e=e||{})?(t=e,e={}):t=e.onEnd;let r,n,i,s=new FIFO$1;const o=e=>n?n(e):(s.push(e),r),a=e=>i?r:o({done:!1,value:e}),u=e=>i?r:(i=!0,e?(e=>(s=new FIFO$1,n?n({error:e}):(s.push({error:e}),r)))(e):o({done:!0}));if(r={[Symbol.asyncIterator](){return this},next:()=>{if(!s.isEmpty()){if(e.writev){let e;const t=[];for(;!s.isEmpty();){if(e=s.shift(),e.error)throw e.error;t.push(e.value)}return{done:e.done,value:t}}const t=s.shift();if(t.error)throw t.error;return t}return i?{done:!0}:new Promise(((t,i)=>{n=s=>(n=null,s.error?i(s.error):e.writev&&!s.done?t({done:s.done,value:[s.value]}):t(s),r)}))},return:()=>(s=new FIFO$1,u(),{done:!0}),throw:e=>(u(e),{done:!0}),push:a,end:u},!t)return r;const c=r;return r={[Symbol.asyncIterator](){return this},next:()=>c.next(),throw:e=>(c.throw(e),t&&(t(e),t=null),{done:!0}),return:()=>(c.return(),t&&(t(),t=null),{done:!0}),push:a,end:e=>(c.end(e),t&&(t(e),t=null),r)},r};const pushable$3=itPushable,merge$3=async function*(...e){const t=pushable$3();setTimeout((async()=>{try{await Promise.all(e.map((async e=>{for await(const r of e)t.push(r)}))),t.end()}catch(e){t.end(e)}}),0),yield*t};var itMerge=merge$3,itPipe={exports:{}};const rawPipe=(...e)=>{let t;for(;e.length;)t=e.shift()(t);return t},isIterable=e=>e&&("function"==typeof e[Symbol.asyncIterator]||"function"==typeof e[Symbol.iterator]||"function"==typeof e.next),isDuplex=e=>e&&"function"==typeof e.sink&&isIterable(e.source),duplexPipelineFn=e=>t=>(e.sink(t),e.source),pipe$b=(...e)=>{if(isDuplex(e[0])){const t=e[0];e[0]=()=>t.source}else if(isIterable(e[0])){const t=e[0];e[0]=()=>t}if(e.length>1&&isDuplex(e[e.length-1])&&(e[e.length-1]=e[e.length-1].sink),e.length>2)for(let t=1;t<e.length-1;t++)isDuplex(e[t])&&(e[t]=duplexPipelineFn(e[t]));return rawPipe(...e)};itPipe.exports=pipe$b,itPipe.exports.pipe=pipe$b,itPipe.exports.rawPipe=rawPipe,itPipe.exports.isIterable=isIterable,itPipe.exports.isDuplex=isDuplex;const first$1=async e=>{for await(const t of e)return t};var itFirst=first$1;const drain$3=async e=>{for await(const t of e);};var itDrain=drain$3;const intervals=new Map,_generateId=()=>`${Date.now()}:${Math.floor(1e6*Math.random())}`;async function _runPeriodically(e,t,r){for(;intervals.get(r);){try{await e()}catch(e){setTimeout((()=>{throw e}),1);break}if(!intervals.get(r))break;await new Promise((e=>{const n=setTimeout(e,t);intervals.set(r,n)}))}}function setDelayedInterval$2(e,t,r){r=r||t;const n=_generateId(),i=setTimeout((()=>{_runPeriodically(e,t,n)}),r);return intervals.set(n,i),n}function clearDelayedInterval$2(e){const t=intervals.get(e);t&&(clearTimeout(t),intervals.delete(e))}var src$m={setDelayedInterval:setDelayedInterval$2,clearDelayedInterval:clearDelayedInterval$2},errors$4={messages:{NOT_STARTED_YET:"The libp2p node is not started yet",DHT_DISABLED:"DHT is not available",CONN_ENCRYPTION_REQUIRED:"At least one connection encryption module is required",NOT_FOUND:"Not found"},codes:{DHT_DISABLED:"ERR_DHT_DISABLED",PUBSUB_NOT_STARTED:"ERR_PUBSUB_NOT_STARTED",DHT_NOT_STARTED:"ERR_DHT_NOT_STARTED",CONN_ENCRYPTION_REQUIRED:"ERR_CONN_ENCRYPTION_REQUIRED",ERR_INVALID_PROTOCOLS_FOR_STREAM:"ERR_INVALID_PROTOCOLS_FOR_STREAM",ERR_CONNECTION_ENDED:"ERR_CONNECTION_ENDED",ERR_CONNECTION_FAILED:"ERR_CONNECTION_FAILED",ERR_NODE_NOT_STARTED:"ERR_NODE_NOT_STARTED",ERR_ALREADY_ABORTED:"ERR_ALREADY_ABORTED",ERR_TOO_MANY_ADDRESSES:"ERR_TOO_MANY_ADDRESSES",ERR_NO_VALID_ADDRESSES:"ERR_NO_VALID_ADDRESSES",ERR_RELAYED_DIAL:"ERR_RELAYED_DIAL",ERR_DIALED_SELF:"ERR_DIALED_SELF",ERR_DISCOVERED_SELF:"ERR_DISCOVERED_SELF",ERR_DUPLICATE_TRANSPORT:"ERR_DUPLICATE_TRANSPORT",ERR_ENCRYPTION_FAILED:"ERR_ENCRYPTION_FAILED",ERR_HOP_REQUEST_FAILED:"ERR_HOP_REQUEST_FAILED",ERR_INVALID_KEY:"ERR_INVALID_KEY",ERR_INVALID_MESSAGE:"ERR_INVALID_MESSAGE",ERR_INVALID_PARAMETERS:"ERR_INVALID_PARAMETERS",ERR_INVALID_PEER:"ERR_INVALID_PEER",ERR_MUXER_UNAVAILABLE:"ERR_MUXER_UNAVAILABLE",ERR_NOT_FOUND:"ERR_NOT_FOUND",ERR_TIMEOUT:"ERR_TIMEOUT",ERR_TRANSPORT_UNAVAILABLE:"ERR_TRANSPORT_UNAVAILABLE",ERR_TRANSPORT_DIAL_FAILED:"ERR_TRANSPORT_DIAL_FAILED",ERR_UNSUPPORTED_PROTOCOL:"ERR_UNSUPPORTED_PROTOCOL",ERR_INVALID_MULTIADDR:"ERR_INVALID_MULTIADDR",ERR_SIGNATURE_NOT_VALID:"ERR_SIGNATURE_NOT_VALID"}};const errCode$j=errCode$m,{messages:messages$2,codes:codes$b}=errors$4;class DHTPeerRouting$1{constructor(e){this._dht=e}async findPeer(e,t={}){for await(const r of this._dht.findPeer(e,t))if("FINAL_PEER"===r.name)return r.peer;throw errCode$j(new Error(messages$2.NOT_FOUND),codes$b.ERR_NOT_FOUND)}async*getClosestPeers(e,t={}){for await(const r of this._dht.getClosestPeers(e,t))"PEER_RESPONSE"===r.name&&(yield*r.closer)}}var dhtPeerRouting={DHTPeerRouting:DHTPeerRouting$1};const debug$I=require$$0$b,log$B=Object.assign(debug$I("libp2p:peer-routing"),{error:debug$I("libp2p:peer-routing:err")}),errCode$i=errCode$m,{storeAddresses:storeAddresses$1,uniquePeers:uniquePeers$1,requirePeers:requirePeers$1}=utils$x,{TimeoutController:TimeoutController$1}=timeoutAbortController,merge$2=itMerge,{pipe:pipe$a}=itPipe.exports,first=itFirst,drain$2=itDrain,filter=itFilter,{setDelayedInterval:setDelayedInterval$1,clearDelayedInterval:clearDelayedInterval$1}=src$m,{DHTPeerRouting:DHTPeerRouting}=dhtPeerRouting;class PeerRouting$1{constructor(e){this._peerId=e.peerId,this._peerStore=e.peerStore,this._routers=e._modules.peerRouting||[],e._dht&&e._config.dht.enabled&&this._routers.push(new DHTPeerRouting(e._dht)),this._refreshManagerOptions=e._options.peerRouting.refreshManager,this._findClosestPeersTask=this._findClosestPeersTask.bind(this)}start(){this._routers.length&&!this._timeoutId&&this._refreshManagerOptions.enabled&&(this._timeoutId=setDelayedInterval$1(this._findClosestPeersTask,this._refreshManagerOptions.interval,this._refreshManagerOptions.bootDelay))}async _findClosestPeersTask(){try{await drain$2(this.getClosestPeers(this._peerId.id,{timeout:this._refreshManagerOptions.timeout||1e4}))}catch(e){log$B.error(e)}}stop(){clearDelayedInterval$1(this._timeoutId)}async findPeer(e,t){if(!this._routers.length)throw errCode$i(new Error("No peer routers available"),"NO_ROUTERS_AVAILABLE");if(e.toB58String()===this._peerId.toB58String())throw errCode$i(new Error("Should not try to find self"),"ERR_FIND_SELF");const r=await pipe$a(merge$2(...this._routers.map((r=>[r.findPeer(e,t)]))),(e=>filter(e,Boolean)),(e=>storeAddresses$1(e,this._peerStore)),(e=>first(e)));if(r)return r;throw errCode$i(new Error("not found"),"NOT_FOUND")}async*getClosestPeers(e,t={timeout:3e4}){if(!this._routers.length)throw errCode$i(new Error("No peer routers available"),"NO_ROUTERS_AVAILABLE");t.timeout&&(t.signal=new TimeoutController$1(t.timeout).signal),yield*pipe$a(merge$2(...this._routers.map((r=>r.getClosestPeers(e,t)))),(e=>storeAddresses$1(e,this._peerStore)),(e=>uniquePeers$1(e)),(e=>requirePeers$1(e)))}}var peerRouting=PeerRouting$1;const drain$1=itDrain;class DHTContentRouting$1{constructor(e){this._dht=e}async provide(e){await drain$1(this._dht.provide(e))}async*findProviders(e,t){for await(const r of this._dht.findProviders(e,t))"PROVIDER"===r.name&&(yield*r.providers)}}var dhtContentRouting={DHTContentRouting:DHTContentRouting$1};const errCode$h=errCode$m,{messages:messages$1,codes:codes$a}=errors$4,{storeAddresses:storeAddresses,uniquePeers:uniquePeers,requirePeers:requirePeers,maybeLimitSource:maybeLimitSource}=utils$x,drain=itDrain,merge$1=itMerge,{pipe:pipe$9}=itPipe.exports,{DHTContentRouting:DHTContentRouting}=dhtContentRouting;class ContentRouting$1{constructor(e){this.libp2p=e,this.routers=e._modules.contentRouting||[],this.dht=e._dht,this.dht&&e._config.dht.enabled&&this.routers.push(new DHTContentRouting(this.dht))}async*findProviders(e,t={}){if(!this.routers.length)throw errCode$h(new Error("No content this.routers available"),"NO_ROUTERS_AVAILABLE");yield*pipe$9(merge$1(...this.routers.map((r=>r.findProviders(e,t)))),(e=>storeAddresses(e,this.libp2p.peerStore)),(e=>uniquePeers(e)),(e=>maybeLimitSource(e,t.maxNumProviders)),(e=>requirePeers(e)))}async provide(e){if(!this.routers.length)throw errCode$h(new Error("No content routers available"),"NO_ROUTERS_AVAILABLE");await Promise.all(this.routers.map((t=>t.provide(e))))}async put(e,t,r){if(!this.libp2p.isStarted()||!this.dht.isStarted)throw errCode$h(new Error(messages$1.NOT_STARTED_YET),codes$a.DHT_NOT_STARTED);await drain(this.dht.put(e,t,r))}async get(e,t){if(!this.libp2p.isStarted()||!this.dht.isStarted)throw errCode$h(new Error(messages$1.NOT_STARTED_YET),codes$a.DHT_NOT_STARTED);for await(const r of this.dht.get(e,t))if("VALUE"===r.name)return{from:r.peerId,val:r.value};throw errCode$h(new Error(messages$1.NOT_FOUND),codes$a.ERR_NOT_FOUND)}async*getMany(e,t,r){if(!this.libp2p.isStarted()||!this.dht.isStarted)throw errCode$h(new Error(messages$1.NOT_STARTED_YET),codes$a.DHT_NOT_STARTED);if(!t)return;let n=0;for await(const i of this.dht.get(e,r))if("VALUE"===i.name&&(yield{from:i.peerId,val:i.value},n++,n===t))break;if(0===n)throw errCode$h(new Error(messages$1.NOT_FOUND),codes$a.ERR_NOT_FOUND)}}var contentRouting=ContentRouting$1;const PeerId$l=src$q.exports,{Multiaddr:Multiaddr$i}=src$o,errCode$g=errCode$m,{codes:codes$9}=errors$4;function getPeer$2(e){let t;if("string"==typeof e&&(e=new Multiaddr$i(e)),Multiaddr$i.isMultiaddr(e)){t=e;const r=e.getPeerId();if(!r)throw errCode$g(new Error(`${e} does not have a valid peer type`),codes$9.ERR_INVALID_MULTIADDR);try{e=PeerId$l.createFromB58String(r)}catch(t){throw errCode$g(new Error(`${e} is not a valid peer type`),codes$9.ERR_INVALID_MULTIADDR)}}return{id:e,multiaddrs:t?[t]:void 0}}var getPeer_1=getPeer$2,config$2={},isPlainObj=e=>{if("[object Object]"!==Object.prototype.toString.call(e))return!1;const t=Object.getPrototypeOf(e);return null===t||t===Object.prototype};const isOptionObject=isPlainObj,{hasOwnProperty:hasOwnProperty$1}=Object.prototype,{propertyIsEnumerable:propertyIsEnumerable}=Object,defineProperty=(e,t,r)=>Object.defineProperty(e,t,{value:r,writable:!0,enumerable:!0,configurable:!0}),globalThis$1=commonjsGlobal,defaultMergeOptions={concatArrays:!1,ignoreUndefined:!1},getEnumerableOwnPropertyKeys=e=>{const t=[];for(const r in e)hasOwnProperty$1.call(e,r)&&t.push(r);if(Object.getOwnPropertySymbols){const r=Object.getOwnPropertySymbols(e);for(const n of r)propertyIsEnumerable.call(e,n)&&t.push(n)}return t};function clone$1(e){return Array.isArray(e)?cloneArray(e):isOptionObject(e)?cloneOptionObject(e):e}function cloneArray(e){const t=e.slice(0,0);return getEnumerableOwnPropertyKeys(e).forEach((r=>{defineProperty(t,r,clone$1(e[r]))})),t}function cloneOptionObject(e){const t=null===Object.getPrototypeOf(e)?Object.create(null):{};return getEnumerableOwnPropertyKeys(e).forEach((r=>{defineProperty(t,r,clone$1(e[r]))})),t}const mergeKeys=(e,t,r,n)=>(r.forEach((r=>{void 0===t[r]&&n.ignoreUndefined||(r in e&&e[r]!==Object.getPrototypeOf(e)?defineProperty(e,r,merge(e[r],t[r],n)):defineProperty(e,r,clone$1(t[r])))})),e),concatArrays=(e,t,r)=>{let n=e.slice(0,0),i=0;return[e,t].forEach((t=>{const s=[];for(let r=0;r<t.length;r++)hasOwnProperty$1.call(t,r)&&(s.push(String(r)),defineProperty(n,i++,t===e?t[r]:clone$1(t[r])));n=mergeKeys(n,t,getEnumerableOwnPropertyKeys(t).filter((e=>!s.includes(e))),r)})),n};function merge(e,t,r){return r.concatArrays&&Array.isArray(e)&&Array.isArray(t)?concatArrays(e,t,r):isOptionObject(t)&&isOptionObject(e)?mergeKeys(e,t,getEnumerableOwnPropertyKeys(t),r):clone$1(t)}var mergeOptions$5=function(...e){const t=merge(clone$1(defaultMergeOptions),this!==globalThis$1&&this||{},defaultMergeOptions);let r={_:{}};for(const n of e)if(void 0!==n){if(!isOptionObject(n))throw new TypeError("`"+n+"` is not an Option Object");r=merge(r,{_:n},t)}return r._},receptacle=Receptacle$1,toMS=ms,cache=Receptacle$1.prototype,counter=new Date%1e9;function getUID(){return(1e9*Math.random()>>>0)+counter++}function Receptacle$1(e){e=e||{},this.id=e.id||getUID(),this.max=e.max||1/0,this.items=e.items||[],this._lookup={},this.size=this.items.length,this.lastModified=new Date(e.lastModified||new Date);for(var t,r,n=this.items.length;n--;)t=this.items[n],r=new Date(t.expires)-new Date,this._lookup[t.key]=t,r>0?this.expire(t.key,r):r<=0&&this.delete(t.key)}cache.has=function(e){return e in this._lookup},cache.get=function(e){if(!this.has(e))return null;var t=this._lookup[e];return t.refresh&&this.expire(e,t.refresh),this.items.splice(this.items.indexOf(t),1),this.items.push(t),t.value},cache.meta=function(e){if(!this.has(e))return null;var t=this._lookup[e];return"meta"in t?t.meta:null},cache.set=function(e,t,r){var n=this._lookup[e],i=this._lookup[e]={key:e,value:t};return this.lastModified=new Date,n?(clearTimeout(n.timeout),this.items.splice(this.items.indexOf(n),1,i)):(this.size>=this.max&&this.delete(this.items[0].key),this.items.push(i),this.size++),r&&("ttl"in r&&this.expire(e,r.ttl),"meta"in r&&(i.meta=r.meta),r.refresh&&(i.refresh=r.ttl)),this},cache.delete=function(e){var t=this._lookup[e];return!!t&&(this.lastModified=new Date,this.items.splice(this.items.indexOf(t),1),clearTimeout(t.timeout),delete this._lookup[e],this.size--,this)},cache.expire=function(e,t){var r=t||0,n=this._lookup[e];if(!n)return this;if("string"==typeof r&&(r=toMS(t)),"number"!=typeof r)throw new TypeError("Expiration time must be a string or number.");return clearTimeout(n.timeout),n.timeout=setTimeout(this.delete.bind(this,n.key),r),n.expires=Number(new Date)+r,this},cache.clear=function(){for(var e=this.items.length;e--;)this.delete(this.items[e].key);return this},cache.toJSON=function(){for(var e,t=new Array(this.items.length),r=t.length;r--;)e=this.items[r],t[r]={key:e.key,meta:e.meta,value:e.value,expires:e.expires,refresh:e.refresh};return{id:this.id,max:isFinite(this.max)?this.max:void 0,lastModified:this.lastModified,items:t}};var src$l={exports:{}},browser$6={exports:{}};!function(e,t){var r=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==r)return r;throw new Error("unable to locate global object")}();e.exports=t=r.fetch,r.fetch&&(t.default=r.fetch.bind(r)),t.Headers=r.Headers,t.Request=r.Request,t.Response=r.Response}(browser$6,browser$6.exports),globalThis.fetch&&globalThis.Headers&&globalThis.Request&&globalThis.Response?src$l.exports={default:globalThis.fetch,Headers:globalThis.Headers,Request:globalThis.Request,Response:globalThis.Response}:src$l.exports={default:browser$6.exports.default,Headers:browser$6.exports.Headers,Request:browser$6.exports.Request,Response:browser$6.exports.Response};const{default:nativeFetch,Headers:Headers}=src$l.exports;function buildResource({serverResolver:e,hostname:t,recordType:r}){return`${e}?name=${t}&type=${r}`}function fetch(e){return nativeFetch(e,{headers:new Headers({accept:"application/dns-json"})})}function getCacheKey(e,t){return`${t}_${e}`}var utils$w={buildResource:buildResource,fetch:fetch,getCacheKey:getCacheKey};const debug$H=require$$0$b,log$A=debug$H("dns-over-http-resolver");log$A.error=debug$H("dns-over-http-resolver:error");const Receptacle=receptacle,utils$v=utils$w;class Resolver{constructor({maxCache:e=100}={}){this._cache=new Receptacle({max:e}),this._servers=["https://cloudflare-dns.com/dns-query","https://dns.google/resolve"]}getServers(){return this._servers}_getShuffledServers(){const e=[].concat(this._servers);for(let t=e.length-1;t>0;t--){const r=Math.floor(Math.random()*t),n=e[t];e[t]=e[r],e[r]=n}return e}setServers(e){this._servers=e}resolve(e,t="A"){switch(t){case"A":return this.resolve4(e);case"AAAA":return this.resolve6(e);case"TXT":return this.resolveTxt(e);default:throw new Error(`${t} is not supported`)}}async resolve4(e){const t="A",r=this._cache.get(utils$v.getCacheKey(e,t));if(r)return r;for(const r of this._getShuffledServers())try{const n=await utils$v.fetch(utils$v.buildResource({serverResolver:r,hostname:e,recordType:t})),i=await n.json(),s=i.Answer.map((e=>e.data)),o=Math.min(i.Answer.map((e=>e.TTL)));return this._cache.set(utils$v.getCacheKey(e,t),s,{ttl:o}),s}catch(t){log$A.error(`${r} could not resolve ${e} record A`)}throw new Error(`Could not resolve ${e} record A`)}async resolve6(e){const t="AAAA",r=this._cache.get(utils$v.getCacheKey(e,t));if(r)return r;for(const r of this._getShuffledServers())try{const n=await utils$v.fetch(utils$v.buildResource({serverResolver:r,hostname:e,recordType:t})),i=await n.json(),s=i.Answer.map((e=>e.data)),o=Math.min(i.Answer.map((e=>e.TTL)));return this._cache.set(utils$v.getCacheKey(e,t),s,{ttl:o}),s}catch(t){log$A.error(`${r} could not resolve ${e} record AAAA`)}throw new Error(`Could not resolve ${e} record AAAA`)}async resolveTxt(e){const t="TXT",r=this._cache.get(utils$v.getCacheKey(e,t));if(r)return r;for(const r of this._getShuffledServers())try{const n=await utils$v.fetch(utils$v.buildResource({serverResolver:r,hostname:e,recordType:t})),i=await n.json(),s=i.Answer.map((e=>[e.data.replace(/['"]+/g,"")])),o=Math.min(i.Answer.map((e=>e.TTL)));return this._cache.set(utils$v.getCacheKey(e,t),s,{ttl:o}),s}catch(t){log$A.error(`${r} could not resolve ${e} record TXT`)}throw new Error(`Could not resolve ${e} record TXT`)}}Resolver.Resolver=Resolver;var src$k=Resolver;const dns=src$k;var dns_browser=dns;const protocols=protocolsTable,{code:dnsaddrCode}=protocols("dnsaddr");async function dnsaddrResolver$1(e){const t=new dns_browser,r=e.getPeerId(),[,n]=e.stringTuples().find((([e])=>e===dnsaddrCode))||[];let i=(await t.resolveTxt(`_dnsaddr.${n}`)).flat().map((e=>e.split("=")[1]));return r&&(i=i.filter((e=>e.includes(r)))),i}var resolvers={dnsaddrResolver:dnsaddrResolver$1},constants$9={DIAL_TIMEOUT:3e4,MAX_PARALLEL_DIALS:100,MAX_PER_PEER_DIALS:4,MAX_ADDRS_TO_DIAL:25,METRICS:{computeThrottleMaxQueueSize:1e3,computeThrottleTimeout:2e3,movingAverageIntervals:[6e4,3e5,9e5],maxOldPeersRetention:50}},consts$2={},name$1="libp2p",version$1="0.35.1",description$1="JavaScript implementation of libp2p, a modular peer to peer network stack",leadMaintainer="Jacob Heun <jacobheun@gmail.com>",main$1="src/index.js",types="dist/src/index.d.ts",typesVersions={"*":{"src/*":["dist/src/*","dist/src/*/index"]}},files$1=["dist","src"],scripts$1={lint:"aegir lint",build:"aegir build","build:proto":"npm run build:proto:circuit && npm run build:proto:identify && npm run build:proto:plaintext && npm run build:proto:address-book && npm run build:proto:proto-book && npm run build:proto:peer-record && npm run build:proto:envelope","build:proto:circuit":"pbjs -t static-module -w commonjs -r libp2p-circuit --force-number --no-verify --no-delimited --no-create --no-beautify --no-defaults --lint eslint-disable -o src/circuit/protocol/index.js ./src/circuit/protocol/index.proto","build:proto:identify":"pbjs -t static-module -w commonjs -r libp2p-identify --force-number --no-verify --no-delimited --no-create --no-beautify --no-defaults --lint eslint-disable -o src/identify/message.js ./src/identify/message.proto","build:proto:plaintext":"pbjs -t static-module -w commonjs -r libp2p-plaintext --force-number --no-verify --no-delimited --no-create --no-beautify --no-defaults --lint eslint-disable -o src/insecure/proto.js ./src/insecure/proto.proto","build:proto:address-book":"pbjs -t static-module -w commonjs -r libp2p-address-book --force-number --no-verify --no-delimited --no-create --no-beautify --no-defaults --lint eslint-disable -o src/peer-store/persistent/pb/address-book.js ./src/peer-store/persistent/pb/address-book.proto","build:proto:proto-book":"pbjs -t static-module -w commonjs -r libp2p-proto-book --force-number --no-verify --no-delimited --no-create --no-beautify --no-defaults --lint eslint-disable -o src/peer-store/persistent/pb/proto-book.js ./src/peer-store/persistent/pb/proto-book.proto","build:proto:peer-record":"pbjs -t static-module -w commonjs -r libp2p-peer-record --force-number --no-verify --no-delimited --no-create --no-beautify --no-defaults --lint eslint-disable -o src/record/peer-record/peer-record.js ./src/record/peer-record/peer-record.proto","build:proto:envelope":"pbjs -t static-module -w commonjs -r libp2p-envelope --force-number --no-verify --no-delimited --no-create --no-beautify --no-defaults --lint eslint-disable -o src/record/envelope/envelope.js ./src/record/envelope/envelope.proto","build:proto-types":"npm run build:proto-types:circuit && npm run build:proto-types:identify && npm run build:proto-types:plaintext && npm run build:proto-types:address-book && npm run build:proto-types:proto-book && npm run build:proto-types:peer-record && npm run build:proto-types:envelope","build:proto-types:circuit":"pbts -o src/circuit/protocol/index.d.ts src/circuit/protocol/index.js","build:proto-types:identify":"pbts -o src/identify/message.d.ts src/identify/message.js","build:proto-types:plaintext":"pbts -o src/insecure/proto.d.ts src/insecure/proto.js","build:proto-types:address-book":"pbts -o src/peer-store/persistent/pb/address-book.d.ts src/peer-store/persistent/pb/address-book.js","build:proto-types:proto-book":"pbts -o src/peer-store/persistent/pb/proto-book.d.ts src/peer-store/persistent/pb/proto-book.js","build:proto-types:peer-record":"pbts -o src/record/peer-record/peer-record.d.ts src/record/peer-record/peer-record.js","build:proto-types:envelope":"pbts -o src/record/envelope/envelope.d.ts src/record/envelope/envelope.js",test:"aegir test","test:ts":"aegir build --no-bundle && npm run test --prefix test/ts-use","test:node":'aegir test -t node -f "./test/**/*.{node,spec}.js"',"test:browser":"aegir test -t browser","test:examples":"cd examples && npm run test:all","test:interop":"LIBP2P_JS=$PWD npx aegir test -t node -f ./node_modules/libp2p-interop/test/*",prepare:"aegir build --no-bundle",release:"aegir release -t node -t browser","release-minor":"aegir release --type minor -t node -t browser","release-major":"aegir release --type major -t node -t browser",coverage:"nyc --reporter=text --reporter=lcov npm run test:node"},repository$1={type:"git",url:"https://github.com/libp2p/js-libp2p.git"},keywords$1=["libp2p","network","p2p","peer","peer-to-peer","IPFS"],bugs$1={url:"https://github.com/libp2p/js-libp2p/issues"},homepage$1="https://libp2p.io",license$1="MIT",engines={node:">=15.0.0"},browser$5={"@motrix/nat-api":!1},eslintConfig={extends:"ipfs",ignorePatterns:["!.aegir.js","test/ts-use","*.d.ts"]},dependencies$1={"@motrix/nat-api":"^0.3.1","@vascosantos/moving-average":"^1.1.0","abort-controller":"^3.0.0","abortable-iterator":"^3.0.0","aggregate-error":"^3.1.0","any-signal":"^2.1.1","bignumber.js":"^9.0.1","class-is":"^1.1.0",debug:"^4.3.1","err-code":"^3.0.0","es6-promisify":"^7.0.0",events:"^3.3.0",hashlru:"^2.3.0","interface-datastore":"^6.0.2","it-all":"^1.0.4","it-buffer":"^0.1.2","it-drain":"^1.0.3","it-filter":"^1.0.1","it-first":"^1.0.4","it-handshake":"^2.0.0","it-length-prefixed":"^5.0.2","it-map":"^1.0.4","it-merge":"^1.0.0","it-pipe":"^1.1.0","it-take":"^1.0.0","libp2p-crypto":"^0.21.0","libp2p-interfaces":"^2.0.1","libp2p-utils":"^0.4.0",mafmt:"^10.0.0","merge-options":"^3.0.4",multiaddr:"^10.0.0",multiformats:"^9.0.0","multistream-select":"^2.0.0","mutable-proxy":"^1.0.0","node-forge":"^0.10.0","p-any":"^3.0.0","p-fifo":"^1.0.0","p-retry":"^4.4.0","p-settle":"^4.1.1","peer-id":"^0.16.0","private-ip":"^2.1.0",protobufjs:"^6.10.2",retimer:"^3.0.0","sanitize-filename":"^1.6.3","set-delayed-interval":"^1.0.0","streaming-iterables":"^6.0.0","timeout-abort-controller":"^2.0.0",uint8arrays:"^3.0.0",varint:"^6.0.0",wherearewe:"^1.0.0",xsalsa20:"^1.1.0"},devDependencies$1={"@chainsafe/libp2p-noise":"^4.0.0","@nodeutils/defaults-deep":"^1.1.0","@types/es6-promisify":"^6.0.0","@types/node":"^16.0.1","@types/node-forge":"^0.10.1","@types/varint":"^6.0.0",aegir:"^36.0.0",buffer:"^6.0.3","datastore-core":"^6.0.7",delay:"^5.0.0","into-stream":"^6.0.0","ipfs-http-client":"^54.0.2","it-concat":"^2.0.0","it-pair":"^1.0.0","it-pushable":"^1.4.0",libp2p:".","libp2p-bootstrap":"^0.14.0","libp2p-delegated-content-routing":"^0.11.0","libp2p-delegated-peer-routing":"^0.11.0","libp2p-floodsub":"^0.27.0","libp2p-gossipsub":"^0.11.0","libp2p-interfaces-compliance-tests":"^2.0.1","libp2p-interop":"^0.5.0","libp2p-kad-dht":"^0.27.1","libp2p-mdns":"^0.18.0","libp2p-mplex":"^0.10.1","libp2p-tcp":"^0.17.0","libp2p-webrtc-star":"^0.25.0","libp2p-websockets":"^0.16.0",nock:"^13.0.3","p-defer":"^3.0.0","p-times":"^3.0.0","p-wait-for":"^3.2.0",rimraf:"^3.0.2",sinon:"^12.0.1",util:"^0.12.3"},contributors=["Vasco Santos <vasco.santos@moxy.studio>","David Dias <daviddias.p@gmail.com>","Jacob Heun <jacobheun@gmail.com>","Alex Potsides <alex@achingbrain.net>","Alan Shaw <alan@tableflip.io>","Cayman <caymannava@gmail.com>","Pedro Teixeira <i@pgte.me>","Friedel Ziegelmayer <dignifiedquire@gmail.com>","Maciej Krger <mkg20001@gmail.com>","Hugo Dias <mail@hugodias.me>","dirkmc <dirkmdev@gmail.com>","Chris Dostert <chrisdostert@users.noreply.github.com>","Volker Mische <volker.mische@gmail.com>","zeim839 <50573884+zeim839@users.noreply.github.com>","Richard Littauer <richard.littauer@gmail.com>","a1300 <matthias-knopp@gmx.net>","Ryan Bell <ryan@piing.net>","  <victorbjelkholm@gmail.com>","Giovanni T. Parra <fiatjaf@gmail.com>","acolytec3 <17355484+acolytec3@users.noreply.github.com>","Franck Royer <franck@royer.one>","Elven <mon.samuel@qq.com>","Robert Kiel <robert.kiel@hoprnet.org>","Andrew Nesbitt <andrewnez@gmail.com>","Samlior <samlior@foxmail.com>","Thomas Eizinger <thomas@eizinger.io>","Didrik Nordstrm <didrik.nordstrom@gmail.com>","Smite Chow <xiaopengyou@live.com>","Soeren <nikorpoulsen@gmail.com>","Snke Hahn <soenkehahn@gmail.com>","TJKoury <TJKoury@gmail.com>","TheStarBoys <41286328+TheStarBoys@users.noreply.github.com>","Tiago Alves <alvesjtiago@gmail.com>","XiaoZhang <zxinmyth@gmail.com>","Yusef Napora <yusef@napora.org>","Zane Starr <zcstarr@gmail.com>","ebinks <elizabethjbinks@gmail.com>","Aditya Bose <13054902+adbose@users.noreply.github.com>","isan_rivkin <isanrivkin@gmail.com>","mayerwin <mayerwin@users.noreply.github.com>","mcclure <andi.m.mcclure@gmail.com>","patrickwoodhead <91056047+patrickwoodhead@users.noreply.github.com>","phillmac <phillmac@users.noreply.github.com>","robertkiel <robert.kiel@validitylabs.org>","shresthagrawal <34920931+shresthagrawal@users.noreply.github.com>","swedneck <40505480+swedneck@users.noreply.github.com>","greenSnot <greenSnot@users.noreply.github.com>","Alan Smithee <ggnore.alan.smithee@gmail.com>","Aleksei <vozhdb@gmail.com>","Bernd Strehl <bernd.strehl@gmail.com>","Chris Bratlien <chrisbratlien@gmail.com>","Cindy Wu <ciindy.wu@gmail.com>","Daijiro Wachi <daijiro.wachi@gmail.com>","Diogo Silva <fsdiogo@gmail.com>","Dmitriy Ryajov <dryajov@gmail.com>","Ethan Lam <elmemphis2000@gmail.com>","Fei Liu <liu.feiwood@gmail.com>","Felipe Martins <felipebrasil93@gmail.com>","Florian-Merle <florian.david.merle@gmail.com>","Francis Gulotta <wizard@roborooter.com>","Guy Sviry <32539816+guysv@users.noreply.github.com>","Henrique Dias <hacdias@gmail.com>","Irakli Gozalishvili <rfobic@gmail.com>","Joel Gustafson <joelg@mit.edu>","John Rees <johnrees@users.noreply.github.com>","Joo Santos <joaosantos15@users.noreply.github.com>","Julien Bouquillon <contact@revolunet.com>","Kevin Kwok <antimatter15@gmail.com>","Kevin Lacker <lacker@gmail.com>","Lars Gierth <lgierth@users.noreply.github.com>","Leask Wong <i@leaskh.com>","Marcin Tojek <mtojek@users.noreply.github.com>","Michael Burns <5170+mburns@users.noreply.github.com>","Miguel Mota <miguelmota2@gmail.com>","Nuno Nogueira <nunofmn@gmail.com>","Philipp Muens <raute1337@gmx.de>","RasmusErik Voel Jensen <github@solsort.com>"],require$$7={name:name$1,version:version$1,description:description$1,leadMaintainer:leadMaintainer,main:main$1,types:types,typesVersions:typesVersions,files:files$1,scripts:scripts$1,repository:repository$1,keywords:keywords$1,bugs:bugs$1,homepage:homepage$1,license:license$1,engines:engines,browser:browser$5,eslintConfig:eslintConfig,dependencies:dependencies$1,devDependencies:devDependencies$1,contributors:contributors};const libp2pVersion=require$$7.version;consts$2.PROTOCOL_VERSION="ipfs/0.1.0",consts$2.AGENT_VERSION=`js-libp2p/${libp2pVersion}`,consts$2.MULTICODEC_IDENTIFY="/ipfs/id/1.0.0",consts$2.MULTICODEC_IDENTIFY_PUSH="/ipfs/id/push/1.0.0",consts$2.IDENTIFY_PROTOCOL_VERSION="0.1.0",consts$2.MULTICODEC_IDENTIFY_PROTOCOL_NAME="id",consts$2.MULTICODEC_IDENTIFY_PUSH_PROTOCOL_NAME="id/push",consts$2.MULTICODEC_IDENTIFY_PROTOCOL_VERSION="1.0.0",consts$2.MULTICODEC_IDENTIFY_PUSH_PROTOCOL_VERSION="1.0.0";const minute=6e4;var constants$8={ADVERTISE_BOOT_DELAY:15*minute,ADVERTISE_TTL:30*minute,CIRCUIT_PROTO_CODE:290,HOP_METADATA_KEY:"hop_relay",HOP_METADATA_VALUE:"true",RELAY_RENDEZVOUS_NS:"/libp2p/relay"},addressSort={},lib$1={},netmask={};(function(){var e,t,r,n,i,s,o,a;a=function(e){return[(e&255<<24)>>>24,(e&255<<16)>>>16,(65280&e)>>>8,255&e].join(".")},o=function(e){var r,n,i,s,o,a;for(r=[],i=s=0;s<=3&&0!==e.length;i=++s){if(i>0){if("."!==e[0])throw new Error("Invalid IP");e=e.substring(1)}o=(a=t(e))[0],n=a[1],e=e.substring(n),r.push(o)}if(0!==e.length)throw new Error("Invalid IP");switch(r.length){case 1:if(r[0]>4294967295)throw new Error("Invalid IP");return r[0]>>>0;case 2:if(r[0]>255||r[1]>16777215)throw new Error("Invalid IP");return(r[0]<<24|r[1])>>>0;case 3:if(r[0]>255||r[1]>255||r[2]>65535)throw new Error("Invalid IP");return(r[0]<<24|r[1]<<16|r[2])>>>0;case 4:if(r[0]>255||r[1]>255||r[2]>255||r[3]>255)throw new Error("Invalid IP");return(r[0]<<24|r[1]<<16|r[2]<<8|r[3])>>>0;default:throw new Error("Invalid IP")}},r=function(e){return e.charCodeAt(0)},n=r("0"),s=r("a"),i=r("A"),t=function(e){var t,o,a,u,c;for(u=0,t=10,o="9",a=0,e.length>1&&"0"===e[a]&&("x"===e[a+1]||"X"===e[a+1]?(a+=2,t=16):"0"<=e[a+1]&&e[a+1]<="9"&&(a++,t=8,o="7")),c=a;a<e.length;){if("0"<=e[a]&&e[a]<=o)u=u*t+(r(e[a])-n)>>>0;else{if(16!==t)break;if("a"<=e[a]&&e[a]<="f")u=u*t+(10+r(e[a])-s)>>>0;else{if(!("A"<=e[a]&&e[a]<="F"))break;u=u*t+(10+r(e[a])-i)>>>0}}if(u>4294967295)throw new Error("too large");a++}if(a===c)throw new Error("empty octet");return[u,a]},e=function(){function e(e,t){var r,n,i;if("string"!=typeof e)throw new Error("Missing `net' parameter");if(t||(i=e.split("/",2),e=i[0],t=i[1]),t||(t=32),"string"==typeof t&&t.indexOf(".")>-1){try{this.maskLong=o(t)}catch(e){throw new Error("Invalid mask: "+t)}for(r=n=32;n>=0;r=--n)if(this.maskLong===4294967295<<32-r>>>0){this.bitmask=r;break}}else{if(!t&&0!==t)throw new Error("Invalid mask: empty");this.bitmask=parseInt(t,10),this.maskLong=0,this.bitmask>0&&(this.maskLong=4294967295<<32-this.bitmask>>>0)}try{this.netLong=(o(e)&this.maskLong)>>>0}catch(t){throw new Error("Invalid net address: "+e)}if(!(this.bitmask<=32))throw new Error("Invalid mask for ip4: "+t);this.size=Math.pow(2,32-this.bitmask),this.base=a(this.netLong),this.mask=a(this.maskLong),this.hostmask=a(~this.maskLong),this.first=this.bitmask<=30?a(this.netLong+1):this.base,this.last=this.bitmask<=30?a(this.netLong+this.size-2):a(this.netLong+this.size-1),this.broadcast=this.bitmask<=30?a(this.netLong+this.size-1):void 0}return e.prototype.contains=function(t){return"string"==typeof t&&(t.indexOf("/")>0||4!==t.split(".").length)&&(t=new e(t)),t instanceof e?this.contains(t.base)&&this.contains(t.broadcast||t.last):(o(t)&this.maskLong)>>>0==(this.netLong&this.maskLong)>>>0},e.prototype.next=function(t){return null==t&&(t=1),new e(a(this.netLong+this.size*t),this.mask)},e.prototype.forEach=function(e){var t,r,n;for(n=o(this.first),r=o(this.last),t=0;n<=r;)e(a(n),n,t),t++,n++},e.prototype.toString=function(){return this.base+"/"+this.bitmask},e}(),netmask.ip2long=o,netmask.long2ip=a,netmask.Netmask=e}).call(commonjsGlobal);var ipaddr={exports:{}};!function(e){!function(t){const r="(0?\\d+|0x[a-f0-9]+)",n={fourOctet:new RegExp(`^${r}\\.${r}\\.${r}\\.${r}$`,"i"),threeOctet:new RegExp(`^${r}\\.${r}\\.${r}$`,"i"),twoOctet:new RegExp(`^${r}\\.${r}$`,"i"),longValue:new RegExp(`^${r}$`,"i")},i=new RegExp("^0[0-7]+$","i"),s=new RegExp("^0x[a-f0-9]+$","i"),o="%[0-9a-z]{1,}",a="(?:[0-9a-f]+::?)+",u={zoneIndex:new RegExp(o,"i"),native:new RegExp(`^(::)?(${a})?([0-9a-f]+)?(::)?(${o})?$`,"i"),deprecatedTransitional:new RegExp(`^(?:::)(${r}\\.${r}\\.${r}\\.${r}(${o})?)$`,"i"),transitional:new RegExp(`^((?:${a})|(?:::)(?:${a})?)${r}\\.${r}\\.${r}\\.${r}(${o})?$`,"i")};function c(e,t){if(e.indexOf("::")!==e.lastIndexOf("::"))return null;let r,n,i=0,s=-1,o=(e.match(u.zoneIndex)||[])[0];for(o&&(o=o.substring(1),e=e.replace(/%.+$/,""));(s=e.indexOf(":",s+1))>=0;)i++;if("::"===e.substr(0,2)&&i--,"::"===e.substr(-2,2)&&i--,i>t)return null;for(n=t-i,r=":";n--;)r+="0:";return":"===(e=e.replace("::",r))[0]&&(e=e.slice(1)),":"===e[e.length-1]&&(e=e.slice(0,-1)),t=function(){const t=e.split(":"),r=[];for(let e=0;e<t.length;e++)r.push(parseInt(t[e],16));return r}(),{parts:t,zoneId:o}}function l(e,t,r,n){if(e.length!==t.length)throw new Error("ipaddr: cannot match CIDR for objects with different lengths");let i,s=0;for(;n>0;){if(i=r-n,i<0&&(i=0),e[s]>>i!=t[s]>>i)return!1;n-=r,s+=1}return!0}function h(e){if(s.test(e))return parseInt(e,16);if("0"===e[0]&&!isNaN(parseInt(e[1],10))){if(i.test(e))return parseInt(e,8);throw new Error(`ipaddr: cannot parse ${e} as octal`)}return parseInt(e,10)}function d(e,t){for(;e.length<t;)e=`0${e}`;return e}const f={};f.IPv4=function(){function e(e){if(4!==e.length)throw new Error("ipaddr: ipv4 octet count should be 4");let t,r;for(t=0;t<e.length;t++)if(r=e[t],!(0<=r&&r<=255))throw new Error("ipaddr: ipv4 octet should fit in 8 bits");this.octets=e}return e.prototype.SpecialRanges={unspecified:[[new e([0,0,0,0]),8]],broadcast:[[new e([255,255,255,255]),32]],multicast:[[new e([224,0,0,0]),4]],linkLocal:[[new e([169,254,0,0]),16]],loopback:[[new e([127,0,0,0]),8]],carrierGradeNat:[[new e([100,64,0,0]),10]],private:[[new e([10,0,0,0]),8],[new e([172,16,0,0]),12],[new e([192,168,0,0]),16]],reserved:[[new e([192,0,0,0]),24],[new e([192,0,2,0]),24],[new e([192,88,99,0]),24],[new e([198,51,100,0]),24],[new e([203,0,113,0]),24],[new e([240,0,0,0]),4]]},e.prototype.kind=function(){return"ipv4"},e.prototype.match=function(e,t){let r;if(void 0===t&&(r=e,e=r[0],t=r[1]),"ipv4"!==e.kind())throw new Error("ipaddr: cannot match ipv4 address with non-ipv4 one");return l(this.octets,e.octets,8,t)},e.prototype.prefixLengthFromSubnetMask=function(){let e=0,t=!1;const r={0:8,128:7,192:6,224:5,240:4,248:3,252:2,254:1,255:0};let n,i,s;for(n=3;n>=0;n-=1){if(i=this.octets[n],!(i in r))return null;if(s=r[i],t&&0!==s)return null;8!==s&&(t=!0),e+=s}return 32-e},e.prototype.range=function(){return f.subnetMatch(this,this.SpecialRanges)},e.prototype.toByteArray=function(){return this.octets.slice(0)},e.prototype.toIPv4MappedAddress=function(){return f.IPv6.parse(`::ffff:${this.toString()}`)},e.prototype.toNormalizedString=function(){return this.toString()},e.prototype.toString=function(){return this.octets.join(".")},e}(),f.IPv4.broadcastAddressFromCIDR=function(e){try{const t=this.parseCIDR(e),r=t[0].toByteArray(),n=this.subnetMaskFromPrefixLength(t[1]).toByteArray(),i=[];let s=0;for(;s<4;)i.push(parseInt(r[s],10)|255^parseInt(n[s],10)),s++;return new this(i)}catch(e){throw new Error("ipaddr: the address does not have IPv4 CIDR format")}},f.IPv4.isIPv4=function(e){return null!==this.parser(e)},f.IPv4.isValid=function(e){try{return new this(this.parser(e)),!0}catch(e){return!1}},f.IPv4.isValidFourPartDecimal=function(e){return!(!f.IPv4.isValid(e)||!e.match(/^(0|[1-9]\d*)(\.(0|[1-9]\d*)){3}$/))},f.IPv4.networkAddressFromCIDR=function(e){let t,r,n,i,s;try{for(t=this.parseCIDR(e),n=t[0].toByteArray(),s=this.subnetMaskFromPrefixLength(t[1]).toByteArray(),i=[],r=0;r<4;)i.push(parseInt(n[r],10)&parseInt(s[r],10)),r++;return new this(i)}catch(e){throw new Error("ipaddr: the address does not have IPv4 CIDR format")}},f.IPv4.parse=function(e){const t=this.parser(e);if(null===t)throw new Error("ipaddr: string is not formatted like an IPv4 Address");return new this(t)},f.IPv4.parseCIDR=function(e){let t;if(t=e.match(/^(.+)\/(\d+)$/)){const e=parseInt(t[2]);if(e>=0&&e<=32){const r=[this.parse(t[1]),e];return Object.defineProperty(r,"toString",{value:function(){return this.join("/")}}),r}}throw new Error("ipaddr: string is not formatted like an IPv4 CIDR range")},f.IPv4.parser=function(e){let t,r,i;if(t=e.match(n.fourOctet))return function(){const e=t.slice(1,6),n=[];for(let t=0;t<e.length;t++)r=e[t],n.push(h(r));return n}();if(t=e.match(n.longValue)){if(i=h(t[1]),i>4294967295||i<0)throw new Error("ipaddr: address outside defined range");return function(){const e=[];let t;for(t=0;t<=24;t+=8)e.push(i>>t&255);return e}().reverse()}return(t=e.match(n.twoOctet))?function(){const e=t.slice(1,4),r=[];if(i=h(e[1]),i>16777215||i<0)throw new Error("ipaddr: address outside defined range");return r.push(h(e[0])),r.push(i>>16&255),r.push(i>>8&255),r.push(255&i),r}():(t=e.match(n.threeOctet))?function(){const e=t.slice(1,5),r=[];if(i=h(e[2]),i>65535||i<0)throw new Error("ipaddr: address outside defined range");return r.push(h(e[0])),r.push(h(e[1])),r.push(i>>8&255),r.push(255&i),r}():null},f.IPv4.subnetMaskFromPrefixLength=function(e){if((e=parseInt(e))<0||e>32)throw new Error("ipaddr: invalid IPv4 prefix length");const t=[0,0,0,0];let r=0;const n=Math.floor(e/8);for(;r<n;)t[r]=255,r++;return n<4&&(t[n]=Math.pow(2,e%8)-1<<8-e%8),new this(t)},f.IPv6=function(){function e(e,t){let r,n;if(16===e.length)for(this.parts=[],r=0;r<=14;r+=2)this.parts.push(e[r]<<8|e[r+1]);else{if(8!==e.length)throw new Error("ipaddr: ipv6 part count should be 8 or 16");this.parts=e}for(r=0;r<this.parts.length;r++)if(n=this.parts[r],!(0<=n&&n<=65535))throw new Error("ipaddr: ipv6 part should fit in 16 bits");t&&(this.zoneId=t)}return e.prototype.SpecialRanges={unspecified:[new e([0,0,0,0,0,0,0,0]),128],linkLocal:[new e([65152,0,0,0,0,0,0,0]),10],multicast:[new e([65280,0,0,0,0,0,0,0]),8],loopback:[new e([0,0,0,0,0,0,0,1]),128],uniqueLocal:[new e([64512,0,0,0,0,0,0,0]),7],ipv4Mapped:[new e([0,0,0,0,0,65535,0,0]),96],rfc6145:[new e([0,0,0,0,65535,0,0,0]),96],rfc6052:[new e([100,65435,0,0,0,0,0,0]),96],"6to4":[new e([8194,0,0,0,0,0,0,0]),16],teredo:[new e([8193,0,0,0,0,0,0,0]),32],reserved:[[new e([8193,3512,0,0,0,0,0,0]),32]]},e.prototype.isIPv4MappedAddress=function(){return"ipv4Mapped"===this.range()},e.prototype.kind=function(){return"ipv6"},e.prototype.match=function(e,t){let r;if(void 0===t&&(r=e,e=r[0],t=r[1]),"ipv6"!==e.kind())throw new Error("ipaddr: cannot match ipv6 address with non-ipv6 one");return l(this.parts,e.parts,16,t)},e.prototype.prefixLengthFromSubnetMask=function(){let e=0,t=!1;const r={0:16,32768:15,49152:14,57344:13,61440:12,63488:11,64512:10,65024:9,65280:8,65408:7,65472:6,65504:5,65520:4,65528:3,65532:2,65534:1,65535:0};let n,i;for(let s=7;s>=0;s-=1){if(n=this.parts[s],!(n in r))return null;if(i=r[n],t&&0!==i)return null;16!==i&&(t=!0),e+=i}return 128-e},e.prototype.range=function(){return f.subnetMatch(this,this.SpecialRanges)},e.prototype.toByteArray=function(){let e;const t=[],r=this.parts;for(let n=0;n<r.length;n++)e=r[n],t.push(e>>8),t.push(255&e);return t},e.prototype.toFixedLengthString=function(){const e=function(){const e=[];for(let t=0;t<this.parts.length;t++)e.push(d(this.parts[t].toString(16),4));return e}.call(this).join(":");let t="";return this.zoneId&&(t=`%${this.zoneId}`),e+t},e.prototype.toIPv4Address=function(){if(!this.isIPv4MappedAddress())throw new Error("ipaddr: trying to convert a generic ipv6 address to ipv4");const e=this.parts.slice(-2),t=e[0],r=e[1];return new f.IPv4([t>>8,255&t,r>>8,255&r])},e.prototype.toNormalizedString=function(){const e=function(){const e=[];for(let t=0;t<this.parts.length;t++)e.push(this.parts[t].toString(16));return e}.call(this).join(":");let t="";return this.zoneId&&(t=`%${this.zoneId}`),e+t},e.prototype.toRFC5952String=function(){const e=/((^|:)(0(:|$)){2,})/g,t=this.toNormalizedString();let r,n=0,i=-1;for(;r=e.exec(t);)r[0].length>i&&(n=r.index,i=r[0].length);return i<0?t:`${t.substring(0,n)}::${t.substring(n+i)}`},e.prototype.toString=function(){return this.toNormalizedString().replace(/((^|:)(0(:|$))+)/,"::")},e}(),f.IPv6.broadcastAddressFromCIDR=function(e){try{const t=this.parseCIDR(e),r=t[0].toByteArray(),n=this.subnetMaskFromPrefixLength(t[1]).toByteArray(),i=[];let s=0;for(;s<16;)i.push(parseInt(r[s],10)|255^parseInt(n[s],10)),s++;return new this(i)}catch(e){throw new Error(`ipaddr: the address does not have IPv6 CIDR format (${e})`)}},f.IPv6.isIPv6=function(e){return null!==this.parser(e)},f.IPv6.isValid=function(e){if("string"==typeof e&&-1===e.indexOf(":"))return!1;try{const t=this.parser(e);return new this(t.parts,t.zoneId),!0}catch(e){return!1}},f.IPv6.networkAddressFromCIDR=function(e){let t,r,n,i,s;try{for(t=this.parseCIDR(e),n=t[0].toByteArray(),s=this.subnetMaskFromPrefixLength(t[1]).toByteArray(),i=[],r=0;r<16;)i.push(parseInt(n[r],10)&parseInt(s[r],10)),r++;return new this(i)}catch(e){throw new Error(`ipaddr: the address does not have IPv6 CIDR format (${e})`)}},f.IPv6.parse=function(e){const t=this.parser(e);if(null===t.parts)throw new Error("ipaddr: string is not formatted like an IPv6 Address");return new this(t.parts,t.zoneId)},f.IPv6.parseCIDR=function(e){let t,r,n;if((r=e.match(/^(.+)\/(\d+)$/))&&(t=parseInt(r[2]),t>=0&&t<=128))return n=[this.parse(r[1]),t],Object.defineProperty(n,"toString",{value:function(){return this.join("/")}}),n;throw new Error("ipaddr: string is not formatted like an IPv6 CIDR range")},f.IPv6.parser=function(e){let t,r,n,i,s,o;if(n=e.match(u.deprecatedTransitional))return this.parser(`::ffff:${n[1]}`);if(u.native.test(e))return c(e,8);if((n=e.match(u.transitional))&&(o=n[6]||"",t=c(n[1].slice(0,-1)+o,6),t.parts)){for(s=[parseInt(n[2]),parseInt(n[3]),parseInt(n[4]),parseInt(n[5])],r=0;r<s.length;r++)if(i=s[r],!(0<=i&&i<=255))return null;return t.parts.push(s[0]<<8|s[1]),t.parts.push(s[2]<<8|s[3]),{parts:t.parts,zoneId:t.zoneId}}return null},f.IPv6.subnetMaskFromPrefixLength=function(e){if((e=parseInt(e))<0||e>128)throw new Error("ipaddr: invalid IPv6 prefix length");const t=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];let r=0;const n=Math.floor(e/8);for(;r<n;)t[r]=255,r++;return n<16&&(t[n]=Math.pow(2,e%8)-1<<8-e%8),new this(t)},f.fromByteArray=function(e){const t=e.length;if(4===t)return new f.IPv4(e);if(16===t)return new f.IPv6(e);throw new Error("ipaddr: the binary input is neither an IPv6 nor IPv4 address")},f.isValid=function(e){return f.IPv6.isValid(e)||f.IPv4.isValid(e)},f.parse=function(e){if(f.IPv6.isValid(e))return f.IPv6.parse(e);if(f.IPv4.isValid(e))return f.IPv4.parse(e);throw new Error("ipaddr: the address has neither IPv6 nor IPv4 format")},f.parseCIDR=function(e){try{return f.IPv6.parseCIDR(e)}catch(t){try{return f.IPv4.parseCIDR(e)}catch(e){throw new Error("ipaddr: the address has neither IPv6 nor IPv4 CIDR format")}}},f.process=function(e){const t=this.parse(e);return"ipv6"===t.kind()&&t.isIPv4MappedAddress()?t.toIPv4Address():t},f.subnetMatch=function(e,t,r){let n,i,s,o;for(i in null==r&&(r="unicast"),t)if(Object.prototype.hasOwnProperty.call(t,i))for(s=t[i],!s[0]||s[0]instanceof Array||(s=[s]),n=0;n<s.length;n++)if(o=s[n],e.kind()===o[0].kind()&&e.match.apply(e,o))return i;return r},e.exports?e.exports=f:t.ipaddr=f}(commonjsGlobal)}(ipaddr);var __importDefault$d=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(lib$1,"__esModule",{value:!0});const netmask_1=netmask,ip_regex_1=__importDefault$d(ipRegex$1),is_ip_1=__importDefault$d(isIp_1),ipaddr_js_1=ipaddr.exports,PRIVATE_IP_RANGES=["0.0.0.0/8","10.0.0.0/8","100.64.0.0/10","127.0.0.0/8","169.254.0.0/16","172.16.0.0/12","192.0.0.0/24","192.0.0.0/29","192.0.0.8/32","192.0.0.9/32","192.0.0.10/32","192.0.0.170/32","192.0.0.171/32","192.0.2.0/24","192.31.196.0/24","192.52.193.0/24","192.88.99.0/24","192.168.0.0/16","192.175.48.0/24","198.18.0.0/15","198.51.100.0/24","203.0.113.0/24","240.0.0.0/4","255.255.255.255/32"],NETMASK_RANGES=PRIVATE_IP_RANGES.map((e=>new netmask_1.Netmask(e)));function ipv4_check(e){for(let t of NETMASK_RANGES)if(t.contains(e))return!0;return!1}function ipv6_check(e){return/^::$/.test(e)||/^::1$/.test(e)||/^::f{4}:([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(e)||/^::f{4}:0.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(e)||/^64:ff9b::([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(e)||/^100::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^2001::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^2001:2[0-9a-fA-F]:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^2001:db8:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^2002:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^f[c-d]([0-9a-fA-F]{2,2}):/i.test(e)||/^fe[8-9a-bA-B][0-9a-fA-F]:/i.test(e)||/^ff([0-9a-fA-F]{2,2}):/i.test(e)}lib$1.default=e=>{if(ipaddr_js_1.isValid(e)){const t=ipaddr_js_1.parse(e);if("ipv4"===t.kind())return ipv4_check(t.toNormalizedString());if("ipv6"===t.kind())return ipv6_check(e)}else if(is_ip_1.default(e)&&ip_regex_1.default.v6().test(e))return ipv6_check(e)};var privateIp=lib$1.default;const isIpPrivate=privateIp;function isPrivate$1(e){const{address:t}=e.nodeAddress();return isIpPrivate(t)}var isPrivate_1=isPrivate$1;const isPrivate=isPrivate_1;function addressesPublicFirstCompareFunction(e,t){const r=isPrivate(e.multiaddr),n=isPrivate(t.multiaddr);return r&&!n?1:!r&&n||e.isCertified&&!t.isCertified?-1:!e.isCertified&&t.isCertified?1:0}function publicAddressesFirst$2(e){return[...e].sort(addressesPublicFirstCompareFunction)}addressSort.publicAddressesFirst=publicAddressesFirst$2;var pReflect$2={exports:{}};const pReflect$1=async e=>{try{return{isFulfilled:!0,isRejected:!1,value:await e}}catch(e){return{isFulfilled:!1,isRejected:!0,reason:e}}};pReflect$2.exports=pReflect$1,pReflect$2.exports.default=pReflect$1;var pLimit$2={exports:{}},pTry$2={exports:{}};const pTry$1=(e,...t)=>new Promise((r=>{r(e(...t))}));pTry$2.exports=pTry$1,pTry$2.exports.default=pTry$1;const pTry=pTry$2.exports,pLimit$1=e=>{if(!Number.isInteger(e)&&e!==1/0||!(e>0))return Promise.reject(new TypeError("Expected `concurrency` to be a number from 1 and up"));const t=[];let r=0;const n=()=>{r--,t.length>0&&t.shift()()},i=(e,t,...i)=>{r++;const s=pTry(e,...i);t(s),s.then(n,n)},s=(n,...s)=>new Promise((o=>((n,s,...o)=>{r<e?i(n,s,...o):t.push(i.bind(null,n,s,...o))})(n,o,...s)));return Object.defineProperties(s,{activeCount:{get:()=>r},pendingCount:{get:()=>t.length},clearQueue:{value:()=>{t.length=0}}}),s};pLimit$2.exports=pLimit$1,pLimit$2.exports.default=pLimit$1;const pReflect=pReflect$2.exports,pLimit=pLimit$2.exports;var pSettle$1=async(e,t={})=>{const{concurrency:r=1/0}=t,n=pLimit(r);return Promise.all(e.map((e=>e&&"function"==typeof e.then?pReflect(e):pReflect("function"==typeof e?n((()=>e())):Promise.resolve(e)))))},utils$u={},$protobuf$f=minimal,$Reader$f=$protobuf$f.Reader,$Writer$f=$protobuf$f.Writer,$util$f=$protobuf$f.util,$root$f=$protobuf$f.roots["libp2p-envelope"]||($protobuf$f.roots["libp2p-envelope"]={});$root$f.Envelope=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.publicKey=$util$f.newBuffer([]),e.prototype.payloadType=$util$f.newBuffer([]),e.prototype.payload=$util$f.newBuffer([]),e.prototype.signature=$util$f.newBuffer([]),e.encode=function(e,t){return t||(t=$Writer$f.create()),null!=e.publicKey&&Object.hasOwnProperty.call(e,"publicKey")&&t.uint32(10).bytes(e.publicKey),null!=e.payloadType&&Object.hasOwnProperty.call(e,"payloadType")&&t.uint32(18).bytes(e.payloadType),null!=e.payload&&Object.hasOwnProperty.call(e,"payload")&&t.uint32(26).bytes(e.payload),null!=e.signature&&Object.hasOwnProperty.call(e,"signature")&&t.uint32(42).bytes(e.signature),t},e.decode=function(e,t){e instanceof $Reader$f||(e=$Reader$f.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root$f.Envelope;e.pos<r;){var i=e.uint32();switch(i>>>3){case 1:n.publicKey=e.bytes();break;case 2:n.payloadType=e.bytes();break;case 3:n.payload=e.bytes();break;case 5:n.signature=e.bytes();break;default:e.skipType(7&i)}}return n},e.fromObject=function(e){if(e instanceof $root$f.Envelope)return e;var t=new $root$f.Envelope;return null!=e.publicKey&&("string"==typeof e.publicKey?$util$f.base64.decode(e.publicKey,t.publicKey=$util$f.newBuffer($util$f.base64.length(e.publicKey)),0):e.publicKey.length&&(t.publicKey=e.publicKey)),null!=e.payloadType&&("string"==typeof e.payloadType?$util$f.base64.decode(e.payloadType,t.payloadType=$util$f.newBuffer($util$f.base64.length(e.payloadType)),0):e.payloadType.length&&(t.payloadType=e.payloadType)),null!=e.payload&&("string"==typeof e.payload?$util$f.base64.decode(e.payload,t.payload=$util$f.newBuffer($util$f.base64.length(e.payload)),0):e.payload.length&&(t.payload=e.payload)),null!=e.signature&&("string"==typeof e.signature?$util$f.base64.decode(e.signature,t.signature=$util$f.newBuffer($util$f.base64.length(e.signature)),0):e.signature.length&&(t.signature=e.signature)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(t.bytes===String?r.publicKey="":(r.publicKey=[],t.bytes!==Array&&(r.publicKey=$util$f.newBuffer(r.publicKey))),t.bytes===String?r.payloadType="":(r.payloadType=[],t.bytes!==Array&&(r.payloadType=$util$f.newBuffer(r.payloadType))),t.bytes===String?r.payload="":(r.payload=[],t.bytes!==Array&&(r.payload=$util$f.newBuffer(r.payload))),t.bytes===String?r.signature="":(r.signature=[],t.bytes!==Array&&(r.signature=$util$f.newBuffer(r.signature)))),null!=e.publicKey&&e.hasOwnProperty("publicKey")&&(r.publicKey=t.bytes===String?$util$f.base64.encode(e.publicKey,0,e.publicKey.length):t.bytes===Array?Array.prototype.slice.call(e.publicKey):e.publicKey),null!=e.payloadType&&e.hasOwnProperty("payloadType")&&(r.payloadType=t.bytes===String?$util$f.base64.encode(e.payloadType,0,e.payloadType.length):t.bytes===Array?Array.prototype.slice.call(e.payloadType):e.payloadType),null!=e.payload&&e.hasOwnProperty("payload")&&(r.payload=t.bytes===String?$util$f.base64.encode(e.payload,0,e.payload.length):t.bytes===Array?Array.prototype.slice.call(e.payload):e.payload),null!=e.signature&&e.hasOwnProperty("signature")&&(r.signature=t.bytes===String?$util$f.base64.encode(e.signature,0,e.signature.length):t.bytes===Array?Array.prototype.slice.call(e.signature):e.signature),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf$f.util.toJSONOptions)},e}();var envelope$1=$root$f;const errCode$f=errCode$m,{concat:uint8arraysConcat}=require$$2$2,{fromString:uint8arraysFromString}=require$$3$1,cryptoKeys=keys$d,PeerId$k=src$q.exports,varint$2=varint$6,{equals:uint8arraysEquals}=require$$10$1,{codes:codes$8}=errors$4,{Envelope:Protobuf$1}=envelope$1;class Envelope$3{constructor({peerId:e,payloadType:t,payload:r,signature:n}){this.peerId=e,this.payloadType=t,this.payload=r,this.signature=n,this._marshal=void 0}marshal(){if(this._marshal)return this._marshal;const e=cryptoKeys.marshalPublicKey(this.peerId.pubKey);return this._marshal=Protobuf$1.encode({publicKey:e,payloadType:this.payloadType,payload:this.payload,signature:this.signature}).finish(),this._marshal}equals(e){return uint8arraysEquals(this.peerId.pubKey.bytes,e.peerId.pubKey.bytes)&&uint8arraysEquals(this.payloadType,e.payloadType)&&uint8arraysEquals(this.payload,e.payload)&&uint8arraysEquals(this.signature,e.signature)}validate(e){const t=formatSignaturePayload(e,this.payloadType,this.payload);return this.peerId.pubKey.verify(t,this.signature)}}const formatSignaturePayload=(e,t,r)=>{const n=uint8arraysFromString(e),i=varint$2.encode(n.byteLength),s=varint$2.encode(t.length),o=varint$2.encode(r.length);return uint8arraysConcat([new Uint8Array(i),n,new Uint8Array(s),t,new Uint8Array(o),r])};Envelope$3.createFromProtobuf=async e=>{const t=Protobuf$1.decode(e),r=await PeerId$k.createFromPubKey(t.publicKey);return new Envelope$3({peerId:r,payloadType:t.payloadType,payload:t.payload,signature:t.signature})},Envelope$3.seal=async(e,t)=>{const r=e.domain,n=e.codec,i=e.marshal(),s=formatSignaturePayload(r,n,i),o=await t.privKey.sign(s);return new Envelope$3({peerId:t,payloadType:n,payload:i,signature:o})},Envelope$3.openAndCertify=async(e,t)=>{const r=await Envelope$3.createFromProtobuf(e);if(!await r.validate(t))throw errCode$f(new Error("envelope signature is not valid for the given domain"),codes$8.ERR_SIGNATURE_NOT_VALID);return r};var envelope=Envelope$3;function arrayEquals$1(e,t){return e.length===t.length&&t.sort()&&e.sort().every(((e,r)=>t[r].equals(e)))}var arrayEquals_1=arrayEquals$1,$protobuf$e=minimal,$Reader$e=$protobuf$e.Reader,$Writer$e=$protobuf$e.Writer,$util$e=$protobuf$e.util,$root$e=$protobuf$e.roots["libp2p-peer-record"]||($protobuf$e.roots["libp2p-peer-record"]={});$root$e.PeerRecord=function(){function e(e){if(this.addresses=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.peerId=$util$e.newBuffer([]),e.prototype.seq=$util$e.Long?$util$e.Long.fromBits(0,0,!0):0,e.prototype.addresses=$util$e.emptyArray,e.encode=function(e,t){if(t||(t=$Writer$e.create()),null!=e.peerId&&Object.hasOwnProperty.call(e,"peerId")&&t.uint32(10).bytes(e.peerId),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(16).uint64(e.seq),null!=e.addresses&&e.addresses.length)for(var r=0;r<e.addresses.length;++r)$root$e.PeerRecord.AddressInfo.encode(e.addresses[r],t.uint32(26).fork()).ldelim();return t},e.decode=function(e,t){e instanceof $Reader$e||(e=$Reader$e.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root$e.PeerRecord;e.pos<r;){var i=e.uint32();switch(i>>>3){case 1:n.peerId=e.bytes();break;case 2:n.seq=e.uint64();break;case 3:n.addresses&&n.addresses.length||(n.addresses=[]),n.addresses.push($root$e.PeerRecord.AddressInfo.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return n},e.fromObject=function(e){if(e instanceof $root$e.PeerRecord)return e;var t=new $root$e.PeerRecord;if(null!=e.peerId&&("string"==typeof e.peerId?$util$e.base64.decode(e.peerId,t.peerId=$util$e.newBuffer($util$e.base64.length(e.peerId)),0):e.peerId.length&&(t.peerId=e.peerId)),null!=e.seq&&($util$e.Long?(t.seq=$util$e.Long.fromValue(e.seq)).unsigned=!0:"string"==typeof e.seq?t.seq=parseInt(e.seq,10):"number"==typeof e.seq?t.seq=e.seq:"object"==typeof e.seq&&(t.seq=new $util$e.LongBits(e.seq.low>>>0,e.seq.high>>>0).toNumber(!0))),e.addresses){if(!Array.isArray(e.addresses))throw TypeError(".PeerRecord.addresses: array expected");t.addresses=[];for(var r=0;r<e.addresses.length;++r){if("object"!=typeof e.addresses[r])throw TypeError(".PeerRecord.addresses: object expected");t.addresses[r]=$root$e.PeerRecord.AddressInfo.fromObject(e.addresses[r])}}return t},e.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.addresses=[]),t.defaults)if(t.bytes===String?r.peerId="":(r.peerId=[],t.bytes!==Array&&(r.peerId=$util$e.newBuffer(r.peerId))),$util$e.Long){var n=new $util$e.Long(0,0,!0);r.seq=t.longs===String?n.toString():t.longs===Number?n.toNumber():n}else r.seq=t.longs===String?"0":0;if(null!=e.peerId&&e.hasOwnProperty("peerId")&&(r.peerId=t.bytes===String?$util$e.base64.encode(e.peerId,0,e.peerId.length):t.bytes===Array?Array.prototype.slice.call(e.peerId):e.peerId),null!=e.seq&&e.hasOwnProperty("seq")&&("number"==typeof e.seq?r.seq=t.longs===String?String(e.seq):e.seq:r.seq=t.longs===String?$util$e.Long.prototype.toString.call(e.seq):t.longs===Number?new $util$e.LongBits(e.seq.low>>>0,e.seq.high>>>0).toNumber(!0):e.seq),e.addresses&&e.addresses.length){r.addresses=[];for(var i=0;i<e.addresses.length;++i)r.addresses[i]=$root$e.PeerRecord.AddressInfo.toObject(e.addresses[i],t)}return r},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf$e.util.toJSONOptions)},e.AddressInfo=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.multiaddr=$util$e.newBuffer([]),e.encode=function(e,t){return t||(t=$Writer$e.create()),null!=e.multiaddr&&Object.hasOwnProperty.call(e,"multiaddr")&&t.uint32(10).bytes(e.multiaddr),t},e.decode=function(e,t){e instanceof $Reader$e||(e=$Reader$e.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root$e.PeerRecord.AddressInfo;e.pos<r;){var i=e.uint32();if(i>>>3==1)n.multiaddr=e.bytes();else e.skipType(7&i)}return n},e.fromObject=function(e){if(e instanceof $root$e.PeerRecord.AddressInfo)return e;var t=new $root$e.PeerRecord.AddressInfo;return null!=e.multiaddr&&("string"==typeof e.multiaddr?$util$e.base64.decode(e.multiaddr,t.multiaddr=$util$e.newBuffer($util$e.base64.length(e.multiaddr)),0):e.multiaddr.length&&(t.multiaddr=e.multiaddr)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(t.bytes===String?r.multiaddr="":(r.multiaddr=[],t.bytes!==Array&&(r.multiaddr=$util$e.newBuffer(r.multiaddr)))),null!=e.multiaddr&&e.hasOwnProperty("multiaddr")&&(r.multiaddr=t.bytes===String?$util$e.base64.encode(e.multiaddr,0,e.multiaddr.length):t.bytes===Array?Array.prototype.slice.call(e.multiaddr):e.multiaddr),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf$e.util.toJSONOptions)},e}(),e}();var peerRecord$1=$root$e;const domain="libp2p-peer-record",payloadType=Uint8Array.from([3,1]);var consts$1={ENVELOPE_DOMAIN_PEER_RECORD:domain,ENVELOPE_PAYLOAD_TYPE_PEER_RECORD:payloadType};const{Multiaddr:Multiaddr$h}=src$o,PeerId$j=src$q.exports,arrayEquals=arrayEquals_1,{PeerRecord:Protobuf}=peerRecord$1,{ENVELOPE_DOMAIN_PEER_RECORD:ENVELOPE_DOMAIN_PEER_RECORD,ENVELOPE_PAYLOAD_TYPE_PEER_RECORD:ENVELOPE_PAYLOAD_TYPE_PEER_RECORD}=consts$1;class PeerRecord$3{constructor({peerId:e,multiaddrs:t=[],seqNumber:r=Date.now()}){this.domain=ENVELOPE_DOMAIN_PEER_RECORD,this.codec=ENVELOPE_PAYLOAD_TYPE_PEER_RECORD,this.peerId=e,this.multiaddrs=t,this.seqNumber=r,this._marshal=void 0}marshal(){return this._marshal||(this._marshal=Protobuf.encode({peerId:this.peerId.toBytes(),seq:this.seqNumber,addresses:this.multiaddrs.map((e=>({multiaddr:e.bytes})))}).finish()),this._marshal}equals(e){return e instanceof PeerRecord$3&&(!!this.peerId.equals(e.peerId)&&(this.seqNumber===e.seqNumber&&!!arrayEquals(this.multiaddrs,e.multiaddrs)))}}PeerRecord$3.createFromProtobuf=e=>{const t=Protobuf.decode(e),r=PeerId$j.createFromBytes(t.peerId),n=(t.addresses||[]).map((e=>new Multiaddr$h(e.multiaddr))),i=Number(t.seq);return new PeerRecord$3({peerId:r,multiaddrs:n,seqNumber:i})},PeerRecord$3.DOMAIN=ENVELOPE_DOMAIN_PEER_RECORD;var peerRecord=PeerRecord$3;const Envelope$2=envelope,PeerRecord$2=peerRecord;async function updateSelfPeerRecord$2(e){const t=new PeerRecord$2({peerId:e.peerId,multiaddrs:e.multiaddrs}),r=await Envelope$2.seal(t,e.peerId);e.peerStore.addressBook.consumePeerRecord(r)}utils$u.updateSelfPeerRecord=updateSelfPeerRecord$2;const debug$G=require$$0$b,log$z=Object.assign(debug$G("libp2p:transports"),{error:debug$G("libp2p:transports:err")}),pSettle=pSettle$1,{codes:codes$7}=errors$4,errCode$e=errCode$m,{updateSelfPeerRecord:updateSelfPeerRecord$1}=utils$u;class TransportManager$1{constructor({libp2p:e,upgrader:t,faultTolerance:r=FAULT_TOLERANCE.FATAL_ALL}){this.libp2p=e,this.upgrader=t,this._transports=new Map,this._listeners=new Map,this._listenerOptions=new Map,this.faultTolerance=r}add(e,t,r={}){if(log$z("adding %s",e),!e)throw errCode$e(new Error(`Transport must have a valid key, was given '${e}'`),codes$7.ERR_INVALID_KEY);if(this._transports.has(e))throw errCode$e(new Error("There is already a transport with this key"),codes$7.ERR_DUPLICATE_TRANSPORT);const n=new t({...r,libp2p:this.libp2p,upgrader:this.upgrader});this._transports.set(e,n),this._listenerOptions.set(e,r.listenerOptions||{}),this._listeners.has(e)||this._listeners.set(e,[])}async close(){const e=[];for(const[t,r]of this._listeners)for(log$z("closing listeners for %s",t);r.length;){const t=r.pop();t.removeAllListeners("listening"),t.removeAllListeners("close"),e.push(t.close())}await Promise.all(e),log$z("all listeners closed");for(const e of this._listeners.keys())this._listeners.set(e,[])}async dial(e,t){const r=this.transportForMultiaddr(e);if(!r)throw errCode$e(new Error(`No transport available for address ${String(e)}`),codes$7.ERR_TRANSPORT_UNAVAILABLE);try{return await r.dial(e,t)}catch(e){throw e.code||(e.code=codes$7.ERR_TRANSPORT_DIAL_FAILED),e}}getAddrs(){let e=[];for(const t of this._listeners.values())for(const r of t)e=[...e,...r.getAddrs()];return e}getTransports(){return this._transports.values()}transportForMultiaddr(e){for(const t of this._transports.values()){if(t.filter([e]).length)return t}return null}async listen(e){if(!e||0===e.length)return void log$z("no addresses were provided for listening, this node is dial only");const t=[];for(const[r,n]of this._transports.entries()){const i=n.filter(e),s=[];for(const e of i){log$z("creating listener for %s on %s",r,e);const t=n.createListener(this._listenerOptions.get(r));this._listeners.get(r).push(t),t.on("listening",(()=>updateSelfPeerRecord$1(this.libp2p))),t.on("close",(()=>updateSelfPeerRecord$1(this.libp2p))),s.push(t.listen(e))}if(0===s.length){t.push(r);continue}const o=(await pSettle(s)).find((e=>!0===e.isFulfilled));if(!o&&this.faultTolerance!==FAULT_TOLERANCE.NO_FATAL)throw errCode$e(new Error(`Transport (${r}) could not listen on any available address`),codes$7.ERR_NO_VALID_ADDRESSES)}if(t.length===this._transports.size){const e=`no valid addresses were provided for transports [${t}]`;if(this.faultTolerance===FAULT_TOLERANCE.FATAL_ALL)throw errCode$e(new Error(e),codes$7.ERR_NO_VALID_ADDRESSES);log$z(`libp2p in dial mode only: ${e}`)}}async remove(e){if(log$z("removing %s",e),this._listeners.has(e))for(const t of this._listeners.get(e))t.removeAllListeners("listening"),t.removeAllListeners("close"),await t.close();this._transports.delete(e),this._listeners.delete(e)}async removeAll(){const e=[];for(const t of this._transports.keys())e.push(this.remove(t));await Promise.all(e)}}const FAULT_TOLERANCE={FATAL_ALL:0,NO_FATAL:1};TransportManager$1.FaultTolerance=FAULT_TOLERANCE;var transportManager=TransportManager$1;const mergeOptions$4=mergeOptions$5,{dnsaddrResolver:dnsaddrResolver}=resolvers,Constants=constants$9,{AGENT_VERSION:AGENT_VERSION}=consts$2,RelayConstants=constants$8,{publicAddressesFirst:publicAddressesFirst$1}=addressSort,{FaultTolerance:FaultTolerance}=transportManager,DefaultConfig={addresses:{listen:[],announce:[],noAnnounce:[],announceFilter:e=>e},connectionManager:{minConnections:25},transportManager:{faultTolerance:FaultTolerance.FATAL_ALL},dialer:{maxParallelDials:Constants.MAX_PARALLEL_DIALS,maxDialsPerPeer:Constants.MAX_PER_PEER_DIALS,dialTimeout:Constants.DIAL_TIMEOUT,resolvers:{dnsaddr:dnsaddrResolver},addressSorter:publicAddressesFirst$1},host:{agentVersion:AGENT_VERSION},metrics:{enabled:!1},peerStore:{persistence:!1,threshold:5},peerRouting:{refreshManager:{enabled:!0,interval:6e5,bootDelay:1e4}},config:{protocolPrefix:"ipfs",dht:{enabled:!1,kBucketSize:20,randomWalk:{enabled:!1,queriesPerPeriod:1,interval:3e5,timeout:1e4}},nat:{enabled:!0,ttl:7200,keepAlive:!0,gateway:null,externalIp:null,pmp:{enabled:!1}},peerDiscovery:{autoDial:!0},pubsub:{enabled:!0},relay:{enabled:!0,advertise:{bootDelay:RelayConstants.ADVERTISE_BOOT_DELAY,enabled:!1,ttl:RelayConstants.ADVERTISE_TTL},hop:{enabled:!1,active:!1},autoRelay:{enabled:!1,maxListeners:2}},transport:{}}};config$2.validate=e=>{const t=mergeOptions$4(DefaultConfig,e);if(t.modules.transport.length<1)throw new Error("'options.modules.transport' must contain at least 1 transport");return t};const{EventEmitter:EventEmitter$c}=require$$1$9,{Multiaddr:Multiaddr$g}=src$o,PeerId$i=src$q.exports;class AddressManager$1 extends EventEmitter$c{constructor(e,{listen:t=[],announce:r=[]}={}){super(),this.peerId=e,this.listen=new Set(t.map((e=>e.toString()))),this.announce=new Set(r.map((e=>e.toString()))),this.observed=new Set}getListenAddrs(){return Array.from(this.listen).map((e=>new Multiaddr$g(e)))}getAnnounceAddrs(){return Array.from(this.announce).map((e=>new Multiaddr$g(e)))}getObservedAddrs(){return Array.from(this.observed).map((e=>new Multiaddr$g(e)))}addObservedAddr(e){let t=new Multiaddr$g(e);const r=t.getPeerId();if(r){PeerId$i.createFromB58String(r).equals(this.peerId)&&(t=t.decapsulate(new Multiaddr$g(`/p2p/${this.peerId}`)))}const n=t.toString();this.observed.has(n)||(this.observed.add(n),this.emit("change:addresses"))}}var addressManager=AddressManager$1;const{EventEmitter:EventEmitter$b}=require$$1$9,debug$F=require$$0$b("latency-monitor:VisibilityChangeEmitter");class VisibilityChangeEmitter$1 extends EventEmitter$b{constructor(){super(),"undefined"!=typeof document?(this._initializeVisibilityVarNames(),this._addVisibilityChangeListener()):debug$F('This is not a browser, no "document" found. Stopping.')}_initializeVisibilityVarNames(){let e,t;void 0!==document.hidden?(e="hidden",t="visibilitychange"):void 0!==document.mozHidden?(e="mozHidden",t="mozvisibilitychange"):void 0!==document.msHidden?(e="msHidden",t="msvisibilitychange"):void 0!==document.webkitHidden&&(e="webkitHidden",t="webkitvisibilitychange"),this._hidden=e,this._visibilityChange=t}_addVisibilityChangeListener(){void 0===document.addEventListener||void 0===document[this._hidden]?debug$F("Checking page visibility requires a browser that supports the Page Visibility API."):document.addEventListener(this._visibilityChange,this._handleVisibilityChange.bind(this),!1)}isVisible(){if(void 0!==this._hidden&&void 0!==document[this._hidden])return!document[this._hidden]}_handleVisibilityChange(){const e=!document[this._hidden];debug$F(e?"Page Visible":"Page Hidden"),this.emit("visibilityChange",e)}}var visibilityChangeEmitter=VisibilityChangeEmitter$1;const{EventEmitter:EventEmitter$a}=require$$1$9,VisibilityChangeEmitter=visibilityChangeEmitter,debug$E=require$$0$b("latency-monitor:LatencyMonitor");class LatencyMonitor$1 extends EventEmitter$a{constructor({latencyCheckIntervalMs:e,dataEmitIntervalMs:t,asyncTestFn:r,latencyRandomPercentage:n}={}){super();const i=this;i.latencyCheckIntervalMs=e||500,i.latencyRandomPercentage=n||10,i._latecyCheckMultiply=i.latencyRandomPercentage/100*2*i.latencyCheckIntervalMs,i._latecyCheckSubtract=i._latecyCheckMultiply/2,i.dataEmitIntervalMs=null===t||0===t?void 0:t||5e3,debug$E("latencyCheckIntervalMs: %s dataEmitIntervalMs: %s",i.latencyCheckIntervalMs,i.dataEmitIntervalMs),i.dataEmitIntervalMs?debug$E("Expecting ~%s events per summary",i.latencyCheckIntervalMs/i.dataEmitIntervalMs):debug$E("Not emitting summaries"),i.asyncTestFn=r}start(){globalThis.process&&globalThis.process.hrtime?(debug$E("Using process.hrtime for timing"),this.now=globalThis.process.hrtime,this.getDeltaMS=e=>{const t=this.now(e);return 1e3*t[0]+t[1]/1e6}):"undefined"!=typeof window&&window.performance&&window.performance.now?(debug$E("Using performance.now for timing"),this.now=window.performance.now.bind(window.performance),this.getDeltaMS=e=>Math.round(this.now()-e)):(debug$E("Using Date.now for timing"),this.now=Date.now,this.getDeltaMS=e=>this.now()-e),this._latencyData=this._initLatencyData(),isBrowser$1()&&(this._visibilityChangeEmitter=new VisibilityChangeEmitter,this._visibilityChangeEmitter.on("visibilityChange",(e=>{e?this._startTimers():(this._emitSummary(),this._stopTimers())}))),this._visibilityChangeEmitter&&!this._visibilityChangeEmitter.isVisible()||this._startTimers()}stop(){this._stopTimers()}_startTimers(){this._checkLatencyID||(this._checkLatency(),this.dataEmitIntervalMs&&(this._emitIntervalID=setInterval((()=>this._emitSummary()),this.dataEmitIntervalMs),"function"==typeof this._emitIntervalID.unref&&this._emitIntervalID.unref()))}_stopTimers(){this._checkLatencyID&&(clearTimeout(this._checkLatencyID),this._checkLatencyID=void 0),this._emitIntervalID&&(clearInterval(this._emitIntervalID),this._emitIntervalID=void 0)}_emitSummary(){const e=this.getSummary();e.events>0&&this.emit("data",e)}getSummary(){const e={events:this._latencyData.events,minMs:this._latencyData.minMs,maxMs:this._latencyData.maxMs,avgMs:this._latencyData.events?this._latencyData.totalMs/this._latencyData.events:Number.POSITIVE_INFINITY,lengthMs:this.getDeltaMS(this._latencyData.startTime)};return this._latencyData=this._initLatencyData(),debug$E("Summary: %O",e),e}_checkLatency(){const e=this,t=Math.random()*e._latecyCheckMultiply-e._latecyCheckSubtract,r={deltaOffset:Math.ceil(e.latencyCheckIntervalMs+t),startTime:e.now()},n=()=>{if(!this._checkLatencyID)return;const t=e.getDeltaMS(r.startTime)-r.deltaOffset;e._checkLatency(),e._latencyData.events++,e._latencyData.minMs=Math.min(e._latencyData.minMs,t),e._latencyData.maxMs=Math.max(e._latencyData.maxMs,t),e._latencyData.totalMs+=t,debug$E("MS: %s Data: %O",t,e._latencyData)};debug$E("localData: %O",r),this._checkLatencyID=setTimeout((()=>{e.asyncTestFn?(r.deltaOffset=0,r.startTime=e.now(),e.asyncTestFn(n)):(r.deltaOffset-=1,n())}),r.deltaOffset),"function"==typeof this._checkLatencyID.unref&&this._checkLatencyID.unref()}_initLatencyData(){return{startTime:this.now(),minMs:Number.POSITIVE_INFINITY,maxMs:Number.NEGATIVE_INFINITY,events:0,totalMs:0}}}function isBrowser$1(){return"undefined"!=typeof window}var latencyMonitor=LatencyMonitor$1;const debug$D=require$$0$b,log$y=Object.assign(debug$D("libp2p:connection-manager"),{error:debug$D("libp2p:connection-manager:err")}),errcode$Y=errCode$m,mergeOptions$3=mergeOptions$5,LatencyMonitor=latencyMonitor,retimer$2=retimer_1,{EventEmitter:EventEmitter$9}=require$$1$9,PeerId$h=src$q.exports,{codes:{ERR_INVALID_PARAMETERS:ERR_INVALID_PARAMETERS$8}}=errors$4,defaultOptions$3={maxConnections:1/0,minConnections:0,maxData:1/0,maxSentData:1/0,maxReceivedData:1/0,maxEventLoopDelay:1/0,pollInterval:2e3,autoDialInterval:1e4,movingAverageInterval:6e4,defaultPeerValue:1};class ConnectionManager$1 extends EventEmitter$9{constructor(e,t={}){if(super(),this._libp2p=e,this._peerId=e.peerId.toB58String(),this._options=mergeOptions$3.call({ignoreUndefined:!0},defaultOptions$3,t),this._options.maxConnections<this._options.minConnections)throw errcode$Y(new Error("Connection Manager maxConnections must be greater than minConnections"),ERR_INVALID_PARAMETERS$8);log$y("options: %j",this._options),this._peerValues=new Map,this.connections=new Map,this._started=!1,this._timer=null,this._checkMetrics=this._checkMetrics.bind(this),this._latencyMonitor=new LatencyMonitor({latencyCheckIntervalMs:this._options.pollInterval,dataEmitIntervalMs:this._options.pollInterval})}get size(){return Array.from(this.connections.values()).reduce(((e,t)=>e+t.length),0)}start(){this._libp2p.metrics&&(this._timer=this._timer||retimer$2(this._checkMetrics,this._options.pollInterval)),this._latencyMonitor.start(),this._onLatencyMeasure=this._onLatencyMeasure.bind(this),this._latencyMonitor.on("data",this._onLatencyMeasure),this._started=!0,log$y("started")}async stop(){this._timer&&this._timer.clear(),this._latencyMonitor.removeListener("data",this._onLatencyMeasure),this._latencyMonitor.stop(),this._started=!1,await this._close(),log$y("stopped")}async _close(){const e=[];for(const t of this.connections.values())for(const r of t)e.push(r.close());await Promise.all(e),this.connections.clear()}setPeerValue(e,t){if(t<0||t>1)throw new Error("value should be a number between 0 and 1");this._peerValues.set(e.toB58String(),t)}_checkMetrics(){if(this._libp2p.metrics){const e=this._libp2p.metrics.global.movingAverages,t=e.dataReceived[this._options.movingAverageInterval].movingAverage();this._checkMaxLimit("maxReceivedData",t);const r=e.dataSent[this._options.movingAverageInterval].movingAverage();this._checkMaxLimit("maxSentData",r);const n=t+r;this._checkMaxLimit("maxData",n),log$y("metrics update",n),this._timer=retimer$2(this._checkMetrics,this._options.pollInterval)}}onConnect(e){const t=e.remotePeer,r=t.toB58String(),n=this.connections.get(r);this.emit("peer:connect",e),n?n.push(e):this.connections.set(r,[e]),this._libp2p.peerStore.keyBook.set(t,t.pubKey),this._peerValues.has(r)||this._peerValues.set(r,this._options.defaultPeerValue),this._checkMaxLimit("maxConnections",this.size)}onDisconnect(e){const t=e.remotePeer.toB58String();let r=this.connections.get(t);r&&r.length>1?(r=r.filter((t=>t.id!==e.id)),this.connections.set(t,r)):r&&(this.connections.delete(t),this._peerValues.delete(e.remotePeer.toB58String()),this.emit("peer:disconnect",e))}get(e){const t=this.getAll(e);return t.length?t[0]:null}getAll(e){if(!PeerId$h.isPeerId(e))throw errcode$Y(new Error("peerId must be an instance of peer-id"),ERR_INVALID_PARAMETERS$8);const t=e.toB58String(),r=this.connections.get(t);return r?r.filter((e=>"open"===e.stat.status)):[]}_onLatencyMeasure(e){this._checkMaxLimit("maxEventLoopDelay",e.avgMs)}_checkMaxLimit(e,t){const r=this._options[e];log$y("checking limit of %s. current value: %d of %d",e,t,r),t>r&&(log$y("%s: limit exceeded: %s, %d",this._peerId,e,t),this._maybeDisconnectOne())}_maybeDisconnectOne(){if(this._options.minConnections<this.connections.size){const e=Array.from(new Map([...this._peerValues.entries()].sort(((e,t)=>e[1]-t[1]))));log$y("%s: sorted peer values: %j",this._peerId,e);const t=e[0];if(t){const e=t[0];log$y("%s: lowest value peer is %s",this._peerId,e),log$y("%s: closing a connection to %j",this._peerId,e);for(const t of this.connections.values())if(t[0].remotePeer.toB58String()===e){t[0].close();break}}}}}var connectionManager=ConnectionManager$1;const debug$C=require$$0$b,mergeOptions$2=mergeOptions$5,retimer$1=retimer_1,log$x=Object.assign(debug$C("libp2p:connection-manager:auto-dialler"),{error:debug$C("libp2p:connection-manager:auto-dialler:err")}),defaultOptions$2={enabled:!0,minConnections:0,autoDialInterval:1e4};class AutoDialler$1{constructor(e,t={}){this._options=mergeOptions$2.call({ignoreUndefined:!0},defaultOptions$2,t),this._libp2p=e,this._running=!1,this._autoDialTimeout=null,this._autoDial=this._autoDial.bind(this),log$x("options: %j",this._options)}start(){this._options.enabled?(this._running=!0,this._autoDial(),log$x("started")):log$x("not enabled")}async stop(){this._options.enabled?(this._running=!1,this._autoDialTimeout&&this._autoDialTimeout.clear(),log$x("stopped")):log$x("not enabled")}async _autoDial(){const e=this._options.minConnections;if(this._libp2p.connections.size>=e)return void(this._autoDialTimeout=retimer$1(this._autoDial,this._options.autoDialInterval));const t=Array.from(this._libp2p.peerStore.peers.values()).sort(((e,t)=>!t.protocols||!t.protocols.length||e.protocols&&e.protocols.length?t.id.pubKey&&!e.id.pubKey?1:-1:1));for(let r=0;this._running&&r<t.length&&this._libp2p.connections.size<e;r++)if(!this._libp2p.connectionManager.get(t[r].id)){log$x("connecting to a peerStore stored peer %s",t[r].id.toB58String());try{await this._libp2p.dialer.connectToPeer(t[r].id)}catch(e){log$x.error("could not connect to peerStore stored peer",e)}}this._running&&(this._autoDialTimeout=retimer$1(this._autoDial,this._options.autoDialInterval))}}var autoDialler=AutoDialler$1;const{Multiaddr:Multiaddr$f}=src$o,DNS4=base$1("dns4"),DNS6=base$1("dns6"),DNSADDR=base$1("dnsaddr"),DNS=or(base$1("dns"),DNSADDR,DNS4,DNS6),IP=or(base$1("ip4"),base$1("ip6")),TCP=or(and(IP,base$1("tcp")),and(DNS,base$1("tcp"))),UDP=and(IP,base$1("udp")),UTP=and(UDP,base$1("utp")),QUIC=and(UDP,base$1("quic")),WebSockets$1=or(and(TCP,base$1("ws")),and(DNS,base$1("ws"))),WebSocketsSecure=or(and(TCP,base$1("wss")),and(DNS,base$1("wss"))),HTTP=or(and(TCP,base$1("http")),and(IP,base$1("http")),and(DNS,base$1("http"))),HTTPS=or(and(TCP,base$1("https")),and(IP,base$1("https")),and(DNS,base$1("https"))),WebRTCStar$1=or(and(WebSockets$1,base$1("p2p-webrtc-star"),base$1("p2p")),and(WebSocketsSecure,base$1("p2p-webrtc-star"),base$1("p2p")),and(WebSockets$1,base$1("p2p-webrtc-star")),and(WebSocketsSecure,base$1("p2p-webrtc-star"))),WebSocketStar=or(and(WebSockets$1,base$1("p2p-websocket-star"),base$1("p2p")),and(WebSocketsSecure,base$1("p2p-websocket-star"),base$1("p2p")),and(WebSockets$1,base$1("p2p-websocket-star")),and(WebSocketsSecure,base$1("p2p-websocket-star"))),WebRTCDirect=or(and(HTTP,base$1("p2p-webrtc-direct"),base$1("p2p")),and(HTTPS,base$1("p2p-webrtc-direct"),base$1("p2p")),and(HTTP,base$1("p2p-webrtc-direct")),and(HTTPS,base$1("p2p-webrtc-direct"))),Reliable=or(WebSockets$1,WebSocketsSecure,HTTP,HTTPS,WebRTCStar$1,WebRTCDirect,TCP,UTP,QUIC,DNS),Stardust=or(and(Reliable,base$1("p2p-stardust"),base$1("p2p")),and(Reliable,base$1("p2p-stardust"))),_P2P=or(and(Reliable,base$1("p2p")),WebRTCStar$1,WebRTCDirect,base$1("p2p")),_Circuit=or(and(_P2P,base$1("p2p-circuit"),_P2P),and(_P2P,base$1("p2p-circuit")),and(base$1("p2p-circuit"),_P2P),and(Reliable,base$1("p2p-circuit")),and(base$1("p2p-circuit"),Reliable),base$1("p2p-circuit")),CircuitRecursive=()=>or(and(_Circuit,CircuitRecursive),_Circuit),Circuit$2=CircuitRecursive(),P2P=or(and(Circuit$2,_P2P,Circuit$2),and(_P2P,Circuit$2),and(Circuit$2,_P2P),Circuit$2,_P2P);var src$j={DNS:DNS,DNS4:DNS4,DNS6:DNS6,DNSADDR:DNSADDR,IP:IP,TCP:TCP,UDP:UDP,QUIC:QUIC,UTP:UTP,HTTP:HTTP,HTTPS:HTTPS,WebSockets:WebSockets$1,WebSocketsSecure:WebSocketsSecure,WebSocketStar:WebSocketStar,WebRTCStar:WebRTCStar$1,WebRTCDirect:WebRTCDirect,Reliable:Reliable,Stardust:Stardust,Circuit:Circuit$2,P2P:P2P,IPFS:P2P};function makeMatchesFunction(e){return function(t){if(!Multiaddr$f.isMultiaddr(t))try{t=new Multiaddr$f(t)}catch(e){return!1}const r=e(t.protoNames());return null!==r&&(!0===r||!1===r?r:0===r.length)}}function and(...e){function t(t){if(t.length<e.length)return null;let r=t;return e.some((e=>(r="function"==typeof e?e().partialMatch(t):e.partialMatch(t),Array.isArray(r)&&(t=r),null===r))),r}return{toString:function(){return"{ "+e.join(" ")+" }"},input:e,matches:makeMatchesFunction(t),partialMatch:t}}function or(...e){function t(t){let r=null;return e.some((e=>{const n="function"==typeof e?e().partialMatch(t):e.partialMatch(t);return!!n&&(r=n,!0)})),r}return{toString:function(){return"{ "+e.join(" ")+" }"},input:e,matches:makeMatchesFunction(t),partialMatch:t}}function base$1(e){const t=e;return{toString:function(){return t},matches:function(e){let r;if("string"==typeof e||e instanceof Uint8Array)try{r=new Multiaddr$f(e)}catch(e){return!1}else r=e;const n=r.protoNames();return 1===n.length&&n[0]===t},partialMatch:function(e){return 0===e.length?null:e[0]===t?e.slice(1):null}}}var $protobuf$d=minimal,$Reader$d=$protobuf$d.Reader,$Writer$d=$protobuf$d.Writer,$util$d=$protobuf$d.util,$root$d=$protobuf$d.roots["libp2p-circuit"]||($protobuf$d.roots["libp2p-circuit"]={});$root$d.CircuitRelay=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.type=1,e.prototype.srcPeer=null,e.prototype.dstPeer=null,e.prototype.code=100,e.encode=function(e,t){return t||(t=$Writer$d.create()),null!=e.type&&Object.hasOwnProperty.call(e,"type")&&t.uint32(8).int32(e.type),null!=e.srcPeer&&Object.hasOwnProperty.call(e,"srcPeer")&&$root$d.CircuitRelay.Peer.encode(e.srcPeer,t.uint32(18).fork()).ldelim(),null!=e.dstPeer&&Object.hasOwnProperty.call(e,"dstPeer")&&$root$d.CircuitRelay.Peer.encode(e.dstPeer,t.uint32(26).fork()).ldelim(),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(32).int32(e.code),t},e.decode=function(e,t){e instanceof $Reader$d||(e=$Reader$d.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root$d.CircuitRelay;e.pos<r;){var i=e.uint32();switch(i>>>3){case 1:n.type=e.int32();break;case 2:n.srcPeer=$root$d.CircuitRelay.Peer.decode(e,e.uint32());break;case 3:n.dstPeer=$root$d.CircuitRelay.Peer.decode(e,e.uint32());break;case 4:n.code=e.int32();break;default:e.skipType(7&i)}}return n},e.fromObject=function(e){if(e instanceof $root$d.CircuitRelay)return e;var t=new $root$d.CircuitRelay;switch(e.type){case"HOP":case 1:t.type=1;break;case"STOP":case 2:t.type=2;break;case"STATUS":case 3:t.type=3;break;case"CAN_HOP":case 4:t.type=4}if(null!=e.srcPeer){if("object"!=typeof e.srcPeer)throw TypeError(".CircuitRelay.srcPeer: object expected");t.srcPeer=$root$d.CircuitRelay.Peer.fromObject(e.srcPeer)}if(null!=e.dstPeer){if("object"!=typeof e.dstPeer)throw TypeError(".CircuitRelay.dstPeer: object expected");t.dstPeer=$root$d.CircuitRelay.Peer.fromObject(e.dstPeer)}switch(e.code){case"SUCCESS":case 100:t.code=100;break;case"HOP_SRC_ADDR_TOO_LONG":case 220:t.code=220;break;case"HOP_DST_ADDR_TOO_LONG":case 221:t.code=221;break;case"HOP_SRC_MULTIADDR_INVALID":case 250:t.code=250;break;case"HOP_DST_MULTIADDR_INVALID":case 251:t.code=251;break;case"HOP_NO_CONN_TO_DST":case 260:t.code=260;break;case"HOP_CANT_DIAL_DST":case 261:t.code=261;break;case"HOP_CANT_OPEN_DST_STREAM":case 262:t.code=262;break;case"HOP_CANT_SPEAK_RELAY":case 270:t.code=270;break;case"HOP_CANT_RELAY_TO_SELF":case 280:t.code=280;break;case"STOP_SRC_ADDR_TOO_LONG":case 320:t.code=320;break;case"STOP_DST_ADDR_TOO_LONG":case 321:t.code=321;break;case"STOP_SRC_MULTIADDR_INVALID":case 350:t.code=350;break;case"STOP_DST_MULTIADDR_INVALID":case 351:t.code=351;break;case"STOP_RELAY_REFUSED":case 390:t.code=390;break;case"MALFORMED_MESSAGE":case 400:t.code=400}return t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.type=t.enums===String?"HOP":1,r.srcPeer=null,r.dstPeer=null,r.code=t.enums===String?"SUCCESS":100),null!=e.type&&e.hasOwnProperty("type")&&(r.type=t.enums===String?$root$d.CircuitRelay.Type[e.type]:e.type),null!=e.srcPeer&&e.hasOwnProperty("srcPeer")&&(r.srcPeer=$root$d.CircuitRelay.Peer.toObject(e.srcPeer,t)),null!=e.dstPeer&&e.hasOwnProperty("dstPeer")&&(r.dstPeer=$root$d.CircuitRelay.Peer.toObject(e.dstPeer,t)),null!=e.code&&e.hasOwnProperty("code")&&(r.code=t.enums===String?$root$d.CircuitRelay.Status[e.code]:e.code),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf$d.util.toJSONOptions)},e.Status=function(){var e={},t=Object.create(e);return t[e[100]="SUCCESS"]=100,t[e[220]="HOP_SRC_ADDR_TOO_LONG"]=220,t[e[221]="HOP_DST_ADDR_TOO_LONG"]=221,t[e[250]="HOP_SRC_MULTIADDR_INVALID"]=250,t[e[251]="HOP_DST_MULTIADDR_INVALID"]=251,t[e[260]="HOP_NO_CONN_TO_DST"]=260,t[e[261]="HOP_CANT_DIAL_DST"]=261,t[e[262]="HOP_CANT_OPEN_DST_STREAM"]=262,t[e[270]="HOP_CANT_SPEAK_RELAY"]=270,t[e[280]="HOP_CANT_RELAY_TO_SELF"]=280,t[e[320]="STOP_SRC_ADDR_TOO_LONG"]=320,t[e[321]="STOP_DST_ADDR_TOO_LONG"]=321,t[e[350]="STOP_SRC_MULTIADDR_INVALID"]=350,t[e[351]="STOP_DST_MULTIADDR_INVALID"]=351,t[e[390]="STOP_RELAY_REFUSED"]=390,t[e[400]="MALFORMED_MESSAGE"]=400,t}(),e.Type=function(){var e={},t=Object.create(e);return t[e[1]="HOP"]=1,t[e[2]="STOP"]=2,t[e[3]="STATUS"]=3,t[e[4]="CAN_HOP"]=4,t}(),e.Peer=function(){function e(e){if(this.addrs=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.id=$util$d.newBuffer([]),e.prototype.addrs=$util$d.emptyArray,e.encode=function(e,t){if(t||(t=$Writer$d.create()),t.uint32(10).bytes(e.id),null!=e.addrs&&e.addrs.length)for(var r=0;r<e.addrs.length;++r)t.uint32(18).bytes(e.addrs[r]);return t},e.decode=function(e,t){e instanceof $Reader$d||(e=$Reader$d.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root$d.CircuitRelay.Peer;e.pos<r;){var i=e.uint32();switch(i>>>3){case 1:n.id=e.bytes();break;case 2:n.addrs&&n.addrs.length||(n.addrs=[]),n.addrs.push(e.bytes());break;default:e.skipType(7&i)}}if(!n.hasOwnProperty("id"))throw $util$d.ProtocolError("missing required 'id'",{instance:n});return n},e.fromObject=function(e){if(e instanceof $root$d.CircuitRelay.Peer)return e;var t=new $root$d.CircuitRelay.Peer;if(null!=e.id&&("string"==typeof e.id?$util$d.base64.decode(e.id,t.id=$util$d.newBuffer($util$d.base64.length(e.id)),0):e.id.length&&(t.id=e.id)),e.addrs){if(!Array.isArray(e.addrs))throw TypeError(".CircuitRelay.Peer.addrs: array expected");t.addrs=[];for(var r=0;r<e.addrs.length;++r)"string"==typeof e.addrs[r]?$util$d.base64.decode(e.addrs[r],t.addrs[r]=$util$d.newBuffer($util$d.base64.length(e.addrs[r])),0):e.addrs[r].length&&(t.addrs[r]=e.addrs[r])}return t},e.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.addrs=[]),t.defaults&&(t.bytes===String?r.id="":(r.id=[],t.bytes!==Array&&(r.id=$util$d.newBuffer(r.id)))),null!=e.id&&e.hasOwnProperty("id")&&(r.id=t.bytes===String?$util$d.base64.encode(e.id,0,e.id.length):t.bytes===Array?Array.prototype.slice.call(e.id):e.id),e.addrs&&e.addrs.length){r.addrs=[];for(var n=0;n<e.addrs.length;++n)r.addrs[n]=t.bytes===String?$util$d.base64.encode(e.addrs[n],0,e.addrs[n].length):t.bytes===Array?Array.prototype.slice.call(e.addrs[n]):e.addrs[n]}return r},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf$d.util.toJSONOptions)},e}(),e}();var protocol=$root$d,abortableIterator={exports:{}},getIterator$3=function(e){if(e){if("function"==typeof e[Symbol.iterator])return e[Symbol.iterator]();if("function"==typeof e[Symbol.asyncIterator])return e[Symbol.asyncIterator]();if("function"==typeof e.next)return e}throw new Error("argument is not an iterator or iterable")},AbortError_1=class extends Error{constructor(e,t){super(e||"The operation was aborted"),this.type="aborted",this.code=t||"ABORT_ERR"}};const getIterator$2=getIterator$3,AbortError$4=AbortError_1,toAbortableSource=(e,t,r)=>toMultiAbortableSource(e,Array.isArray(t)?t:[{signal:t,options:r}]),toMultiAbortableSource=(e,t)=>(e=getIterator$2(e),t=t.map((({signal:e,options:t})=>({signal:e,options:t||{}}))),async function*(){let r;const n=()=>{r&&r()};for(const{signal:e}of t)e.addEventListener("abort",n);for(;;){let i;try{for(const{signal:e,options:r}of t)if(e.aborted){const{abortMessage:e,abortCode:t}=r;throw new AbortError$4(e,t)}const n=new Promise(((e,n)=>{r=()=>{const{options:e}=t.find((({signal:e})=>e.aborted)),{abortMessage:r,abortCode:i}=e;n(new AbortError$4(r,i))}}));i=await Promise.race([n,e.next()]),r=null}catch(r){for(const{signal:e}of t)e.removeEventListener("abort",n);const i=t.find((({signal:e})=>e.aborted)),s="aborted"===r.type&&i;if(s&&i.options.onAbort&&await i.options.onAbort(e),"function"==typeof e.return&&await e.return(),s&&i.options.returnOnAbort)return;throw r}if(i.done)break;yield i.value}for(const{signal:e}of t)e.removeEventListener("abort",n)}()),toAbortableSink=(e,t,r)=>toMultiAbortableSink(e,Array.isArray(t)?t:[{signal:t,options:r}]),toMultiAbortableSink=(e,t)=>r=>e(toMultiAbortableSource(r,t)),toAbortableDuplex=(e,t,r)=>toMultiAbortableDuplex(e,Array.isArray(t)?t:[{signal:t,options:r}]),toMultiAbortableDuplex=(e,t)=>({sink:toMultiAbortableSink(e.sink,t),source:toMultiAbortableSource(e.source,t)});abortableIterator.exports=toAbortableSource,abortableIterator.exports.AbortError=AbortError$4,abortableIterator.exports.source=toAbortableSource,abortableIterator.exports.sink=toAbortableSink,abortableIterator.exports.transform=toAbortableSink,abortableIterator.exports.duplex=toAbortableDuplex;const{source:abortable$5}=abortableIterator.exports,debug$B=require$$0$b,log$w=debug$B("libp2p:stream:converter");function streamToMaConnection({stream:e,remoteAddr:t,localAddr:r},n={}){const{sink:i,source:s}=e,o={async sink(e){n.signal&&(e=abortable$5(e,n.signal));try{await i(e)}catch(e){"aborted"!==e.type&&log$w(e)}a()},source:n.signal?abortable$5(s,n.signal):s,conn:e,localAddr:r,remoteAddr:t,timeline:{open:Date.now(),close:void 0},close:()=>(i(new Uint8Array(0)),a())};function a(){return o.timeline.close||(o.timeline.close=Date.now()),Promise.resolve()}return o}var streamToMaConn=streamToMaConnection,multicodec$5={relay:"/libp2p/circuit/relay/0.1.0"};const{EventEmitter:EventEmitter$8}=require$$1$9,{Multiaddr:Multiaddr$e}=src$o;var listener$1=e=>{const t=new Map;const r=Object.assign(new EventEmitter$8,{close:()=>Promise.resolve(),listen:async function(n){const i=String(n).split("/p2p-circuit").find((e=>""!==e)),s=await e.dial(new Multiaddr$e(i)),o=s.remoteAddr.encapsulate("/p2p-circuit");t.set(s.remotePeer.toB58String(),o),r.emit("listening")},getAddrs:function(){const e=[];for(const r of t.values())e.push(r);return e}});return e.connectionManager.on("peer:disconnect",(e=>{t.delete(e.remotePeer.toB58String())&&r.emit("close")})),r};const{Multiaddr:Multiaddr$d}=src$o,{CircuitRelay:CircuitRelay$1}=protocol;function writeResponse(e,t){e.write({type:CircuitRelay$1.Type.STATUS,code:t})}function validateAddrs$2(e,t){try{e.dstPeer&&e.dstPeer.addrs&&e.dstPeer.addrs.forEach((e=>new Multiaddr$d(e)))}catch(r){throw writeResponse(t,e.type===CircuitRelay$1.Type.HOP?CircuitRelay$1.Status.HOP_DST_MULTIADDR_INVALID:CircuitRelay$1.Status.STOP_DST_MULTIADDR_INVALID),r}try{e.srcPeer&&e.srcPeer.addrs&&e.srcPeer.addrs.forEach((e=>new Multiaddr$d(e)))}catch(r){throw writeResponse(t,e.type===CircuitRelay$1.Type.HOP?CircuitRelay$1.Status.HOP_SRC_MULTIADDR_INVALID:CircuitRelay$1.Status.STOP_SRC_MULTIADDR_INVALID),r}}var utils$t={validateAddrs:validateAddrs$2},src$i={},encode$3={exports:{}},require$$0$7=getAugmentedNamespace(_polyfillNode_buffer);const{Buffer:Buffer$e}=require$$0$7,symbol$4=Symbol.for("BufferList");function BufferList$c(e){if(!(this instanceof BufferList$c))return new BufferList$c(e);BufferList$c._init.call(this,e)}BufferList$c._init=function(e){Object.defineProperty(this,symbol$4,{value:!0}),this._bufs=[],this.length=0,e&&this.append(e)},BufferList$c.prototype._new=function(e){return new BufferList$c(e)},BufferList$c.prototype._offset=function(e){if(0===e)return[0,0];let t=0;for(let r=0;r<this._bufs.length;r++){const n=t+this._bufs[r].length;if(e<n||r===this._bufs.length-1)return[r,e-t];t=n}},BufferList$c.prototype._reverseOffset=function(e){const t=e[0];let r=e[1];for(let e=0;e<t;e++)r+=this._bufs[e].length;return r},BufferList$c.prototype.get=function(e){if(e>this.length||e<0)return;const t=this._offset(e);return this._bufs[t[0]][t[1]]},BufferList$c.prototype.slice=function(e,t){return"number"==typeof e&&e<0&&(e+=this.length),"number"==typeof t&&t<0&&(t+=this.length),this.copy(null,0,e,t)},BufferList$c.prototype.copy=function(e,t,r,n){if(("number"!=typeof r||r<0)&&(r=0),("number"!=typeof n||n>this.length)&&(n=this.length),r>=this.length)return e||Buffer$e.alloc(0);if(n<=0)return e||Buffer$e.alloc(0);const i=!!e,s=this._offset(r),o=n-r;let a=o,u=i&&t||0,c=s[1];if(0===r&&n===this.length){if(!i)return 1===this._bufs.length?this._bufs[0]:Buffer$e.concat(this._bufs,this.length);for(let t=0;t<this._bufs.length;t++)this._bufs[t].copy(e,u),u+=this._bufs[t].length;return e}if(a<=this._bufs[s[0]].length-c)return i?this._bufs[s[0]].copy(e,t,c,c+a):this._bufs[s[0]].slice(c,c+a);i||(e=Buffer$e.allocUnsafe(o));for(let t=s[0];t<this._bufs.length;t++){const r=this._bufs[t].length-c;if(!(a>r)){this._bufs[t].copy(e,u,c,c+a),u+=r;break}this._bufs[t].copy(e,u,c),u+=r,a-=r,c&&(c=0)}return e.length>u?e.slice(0,u):e},BufferList$c.prototype.shallowSlice=function(e,t){if(e=e||0,t="number"!=typeof t?this.length:t,e<0&&(e+=this.length),t<0&&(t+=this.length),e===t)return this._new();const r=this._offset(e),n=this._offset(t),i=this._bufs.slice(r[0],n[0]+1);return 0===n[1]?i.pop():i[i.length-1]=i[i.length-1].slice(0,n[1]),0!==r[1]&&(i[0]=i[0].slice(r[1])),this._new(i)},BufferList$c.prototype.toString=function(e,t,r){return this.slice(t,r).toString(e)},BufferList$c.prototype.consume=function(e){if(e=Math.trunc(e),Number.isNaN(e)||e<=0)return this;for(;this._bufs.length;){if(!(e>=this._bufs[0].length)){this._bufs[0]=this._bufs[0].slice(e),this.length-=e;break}e-=this._bufs[0].length,this.length-=this._bufs[0].length,this._bufs.shift()}return this},BufferList$c.prototype.duplicate=function(){const e=this._new();for(let t=0;t<this._bufs.length;t++)e.append(this._bufs[t]);return e},BufferList$c.prototype.append=function(e){if(null==e)return this;if(e.buffer)this._appendBuffer(Buffer$e.from(e.buffer,e.byteOffset,e.byteLength));else if(Array.isArray(e))for(let t=0;t<e.length;t++)this.append(e[t]);else if(this._isBufferList(e))for(let t=0;t<e._bufs.length;t++)this.append(e._bufs[t]);else"number"==typeof e&&(e=e.toString()),this._appendBuffer(Buffer$e.from(e));return this},BufferList$c.prototype._appendBuffer=function(e){this._bufs.push(e),this.length+=e.length},BufferList$c.prototype.indexOf=function(e,t,r){if(void 0===r&&"string"==typeof t&&(r=t,t=void 0),"function"==typeof e||Array.isArray(e))throw new TypeError('The "value" argument must be one of type string, Buffer, BufferList, or Uint8Array.');if("number"==typeof e?e=Buffer$e.from([e]):"string"==typeof e?e=Buffer$e.from(e,r):this._isBufferList(e)?e=e.slice():Array.isArray(e.buffer)?e=Buffer$e.from(e.buffer,e.byteOffset,e.byteLength):Buffer$e.isBuffer(e)||(e=Buffer$e.from(e)),t=Number(t||0),isNaN(t)&&(t=0),t<0&&(t=this.length+t),t<0&&(t=0),0===e.length)return t>this.length?this.length:t;const n=this._offset(t);let i=n[0],s=n[1];for(;i<this._bufs.length;i++){const t=this._bufs[i];for(;s<t.length;){if(t.length-s>=e.length){const r=t.indexOf(e,s);if(-1!==r)return this._reverseOffset([i,r]);s=t.length-e.length+1}else{const t=this._reverseOffset([i,s]);if(this._match(t,e))return t;s++}}s=0}return-1},BufferList$c.prototype._match=function(e,t){if(this.length-e<t.length)return!1;for(let r=0;r<t.length;r++)if(this.get(e+r)!==t[r])return!1;return!0},function(){const e={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1,readIntBE:null,readIntLE:null,readUIntBE:null,readUIntLE:null};for(const t in e)!function(t){BufferList$c.prototype[t]=null===e[t]?function(e,r){return this.slice(e,e+r)[t](0,r)}:function(r=0){return this.slice(r,r+e[t])[t](0)}}(t)}(),BufferList$c.prototype._isBufferList=function(e){return e instanceof BufferList$c||BufferList$c.isBufferList(e)},BufferList$c.isBufferList=function(e){return null!=e&&e[symbol$4]};var BufferList_1$4=BufferList$c;const Varint$1=varint$6,{Buffer:Buffer$d}=require$$0$7,varintEncode$1=(e,t,r)=>{const n=Varint$1.encode(e,t,r);return varintEncode$1.bytes=Varint$1.encode.bytes,t||Buffer$d.from(n)};var varintEncode_1=varintEncode$1;const{Buffer:Buffer$c}=require$$0$7,BufferList$b=BufferList_1$4,varintEncode=varintEncode_1,MIN_POOL_SIZE=8,DEFAULT_POOL_SIZE=10240;function encode$2(e){e=e||{};const t=Math.max(e.poolSize||DEFAULT_POOL_SIZE,e.minPoolSize||MIN_POOL_SIZE),r=e.lengthEncoder||varintEncode;return async function*(e){let n=Buffer$c.alloc(t),i=0;for await(const s of e){r(s.length,n,i);const e=n.slice(i,i+r.bytes);i+=r.bytes,n.length-i<MIN_POOL_SIZE&&(n=Buffer$c.alloc(t),i=0),yield(new BufferList$b).append(e).append(s)}}}encode$2.single=(e,t)=>{const r=(t=t||{}).lengthEncoder||varintEncode;return new BufferList$b([r(e.length),e.slice()])},encode$3.exports=encode$2,encode$3.exports.MIN_POOL_SIZE=MIN_POOL_SIZE,encode$3.exports.DEFAULT_POOL_SIZE=DEFAULT_POOL_SIZE;var decode$4={exports:{}};const Varint=varint$6,{Buffer:Buffer$b}=require$$0$7,toBufferProxy=e=>new Proxy({},{get:(t,r)=>"l"===r[0]?e[r]:e.get(parseInt(r))}),varintDecode$1=e=>{const t=Varint.decode(Buffer$b.isBuffer(e)?e:toBufferProxy(e));return varintDecode$1.bytes=Varint.decode.bytes,t};var varintDecode_1=varintDecode$1;const{Buffer:Buffer$a}=require$$0$7,BufferList$a=BufferList_1$4,varintDecode=varintDecode_1,MAX_LENGTH_LENGTH=8,MAX_DATA_LENGTH=4194304,Empty=Buffer$a.alloc(0),ReadModes={LENGTH:"readLength",DATA:"readData"},ReadHandlers={[ReadModes.LENGTH]:(e,t,r,n)=>{let i;t=t.append(e);try{i=n.lengthDecoder(t)}catch(e){if(t.length>n.maxLengthLength)throw Object.assign(e,{message:"message length too long",code:"ERR_MSG_LENGTH_TOO_LONG"});if(e instanceof RangeError)return{mode:ReadModes.LENGTH,buffer:t,chunk:void 0,state:void 0,data:void 0};throw e}if(i>n.maxDataLength)throw Object.assign(new Error("message data too long"),{code:"ERR_MSG_DATA_TOO_LONG"});return e=t.shallowSlice(n.lengthDecoder.bytes),t=new BufferList$a,n.onLength&&n.onLength(i),i<=0?(n.onData&&n.onData(Empty),{mode:ReadModes.LENGTH,chunk:e,buffer:t,data:Empty}):{mode:ReadModes.DATA,chunk:e,buffer:t,state:{dataLength:i},data:void 0}},[ReadModes.DATA]:(e,t,r,n)=>{if(t=t.append(e),!r)throw new Error("state is required");if(t.length<r.dataLength)return{mode:ReadModes.DATA,buffer:t,state:r,chunk:void 0,data:void 0};const{dataLength:i}=r,s=t.shallowSlice(0,i),o=t.length>i?t.shallowSlice(i):void 0;return t=new BufferList$a,n.onData&&n.onData(s),{mode:ReadModes.LENGTH,chunk:o,buffer:t,state:void 0,data:s}}};function decode$3(e){const t={lengthDecoder:(e=e||{}).lengthDecoder||varintDecode,maxLengthLength:e.maxLengthLength||MAX_LENGTH_LENGTH,maxDataLength:e.maxDataLength||MAX_DATA_LENGTH,onLength:e.onLength,onData:e.onData};return async function*(e){let r,n=new BufferList$a,i=ReadModes.LENGTH;for await(const s of e){let e=s;for(;e;){const s=ReadHandlers[i](e,n,r,t);i=s.mode,e=s.chunk,n=s.buffer,r=s.state,s.data&&(yield s.data)}}if(n.length)throw Object.assign(new Error("unexpected end of input"),{code:"ERR_UNEXPECTED_EOF"})}}decode$3.fromReader=(e,t)=>{let r=1;const n={[Symbol.asyncIterator](){return this},next:async()=>{try{return await e.next(r)}catch(e){if("ERR_UNDER_READ"===e.code)return{done:!0,value:null};throw e}finally{r=1}}};return decode$3({...t||{},onLength:e=>{r=e}})(n)},decode$4.exports=decode$3,decode$4.exports.MAX_LENGTH_LENGTH=MAX_LENGTH_LENGTH,decode$4.exports.MAX_DATA_LENGTH=MAX_DATA_LENGTH;const{Buffer:Buffer$9}=require$$0$7,int32BEEncode=(e,t,r)=>((t=t||Buffer$9.allocUnsafe(4)).writeInt32BE(e,r),t);int32BEEncode.bytes=4;var int32BEEncode_1=int32BEEncode;const int32BEDecode=e=>{if(e.length<4)throw RangeError("Could not decode int32BE");return e.readInt32BE(0)};int32BEDecode.bytes=4;var int32BEDecode_1=int32BEDecode;src$i.encode=encode$3.exports,src$i.decode=decode$4.exports,src$i.varintEncode=varintEncode_1,src$i.varintDecode=varintDecode_1,src$i.int32BEEncode=int32BEEncode_1,src$i.int32BEDecode=int32BEDecode_1;const{Buffer:Buffer$8}=require$$0$7,symbol$3=Symbol.for("BufferList");function BufferList$9(e){if(!(this instanceof BufferList$9))return new BufferList$9(e);BufferList$9._init.call(this,e)}BufferList$9._init=function(e){Object.defineProperty(this,symbol$3,{value:!0}),this._bufs=[],this.length=0,e&&this.append(e)},BufferList$9.prototype._new=function(e){return new BufferList$9(e)},BufferList$9.prototype._offset=function(e){if(0===e)return[0,0];let t=0;for(let r=0;r<this._bufs.length;r++){const n=t+this._bufs[r].length;if(e<n||r===this._bufs.length-1)return[r,e-t];t=n}},BufferList$9.prototype._reverseOffset=function(e){const t=e[0];let r=e[1];for(let e=0;e<t;e++)r+=this._bufs[e].length;return r},BufferList$9.prototype.get=function(e){if(e>this.length||e<0)return;const t=this._offset(e);return this._bufs[t[0]][t[1]]},BufferList$9.prototype.slice=function(e,t){return"number"==typeof e&&e<0&&(e+=this.length),"number"==typeof t&&t<0&&(t+=this.length),this.copy(null,0,e,t)},BufferList$9.prototype.copy=function(e,t,r,n){if(("number"!=typeof r||r<0)&&(r=0),("number"!=typeof n||n>this.length)&&(n=this.length),r>=this.length)return e||Buffer$8.alloc(0);if(n<=0)return e||Buffer$8.alloc(0);const i=!!e,s=this._offset(r),o=n-r;let a=o,u=i&&t||0,c=s[1];if(0===r&&n===this.length){if(!i)return 1===this._bufs.length?this._bufs[0]:Buffer$8.concat(this._bufs,this.length);for(let t=0;t<this._bufs.length;t++)this._bufs[t].copy(e,u),u+=this._bufs[t].length;return e}if(a<=this._bufs[s[0]].length-c)return i?this._bufs[s[0]].copy(e,t,c,c+a):this._bufs[s[0]].slice(c,c+a);i||(e=Buffer$8.allocUnsafe(o));for(let t=s[0];t<this._bufs.length;t++){const r=this._bufs[t].length-c;if(!(a>r)){this._bufs[t].copy(e,u,c,c+a),u+=r;break}this._bufs[t].copy(e,u,c),u+=r,a-=r,c&&(c=0)}return e.length>u?e.slice(0,u):e},BufferList$9.prototype.shallowSlice=function(e,t){if(e=e||0,t="number"!=typeof t?this.length:t,e<0&&(e+=this.length),t<0&&(t+=this.length),e===t)return this._new();const r=this._offset(e),n=this._offset(t),i=this._bufs.slice(r[0],n[0]+1);return 0===n[1]?i.pop():i[i.length-1]=i[i.length-1].slice(0,n[1]),0!==r[1]&&(i[0]=i[0].slice(r[1])),this._new(i)},BufferList$9.prototype.toString=function(e,t,r){return this.slice(t,r).toString(e)},BufferList$9.prototype.consume=function(e){if(e=Math.trunc(e),Number.isNaN(e)||e<=0)return this;for(;this._bufs.length;){if(!(e>=this._bufs[0].length)){this._bufs[0]=this._bufs[0].slice(e),this.length-=e;break}e-=this._bufs[0].length,this.length-=this._bufs[0].length,this._bufs.shift()}return this},BufferList$9.prototype.duplicate=function(){const e=this._new();for(let t=0;t<this._bufs.length;t++)e.append(this._bufs[t]);return e},BufferList$9.prototype.append=function(e){if(null==e)return this;if(e.buffer)this._appendBuffer(Buffer$8.from(e.buffer,e.byteOffset,e.byteLength));else if(Array.isArray(e))for(let t=0;t<e.length;t++)this.append(e[t]);else if(this._isBufferList(e))for(let t=0;t<e._bufs.length;t++)this.append(e._bufs[t]);else"number"==typeof e&&(e=e.toString()),this._appendBuffer(Buffer$8.from(e));return this},BufferList$9.prototype._appendBuffer=function(e){this._bufs.push(e),this.length+=e.length},BufferList$9.prototype.indexOf=function(e,t,r){if(void 0===r&&"string"==typeof t&&(r=t,t=void 0),"function"==typeof e||Array.isArray(e))throw new TypeError('The "value" argument must be one of type string, Buffer, BufferList, or Uint8Array.');if("number"==typeof e?e=Buffer$8.from([e]):"string"==typeof e?e=Buffer$8.from(e,r):this._isBufferList(e)?e=e.slice():Array.isArray(e.buffer)?e=Buffer$8.from(e.buffer,e.byteOffset,e.byteLength):Buffer$8.isBuffer(e)||(e=Buffer$8.from(e)),t=Number(t||0),isNaN(t)&&(t=0),t<0&&(t=this.length+t),t<0&&(t=0),0===e.length)return t>this.length?this.length:t;const n=this._offset(t);let i=n[0],s=n[1];for(;i<this._bufs.length;i++){const t=this._bufs[i];for(;s<t.length;){if(t.length-s>=e.length){const r=t.indexOf(e,s);if(-1!==r)return this._reverseOffset([i,r]);s=t.length-e.length+1}else{const t=this._reverseOffset([i,s]);if(this._match(t,e))return t;s++}}s=0}return-1},BufferList$9.prototype._match=function(e,t){if(this.length-e<t.length)return!1;for(let r=0;r<t.length;r++)if(this.get(e+r)!==t[r])return!1;return!0},function(){const e={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1,readIntBE:null,readIntLE:null,readUIntBE:null,readUIntLE:null};for(const t in e)!function(t){BufferList$9.prototype[t]=null===e[t]?function(e,r){return this.slice(e,e+r)[t](0,r)}:function(r=0){return this.slice(r,r+e[t])[t](0)}}(t)}(),BufferList$9.prototype._isBufferList=function(e){return e instanceof BufferList$9||BufferList$9.isBufferList(e)},BufferList$9.isBufferList=function(e){return null!=e&&e[symbol$3]};var BufferList_1$3=BufferList$9;const BufferList$8=BufferList_1$3;var itReader=e=>{const t=async function*(){let t=yield,r=new BufferList$8;for await(const n of e)if(t)for(r.append(n);r.length>=t;){const e=r.shallowSlice(0,t);if(r.consume(t),t=yield e,!t){r.length&&(t=yield r,r=new BufferList$8);break}}else t=yield r.append(n),r=new BufferList$8;if(t)throw Object.assign(new Error(`stream ended before ${t} bytes became available`),{code:"ERR_UNDER_READ",buffer:r})}();return t.next(),t};const pDefer$2=()=>{const e={};return e.promise=new Promise(((t,r)=>{e.resolve=t,e.reject=r})),e};var pDefer_1=pDefer$2;const Reader$1=itReader,Writer=itPushable,defer$1=pDefer_1;var src$h=e=>{const t=Writer(),r=Reader$1(e.source),n=defer$1();let i;const s=e.sink(async function*(){yield*t;const e=await n.promise;yield*e}());s.catch((e=>{i=e}));const o={sink:e=>i?Promise.reject(i):(n.resolve(e),s),source:r};return{reader:r,writer:t,stream:o,rest:()=>t.end(),write:t.push,read:async()=>(await r.next()).value}};const debug$A=require$$0$b,log$v=Object.assign(debug$A("libp2p:circuit:stream-handler"),{error:debug$A("libp2p:circuit:stream-handler:err")}),lp$4=src$i,handshake$3=src$h,{CircuitRelay:CircuitRelay}=protocol;class StreamHandler$3{constructor({stream:e,maxLength:t=4096}){this.stream=e,this.shake=handshake$3(this.stream),this.decoder=lp$4.decode.fromReader(this.shake.reader,{maxDataLength:t})}async read(){const e=await this.decoder.next();if(e.value){const t=CircuitRelay.decode(e.value.slice());return log$v("read message type",t.type),t}log$v("read received no value, closing stream"),this.close()}write(e){log$v("write message type %s",e.type),this.shake.write(lp$4.encode.single(CircuitRelay.encode(e).finish()))}rest(){return this.shake.rest(),this.shake.stream}end(e){this.write(e),this.close()}close(){log$v("closing the stream"),this.rest().sink([])}}var streamHandler=StreamHandler$3,stop$1={};const debug$z=require$$0$b,log$u=Object.assign(debug$z("libp2p:circuit:stop"),{error:debug$z("libp2p:circuit:stop:err")}),{CircuitRelay:CircuitPB$2}=protocol,multicodec$4=multicodec$5,StreamHandler$2=streamHandler,{validateAddrs:validateAddrs$1}=utils$t;stop$1.handleStop=function({connection:e,request:t,streamHandler:r}){try{validateAddrs$1(t,r)}catch(t){return log$u.error("invalid stop request via peer %s",e.remotePeer.toB58String(),t)}return log$u("stop request is valid"),r.write({type:CircuitPB$2.Type.STATUS,code:CircuitPB$2.Status.SUCCESS}),r.rest()},stop$1.stop=async function({connection:e,request:t}){const{stream:r}=await e.newStream([multicodec$4.relay]);log$u("starting stop request to %s",e.remotePeer.toB58String());const n=new StreamHandler$2({stream:r});n.write(t);const i=await n.read();return i?i.code===CircuitPB$2.Status.SUCCESS?(log$u("stop request to %s was successful",e.remotePeer.toB58String()),n.rest()):(log$u("stop request failed with code %d",i.code),void n.close()):n.close()};const debug$y=require$$0$b,log$t=Object.assign(debug$y("libp2p:circuit:hop"),{error:debug$y("libp2p:circuit:hop:err")}),errCode$d=errCode$m,PeerId$g=src$q.exports,{validateAddrs:validateAddrs}=utils$t,StreamHandler$1=streamHandler,{CircuitRelay:CircuitPB$1}=protocol,{pipe:pipe$8}=itPipe.exports,{codes:Errors}=errors$4,{stop:stop}=stop$1,multicodec$3=multicodec$5;async function handleHop$1({connection:e,request:t,streamHandler:r,circuit:n}){if(!n._options.hop.enabled)return log$t("HOP request received but we are not acting as a relay"),r.end({type:CircuitPB$1.Type.STATUS,code:CircuitPB$1.Status.HOP_CANT_SPEAK_RELAY});try{validateAddrs(t,r)}catch(t){return log$t.error("invalid hop request via peer %s",e.remotePeer.toB58String(),t)}if(!t.dstPeer)return void log$t("HOP request received but we do not receive a dstPeer");const i=new PeerId$g(t.dstPeer.id),s=n._connectionManager.get(i);if(!s&&!n._options.hop.active)return log$t("HOP request received but we are not connected to the destination peer"),r.end({type:CircuitPB$1.Type.STATUS,code:CircuitPB$1.Status.HOP_NO_CONN_TO_DST});if(!s)return;const o={type:CircuitPB$1.Type.STOP,dstPeer:t.dstPeer,srcPeer:t.srcPeer};let a;try{a=await stop({connection:s,request:o})}catch(e){return log$t.error(e)}log$t("hop request from %s is valid",e.remotePeer.toB58String()),r.write({type:CircuitPB$1.Type.STATUS,code:CircuitPB$1.Status.SUCCESS});const u=r.rest();return pipe$8(u,a,u)}async function hop$1({connection:e,request:t}){const{stream:r}=await e.newStream([multicodec$3.relay]),n=new StreamHandler$1({stream:r});n.write(t);const i=await n.read();if(!i)throw errCode$d(new Error("HOP request had no response"),Errors.ERR_HOP_REQUEST_FAILED);if(i.code===CircuitPB$1.Status.SUCCESS)return log$t("hop request was successful"),n.rest();throw log$t("hop request failed with code %d, closing stream",i.code),n.close(),errCode$d(new Error(`HOP request failed with code ${i.code}`),Errors.ERR_HOP_REQUEST_FAILED)}async function canHop$1({connection:e}){const{stream:t}=await e.newStream([multicodec$3.relay]),r=new StreamHandler$1({stream:t});r.write({type:CircuitPB$1.Type.CAN_HOP});const n=await r.read();return await r.close(),!(!n||n.code!==CircuitPB$1.Status.SUCCESS)}function handleCanHop$1({connection:e,streamHandler:t,circuit:r}){const n=r._options.hop.enabled;log$t("can hop (%s) request from %s",n,e.remotePeer.toB58String()),t.end({type:CircuitPB$1.Type.STATUS,code:n?CircuitPB$1.Status.SUCCESS:CircuitPB$1.Status.HOP_CANT_SPEAK_RELAY})}var hop_1={handleHop:handleHop$1,hop:hop$1,canHop:canHop$1,handleCanHop:handleCanHop$1};const debug$x=require$$0$b,log$s=Object.assign(debug$x("libp2p:circuit"),{error:debug$x("libp2p:circuit:err")}),errCode$c=errCode$m,mafmt$2=src$j,{Multiaddr:Multiaddr$c}=src$o,PeerId$f=src$q.exports,{CircuitRelay:CircuitPB}=protocol,{codes:codes$6}=errors$4,toConnection$3=streamToMaConn,{relay:multicodec$2}=multicodec$5,createListener$2=listener$1,{handleCanHop:handleCanHop,handleHop:handleHop,hop:hop}=hop_1,{handleStop:handleStop}=stop$1,StreamHandler=streamHandler,transportSymbol=Symbol.for("@libp2p/js-libp2p-circuit/circuit");class Circuit$1{constructor({libp2p:e,upgrader:t}){this._dialer=e.dialer,this._registrar=e.registrar,this._connectionManager=e.connectionManager,this._upgrader=t,this._options=e._config.relay,this._libp2p=e,this.peerId=e.peerId,this._registrar.handle(multicodec$2,this._onProtocol.bind(this))}async _onProtocol({connection:e,stream:t}){const r=new StreamHandler({stream:t}),n=await r.read();if(!n)return;const i=this;let s;switch(n.type){case CircuitPB.Type.CAN_HOP:log$s("received CAN_HOP request from %s",e.remotePeer.toB58String()),await handleCanHop({circuit:i,connection:e,streamHandler:r});break;case CircuitPB.Type.HOP:log$s("received HOP request from %s",e.remotePeer.toB58String()),s=await handleHop({connection:e,request:n,streamHandler:r,circuit:i});break;case CircuitPB.Type.STOP:log$s("received STOP request from %s",e.remotePeer.toB58String()),s=await handleStop({connection:e,request:n,streamHandler:r});break;default:log$s("Request of type %s not supported",n.type)}if(s){const e=new Multiaddr$c(n.dstPeer.addrs[0]),t=new Multiaddr$c(n.srcPeer.addrs[0]),r=toConnection$3({stream:s,remoteAddr:e,localAddr:t}),i=n.type===CircuitPB.Type.HOP?"relay":"inbound";log$s("new %s connection %s",i,r.remoteAddr);const o=await this._upgrader.upgradeInbound(r);log$s("%s connection %s upgraded",i,r.remoteAddr),this.handler&&this.handler(o)}}async dial(e,t){const r=e.toString().split("/p2p-circuit"),n=new Multiaddr$c(r[0]),i=new Multiaddr$c(r[r.length-1]),s=n.getPeerId(),o=i.getPeerId();if(!s||!o){const e="Circuit relay dial failed as addresses did not have peer id";throw log$s.error(e),errCode$c(new Error(e),codes$6.ERR_RELAYED_DIAL)}const a=PeerId$f.createFromB58String(s),u=PeerId$f.createFromB58String(o);let c=!1,l=this._connectionManager.get(a);l||(l=await this._dialer.connectToPeer(n,t),c=!0);try{const t=await hop({connection:l,request:{type:CircuitPB.Type.HOP,srcPeer:{id:this.peerId.toBytes(),addrs:this._libp2p.multiaddrs.map((e=>e.bytes))},dstPeer:{id:u.toBytes(),addrs:[new Multiaddr$c(i).bytes]}}}),r=n.encapsulate(`/p2p-circuit/p2p/${this.peerId.toB58String()}`),s=toConnection$3({stream:t,remoteAddr:e,localAddr:r});return log$s("new outbound connection %s",s.remoteAddr),this._upgrader.upgradeOutbound(s)}catch(e){throw log$s.error("Circuit relay dial failed",e),c&&await l.close(),e}}createListener(e,t){return"function"==typeof e&&(t=e,e={}),this.handler=t,createListener$2(this._libp2p)}filter(e){return(e=Array.isArray(e)?e:[e]).filter((e=>mafmt$2.Circuit.matches(e)))}get[Symbol.toStringTag](){return"Circuit"}static isTransport(e){return Boolean(e&&e[transportSymbol])}}var transport$1=Circuit$1,utils$s={};const{CID:CID}=require$$0$a,{sha256:sha256$m}=require$$4$3;utils$s.namespaceToCid=async e=>{const t=(new TextEncoder).encode(e),r=await sha256$m.digest(t);return CID.createV0(r)};const debug$w=require$$0$b,log$r=Object.assign(debug$w("libp2p:auto-relay"),{error:debug$w("libp2p:auto-relay:err")}),{fromString:uint8ArrayFromString$r}=require$$3$1,{toString:uint8ArrayToString$u}=require$$1$5,{Multiaddr:Multiaddr$b}=src$o,PeerId$e=src$q.exports,{relay:multicodec$1}=multicodec$5,{canHop:canHop}=hop_1,{namespaceToCid:namespaceToCid$1}=utils$s,{CIRCUIT_PROTO_CODE:CIRCUIT_PROTO_CODE,HOP_METADATA_KEY:HOP_METADATA_KEY,HOP_METADATA_VALUE:HOP_METADATA_VALUE,RELAY_RENDEZVOUS_NS:RELAY_RENDEZVOUS_NS$1}=constants$8;class AutoRelay$1{constructor({libp2p:e,maxListeners:t=1,onError:r}){this._libp2p=e,this._peerId=e.peerId,this._peerStore=e.peerStore,this._connectionManager=e.connectionManager,this._transportManager=e.transportManager,this._addressSorter=e.dialer.addressSorter,this.maxListeners=t,this._listenRelays=new Set,this._onProtocolChange=this._onProtocolChange.bind(this),this._onPeerDisconnected=this._onPeerDisconnected.bind(this),this._peerStore.on("change:protocols",this._onProtocolChange),this._connectionManager.on("peer:disconnect",this._onPeerDisconnected),this._onError=(e,t)=>{log$r.error(t||e),r&&r(e,t)}}async _onProtocolChange({peerId:e,protocols:t}){const r=e.toB58String(),n=t.find((e=>e===multicodec$1));if(n||!this._listenRelays.has(r)){if(n&&!this._listenRelays.has(r))try{const t=this._connectionManager.get(e);if(!t)return;if(t.remoteAddr.protoCodes().includes(CIRCUIT_PROTO_CODE))return void log$r(`relayed connection to ${r} will not be used to hop on`);await canHop({connection:t})&&(this._peerStore.metadataBook.set(e,HOP_METADATA_KEY,uint8ArrayFromString$r(HOP_METADATA_VALUE)),await this._addListenRelay(t,r))}catch(e){this._onError(e)}}else this._removeListenRelay(r)}_onPeerDisconnected(e){const t=e.remotePeer.toB58String();this._listenRelays.has(t)&&this._removeListenRelay(t)}async _addListenRelay(e,t){if(this._listenRelays.size>=this.maxListeners)return;const r=this._peerStore.addressBook.getMultiaddrsForPeer(e.remotePeer,this._addressSorter);if(!r||!r.length)return;const n=`${r[0].toString()}/p2p-circuit`;this._listenRelays.add(t);try{await this._transportManager.listen([new Multiaddr$b(n)])}catch(e){this._onError(e),this._listenRelays.delete(t)}}_removeListenRelay(e){this._listenRelays.delete(e)&&this._listenOnAvailableHopRelays([e])}async _listenOnAvailableHopRelays(e=[]){if(this._listenRelays.size>=this.maxListeners)return;const t=[];for(const[r,n]of this._peerStore.metadataBook.data.entries()){if(this._listenRelays.has(r)||e.includes(r))continue;const i=n.get(HOP_METADATA_KEY);if(!i||uint8ArrayToString$u(i)!==HOP_METADATA_VALUE)continue;const s=PeerId$e.createFromB58String(r),o=this._connectionManager.get(s);if(o){if(await this._addListenRelay(o,r),this._listenRelays.size>=this.maxListeners)return}else t.push(s)}for(const e of t)if(await this._tryToListenOnRelay(e),this._listenRelays.size>=this.maxListeners)return;try{const e=await namespaceToCid$1(RELAY_RENDEZVOUS_NS$1);for await(const t of this._libp2p.contentRouting.findProviders(e)){if(!t.multiaddrs.length)continue;const e=t.id;if(this._peerStore.addressBook.add(e,t.multiaddrs),await this._tryToListenOnRelay(e),this._listenRelays.size>=this.maxListeners)return}}catch(e){this._onError(e)}}async _tryToListenOnRelay(e){try{const t=await this._libp2p.dial(e);await this._addListenRelay(t,e.toB58String())}catch(t){this._onError(t,`could not connect and listen on known hop relay ${e.toB58String()}`)}}}var autoRelay=AutoRelay$1;const debug$v=require$$0$b,log$q=Object.assign(debug$v("libp2p:relay"),{error:debug$v("libp2p:relay:err")}),{setDelayedInterval:setDelayedInterval,clearDelayedInterval:clearDelayedInterval}=src$m,AutoRelay=autoRelay,{namespaceToCid:namespaceToCid}=utils$s,{RELAY_RENDEZVOUS_NS:RELAY_RENDEZVOUS_NS}=constants$8;class Relay$1{constructor(e){this._libp2p=e,this._options={...e._config.relay},this._autoRelay=this._options.autoRelay.enabled&&new AutoRelay({libp2p:e,...this._options.autoRelay}),this._advertiseService=this._advertiseService.bind(this)}start(){this._options.hop.enabled&&this._options.advertise.enabled&&(this._timeout=setDelayedInterval(this._advertiseService,this._options.advertise.ttl,this._options.advertise.bootDelay))}stop(){clearDelayedInterval(this._timeout)}async _advertiseService(){try{const e=await namespaceToCid(RELAY_RENDEZVOUS_NS);await this._libp2p.contentRouting.provide(e)}catch(e){"NO_ROUTERS_AVAILABLE"===e.code?(log$q.error("a content router, such as a DHT, must be provided in order to advertise the relay service",e),this.stop()):log$q.error(e)}}}var circuit=Relay$1,anySignal$3={exports:{}};const{AbortController:AbortController$3}=src$n;function anySignal$2(e){const t=new AbortController$3;function r(){t.abort();for(const t of e)t&&t.removeEventListener&&t.removeEventListener("abort",r)}for(const t of e)if(t&&t.addEventListener){if(t.aborted){r();break}t.addEventListener("abort",r)}return t.signal}anySignal$3.exports=anySignal$2,anySignal$3.exports.anySignal=anySignal$2;const Fifo=fastFifo,defer=pDefer_1;var pFifo=class{constructor(){this._buffer=new Fifo,this._waitingConsumers=new Fifo}push(e){const{promise:t,resolve:r}=defer();return this._buffer.push({chunk:e,resolve:r}),this._consume(),t}_consume(){for(;!this._waitingConsumers.isEmpty()&&!this._buffer.isEmpty();){const e=this._waitingConsumers.shift(),t=this._buffer.shift();e.resolve(t.chunk),t.resolve()}}shift(){const{promise:e,resolve:t}=defer();return this._waitingConsumers.push({resolve:t}),this._consume(),e}isEmpty(){return this._buffer.isEmpty()}},pAny$1={exports:{}},pSome$2={exports:{}},indentString$1=(e,t=1,r)=>{if(r={indent:" ",includeEmptyLines:!1,...r},"string"!=typeof e)throw new TypeError(`Expected \`input\` to be a \`string\`, got \`${typeof e}\``);if("number"!=typeof t)throw new TypeError(`Expected \`count\` to be a \`number\`, got \`${typeof t}\``);if("string"!=typeof r.indent)throw new TypeError(`Expected \`options.indent\` to be a \`string\`, got \`${typeof r.indent}\``);if(0===t)return e;const n=r.includeEmptyLines?/^/gm:/^(?!\s*$)/gm;return e.replace(n,r.indent.repeat(t))},_endianness;function endianness(){if(void 0===_endianness){var e=new ArrayBuffer(2),t=new Uint8Array(e),r=new Uint16Array(e);if(t[0]=1,t[1]=2,258===r[0])_endianness="BE";else{if(513!==r[0])throw new Error("unable to figure out endianess");_endianness="LE"}}return _endianness}function hostname(){return void 0!==global$1.location?global$1.location.hostname:""}function loadavg(){return[]}function uptime(){return 0}function freemem(){return Number.MAX_VALUE}function totalmem(){return Number.MAX_VALUE}function cpus(){return[]}function type(){return"Browser"}function release(){return void 0!==global$1.navigator?global$1.navigator.appVersion:""}function networkInterfaces(){}function getNetworkInterfaces(){}function arch(){return"javascript"}function platform(){return"browser"}function tmpDir(){return"/tmp"}var tmpdir=tmpDir,EOL="\n",_polyfillNode_os={EOL:EOL,arch:arch,platform:platform,tmpdir:tmpdir,tmpDir:tmpDir,networkInterfaces:networkInterfaces,getNetworkInterfaces:getNetworkInterfaces,release:release,type:type,cpus:cpus,totalmem:totalmem,freemem:freemem,uptime:uptime,loadavg:loadavg,hostname:hostname,endianness:endianness},_polyfillNode_os$1=Object.freeze({__proto__:null,endianness:endianness,hostname:hostname,loadavg:loadavg,uptime:uptime,freemem:freemem,totalmem:totalmem,cpus:cpus,type:type,release:release,networkInterfaces:networkInterfaces,getNetworkInterfaces:getNetworkInterfaces,arch:arch,platform:platform,tmpDir:tmpDir,tmpdir:tmpdir,EOL:EOL,default:_polyfillNode_os}),require$$0$6=getAugmentedNamespace(_polyfillNode_os$1);const os=require$$0$6,extractPathRegex=/\s+at.*(?:\(|\s)(.*)\)?/,pathRegex=/^(?:(?:(?:node|(?:internal\/[\w/]*|.*node_modules\/(?:babel-polyfill|pirates)\/.*)?\w+)\.js:\d+:\d+)|native)/,homeDir=void 0===os.homedir?"":os.homedir();var cleanStack$1=(e,t)=>(t=Object.assign({pretty:!1},t),e.replace(/\\/g,"/").split("\n").filter((e=>{const t=e.match(extractPathRegex);if(null===t||!t[1])return!0;const r=t[1];return!r.includes(".app/Contents/Resources/electron.asar")&&!r.includes(".app/Contents/Resources/default_app.asar")&&!pathRegex.test(r)})).filter((e=>""!==e.trim())).map((e=>t.pretty?e.replace(extractPathRegex,((e,t)=>e.replace(t,t.replace(homeDir,"~")))):e)).join("\n"));const indentString=indentString$1,cleanStack=cleanStack$1,cleanInternalStack=e=>e.replace(/\s+at .*aggregate-error\/index.js:\d+:\d+\)?/g,"");class AggregateError$1 extends Error{constructor(e){if(!Array.isArray(e))throw new TypeError("Expected input to be an Array, got "+typeof e);let t=(e=[...e].map((e=>e instanceof Error?e:null!==e&&"object"==typeof e?Object.assign(new Error(e.message),e):new Error(e)))).map((e=>"string"==typeof e.stack?cleanInternalStack(cleanStack(e.stack)):String(e))).join("\n");t="\n"+indentString(t,4),super(t),this.name="AggregateError",Object.defineProperty(this,"_errors",{value:e})}*[Symbol.iterator](){for(const e of this._errors)yield e}}var aggregateError=AggregateError$1,pCancelable$1={exports:{}};class CancelError$1 extends Error{constructor(e){super(e||"Promise was canceled"),this.name="CancelError"}get isCanceled(){return!0}}class PCancelable$3{static fn(e){return(...t)=>new PCancelable$3(((r,n,i)=>{t.push(i),e(...t).then(r,n)}))}constructor(e){this._cancelHandlers=[],this._isPending=!0,this._isCanceled=!1,this._rejectOnCancel=!0,this._promise=new Promise(((t,r)=>{this._reject=r;const n=e=>{if(!this._isPending)throw new Error("The `onCancel` handler was attached after the promise settled.");this._cancelHandlers.push(e)};return Object.defineProperties(n,{shouldReject:{get:()=>this._rejectOnCancel,set:e=>{this._rejectOnCancel=e}}}),e((e=>{this._isCanceled&&n.shouldReject||(this._isPending=!1,t(e))}),(e=>{this._isPending=!1,r(e)}),n)}))}then(e,t){return this._promise.then(e,t)}catch(e){return this._promise.catch(e)}finally(e){return this._promise.finally(e)}cancel(e){if(this._isPending&&!this._isCanceled){if(this._isCanceled=!0,this._cancelHandlers.length>0)try{for(const e of this._cancelHandlers)e()}catch(e){return void this._reject(e)}this._rejectOnCancel&&this._reject(new CancelError$1(e))}}get isCanceled(){return this._isCanceled}}Object.setPrototypeOf(PCancelable$3.prototype,Promise.prototype),pCancelable$1.exports=PCancelable$3,pCancelable$1.exports.CancelError=CancelError$1;const AggregateError=aggregateError,PCancelable$2=pCancelable$1.exports;class FilterError extends Error{}const pSome$1=(e,t)=>new PCancelable$2(((r,n,i)=>{const{count:s,filter:o=(()=>!0)}=t;if(!Number.isFinite(s))return void n(new TypeError("Expected a finite number, got "+typeof t.count));const a=[],u=[];let c=0,l=!1;const h=new Set,d=()=>{for(const t of e)h.has(t)||"function"!=typeof t.cancel||t.cancel()};i(d);for(const t of e)c++,(async()=>{try{const e=await t;if(l)return;if(!o(e))throw new FilterError("Value does not satisfy filter");a.push(e)}catch(e){u.push(e)}finally{h.add(t),!l&&(a.length===s&&(r(a),l=!0),c-u.length<s&&(n(new AggregateError(u)),l=!0),l)&&d()}})();s>c&&(n(new RangeError(`Expected input to contain at least ${t.count} items, but contains ${c} items`)),d())}));pSome$2.exports=pSome$1,pSome$2.exports.AggregateError=AggregateError,pSome$2.exports.FilterError=FilterError;var pCancelable={exports:{}};class CancelError extends Error{constructor(e){super(e||"Promise was canceled"),this.name="CancelError"}get isCanceled(){return!0}}class PCancelable$1{static fn(e){return(...t)=>new PCancelable$1(((r,n,i)=>{t.push(i),e(...t).then(r,n)}))}constructor(e){this._cancelHandlers=[],this._isPending=!0,this._isCanceled=!1,this._rejectOnCancel=!0,this._promise=new Promise(((t,r)=>{this._reject=r;const n=e=>{if(!this._isPending)throw new Error("The `onCancel` handler was attached after the promise settled.");this._cancelHandlers.push(e)};return Object.defineProperties(n,{shouldReject:{get:()=>this._rejectOnCancel,set:e=>{this._rejectOnCancel=e}}}),e((e=>{this._isCanceled&&n.shouldReject||(this._isPending=!1,t(e))}),(e=>{this._isPending=!1,r(e)}),n)}))}then(e,t){return this._promise.then(e,t)}catch(e){return this._promise.catch(e)}finally(e){return this._promise.finally(e)}cancel(e){if(this._isPending&&!this._isCanceled){if(this._isCanceled=!0,this._cancelHandlers.length>0)try{for(const e of this._cancelHandlers)e()}catch(e){return void this._reject(e)}this._rejectOnCancel&&this._reject(new CancelError(e))}}get isCanceled(){return this._isCanceled}}Object.setPrototypeOf(PCancelable$1.prototype,Promise.prototype),pCancelable.exports=PCancelable$1,pCancelable.exports.CancelError=CancelError;const pSome=pSome$2.exports,PCancelable=pCancelable.exports;pAny$1.exports=(e,t)=>{const r=pSome(e,{...t,count:1});return PCancelable.fn((async e=>{e((()=>{r.cancel()}));const[t]=await r;return t}))()},pAny$1.exports.AggregateError=pSome.AggregateError;const errCode$b=errCode$m,AbortController$2=browser$7.exports.default,{anySignal:anySignal$1}=anySignal$3.exports,FIFO=pFifo,pAny=pAny$1.exports;class DialRequest$1{constructor({addrs:e,dialAction:t,dialer:r}){this.addrs=e,this.dialer=r,this.dialAction=t}async run(e={}){const t=this.dialer.getTokens(this.addrs.length);if(t.length<1)throw errCode$b(new Error("No dial tokens available"),"ERR_NO_DIAL_TOKENS");const r=new FIFO;t.forEach((e=>r.push(e)));const n=this.addrs.map((()=>new AbortController$2));let i=0;try{return await pAny(this.addrs.map((async(s,o)=>{const a=await r.shift();let u;try{const c=n[o].signal;u=await this.dialAction(s,{...e,signal:e.signal?anySignal$1([c,e.signal]):c}),n.splice(o,1)}finally{i++,this.addrs.length-i>=t.length?r.push(a):this.dialer.releaseToken(t.splice(t.indexOf(a),1)[0])}return u})))}finally{n.map((e=>e.abort())),t.forEach((e=>this.dialer.releaseToken(e)))}}}var dialRequest=DialRequest$1;const debug$u=require$$0$b,log$p=Object.assign(debug$u("libp2p:dialer"),{error:debug$u("libp2p:dialer:err")}),errCode$a=errCode$m,{Multiaddr:Multiaddr$a}=src$o,{TimeoutController:TimeoutController}=timeoutAbortController,{AbortError:AbortError$3}=abortableIterator.exports,{anySignal:anySignal}=anySignal$3.exports,DialRequest=dialRequest,{publicAddressesFirst:publicAddressesFirst}=addressSort,getPeer$1=getPeer_1,{codes:codes$5}=errors$4,{DIAL_TIMEOUT:DIAL_TIMEOUT,MAX_PARALLEL_DIALS:MAX_PARALLEL_DIALS,MAX_PER_PEER_DIALS:MAX_PER_PEER_DIALS,MAX_ADDRS_TO_DIAL:MAX_ADDRS_TO_DIAL}=constants$9;class Dialer$2{constructor({transportManager:e,peerStore:t,addressSorter:r=publicAddressesFirst,maxParallelDials:n=MAX_PARALLEL_DIALS,maxAddrsToDial:i=MAX_ADDRS_TO_DIAL,dialTimeout:s=DIAL_TIMEOUT,maxDialsPerPeer:o=MAX_PER_PEER_DIALS,resolvers:a={}}){this.transportManager=e,this.peerStore=t,this.addressSorter=r,this.maxParallelDials=n,this.maxAddrsToDial=i,this.timeout=s,this.maxDialsPerPeer=o,this.tokens=[...new Array(n)].map(((e,t)=>t)),this._pendingDials=new Map,this._pendingDialTargets=new Map;for(const[e,t]of Object.entries(a))Multiaddr$a.resolvers.set(e,t)}destroy(){for(const e of this._pendingDials.values())try{e.controller.abort()}catch(e){log$p.error(e)}this._pendingDials.clear();for(const e of this._pendingDialTargets.values())e.reject(new AbortError$3("Dialer was destroyed"));this._pendingDialTargets.clear()}async connectToPeer(e,t={}){const r=await this._createCancellableDialTarget(e);if(!r.addrs.length)throw errCode$a(new Error("The dial request has no valid addresses"),codes$5.ERR_NO_VALID_ADDRESSES);const n=this._pendingDials.get(r.id)||this._createPendingDial(r,t);try{const e=await n.promise;return log$p("dial succeeded to %s",r.id),e}catch(e){throw n.controller.signal.aborted&&(e.code=codes$5.ERR_TIMEOUT),log$p.error(e),e}finally{n.destroy()}}async _createCancellableDialTarget(e){const t=`${parseInt(String(1e9*Math.random()),10).toString()+Date.now()}`,r=new Promise(((e,r)=>{this._pendingDialTargets.set(t,{resolve:e,reject:r})})),n=await Promise.race([this._createDialTarget(e),r]);return this._pendingDialTargets.delete(t),n}async _createDialTarget(e){const{id:t,multiaddrs:r}=getPeer$1(e);r&&this.peerStore.addressBook.add(t,r);let n=this.peerStore.addressBook.getMultiaddrsForPeer(t,this.addressSorter)||[];Multiaddr$a.isMultiaddr(e)&&(n=n.filter((t=>!e.equals(t))),n.unshift(e));const i=[];for(const e of n){(await this._resolve(e)).forEach((e=>i.push(e)))}const s=i.filter((e=>this.transportManager.transportForMultiaddr(e)));if(s.length>this.maxAddrsToDial)throw this.peerStore.delete(t),errCode$a(new Error("dial with more addresses than allowed"),codes$5.ERR_TOO_MANY_ADDRESSES);return{id:t.toB58String(),addrs:s}}_createPendingDial(e,t={}){const r=new DialRequest({addrs:e.addrs,dialAction:(e,t)=>{if(t.signal.aborted)throw errCode$a(new Error("already aborted"),codes$5.ERR_ALREADY_ABORTED);return this.transportManager.dial(e,t)},dialer:this}),n=new TimeoutController(this.timeout),i=[n.signal];t.signal&&i.push(t.signal);const s=anySignal(i),o={dialRequest:r,controller:n,promise:r.run({...t,signal:s}),destroy:()=>{n.clear(),this._pendingDials.delete(e.id)}};return this._pendingDials.set(e.id,o),o}getTokens(e){const t=Math.min(e,this.maxDialsPerPeer,this.tokens.length),r=this.tokens.splice(0,t);return log$p("%d tokens request, returning %d, %d remaining",e,t,this.tokens.length),r}releaseToken(e){this.tokens.indexOf(e)>-1||(log$p("token %d released",e),this.tokens.push(e))}async _resolve(e){if(!e.protoNames().includes("dnsaddr"))return[e];const t=await this._resolveRecord(e);return(await Promise.all(t.map((e=>this._resolve(e))))).flat().reduce(((e,t)=>(e.find((e=>e.equals(t)))||e.push(t),e)),[])}async _resolveRecord(e){try{e=new Multiaddr$a(e.toString());return await e.resolve()}catch(t){return log$p.error(`multiaddr ${e} could not be resolved`),[]}}}var dialer=Dialer$2;function isHighSurrogate$1(e){return e>=55296&&e<=56319}function isLowSurrogate$1(e){return e>=56320&&e<=57343}var truncate$2=function(e,t,r){if("string"!=typeof t)throw new Error("Input must be string");for(var n,i,s=t.length,o=0,a=0;a<s;a+=1){if(n=t.charCodeAt(a),i=t[a],isHighSurrogate$1(n)&&isLowSurrogate$1(t.charCodeAt(a+1))&&(i+=t[a+=1]),(o+=e(i))===r)return t.slice(0,a+1);if(o>r)return t.slice(0,a-i.length+1)}return t};function isHighSurrogate(e){return e>=55296&&e<=56319}function isLowSurrogate(e){return e>=56320&&e<=57343}var browser$4=function(e){if("string"!=typeof e)throw new Error("Input must be string");for(var t=e.length,r=0,n=null,i=null,s=0;s<t;s++)isLowSurrogate(n=e.charCodeAt(s))?null!=i&&isHighSurrogate(i)?r+=1:r+=3:n<=127?r+=1:n>=128&&n<=2047?r+=2:n>=2048&&n<=65535&&(r+=3),i=n;return r},truncate$1=truncate$2,getLength$1=browser$4,browser$3=truncate$1.bind(null,getLength$1),truncate=browser$3,illegalRe=/[\/\?<>\\:\*\|"]/g,controlRe=/[\x00-\x1f\x80-\x9f]/g,reservedRe=/^\.+$/,windowsReservedRe=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,windowsTrailingRe=/[\. ]+$/;function sanitize$1(e,t){if("string"!=typeof e)throw new Error("Input must be string");var r=e.replace(illegalRe,t).replace(controlRe,t).replace(reservedRe,t).replace(windowsReservedRe,t).replace(windowsTrailingRe,t);return truncate(r,255)}var sanitizeFilename=function(e,t){var r=t&&t.replacement||"",n=sanitize$1(e,r);return""===r?n:sanitize$1(n,"")},src$g={},aes$3={};const forge$w=forge$X,{toString:uint8ArrayToString$t}=require$$1$5,{fromString:uint8ArrayFromString$q}=require$$3$1;var ciphersBrowser$1={createCipheriv:(e,t,r)=>{const n=forge$w.cipher.createCipher("AES-CTR",uint8ArrayToString$t(t,"ascii"));return n.start({iv:uint8ArrayToString$t(r,"ascii")}),{update:e=>(n.update(forge$w.util.createBuffer(uint8ArrayToString$t(e,"ascii"))),uint8ArrayFromString$q(n.output.getBytes(),"ascii"))}},createDecipheriv:(e,t,r)=>{const n=forge$w.cipher.createDecipher("AES-CTR",uint8ArrayToString$t(t,"ascii"));return n.start({iv:uint8ArrayToString$t(r,"ascii")}),{update:e=>(n.update(forge$w.util.createBuffer(uint8ArrayToString$t(e,"ascii"))),uint8ArrayFromString$q(n.output.getBytes(),"ascii"))}}};const errcode$X=errCode$m,CIPHER_MODES$1={16:"aes-128-ctr",32:"aes-256-ctr"};var cipherMode$3=function(e){const t=CIPHER_MODES$1[e.length];if(!t){const t=Object.entries(CIPHER_MODES$1).map((([e,t])=>`${e} (${t})`)).join(" / ");throw errcode$X(new Error(`Invalid key length ${e.length} bytes. Must be ${t}`),"ERR_INVALID_KEY_LENGTH")}return t};const ciphers$b=ciphersBrowser$1,cipherMode$2=cipherMode$3;aes$3.create=async function(e,t){const r=cipherMode$2(e),n=ciphers$b.createCipheriv(r,e,t),i=ciphers$b.createDecipheriv(r,e,t);return{encrypt:async e=>n.update(e),decrypt:async e=>i.update(e)}};const forgePbkdf2$1=require$$0$8,forgeUtil$1=require$$1$6,errcode$W=errCode$m,hashName$1={sha1:"sha1","sha2-256":"sha256","sha2-512":"sha512"};function pbkdf2$1(e,t,r,n,i){const s=hashName$1[i];if(!s){const e=Object.keys(hashName$1).join(" / ");throw errcode$W(new Error(`Hash '${i}' is unknown or not supported. Must be ${e}`),"ERR_UNSUPPORTED_HASH_TYPE")}const o=forgePbkdf2$1(e,t,r,n,s);return forgeUtil$1.encode64(o)}var pbkdf2_1$1=pbkdf2$1;const hmac$9=indexBrowser$5,aes$2=aes$3,keys$c=keys$d;src$g.aes=aes$2,src$g.hmac=hmac$9,src$g.keys=keys$c,src$g.randomBytes=randomBytes_1$5,src$g.pbkdf2=pbkdf2_1$1;let nanoid=(e=21)=>{let t="",r=crypto.getRandomValues(new Uint8Array(e));for(;e--;){let n=63&r[e];t+=n<36?n.toString(36):n<62?(n-26).toString(36).toUpperCase():n<63?"_":"-"}return t};const pathSepS="/",pathSepB=(new TextEncoder).encode(pathSepS),pathSep=pathSepB[0];class Key$2{constructor(e,t){if("string"==typeof e)this._buf=fromString$7(e);else{if(!(e instanceof Uint8Array))throw new Error("Invalid key, should be String of Uint8Array");this._buf=e}if(null==t&&(t=!0),t&&this.clean(),0===this._buf.byteLength||this._buf[0]!==pathSep)throw new Error("Invalid key")}toString(e="utf8"){return toString$3(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new Key$2(e.join(pathSepS))}static random(){return new Key$2(nanoid().replace(/-/g,""))}static asKey(e){return e instanceof Uint8Array||"string"==typeof e?new Key$2(e):e.uint8Array?new Key$2(e.uint8Array()):null}clean(){if(this._buf&&0!==this._buf.byteLength||(this._buf=pathSepB),this._buf[0]!==pathSep){const e=new Uint8Array(this._buf.byteLength+1);e.fill(pathSep,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===pathSep;)this._buf=this._buf.subarray(0,-1)}less(e){const t=this.list(),r=e.list();for(let e=0;e<t.length;e++){if(r.length<e+1)return!1;const n=t[e],i=r[e];if(n<i)return!0;if(n>i)return!1}return t.length<r.length}reverse(){return Key$2.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){const e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(pathSepS).slice(1)}type(){return namespaceType(this.baseNamespace())}name(){return namespaceValue(this.baseNamespace())}instance(e){return new Key$2(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(pathSepS)||(e+=pathSepS),e+=this.type(),new Key$2(e)}parent(){const e=this.list();return 1===e.length?new Key$2(pathSepS):new Key$2(e.slice(0,-1).join(pathSepS))}child(e){return this.toString()===pathSepS?e:e.toString()===pathSepS?this:new Key$2(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()!==this.toString()&&e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()!==this.toString()&&this.toString().startsWith(e.toString())}isTopLevel(){return 1===this.list().length}concat(...e){return Key$2.withNamespaces([...this.namespaces(),...flatten(e.map((e=>e.namespaces())))])}}function namespaceType(e){const t=e.split(":");return t.length<2?"":t.slice(0,-1).join(":")}function namespaceValue(e){const t=e.split(":");return t[t.length-1]}function flatten(e){return[].concat(...e)}var key$2=Object.freeze({__proto__:null,Key:Key$2}),require$$1$4=getAugmentedNamespace(key$2),forge$v=forge$X,asn1$3=forge$v.asn1,p7v=forge$v.pkcs7asn1=forge$v.pkcs7asn1||{};forge$v.pkcs7=forge$v.pkcs7||{},forge$v.pkcs7.asn1=p7v;var contentInfoValidator={name:"ContentInfo",tagClass:asn1$3.Class.UNIVERSAL,type:asn1$3.Type.SEQUENCE,constructed:!0,value:[{name:"ContentInfo.ContentType",tagClass:asn1$3.Class.UNIVERSAL,type:asn1$3.Type.OID,constructed:!1,capture:"contentType"},{name:"ContentInfo.content",tagClass:asn1$3.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,captureAsn1:"content"}]};p7v.contentInfoValidator=contentInfoValidator;var encryptedContentInfoValidator={name:"EncryptedContentInfo",tagClass:asn1$3.Class.UNIVERSAL,type:asn1$3.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentType",tagClass:asn1$3.Class.UNIVERSAL,type:asn1$3.Type.OID,constructed:!1,capture:"contentType"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm",tagClass:asn1$3.Class.UNIVERSAL,type:asn1$3.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentEncryptionAlgorithm.algorithm",tagClass:asn1$3.Class.UNIVERSAL,type:asn1$3.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm.parameter",tagClass:asn1$3.Class.UNIVERSAL,captureAsn1:"encParameter"}]},{name:"EncryptedContentInfo.encryptedContent",tagClass:asn1$3.Class.CONTEXT_SPECIFIC,type:0,capture:"encryptedContent",captureAsn1:"encryptedContentAsn1"}]};p7v.envelopedDataValidator={name:"EnvelopedData",tagClass:asn1$3.Class.UNIVERSAL,type:asn1$3.Type.SEQUENCE,constructed:!0,value:[{name:"EnvelopedData.Version",tagClass:asn1$3.Class.UNIVERSAL,type:asn1$3.Type.INTEGER,constructed:!1,capture:"version"},{name:"EnvelopedData.RecipientInfos",tagClass:asn1$3.Class.UNIVERSAL,type:asn1$3.Type.SET,constructed:!0,captureAsn1:"recipientInfos"}].concat(encryptedContentInfoValidator)},p7v.encryptedDataValidator={name:"EncryptedData",tagClass:asn1$3.Class.UNIVERSAL,type:asn1$3.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedData.Version",tagClass:asn1$3.Class.UNIVERSAL,type:asn1$3.Type.INTEGER,constructed:!1,capture:"version"}].concat(encryptedContentInfoValidator)};var signerValidator={name:"SignerInfo",tagClass:asn1$3.Class.UNIVERSAL,type:asn1$3.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.version",tagClass:asn1$3.Class.UNIVERSAL,type:asn1$3.Type.INTEGER,constructed:!1},{name:"SignerInfo.issuerAndSerialNumber",tagClass:asn1$3.Class.UNIVERSAL,type:asn1$3.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.issuerAndSerialNumber.issuer",tagClass:asn1$3.Class.UNIVERSAL,type:asn1$3.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"SignerInfo.issuerAndSerialNumber.serialNumber",tagClass:asn1$3.Class.UNIVERSAL,type:asn1$3.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"SignerInfo.digestAlgorithm",tagClass:asn1$3.Class.UNIVERSAL,type:asn1$3.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.digestAlgorithm.algorithm",tagClass:asn1$3.Class.UNIVERSAL,type:asn1$3.Type.OID,constructed:!1,capture:"digestAlgorithm"},{name:"SignerInfo.digestAlgorithm.parameter",tagClass:asn1$3.Class.UNIVERSAL,constructed:!1,captureAsn1:"digestParameter",optional:!0}]},{name:"SignerInfo.authenticatedAttributes",tagClass:asn1$3.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"authenticatedAttributes"},{name:"SignerInfo.digestEncryptionAlgorithm",tagClass:asn1$3.Class.UNIVERSAL,type:asn1$3.Type.SEQUENCE,constructed:!0,capture:"signatureAlgorithm"},{name:"SignerInfo.encryptedDigest",tagClass:asn1$3.Class.UNIVERSAL,type:asn1$3.Type.OCTETSTRING,constructed:!1,capture:"signature"},{name:"SignerInfo.unauthenticatedAttributes",tagClass:asn1$3.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,capture:"unauthenticatedAttributes"}]};p7v.signedDataValidator={name:"SignedData",tagClass:asn1$3.Class.UNIVERSAL,type:asn1$3.Type.SEQUENCE,constructed:!0,value:[{name:"SignedData.Version",tagClass:asn1$3.Class.UNIVERSAL,type:asn1$3.Type.INTEGER,constructed:!1,capture:"version"},{name:"SignedData.DigestAlgorithms",tagClass:asn1$3.Class.UNIVERSAL,type:asn1$3.Type.SET,constructed:!0,captureAsn1:"digestAlgorithms"},contentInfoValidator,{name:"SignedData.Certificates",tagClass:asn1$3.Class.CONTEXT_SPECIFIC,type:0,optional:!0,captureAsn1:"certificates"},{name:"SignedData.CertificateRevocationLists",tagClass:asn1$3.Class.CONTEXT_SPECIFIC,type:1,optional:!0,captureAsn1:"crls"},{name:"SignedData.SignerInfos",tagClass:asn1$3.Class.UNIVERSAL,type:asn1$3.Type.SET,capture:"signerInfos",optional:!0,value:[signerValidator]}]},p7v.recipientInfoValidator={name:"RecipientInfo",tagClass:asn1$3.Class.UNIVERSAL,type:asn1$3.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.version",tagClass:asn1$3.Class.UNIVERSAL,type:asn1$3.Type.INTEGER,constructed:!1,capture:"version"},{name:"RecipientInfo.issuerAndSerial",tagClass:asn1$3.Class.UNIVERSAL,type:asn1$3.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.issuerAndSerial.issuer",tagClass:asn1$3.Class.UNIVERSAL,type:asn1$3.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"RecipientInfo.issuerAndSerial.serialNumber",tagClass:asn1$3.Class.UNIVERSAL,type:asn1$3.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"RecipientInfo.keyEncryptionAlgorithm",tagClass:asn1$3.Class.UNIVERSAL,type:asn1$3.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.keyEncryptionAlgorithm.algorithm",tagClass:asn1$3.Class.UNIVERSAL,type:asn1$3.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"RecipientInfo.keyEncryptionAlgorithm.parameter",tagClass:asn1$3.Class.UNIVERSAL,constructed:!1,captureAsn1:"encParameter"}]},{name:"RecipientInfo.encryptedKey",tagClass:asn1$3.Class.UNIVERSAL,type:asn1$3.Type.OCTETSTRING,constructed:!1,capture:"encKey"}]};var forge$u=forge$X;forge$u.mgf=forge$u.mgf||{};var mgf1=forge$u.mgf.mgf1=forge$u.mgf1=forge$u.mgf1||{};mgf1.create=function(e){var t={generate:function(t,r){for(var n=new forge$u.util.ByteBuffer,i=Math.ceil(r/e.digestLength),s=0;s<i;s++){var o=new forge$u.util.ByteBuffer;o.putInt32(s),e.start(),e.update(t+o.getBytes()),n.putBuffer(e.digest())}return n.truncate(n.length()-r),n.getBytes()}};return t};var forge$t=forge$X;forge$t.mgf=forge$t.mgf||{},forge$t.mgf.mgf1=forge$t.mgf1;var forge$s=forge$X,pss=forge$s.pss=forge$s.pss||{};pss.create=function(e){3===arguments.length&&(e={md:arguments[0],mgf:arguments[1],saltLength:arguments[2]});var t,r=e.md,n=e.mgf,i=r.digestLength,s=e.salt||null;if("string"==typeof s&&(s=forge$s.util.createBuffer(s)),"saltLength"in e)t=e.saltLength;else{if(null===s)throw new Error("Salt length not specified or specific salt not given.");t=s.length()}if(null!==s&&s.length()!==t)throw new Error("Given salt length does not match length of given salt.");var o=e.prng||forge$s.random,a={encode:function(e,a){var u,c,l=a-1,h=Math.ceil(l/8),d=e.digest().getBytes();if(h<i+t+2)throw new Error("Message is too long to encrypt.");c=null===s?o.getBytesSync(t):s.bytes();var f=new forge$s.util.ByteBuffer;f.fillWithByte(0,8),f.putBytes(d),f.putBytes(c),r.start(),r.update(f.getBytes());var p=r.digest().getBytes(),y=new forge$s.util.ByteBuffer;y.fillWithByte(0,h-t-i-2),y.putByte(1),y.putBytes(c);var g=y.getBytes(),$=h-i-1,m=n.generate(p,$),b="";for(u=0;u<$;u++)b+=String.fromCharCode(g.charCodeAt(u)^m.charCodeAt(u));var v=65280>>8*h-l&255;return(b=String.fromCharCode(b.charCodeAt(0)&~v)+b.substr(1))+p+String.fromCharCode(188)},verify:function(e,s,o){var a,u=o-1,c=Math.ceil(u/8);if(s=s.substr(-c),c<i+t+2)throw new Error("Inconsistent parameters to PSS signature verification.");if(188!==s.charCodeAt(c-1))throw new Error("Encoded message does not end in 0xBC.");var l=c-i-1,h=s.substr(0,l),d=s.substr(l,i),f=65280>>8*c-u&255;if(0!=(h.charCodeAt(0)&f))throw new Error("Bits beyond keysize not zero as expected.");var p=n.generate(d,l),y="";for(a=0;a<l;a++)y+=String.fromCharCode(h.charCodeAt(a)^p.charCodeAt(a));y=String.fromCharCode(y.charCodeAt(0)&~f)+y.substr(1);var g=c-i-t-2;for(a=0;a<g;a++)if(0!==y.charCodeAt(a))throw new Error("Leftmost octets not zero as expected");if(1!==y.charCodeAt(g))throw new Error("Inconsistent PSS signature, 0x01 marker not found");var $=y.substr(-t),m=new forge$s.util.ByteBuffer;return m.fillWithByte(0,8),m.putBytes(e),m.putBytes($),r.start(),r.update(m.getBytes()),d===r.digest().getBytes()}};return a};var forge$r=forge$X,asn1$2=forge$r.asn1,pki$1=forge$r.pki=forge$r.pki||{},oids=pki$1.oids,_shortNames={};_shortNames.CN=oids.commonName,_shortNames.commonName="CN",_shortNames.C=oids.countryName,_shortNames.countryName="C",_shortNames.L=oids.localityName,_shortNames.localityName="L",_shortNames.ST=oids.stateOrProvinceName,_shortNames.stateOrProvinceName="ST",_shortNames.O=oids.organizationName,_shortNames.organizationName="O",_shortNames.OU=oids.organizationalUnitName,_shortNames.organizationalUnitName="OU",_shortNames.E=oids.emailAddress,_shortNames.emailAddress="E";var publicKeyValidator$1=forge$r.pki.rsa.publicKeyValidator,x509CertificateValidator={name:"Certificate",tagClass:asn1$2.Class.UNIVERSAL,type:asn1$2.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate",tagClass:asn1$2.Class.UNIVERSAL,type:asn1$2.Type.SEQUENCE,constructed:!0,captureAsn1:"tbsCertificate",value:[{name:"Certificate.TBSCertificate.version",tagClass:asn1$2.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.version.integer",tagClass:asn1$2.Class.UNIVERSAL,type:asn1$2.Type.INTEGER,constructed:!1,capture:"certVersion"}]},{name:"Certificate.TBSCertificate.serialNumber",tagClass:asn1$2.Class.UNIVERSAL,type:asn1$2.Type.INTEGER,constructed:!1,capture:"certSerialNumber"},{name:"Certificate.TBSCertificate.signature",tagClass:asn1$2.Class.UNIVERSAL,type:asn1$2.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.signature.algorithm",tagClass:asn1$2.Class.UNIVERSAL,type:asn1$2.Type.OID,constructed:!1,capture:"certinfoSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:asn1$2.Class.UNIVERSAL,optional:!0,captureAsn1:"certinfoSignatureParams"}]},{name:"Certificate.TBSCertificate.issuer",tagClass:asn1$2.Class.UNIVERSAL,type:asn1$2.Type.SEQUENCE,constructed:!0,captureAsn1:"certIssuer"},{name:"Certificate.TBSCertificate.validity",tagClass:asn1$2.Class.UNIVERSAL,type:asn1$2.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.validity.notBefore (utc)",tagClass:asn1$2.Class.UNIVERSAL,type:asn1$2.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity1UTCTime"},{name:"Certificate.TBSCertificate.validity.notBefore (generalized)",tagClass:asn1$2.Class.UNIVERSAL,type:asn1$2.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity2GeneralizedTime"},{name:"Certificate.TBSCertificate.validity.notAfter (utc)",tagClass:asn1$2.Class.UNIVERSAL,type:asn1$2.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity3UTCTime"},{name:"Certificate.TBSCertificate.validity.notAfter (generalized)",tagClass:asn1$2.Class.UNIVERSAL,type:asn1$2.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity4GeneralizedTime"}]},{name:"Certificate.TBSCertificate.subject",tagClass:asn1$2.Class.UNIVERSAL,type:asn1$2.Type.SEQUENCE,constructed:!0,captureAsn1:"certSubject"},publicKeyValidator$1,{name:"Certificate.TBSCertificate.issuerUniqueID",tagClass:asn1$2.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.issuerUniqueID.id",tagClass:asn1$2.Class.UNIVERSAL,type:asn1$2.Type.BITSTRING,constructed:!1,captureBitStringValue:"certIssuerUniqueId"}]},{name:"Certificate.TBSCertificate.subjectUniqueID",tagClass:asn1$2.Class.CONTEXT_SPECIFIC,type:2,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.subjectUniqueID.id",tagClass:asn1$2.Class.UNIVERSAL,type:asn1$2.Type.BITSTRING,constructed:!1,captureBitStringValue:"certSubjectUniqueId"}]},{name:"Certificate.TBSCertificate.extensions",tagClass:asn1$2.Class.CONTEXT_SPECIFIC,type:3,constructed:!0,captureAsn1:"certExtensions",optional:!0}]},{name:"Certificate.signatureAlgorithm",tagClass:asn1$2.Class.UNIVERSAL,type:asn1$2.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.signatureAlgorithm.algorithm",tagClass:asn1$2.Class.UNIVERSAL,type:asn1$2.Type.OID,constructed:!1,capture:"certSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:asn1$2.Class.UNIVERSAL,optional:!0,captureAsn1:"certSignatureParams"}]},{name:"Certificate.signatureValue",tagClass:asn1$2.Class.UNIVERSAL,type:asn1$2.Type.BITSTRING,constructed:!1,captureBitStringValue:"certSignature"}]},rsassaPssParameterValidator={name:"rsapss",tagClass:asn1$2.Class.UNIVERSAL,type:asn1$2.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.hashAlgorithm",tagClass:asn1$2.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier",tagClass:asn1$2.Class.UNIVERSAL,type:asn1$2.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier.algorithm",tagClass:asn1$2.Class.UNIVERSAL,type:asn1$2.Type.OID,constructed:!1,capture:"hashOid"}]}]},{name:"rsapss.maskGenAlgorithm",tagClass:asn1$2.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier",tagClass:asn1$2.Class.UNIVERSAL,type:asn1$2.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.algorithm",tagClass:asn1$2.Class.UNIVERSAL,type:asn1$2.Type.OID,constructed:!1,capture:"maskGenOid"},{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params",tagClass:asn1$2.Class.UNIVERSAL,type:asn1$2.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params.algorithm",tagClass:asn1$2.Class.UNIVERSAL,type:asn1$2.Type.OID,constructed:!1,capture:"maskGenHashOid"}]}]}]},{name:"rsapss.saltLength",tagClass:asn1$2.Class.CONTEXT_SPECIFIC,type:2,optional:!0,value:[{name:"rsapss.saltLength.saltLength",tagClass:asn1$2.Class.UNIVERSAL,type:asn1$2.Class.INTEGER,constructed:!1,capture:"saltLength"}]},{name:"rsapss.trailerField",tagClass:asn1$2.Class.CONTEXT_SPECIFIC,type:3,optional:!0,value:[{name:"rsapss.trailer.trailer",tagClass:asn1$2.Class.UNIVERSAL,type:asn1$2.Class.INTEGER,constructed:!1,capture:"trailer"}]}]},certificationRequestInfoValidator={name:"CertificationRequestInfo",tagClass:asn1$2.Class.UNIVERSAL,type:asn1$2.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfo",value:[{name:"CertificationRequestInfo.integer",tagClass:asn1$2.Class.UNIVERSAL,type:asn1$2.Type.INTEGER,constructed:!1,capture:"certificationRequestInfoVersion"},{name:"CertificationRequestInfo.subject",tagClass:asn1$2.Class.UNIVERSAL,type:asn1$2.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfoSubject"},publicKeyValidator$1,{name:"CertificationRequestInfo.attributes",tagClass:asn1$2.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"certificationRequestInfoAttributes",value:[{name:"CertificationRequestInfo.attributes",tagClass:asn1$2.Class.UNIVERSAL,type:asn1$2.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequestInfo.attributes.type",tagClass:asn1$2.Class.UNIVERSAL,type:asn1$2.Type.OID,constructed:!1},{name:"CertificationRequestInfo.attributes.value",tagClass:asn1$2.Class.UNIVERSAL,type:asn1$2.Type.SET,constructed:!0}]}]}]},certificationRequestValidator={name:"CertificationRequest",tagClass:asn1$2.Class.UNIVERSAL,type:asn1$2.Type.SEQUENCE,constructed:!0,captureAsn1:"csr",value:[certificationRequestInfoValidator,{name:"CertificationRequest.signatureAlgorithm",tagClass:asn1$2.Class.UNIVERSAL,type:asn1$2.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequest.signatureAlgorithm.algorithm",tagClass:asn1$2.Class.UNIVERSAL,type:asn1$2.Type.OID,constructed:!1,capture:"csrSignatureOid"},{name:"CertificationRequest.signatureAlgorithm.parameters",tagClass:asn1$2.Class.UNIVERSAL,optional:!0,captureAsn1:"csrSignatureParams"}]},{name:"CertificationRequest.signature",tagClass:asn1$2.Class.UNIVERSAL,type:asn1$2.Type.BITSTRING,constructed:!1,captureBitStringValue:"csrSignature"}]};function _getAttribute(e,t){"string"==typeof t&&(t={shortName:t});for(var r,n=null,i=0;null===n&&i<e.attributes.length;++i)r=e.attributes[i],(t.type&&t.type===r.type||t.name&&t.name===r.name||t.shortName&&t.shortName===r.shortName)&&(n=r);return n}pki$1.RDNAttributesAsArray=function(e,t){for(var r,n,i,s=[],o=0;o<e.value.length;++o){r=e.value[o];for(var a=0;a<r.value.length;++a)i={},n=r.value[a],i.type=asn1$2.derToOid(n.value[0].value),i.value=n.value[1].value,i.valueTagClass=n.value[1].type,i.type in oids&&(i.name=oids[i.type],i.name in _shortNames&&(i.shortName=_shortNames[i.name])),t&&(t.update(i.type),t.update(i.value)),s.push(i)}return s},pki$1.CRIAttributesAsArray=function(e){for(var t=[],r=0;r<e.length;++r)for(var n=e[r],i=asn1$2.derToOid(n.value[0].value),s=n.value[1].value,o=0;o<s.length;++o){var a={};if(a.type=i,a.value=s[o].value,a.valueTagClass=s[o].type,a.type in oids&&(a.name=oids[a.type],a.name in _shortNames&&(a.shortName=_shortNames[a.name])),a.type===oids.extensionRequest){a.extensions=[];for(var u=0;u<a.value.length;++u)a.extensions.push(pki$1.certificateExtensionFromAsn1(a.value[u]))}t.push(a)}return t};var _readSignatureParameters=function(e,t,r){var n={};if(e!==oids["RSASSA-PSS"])return n;r&&(n={hash:{algorithmOid:oids.sha1},mgf:{algorithmOid:oids.mgf1,hash:{algorithmOid:oids.sha1}},saltLength:20});var i={},s=[];if(!asn1$2.validate(t,rsassaPssParameterValidator,i,s)){var o=new Error("Cannot read RSASSA-PSS parameter block.");throw o.errors=s,o}return void 0!==i.hashOid&&(n.hash=n.hash||{},n.hash.algorithmOid=asn1$2.derToOid(i.hashOid)),void 0!==i.maskGenOid&&(n.mgf=n.mgf||{},n.mgf.algorithmOid=asn1$2.derToOid(i.maskGenOid),n.mgf.hash=n.mgf.hash||{},n.mgf.hash.algorithmOid=asn1$2.derToOid(i.maskGenHashOid)),void 0!==i.saltLength&&(n.saltLength=i.saltLength.charCodeAt(0)),n};function _dnToAsn1(e){for(var t,r,n=asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.SEQUENCE,!0,[]),i=e.attributes,s=0;s<i.length;++s){var o=(t=i[s]).value,a=asn1$2.Type.PRINTABLESTRING;"valueTagClass"in t&&(a=t.valueTagClass)===asn1$2.Type.UTF8&&(o=forge$r.util.encodeUtf8(o)),r=asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.SET,!0,[asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.SEQUENCE,!0,[asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.OID,!1,asn1$2.oidToDer(t.type).getBytes()),asn1$2.create(asn1$2.Class.UNIVERSAL,a,!1,o)])]),n.value.push(r)}return n}function _fillMissingFields(e){for(var t,r=0;r<e.length;++r){if(void 0===(t=e[r]).name&&(t.type&&t.type in pki$1.oids?t.name=pki$1.oids[t.type]:t.shortName&&t.shortName in _shortNames&&(t.name=pki$1.oids[_shortNames[t.shortName]])),void 0===t.type){if(!t.name||!(t.name in pki$1.oids))throw(i=new Error("Attribute type not specified.")).attribute=t,i;t.type=pki$1.oids[t.name]}if(void 0===t.shortName&&t.name&&t.name in _shortNames&&(t.shortName=_shortNames[t.name]),t.type===oids.extensionRequest&&(t.valueConstructed=!0,t.valueTagClass=asn1$2.Type.SEQUENCE,!t.value&&t.extensions)){t.value=[];for(var n=0;n<t.extensions.length;++n)t.value.push(pki$1.certificateExtensionToAsn1(_fillMissingExtensionFields(t.extensions[n])))}var i;if(void 0===t.value)throw(i=new Error("Attribute value not specified.")).attribute=t,i}}function _fillMissingExtensionFields(e,t){if(t=t||{},void 0===e.name&&e.id&&e.id in pki$1.oids&&(e.name=pki$1.oids[e.id]),void 0===e.id){if(!e.name||!(e.name in pki$1.oids))throw(g=new Error("Extension ID not specified.")).extension=e,g;e.id=pki$1.oids[e.name]}if(void 0!==e.value)return e;if("keyUsage"===e.name){var r=0,n=0,i=0;e.digitalSignature&&(n|=128,r=7),e.nonRepudiation&&(n|=64,r=6),e.keyEncipherment&&(n|=32,r=5),e.dataEncipherment&&(n|=16,r=4),e.keyAgreement&&(n|=8,r=3),e.keyCertSign&&(n|=4,r=2),e.cRLSign&&(n|=2,r=1),e.encipherOnly&&(n|=1,r=0),e.decipherOnly&&(i|=128,r=7);var s=String.fromCharCode(r);0!==i?s+=String.fromCharCode(n)+String.fromCharCode(i):0!==n&&(s+=String.fromCharCode(n)),e.value=asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.BITSTRING,!1,s)}else if("basicConstraints"===e.name)e.value=asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.SEQUENCE,!0,[]),e.cA&&e.value.value.push(asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.BOOLEAN,!1,String.fromCharCode(255))),"pathLenConstraint"in e&&e.value.value.push(asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.INTEGER,!1,asn1$2.integerToDer(e.pathLenConstraint).getBytes()));else if("extKeyUsage"===e.name){e.value=asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.SEQUENCE,!0,[]);var o=e.value.value;for(var a in e)!0===e[a]&&(a in oids?o.push(asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.OID,!1,asn1$2.oidToDer(oids[a]).getBytes())):-1!==a.indexOf(".")&&o.push(asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.OID,!1,asn1$2.oidToDer(a).getBytes())))}else if("nsCertType"===e.name){r=0,n=0;e.client&&(n|=128,r=7),e.server&&(n|=64,r=6),e.email&&(n|=32,r=5),e.objsign&&(n|=16,r=4),e.reserved&&(n|=8,r=3),e.sslCA&&(n|=4,r=2),e.emailCA&&(n|=2,r=1),e.objCA&&(n|=1,r=0);s=String.fromCharCode(r);0!==n&&(s+=String.fromCharCode(n)),e.value=asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.BITSTRING,!1,s)}else if("subjectAltName"===e.name||"issuerAltName"===e.name){e.value=asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.SEQUENCE,!0,[]);for(var u=0;u<e.altNames.length;++u){s=(f=e.altNames[u]).value;if(7===f.type&&f.ip){if(null===(s=forge$r.util.bytesFromIP(f.ip)))throw(g=new Error('Extension "ip" value is not a valid IPv4 or IPv6 address.')).extension=e,g}else 8===f.type&&(s=f.oid?asn1$2.oidToDer(asn1$2.oidToDer(f.oid)):asn1$2.oidToDer(s));e.value.value.push(asn1$2.create(asn1$2.Class.CONTEXT_SPECIFIC,f.type,!1,s))}}else if("nsComment"===e.name&&t.cert){if(!/^[\x00-\x7F]*$/.test(e.comment)||e.comment.length<1||e.comment.length>128)throw new Error('Invalid "nsComment" content.');e.value=asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.IA5STRING,!1,e.comment)}else if("subjectKeyIdentifier"===e.name&&t.cert){var c=t.cert.generateSubjectKeyIdentifier();e.subjectKeyIdentifier=c.toHex(),e.value=asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.OCTETSTRING,!1,c.getBytes())}else if("authorityKeyIdentifier"===e.name&&t.cert){e.value=asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.SEQUENCE,!0,[]);o=e.value.value;if(e.keyIdentifier){var l=!0===e.keyIdentifier?t.cert.generateSubjectKeyIdentifier().getBytes():e.keyIdentifier;o.push(asn1$2.create(asn1$2.Class.CONTEXT_SPECIFIC,0,!1,l))}if(e.authorityCertIssuer){var h=[asn1$2.create(asn1$2.Class.CONTEXT_SPECIFIC,4,!0,[_dnToAsn1(!0===e.authorityCertIssuer?t.cert.issuer:e.authorityCertIssuer)])];o.push(asn1$2.create(asn1$2.Class.CONTEXT_SPECIFIC,1,!0,h))}if(e.serialNumber){var d=forge$r.util.hexToBytes(!0===e.serialNumber?t.cert.serialNumber:e.serialNumber);o.push(asn1$2.create(asn1$2.Class.CONTEXT_SPECIFIC,2,!1,d))}}else if("cRLDistributionPoints"===e.name){e.value=asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.SEQUENCE,!0,[]);o=e.value.value;var f,p=asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.SEQUENCE,!0,[]),y=asn1$2.create(asn1$2.Class.CONTEXT_SPECIFIC,0,!0,[]);for(u=0;u<e.altNames.length;++u){s=(f=e.altNames[u]).value;if(7===f.type&&f.ip){if(null===(s=forge$r.util.bytesFromIP(f.ip)))throw(g=new Error('Extension "ip" value is not a valid IPv4 or IPv6 address.')).extension=e,g}else 8===f.type&&(s=f.oid?asn1$2.oidToDer(asn1$2.oidToDer(f.oid)):asn1$2.oidToDer(s));y.value.push(asn1$2.create(asn1$2.Class.CONTEXT_SPECIFIC,f.type,!1,s))}p.value.push(asn1$2.create(asn1$2.Class.CONTEXT_SPECIFIC,0,!0,[y])),o.push(p)}var g;if(void 0===e.value)throw(g=new Error("Extension value not specified.")).extension=e,g;return e}function _signatureParametersToAsn1(e,t){if(e===oids["RSASSA-PSS"]){var r=[];return void 0!==t.hash.algorithmOid&&r.push(asn1$2.create(asn1$2.Class.CONTEXT_SPECIFIC,0,!0,[asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.SEQUENCE,!0,[asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.OID,!1,asn1$2.oidToDer(t.hash.algorithmOid).getBytes()),asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.NULL,!1,"")])])),void 0!==t.mgf.algorithmOid&&r.push(asn1$2.create(asn1$2.Class.CONTEXT_SPECIFIC,1,!0,[asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.SEQUENCE,!0,[asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.OID,!1,asn1$2.oidToDer(t.mgf.algorithmOid).getBytes()),asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.SEQUENCE,!0,[asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.OID,!1,asn1$2.oidToDer(t.mgf.hash.algorithmOid).getBytes()),asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.NULL,!1,"")])])])),void 0!==t.saltLength&&r.push(asn1$2.create(asn1$2.Class.CONTEXT_SPECIFIC,2,!0,[asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.INTEGER,!1,asn1$2.integerToDer(t.saltLength).getBytes())])),asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.SEQUENCE,!0,r)}return asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.NULL,!1,"")}function _CRIAttributesToAsn1(e){var t=asn1$2.create(asn1$2.Class.CONTEXT_SPECIFIC,0,!0,[]);if(0===e.attributes.length)return t;for(var r=e.attributes,n=0;n<r.length;++n){var i=r[n],s=i.value,o=asn1$2.Type.UTF8;"valueTagClass"in i&&(o=i.valueTagClass),o===asn1$2.Type.UTF8&&(s=forge$r.util.encodeUtf8(s));var a=!1;"valueConstructed"in i&&(a=i.valueConstructed);var u=asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.SEQUENCE,!0,[asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.OID,!1,asn1$2.oidToDer(i.type).getBytes()),asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.SET,!0,[asn1$2.create(asn1$2.Class.UNIVERSAL,o,a,s)])]);t.value.push(u)}return t}pki$1.certificateFromPem=function(e,t,r){var n=forge$r.pem.decode(e)[0];if("CERTIFICATE"!==n.type&&"X509 CERTIFICATE"!==n.type&&"TRUSTED CERTIFICATE"!==n.type){var i=new Error('Could not convert certificate from PEM; PEM header type is not "CERTIFICATE", "X509 CERTIFICATE", or "TRUSTED CERTIFICATE".');throw i.headerType=n.type,i}if(n.procType&&"ENCRYPTED"===n.procType.type)throw new Error("Could not convert certificate from PEM; PEM is encrypted.");var s=asn1$2.fromDer(n.body,r);return pki$1.certificateFromAsn1(s,t)},pki$1.certificateToPem=function(e,t){var r={type:"CERTIFICATE",body:asn1$2.toDer(pki$1.certificateToAsn1(e)).getBytes()};return forge$r.pem.encode(r,{maxline:t})},pki$1.publicKeyFromPem=function(e){var t=forge$r.pem.decode(e)[0];if("PUBLIC KEY"!==t.type&&"RSA PUBLIC KEY"!==t.type){var r=new Error('Could not convert public key from PEM; PEM header type is not "PUBLIC KEY" or "RSA PUBLIC KEY".');throw r.headerType=t.type,r}if(t.procType&&"ENCRYPTED"===t.procType.type)throw new Error("Could not convert public key from PEM; PEM is encrypted.");var n=asn1$2.fromDer(t.body);return pki$1.publicKeyFromAsn1(n)},pki$1.publicKeyToPem=function(e,t){var r={type:"PUBLIC KEY",body:asn1$2.toDer(pki$1.publicKeyToAsn1(e)).getBytes()};return forge$r.pem.encode(r,{maxline:t})},pki$1.publicKeyToRSAPublicKeyPem=function(e,t){var r={type:"RSA PUBLIC KEY",body:asn1$2.toDer(pki$1.publicKeyToRSAPublicKey(e)).getBytes()};return forge$r.pem.encode(r,{maxline:t})},pki$1.getPublicKeyFingerprint=function(e,t){var r,n=(t=t||{}).md||forge$r.md.sha1.create();switch(t.type||"RSAPublicKey"){case"RSAPublicKey":r=asn1$2.toDer(pki$1.publicKeyToRSAPublicKey(e)).getBytes();break;case"SubjectPublicKeyInfo":r=asn1$2.toDer(pki$1.publicKeyToAsn1(e)).getBytes();break;default:throw new Error('Unknown fingerprint type "'+t.type+'".')}n.start(),n.update(r);var i=n.digest();if("hex"===t.encoding){var s=i.toHex();return t.delimiter?s.match(/.{2}/g).join(t.delimiter):s}if("binary"===t.encoding)return i.getBytes();if(t.encoding)throw new Error('Unknown encoding "'+t.encoding+'".');return i},pki$1.certificationRequestFromPem=function(e,t,r){var n=forge$r.pem.decode(e)[0];if("CERTIFICATE REQUEST"!==n.type){var i=new Error('Could not convert certification request from PEM; PEM header type is not "CERTIFICATE REQUEST".');throw i.headerType=n.type,i}if(n.procType&&"ENCRYPTED"===n.procType.type)throw new Error("Could not convert certification request from PEM; PEM is encrypted.");var s=asn1$2.fromDer(n.body,r);return pki$1.certificationRequestFromAsn1(s,t)},pki$1.certificationRequestToPem=function(e,t){var r={type:"CERTIFICATE REQUEST",body:asn1$2.toDer(pki$1.certificationRequestToAsn1(e)).getBytes()};return forge$r.pem.encode(r,{maxline:t})},pki$1.createCertificate=function(){var e={version:2,serialNumber:"00",signatureOid:null,signature:null,siginfo:{}};return e.siginfo.algorithmOid=null,e.validity={},e.validity.notBefore=new Date,e.validity.notAfter=new Date,e.issuer={},e.issuer.getField=function(t){return _getAttribute(e.issuer,t)},e.issuer.addField=function(t){_fillMissingFields([t]),e.issuer.attributes.push(t)},e.issuer.attributes=[],e.issuer.hash=null,e.subject={},e.subject.getField=function(t){return _getAttribute(e.subject,t)},e.subject.addField=function(t){_fillMissingFields([t]),e.subject.attributes.push(t)},e.subject.attributes=[],e.subject.hash=null,e.extensions=[],e.publicKey=null,e.md=null,e.setSubject=function(t,r){_fillMissingFields(t),e.subject.attributes=t,delete e.subject.uniqueId,r&&(e.subject.uniqueId=r),e.subject.hash=null},e.setIssuer=function(t,r){_fillMissingFields(t),e.issuer.attributes=t,delete e.issuer.uniqueId,r&&(e.issuer.uniqueId=r),e.issuer.hash=null},e.setExtensions=function(t){for(var r=0;r<t.length;++r)_fillMissingExtensionFields(t[r],{cert:e});e.extensions=t},e.getExtension=function(t){"string"==typeof t&&(t={name:t});for(var r,n=null,i=0;null===n&&i<e.extensions.length;++i)r=e.extensions[i],(t.id&&r.id===t.id||t.name&&r.name===t.name)&&(n=r);return n},e.sign=function(t,r){e.md=r||forge$r.md.sha1.create();var n=oids[e.md.algorithm+"WithRSAEncryption"];if(!n){var i=new Error("Could not compute certificate digest. Unknown message digest algorithm OID.");throw i.algorithm=e.md.algorithm,i}e.signatureOid=e.siginfo.algorithmOid=n,e.tbsCertificate=pki$1.getTBSCertificate(e);var s=asn1$2.toDer(e.tbsCertificate);e.md.update(s.getBytes()),e.signature=t.sign(e.md)},e.verify=function(t){var r=!1;if(!e.issued(t)){var n=t.issuer,i=e.subject;throw(h=new Error("The parent certificate did not issue the given child certificate; the child certificate's issuer does not match the parent's subject.")).expectedIssuer=n.attributes,h.actualIssuer=i.attributes,h}var s=t.md;if(null===s){if(t.signatureOid in oids)switch(oids[t.signatureOid]){case"sha1WithRSAEncryption":s=forge$r.md.sha1.create();break;case"md5WithRSAEncryption":s=forge$r.md.md5.create();break;case"sha256WithRSAEncryption":case"RSASSA-PSS":s=forge$r.md.sha256.create();break;case"sha384WithRSAEncryption":s=forge$r.md.sha384.create();break;case"sha512WithRSAEncryption":s=forge$r.md.sha512.create()}if(null===s)throw(h=new Error("Could not compute certificate digest. Unknown signature OID.")).signatureOid=t.signatureOid,h;var o=t.tbsCertificate||pki$1.getTBSCertificate(t),a=asn1$2.toDer(o);s.update(a.getBytes())}if(null!==s){var u;switch(t.signatureOid){case oids.sha1WithRSAEncryption:u=void 0;break;case oids["RSASSA-PSS"]:var c,l,h;if(void 0===(c=oids[t.signatureParameters.mgf.hash.algorithmOid])||void 0===forge$r.md[c])throw(h=new Error("Unsupported MGF hash function.")).oid=t.signatureParameters.mgf.hash.algorithmOid,h.name=c,h;if(void 0===(l=oids[t.signatureParameters.mgf.algorithmOid])||void 0===forge$r.mgf[l])throw(h=new Error("Unsupported MGF function.")).oid=t.signatureParameters.mgf.algorithmOid,h.name=l,h;if(l=forge$r.mgf[l].create(forge$r.md[c].create()),void 0===(c=oids[t.signatureParameters.hash.algorithmOid])||void 0===forge$r.md[c])throw{message:"Unsupported RSASSA-PSS hash function.",oid:t.signatureParameters.hash.algorithmOid,name:c};u=forge$r.pss.create(forge$r.md[c].create(),l,t.signatureParameters.saltLength)}r=e.publicKey.verify(s.digest().getBytes(),t.signature,u)}return r},e.isIssuer=function(t){var r=!1,n=e.issuer,i=t.subject;if(n.hash&&i.hash)r=n.hash===i.hash;else if(n.attributes.length===i.attributes.length){var s,o;r=!0;for(var a=0;r&&a<n.attributes.length;++a)s=n.attributes[a],o=i.attributes[a],s.type===o.type&&s.value===o.value||(r=!1)}return r},e.issued=function(t){return t.isIssuer(e)},e.generateSubjectKeyIdentifier=function(){return pki$1.getPublicKeyFingerprint(e.publicKey,{type:"RSAPublicKey"})},e.verifySubjectKeyIdentifier=function(){for(var t=oids.subjectKeyIdentifier,r=0;r<e.extensions.length;++r){var n=e.extensions[r];if(n.id===t){var i=e.generateSubjectKeyIdentifier().getBytes();return forge$r.util.hexToBytes(n.subjectKeyIdentifier)===i}}return!1},e},pki$1.certificateFromAsn1=function(e,t){var r={},n=[];if(!asn1$2.validate(e,x509CertificateValidator,r,n))throw(a=new Error("Cannot read X.509 certificate. ASN.1 object is not an X509v3 Certificate.")).errors=n,a;if(asn1$2.derToOid(r.publicKeyOid)!==pki$1.oids.rsaEncryption)throw new Error("Cannot read public key. OID is not RSA.");var i=pki$1.createCertificate();i.version=r.certVersion?r.certVersion.charCodeAt(0):0;var s=forge$r.util.createBuffer(r.certSerialNumber);i.serialNumber=s.toHex(),i.signatureOid=forge$r.asn1.derToOid(r.certSignatureOid),i.signatureParameters=_readSignatureParameters(i.signatureOid,r.certSignatureParams,!0),i.siginfo.algorithmOid=forge$r.asn1.derToOid(r.certinfoSignatureOid),i.siginfo.parameters=_readSignatureParameters(i.siginfo.algorithmOid,r.certinfoSignatureParams,!1),i.signature=r.certSignature;var o=[];if(void 0!==r.certValidity1UTCTime&&o.push(asn1$2.utcTimeToDate(r.certValidity1UTCTime)),void 0!==r.certValidity2GeneralizedTime&&o.push(asn1$2.generalizedTimeToDate(r.certValidity2GeneralizedTime)),void 0!==r.certValidity3UTCTime&&o.push(asn1$2.utcTimeToDate(r.certValidity3UTCTime)),void 0!==r.certValidity4GeneralizedTime&&o.push(asn1$2.generalizedTimeToDate(r.certValidity4GeneralizedTime)),o.length>2)throw new Error("Cannot read notBefore/notAfter validity times; more than two times were provided in the certificate.");if(o.length<2)throw new Error("Cannot read notBefore/notAfter validity times; they were not provided as either UTCTime or GeneralizedTime.");if(i.validity.notBefore=o[0],i.validity.notAfter=o[1],i.tbsCertificate=r.tbsCertificate,t){var a;if(i.md=null,i.signatureOid in oids)switch(oids[i.signatureOid]){case"sha1WithRSAEncryption":i.md=forge$r.md.sha1.create();break;case"md5WithRSAEncryption":i.md=forge$r.md.md5.create();break;case"sha256WithRSAEncryption":case"RSASSA-PSS":i.md=forge$r.md.sha256.create();break;case"sha384WithRSAEncryption":i.md=forge$r.md.sha384.create();break;case"sha512WithRSAEncryption":i.md=forge$r.md.sha512.create()}if(null===i.md)throw(a=new Error("Could not compute certificate digest. Unknown signature OID.")).signatureOid=i.signatureOid,a;var u=asn1$2.toDer(i.tbsCertificate);i.md.update(u.getBytes())}var c=forge$r.md.sha1.create();i.issuer.getField=function(e){return _getAttribute(i.issuer,e)},i.issuer.addField=function(e){_fillMissingFields([e]),i.issuer.attributes.push(e)},i.issuer.attributes=pki$1.RDNAttributesAsArray(r.certIssuer,c),r.certIssuerUniqueId&&(i.issuer.uniqueId=r.certIssuerUniqueId),i.issuer.hash=c.digest().toHex();var l=forge$r.md.sha1.create();return i.subject.getField=function(e){return _getAttribute(i.subject,e)},i.subject.addField=function(e){_fillMissingFields([e]),i.subject.attributes.push(e)},i.subject.attributes=pki$1.RDNAttributesAsArray(r.certSubject,l),r.certSubjectUniqueId&&(i.subject.uniqueId=r.certSubjectUniqueId),i.subject.hash=l.digest().toHex(),r.certExtensions?i.extensions=pki$1.certificateExtensionsFromAsn1(r.certExtensions):i.extensions=[],i.publicKey=pki$1.publicKeyFromAsn1(r.subjectPublicKeyInfo),i},pki$1.certificateExtensionsFromAsn1=function(e){for(var t=[],r=0;r<e.value.length;++r)for(var n=e.value[r],i=0;i<n.value.length;++i)t.push(pki$1.certificateExtensionFromAsn1(n.value[i]));return t},pki$1.certificateExtensionFromAsn1=function(e){var t={};if(t.id=asn1$2.derToOid(e.value[0].value),t.critical=!1,e.value[1].type===asn1$2.Type.BOOLEAN?(t.critical=0!==e.value[1].value.charCodeAt(0),t.value=e.value[2].value):t.value=e.value[1].value,t.id in oids)if(t.name=oids[t.id],"keyUsage"===t.name){var r=0,n=0;(s=asn1$2.fromDer(t.value)).value.length>1&&(r=s.value.charCodeAt(1),n=s.value.length>2?s.value.charCodeAt(2):0),t.digitalSignature=128==(128&r),t.nonRepudiation=64==(64&r),t.keyEncipherment=32==(32&r),t.dataEncipherment=16==(16&r),t.keyAgreement=8==(8&r),t.keyCertSign=4==(4&r),t.cRLSign=2==(2&r),t.encipherOnly=1==(1&r),t.decipherOnly=128==(128&n)}else if("basicConstraints"===t.name){(s=asn1$2.fromDer(t.value)).value.length>0&&s.value[0].type===asn1$2.Type.BOOLEAN?t.cA=0!==s.value[0].value.charCodeAt(0):t.cA=!1;var i=null;s.value.length>0&&s.value[0].type===asn1$2.Type.INTEGER?i=s.value[0].value:s.value.length>1&&(i=s.value[1].value),null!==i&&(t.pathLenConstraint=asn1$2.derToInteger(i))}else if("extKeyUsage"===t.name)for(var s=asn1$2.fromDer(t.value),o=0;o<s.value.length;++o){var a=asn1$2.derToOid(s.value[o].value);a in oids?t[oids[a]]=!0:t[a]=!0}else if("nsCertType"===t.name){r=0;(s=asn1$2.fromDer(t.value)).value.length>1&&(r=s.value.charCodeAt(1)),t.client=128==(128&r),t.server=64==(64&r),t.email=32==(32&r),t.objsign=16==(16&r),t.reserved=8==(8&r),t.sslCA=4==(4&r),t.emailCA=2==(2&r),t.objCA=1==(1&r)}else if("subjectAltName"===t.name||"issuerAltName"===t.name){var u;t.altNames=[];s=asn1$2.fromDer(t.value);for(var c=0;c<s.value.length;++c){var l={type:(u=s.value[c]).type,value:u.value};switch(t.altNames.push(l),u.type){case 1:case 2:case 6:break;case 7:l.ip=forge$r.util.bytesToIP(u.value);break;case 8:l.oid=asn1$2.derToOid(u.value)}}}else if("subjectKeyIdentifier"===t.name){s=asn1$2.fromDer(t.value);t.subjectKeyIdentifier=forge$r.util.bytesToHex(s.value)}return t},pki$1.certificationRequestFromAsn1=function(e,t){var r={},n=[];if(!asn1$2.validate(e,certificationRequestValidator,r,n))throw(s=new Error("Cannot read PKCS#10 certificate request. ASN.1 object is not a PKCS#10 CertificationRequest.")).errors=n,s;if(asn1$2.derToOid(r.publicKeyOid)!==pki$1.oids.rsaEncryption)throw new Error("Cannot read public key. OID is not RSA.");var i=pki$1.createCertificationRequest();if(i.version=r.csrVersion?r.csrVersion.charCodeAt(0):0,i.signatureOid=forge$r.asn1.derToOid(r.csrSignatureOid),i.signatureParameters=_readSignatureParameters(i.signatureOid,r.csrSignatureParams,!0),i.siginfo.algorithmOid=forge$r.asn1.derToOid(r.csrSignatureOid),i.siginfo.parameters=_readSignatureParameters(i.siginfo.algorithmOid,r.csrSignatureParams,!1),i.signature=r.csrSignature,i.certificationRequestInfo=r.certificationRequestInfo,t){var s;if(i.md=null,i.signatureOid in oids)switch(oids[i.signatureOid]){case"sha1WithRSAEncryption":i.md=forge$r.md.sha1.create();break;case"md5WithRSAEncryption":i.md=forge$r.md.md5.create();break;case"sha256WithRSAEncryption":case"RSASSA-PSS":i.md=forge$r.md.sha256.create();break;case"sha384WithRSAEncryption":i.md=forge$r.md.sha384.create();break;case"sha512WithRSAEncryption":i.md=forge$r.md.sha512.create()}if(null===i.md)throw(s=new Error("Could not compute certification request digest. Unknown signature OID.")).signatureOid=i.signatureOid,s;var o=asn1$2.toDer(i.certificationRequestInfo);i.md.update(o.getBytes())}var a=forge$r.md.sha1.create();return i.subject.getField=function(e){return _getAttribute(i.subject,e)},i.subject.addField=function(e){_fillMissingFields([e]),i.subject.attributes.push(e)},i.subject.attributes=pki$1.RDNAttributesAsArray(r.certificationRequestInfoSubject,a),i.subject.hash=a.digest().toHex(),i.publicKey=pki$1.publicKeyFromAsn1(r.subjectPublicKeyInfo),i.getAttribute=function(e){return _getAttribute(i,e)},i.addAttribute=function(e){_fillMissingFields([e]),i.attributes.push(e)},i.attributes=pki$1.CRIAttributesAsArray(r.certificationRequestInfoAttributes||[]),i},pki$1.createCertificationRequest=function(){var e={version:0,signatureOid:null,signature:null,siginfo:{}};return e.siginfo.algorithmOid=null,e.subject={},e.subject.getField=function(t){return _getAttribute(e.subject,t)},e.subject.addField=function(t){_fillMissingFields([t]),e.subject.attributes.push(t)},e.subject.attributes=[],e.subject.hash=null,e.publicKey=null,e.attributes=[],e.getAttribute=function(t){return _getAttribute(e,t)},e.addAttribute=function(t){_fillMissingFields([t]),e.attributes.push(t)},e.md=null,e.setSubject=function(t){_fillMissingFields(t),e.subject.attributes=t,e.subject.hash=null},e.setAttributes=function(t){_fillMissingFields(t),e.attributes=t},e.sign=function(t,r){e.md=r||forge$r.md.sha1.create();var n=oids[e.md.algorithm+"WithRSAEncryption"];if(!n){var i=new Error("Could not compute certification request digest. Unknown message digest algorithm OID.");throw i.algorithm=e.md.algorithm,i}e.signatureOid=e.siginfo.algorithmOid=n,e.certificationRequestInfo=pki$1.getCertificationRequestInfo(e);var s=asn1$2.toDer(e.certificationRequestInfo);e.md.update(s.getBytes()),e.signature=t.sign(e.md)},e.verify=function(){var t=!1,r=e.md;if(null===r){if(e.signatureOid in oids)switch(oids[e.signatureOid]){case"sha1WithRSAEncryption":r=forge$r.md.sha1.create();break;case"md5WithRSAEncryption":r=forge$r.md.md5.create();break;case"sha256WithRSAEncryption":case"RSASSA-PSS":r=forge$r.md.sha256.create();break;case"sha384WithRSAEncryption":r=forge$r.md.sha384.create();break;case"sha512WithRSAEncryption":r=forge$r.md.sha512.create()}if(null===r)throw(u=new Error("Could not compute certification request digest. Unknown signature OID.")).signatureOid=e.signatureOid,u;var n=e.certificationRequestInfo||pki$1.getCertificationRequestInfo(e),i=asn1$2.toDer(n);r.update(i.getBytes())}if(null!==r){var s;switch(e.signatureOid){case oids.sha1WithRSAEncryption:break;case oids["RSASSA-PSS"]:var o,a,u;if(void 0===(o=oids[e.signatureParameters.mgf.hash.algorithmOid])||void 0===forge$r.md[o])throw(u=new Error("Unsupported MGF hash function.")).oid=e.signatureParameters.mgf.hash.algorithmOid,u.name=o,u;if(void 0===(a=oids[e.signatureParameters.mgf.algorithmOid])||void 0===forge$r.mgf[a])throw(u=new Error("Unsupported MGF function.")).oid=e.signatureParameters.mgf.algorithmOid,u.name=a,u;if(a=forge$r.mgf[a].create(forge$r.md[o].create()),void 0===(o=oids[e.signatureParameters.hash.algorithmOid])||void 0===forge$r.md[o])throw(u=new Error("Unsupported RSASSA-PSS hash function.")).oid=e.signatureParameters.hash.algorithmOid,u.name=o,u;s=forge$r.pss.create(forge$r.md[o].create(),a,e.signatureParameters.saltLength)}t=e.publicKey.verify(r.digest().getBytes(),e.signature,s)}return t},e};var jan_1_1950=new Date("1950-01-01T00:00:00Z"),jan_1_2050=new Date("2050-01-01T00:00:00Z");function _dateToAsn1(e){return e>=jan_1_1950&&e<jan_1_2050?asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.UTCTIME,!1,asn1$2.dateToUtcTime(e)):asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.GENERALIZEDTIME,!1,asn1$2.dateToGeneralizedTime(e))}pki$1.getTBSCertificate=function(e){var t=_dateToAsn1(e.validity.notBefore),r=_dateToAsn1(e.validity.notAfter),n=asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.SEQUENCE,!0,[asn1$2.create(asn1$2.Class.CONTEXT_SPECIFIC,0,!0,[asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.INTEGER,!1,asn1$2.integerToDer(e.version).getBytes())]),asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.INTEGER,!1,forge$r.util.hexToBytes(e.serialNumber)),asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.SEQUENCE,!0,[asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.OID,!1,asn1$2.oidToDer(e.siginfo.algorithmOid).getBytes()),_signatureParametersToAsn1(e.siginfo.algorithmOid,e.siginfo.parameters)]),_dnToAsn1(e.issuer),asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.SEQUENCE,!0,[t,r]),_dnToAsn1(e.subject),pki$1.publicKeyToAsn1(e.publicKey)]);return e.issuer.uniqueId&&n.value.push(asn1$2.create(asn1$2.Class.CONTEXT_SPECIFIC,1,!0,[asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.BITSTRING,!1,String.fromCharCode(0)+e.issuer.uniqueId)])),e.subject.uniqueId&&n.value.push(asn1$2.create(asn1$2.Class.CONTEXT_SPECIFIC,2,!0,[asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.BITSTRING,!1,String.fromCharCode(0)+e.subject.uniqueId)])),e.extensions.length>0&&n.value.push(pki$1.certificateExtensionsToAsn1(e.extensions)),n},pki$1.getCertificationRequestInfo=function(e){return asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.SEQUENCE,!0,[asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.INTEGER,!1,asn1$2.integerToDer(e.version).getBytes()),_dnToAsn1(e.subject),pki$1.publicKeyToAsn1(e.publicKey),_CRIAttributesToAsn1(e)])},pki$1.distinguishedNameToAsn1=function(e){return _dnToAsn1(e)},pki$1.certificateToAsn1=function(e){var t=e.tbsCertificate||pki$1.getTBSCertificate(e);return asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.SEQUENCE,!0,[t,asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.SEQUENCE,!0,[asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.OID,!1,asn1$2.oidToDer(e.signatureOid).getBytes()),_signatureParametersToAsn1(e.signatureOid,e.signatureParameters)]),asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.BITSTRING,!1,String.fromCharCode(0)+e.signature)])},pki$1.certificateExtensionsToAsn1=function(e){var t=asn1$2.create(asn1$2.Class.CONTEXT_SPECIFIC,3,!0,[]),r=asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.SEQUENCE,!0,[]);t.value.push(r);for(var n=0;n<e.length;++n)r.value.push(pki$1.certificateExtensionToAsn1(e[n]));return t},pki$1.certificateExtensionToAsn1=function(e){var t=asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.SEQUENCE,!0,[]);t.value.push(asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.OID,!1,asn1$2.oidToDer(e.id).getBytes())),e.critical&&t.value.push(asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.BOOLEAN,!1,String.fromCharCode(255)));var r=e.value;return"string"!=typeof e.value&&(r=asn1$2.toDer(r).getBytes()),t.value.push(asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.OCTETSTRING,!1,r)),t},pki$1.certificationRequestToAsn1=function(e){var t=e.certificationRequestInfo||pki$1.getCertificationRequestInfo(e);return asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.SEQUENCE,!0,[t,asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.SEQUENCE,!0,[asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.OID,!1,asn1$2.oidToDer(e.signatureOid).getBytes()),_signatureParametersToAsn1(e.signatureOid,e.signatureParameters)]),asn1$2.create(asn1$2.Class.UNIVERSAL,asn1$2.Type.BITSTRING,!1,String.fromCharCode(0)+e.signature)])},pki$1.createCaStore=function(e){var t={certs:{}};function r(e){return n(e),t.certs[e.hash]||null}function n(e){if(!e.hash){var t=forge$r.md.sha1.create();e.attributes=pki$1.RDNAttributesAsArray(_dnToAsn1(e),t),e.hash=t.digest().toHex()}}if(t.getIssuer=function(e){return r(e.issuer)},t.addCertificate=function(e){if("string"==typeof e&&(e=forge$r.pki.certificateFromPem(e)),n(e.subject),!t.hasCertificate(e))if(e.subject.hash in t.certs){var r=t.certs[e.subject.hash];forge$r.util.isArray(r)||(r=[r]),r.push(e),t.certs[e.subject.hash]=r}else t.certs[e.subject.hash]=e},t.hasCertificate=function(e){"string"==typeof e&&(e=forge$r.pki.certificateFromPem(e));var t=r(e.subject);if(!t)return!1;forge$r.util.isArray(t)||(t=[t]);for(var n=asn1$2.toDer(pki$1.certificateToAsn1(e)).getBytes(),i=0;i<t.length;++i){if(n===asn1$2.toDer(pki$1.certificateToAsn1(t[i])).getBytes())return!0}return!1},t.listAllCertificates=function(){var e=[];for(var r in t.certs)if(t.certs.hasOwnProperty(r)){var n=t.certs[r];if(forge$r.util.isArray(n))for(var i=0;i<n.length;++i)e.push(n[i]);else e.push(n)}return e},t.removeCertificate=function(e){var i;if("string"==typeof e&&(e=forge$r.pki.certificateFromPem(e)),n(e.subject),!t.hasCertificate(e))return null;var s=r(e.subject);if(!forge$r.util.isArray(s))return i=t.certs[e.subject.hash],delete t.certs[e.subject.hash],i;for(var o=asn1$2.toDer(pki$1.certificateToAsn1(e)).getBytes(),a=0;a<s.length;++a){o===asn1$2.toDer(pki$1.certificateToAsn1(s[a])).getBytes()&&(i=s[a],s.splice(a,1))}return 0===s.length&&delete t.certs[e.subject.hash],i},e)for(var i=0;i<e.length;++i){var s=e[i];t.addCertificate(s)}return t},pki$1.certificateError={bad_certificate:"forge.pki.BadCertificate",unsupported_certificate:"forge.pki.UnsupportedCertificate",certificate_revoked:"forge.pki.CertificateRevoked",certificate_expired:"forge.pki.CertificateExpired",certificate_unknown:"forge.pki.CertificateUnknown",unknown_ca:"forge.pki.UnknownCertificateAuthority"},pki$1.verifyCertificateChain=function(e,t,r){"function"==typeof r&&(r={verify:r}),r=r||{};var n=(t=t.slice(0)).slice(0),i=r.validityCheckDate;void 0===i&&(i=new Date);var s=!0,o=null,a=0;do{var u=t.shift(),c=null,l=!1;if(i&&(i<u.validity.notBefore||i>u.validity.notAfter)&&(o={message:"Certificate is not valid yet or has expired.",error:pki$1.certificateError.certificate_expired,notBefore:u.validity.notBefore,notAfter:u.validity.notAfter,now:i}),null===o){if(null===(c=t[0]||e.getIssuer(u))&&u.isIssuer(u)&&(l=!0,c=u),c){var h=c;forge$r.util.isArray(h)||(h=[h]);for(var d=!1;!d&&h.length>0;){c=h.shift();try{d=c.verify(u)}catch(e){}}d||(o={message:"Certificate signature is invalid.",error:pki$1.certificateError.bad_certificate})}null!==o||c&&!l||e.hasCertificate(u)||(o={message:"Certificate is not trusted.",error:pki$1.certificateError.unknown_ca})}if(null===o&&c&&!u.isIssuer(c)&&(o={message:"Certificate issuer is invalid.",error:pki$1.certificateError.bad_certificate}),null===o)for(var f={keyUsage:!0,basicConstraints:!0},p=0;null===o&&p<u.extensions.length;++p){var y=u.extensions[p];y.critical&&!(y.name in f)&&(o={message:"Certificate has an unsupported critical extension.",error:pki$1.certificateError.unsupported_certificate})}if(null===o&&(!s||0===t.length&&(!c||l))){var g=u.getExtension("basicConstraints"),$=u.getExtension("keyUsage");if(null!==$&&($.keyCertSign&&null!==g||(o={message:"Certificate keyUsage or basicConstraints conflict or indicate that the certificate is not a CA. If the certificate is the only one in the chain or isn't the first then the certificate must be a valid CA.",error:pki$1.certificateError.bad_certificate})),null!==o||null===g||g.cA||(o={message:"Certificate basicConstraints indicates the certificate is not a CA.",error:pki$1.certificateError.bad_certificate}),null===o&&null!==$&&"pathLenConstraint"in g)a-1>g.pathLenConstraint&&(o={message:"Certificate basicConstraints pathLenConstraint violated.",error:pki$1.certificateError.bad_certificate})}var m=null===o||o.error,b=r.verify?r.verify(m,a,n):m;if(!0!==b)throw!0===m&&(o={message:"The application rejected the certificate.",error:pki$1.certificateError.bad_certificate}),(b||0===b)&&("object"!=typeof b||forge$r.util.isArray(b)?"string"==typeof b&&(o.error=b):(b.message&&(o.message=b.message),b.error&&(o.error=b.error))),o;o=null,s=!1,++a}while(t.length>0);return!0};var forge$q=forge$X,asn1$1=forge$q.asn1,p7=forge$q.pkcs7=forge$q.pkcs7||{};function _recipientFromAsn1(e){var t={},r=[];if(!asn1$1.validate(e,p7.asn1.recipientInfoValidator,t,r)){var n=new Error("Cannot read PKCS#7 RecipientInfo. ASN.1 object is not an PKCS#7 RecipientInfo.");throw n.errors=r,n}return{version:t.version.charCodeAt(0),issuer:forge$q.pki.RDNAttributesAsArray(t.issuer),serialNumber:forge$q.util.createBuffer(t.serial).toHex(),encryptedContent:{algorithm:asn1$1.derToOid(t.encAlgorithm),parameter:t.encParameter.value,content:t.encKey}}}function _recipientToAsn1(e){return asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.SEQUENCE,!0,[asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.INTEGER,!1,asn1$1.integerToDer(e.version).getBytes()),asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.SEQUENCE,!0,[forge$q.pki.distinguishedNameToAsn1({attributes:e.issuer}),asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.INTEGER,!1,forge$q.util.hexToBytes(e.serialNumber))]),asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.SEQUENCE,!0,[asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.OID,!1,asn1$1.oidToDer(e.encryptedContent.algorithm).getBytes()),asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.NULL,!1,"")]),asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.OCTETSTRING,!1,e.encryptedContent.content)])}function _recipientsFromAsn1(e){for(var t=[],r=0;r<e.length;++r)t.push(_recipientFromAsn1(e[r]));return t}function _recipientsToAsn1(e){for(var t=[],r=0;r<e.length;++r)t.push(_recipientToAsn1(e[r]));return t}function _signerToAsn1(e){var t=asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.SEQUENCE,!0,[asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.INTEGER,!1,asn1$1.integerToDer(e.version).getBytes()),asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.SEQUENCE,!0,[forge$q.pki.distinguishedNameToAsn1({attributes:e.issuer}),asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.INTEGER,!1,forge$q.util.hexToBytes(e.serialNumber))]),asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.SEQUENCE,!0,[asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.OID,!1,asn1$1.oidToDer(e.digestAlgorithm).getBytes()),asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.NULL,!1,"")])]);if(e.authenticatedAttributesAsn1&&t.value.push(e.authenticatedAttributesAsn1),t.value.push(asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.SEQUENCE,!0,[asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.OID,!1,asn1$1.oidToDer(e.signatureAlgorithm).getBytes()),asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.NULL,!1,"")])),t.value.push(asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.OCTETSTRING,!1,e.signature)),e.unauthenticatedAttributes.length>0){for(var r=asn1$1.create(asn1$1.Class.CONTEXT_SPECIFIC,1,!0,[]),n=0;n<e.unauthenticatedAttributes.length;++n){var i=e.unauthenticatedAttributes[n];r.values.push(_attributeToAsn1(i))}t.value.push(r)}return t}function _signersToAsn1(e){for(var t=[],r=0;r<e.length;++r)t.push(_signerToAsn1(e[r]));return t}function _attributeToAsn1(e){var t;if(e.type===forge$q.pki.oids.contentType)t=asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.OID,!1,asn1$1.oidToDer(e.value).getBytes());else if(e.type===forge$q.pki.oids.messageDigest)t=asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.OCTETSTRING,!1,e.value.bytes());else if(e.type===forge$q.pki.oids.signingTime){var r=new Date("1950-01-01T00:00:00Z"),n=new Date("2050-01-01T00:00:00Z"),i=e.value;if("string"==typeof i){var s=Date.parse(i);i=isNaN(s)?13===i.length?asn1$1.utcTimeToDate(i):asn1$1.generalizedTimeToDate(i):new Date(s)}t=i>=r&&i<n?asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.UTCTIME,!1,asn1$1.dateToUtcTime(i)):asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.GENERALIZEDTIME,!1,asn1$1.dateToGeneralizedTime(i))}return asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.SEQUENCE,!0,[asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.OID,!1,asn1$1.oidToDer(e.type).getBytes()),asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.SET,!0,[t])])}function _encryptedContentToAsn1(e){return[asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.OID,!1,asn1$1.oidToDer(forge$q.pki.oids.data).getBytes()),asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.SEQUENCE,!0,[asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.OID,!1,asn1$1.oidToDer(e.algorithm).getBytes()),asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.OCTETSTRING,!1,e.parameter.getBytes())]),asn1$1.create(asn1$1.Class.CONTEXT_SPECIFIC,0,!0,[asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.OCTETSTRING,!1,e.content.getBytes())])]}function _fromAsn1(e,t,r){var n={};if(!asn1$1.validate(t,r,n,[])){var i=new Error("Cannot read PKCS#7 message. ASN.1 object is not a supported PKCS#7 message.");throw i.errors=i,i}if(asn1$1.derToOid(n.contentType)!==forge$q.pki.oids.data)throw new Error("Unsupported PKCS#7 message. Only wrapped ContentType Data supported.");if(n.encryptedContent){var s="";if(forge$q.util.isArray(n.encryptedContent))for(var o=0;o<n.encryptedContent.length;++o){if(n.encryptedContent[o].type!==asn1$1.Type.OCTETSTRING)throw new Error("Malformed PKCS#7 message, expecting encrypted content constructed of only OCTET STRING objects.");s+=n.encryptedContent[o].value}else s=n.encryptedContent;e.encryptedContent={algorithm:asn1$1.derToOid(n.encAlgorithm),parameter:forge$q.util.createBuffer(n.encParameter.value),content:forge$q.util.createBuffer(s)}}if(n.content){s="";if(forge$q.util.isArray(n.content))for(o=0;o<n.content.length;++o){if(n.content[o].type!==asn1$1.Type.OCTETSTRING)throw new Error("Malformed PKCS#7 message, expecting content constructed of only OCTET STRING objects.");s+=n.content[o].value}else s=n.content;e.content=forge$q.util.createBuffer(s)}return e.version=n.version.charCodeAt(0),e.rawCapture=n,n}function _decryptContent(e){if(void 0===e.encryptedContent.key)throw new Error("Symmetric key not available.");if(void 0===e.content){var t;switch(e.encryptedContent.algorithm){case forge$q.pki.oids["aes128-CBC"]:case forge$q.pki.oids["aes192-CBC"]:case forge$q.pki.oids["aes256-CBC"]:t=forge$q.aes.createDecryptionCipher(e.encryptedContent.key);break;case forge$q.pki.oids.desCBC:case forge$q.pki.oids["des-EDE3-CBC"]:t=forge$q.des.createDecryptionCipher(e.encryptedContent.key);break;default:throw new Error("Unsupported symmetric cipher, OID "+e.encryptedContent.algorithm)}if(t.start(e.encryptedContent.parameter),t.update(e.encryptedContent.content),!t.finish())throw new Error("Symmetric decryption failed.");e.content=t.output}}p7.messageFromPem=function(e){var t=forge$q.pem.decode(e)[0];if("PKCS7"!==t.type){var r=new Error('Could not convert PKCS#7 message from PEM; PEM header type is not "PKCS#7".');throw r.headerType=t.type,r}if(t.procType&&"ENCRYPTED"===t.procType.type)throw new Error("Could not convert PKCS#7 message from PEM; PEM is encrypted.");var n=asn1$1.fromDer(t.body);return p7.messageFromAsn1(n)},p7.messageToPem=function(e,t){var r={type:"PKCS7",body:asn1$1.toDer(e.toAsn1()).getBytes()};return forge$q.pem.encode(r,{maxline:t})},p7.messageFromAsn1=function(e){var t={},r=[];if(!asn1$1.validate(e,p7.asn1.contentInfoValidator,t,r)){var n=new Error("Cannot read PKCS#7 message. ASN.1 object is not an PKCS#7 ContentInfo.");throw n.errors=r,n}var i,s=asn1$1.derToOid(t.contentType);switch(s){case forge$q.pki.oids.envelopedData:i=p7.createEnvelopedData();break;case forge$q.pki.oids.encryptedData:i=p7.createEncryptedData();break;case forge$q.pki.oids.signedData:i=p7.createSignedData();break;default:throw new Error("Cannot read PKCS#7 message. ContentType with OID "+s+" is not (yet) supported.")}return i.fromAsn1(t.content.value[0]),i},p7.createSignedData=function(){var e=null;return e={type:forge$q.pki.oids.signedData,version:1,certificates:[],crls:[],signers:[],digestAlgorithmIdentifiers:[],contentInfo:null,signerInfos:[],fromAsn1:function(t){if(_fromAsn1(e,t,p7.asn1.signedDataValidator),e.certificates=[],e.crls=[],e.digestAlgorithmIdentifiers=[],e.contentInfo=null,e.signerInfos=[],e.rawCapture.certificates)for(var r=e.rawCapture.certificates.value,n=0;n<r.length;++n)e.certificates.push(forge$q.pki.certificateFromAsn1(r[n]))},toAsn1:function(){e.contentInfo||e.sign();for(var t=[],r=0;r<e.certificates.length;++r)t.push(forge$q.pki.certificateToAsn1(e.certificates[r]));var n=[],i=asn1$1.create(asn1$1.Class.CONTEXT_SPECIFIC,0,!0,[asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.SEQUENCE,!0,[asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.INTEGER,!1,asn1$1.integerToDer(e.version).getBytes()),asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.SET,!0,e.digestAlgorithmIdentifiers),e.contentInfo])]);return t.length>0&&i.value[0].value.push(asn1$1.create(asn1$1.Class.CONTEXT_SPECIFIC,0,!0,t)),n.length>0&&i.value[0].value.push(asn1$1.create(asn1$1.Class.CONTEXT_SPECIFIC,1,!0,n)),i.value[0].value.push(asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.SET,!0,e.signerInfos)),asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.SEQUENCE,!0,[asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.OID,!1,asn1$1.oidToDer(e.type).getBytes()),i])},addSigner:function(t){var r=t.issuer,n=t.serialNumber;if(t.certificate){var i=t.certificate;"string"==typeof i&&(i=forge$q.pki.certificateFromPem(i)),r=i.issuer.attributes,n=i.serialNumber}var s=t.key;if(!s)throw new Error("Could not add PKCS#7 signer; no private key specified.");"string"==typeof s&&(s=forge$q.pki.privateKeyFromPem(s));var o=t.digestAlgorithm||forge$q.pki.oids.sha1;switch(o){case forge$q.pki.oids.sha1:case forge$q.pki.oids.sha256:case forge$q.pki.oids.sha384:case forge$q.pki.oids.sha512:case forge$q.pki.oids.md5:break;default:throw new Error("Could not add PKCS#7 signer; unknown message digest algorithm: "+o)}var a=t.authenticatedAttributes||[];if(a.length>0){for(var u=!1,c=!1,l=0;l<a.length;++l){var h=a[l];if(u||h.type!==forge$q.pki.oids.contentType){if(c||h.type!==forge$q.pki.oids.messageDigest);else if(c=!0,u)break}else if(u=!0,c)break}if(!u||!c)throw new Error("Invalid signer.authenticatedAttributes. If signer.authenticatedAttributes is specified, then it must contain at least two attributes, PKCS #9 content-type and PKCS #9 message-digest.")}e.signers.push({key:s,version:1,issuer:r,serialNumber:n,digestAlgorithm:o,signatureAlgorithm:forge$q.pki.oids.rsaEncryption,signature:null,authenticatedAttributes:a,unauthenticatedAttributes:[]})},sign:function(t){var r;(t=t||{},"object"!=typeof e.content||null===e.contentInfo)&&(e.contentInfo=asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.SEQUENCE,!0,[asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.OID,!1,asn1$1.oidToDer(forge$q.pki.oids.data).getBytes())]),"content"in e&&(e.content instanceof forge$q.util.ByteBuffer?r=e.content.bytes():"string"==typeof e.content&&(r=forge$q.util.encodeUtf8(e.content)),t.detached?e.detachedContent=asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.OCTETSTRING,!1,r):e.contentInfo.value.push(asn1$1.create(asn1$1.Class.CONTEXT_SPECIFIC,0,!0,[asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.OCTETSTRING,!1,r)]))));if(0!==e.signers.length){var n=function(){for(var t={},r=0;r<e.signers.length;++r){var n=e.signers[r];(i=n.digestAlgorithm)in t||(t[i]=forge$q.md[forge$q.pki.oids[i]].create()),0===n.authenticatedAttributes.length?n.md=t[i]:n.md=forge$q.md[forge$q.pki.oids[i]].create()}for(var i in e.digestAlgorithmIdentifiers=[],t)e.digestAlgorithmIdentifiers.push(asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.SEQUENCE,!0,[asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.OID,!1,asn1$1.oidToDer(i).getBytes()),asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.NULL,!1,"")]));return t}();!function(t){var r;r=e.detachedContent?e.detachedContent:(r=e.contentInfo.value[1]).value[0];if(!r)throw new Error("Could not sign PKCS#7 message; there is no content to sign.");var n=asn1$1.derToOid(e.contentInfo.value[0].value),i=asn1$1.toDer(r);for(var s in i.getByte(),asn1$1.getBerValueLength(i),i=i.getBytes(),t)t[s].start().update(i);for(var o=new Date,a=0;a<e.signers.length;++a){var u=e.signers[a];if(0===u.authenticatedAttributes.length){if(n!==forge$q.pki.oids.data)throw new Error("Invalid signer; authenticatedAttributes must be present when the ContentInfo content type is not PKCS#7 Data.")}else{u.authenticatedAttributesAsn1=asn1$1.create(asn1$1.Class.CONTEXT_SPECIFIC,0,!0,[]);for(var c=asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.SET,!0,[]),l=0;l<u.authenticatedAttributes.length;++l){var h=u.authenticatedAttributes[l];h.type===forge$q.pki.oids.messageDigest?h.value=t[u.digestAlgorithm].digest():h.type===forge$q.pki.oids.signingTime&&(h.value||(h.value=o)),c.value.push(_attributeToAsn1(h)),u.authenticatedAttributesAsn1.value.push(_attributeToAsn1(h))}i=asn1$1.toDer(c).getBytes(),u.md.start().update(i)}u.signature=u.key.sign(u.md,"RSASSA-PKCS1-V1_5")}e.signerInfos=_signersToAsn1(e.signers)}(n)}},verify:function(){throw new Error("PKCS#7 signature verification not yet implemented.")},addCertificate:function(t){"string"==typeof t&&(t=forge$q.pki.certificateFromPem(t)),e.certificates.push(t)},addCertificateRevokationList:function(e){throw new Error("PKCS#7 CRL support not yet implemented.")}},e},p7.createEncryptedData=function(){var e=null;return e={type:forge$q.pki.oids.encryptedData,version:0,encryptedContent:{algorithm:forge$q.pki.oids["aes256-CBC"]},fromAsn1:function(t){_fromAsn1(e,t,p7.asn1.encryptedDataValidator)},decrypt:function(t){void 0!==t&&(e.encryptedContent.key=t),_decryptContent(e)}},e},p7.createEnvelopedData=function(){var e=null;return e={type:forge$q.pki.oids.envelopedData,version:0,recipients:[],encryptedContent:{algorithm:forge$q.pki.oids["aes256-CBC"]},fromAsn1:function(t){var r=_fromAsn1(e,t,p7.asn1.envelopedDataValidator);e.recipients=_recipientsFromAsn1(r.recipientInfos.value)},toAsn1:function(){return asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.SEQUENCE,!0,[asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.OID,!1,asn1$1.oidToDer(e.type).getBytes()),asn1$1.create(asn1$1.Class.CONTEXT_SPECIFIC,0,!0,[asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.SEQUENCE,!0,[asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.INTEGER,!1,asn1$1.integerToDer(e.version).getBytes()),asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.SET,!0,_recipientsToAsn1(e.recipients)),asn1$1.create(asn1$1.Class.UNIVERSAL,asn1$1.Type.SEQUENCE,!0,_encryptedContentToAsn1(e.encryptedContent))])])])},findRecipient:function(t){for(var r=t.issuer.attributes,n=0;n<e.recipients.length;++n){var i=e.recipients[n],s=i.issuer;if(i.serialNumber===t.serialNumber&&s.length===r.length){for(var o=!0,a=0;a<r.length;++a)if(s[a].type!==r[a].type||s[a].value!==r[a].value){o=!1;break}if(o)return i}}return null},decrypt:function(t,r){if(void 0===e.encryptedContent.key&&void 0!==t&&void 0!==r)switch(t.encryptedContent.algorithm){case forge$q.pki.oids.rsaEncryption:case forge$q.pki.oids.desCBC:var n=r.decrypt(t.encryptedContent.content);e.encryptedContent.key=forge$q.util.createBuffer(n);break;default:throw new Error("Unsupported asymmetric cipher, OID "+t.encryptedContent.algorithm)}_decryptContent(e)},addRecipient:function(t){e.recipients.push({version:0,issuer:t.issuer.attributes,serialNumber:t.serialNumber,encryptedContent:{algorithm:forge$q.pki.oids.rsaEncryption,key:t.publicKey}})},encrypt:function(t,r){if(void 0===e.encryptedContent.content){var n,i,s;switch(r=r||e.encryptedContent.algorithm,t=t||e.encryptedContent.key,r){case forge$q.pki.oids["aes128-CBC"]:n=16,i=16,s=forge$q.aes.createEncryptionCipher;break;case forge$q.pki.oids["aes192-CBC"]:n=24,i=16,s=forge$q.aes.createEncryptionCipher;break;case forge$q.pki.oids["aes256-CBC"]:n=32,i=16,s=forge$q.aes.createEncryptionCipher;break;case forge$q.pki.oids["des-EDE3-CBC"]:n=24,i=8,s=forge$q.des.createEncryptionCipher;break;default:throw new Error("Unsupported symmetric cipher, OID "+r)}if(void 0===t)t=forge$q.util.createBuffer(forge$q.random.getBytes(n));else if(t.length()!=n)throw new Error("Symmetric key has wrong length; got "+t.length()+" bytes, expected "+n+".");e.encryptedContent.algorithm=r,e.encryptedContent.key=t,e.encryptedContent.parameter=forge$q.util.createBuffer(forge$q.random.getBytes(i));var o=s(t);if(o.start(e.encryptedContent.parameter.copy()),o.update(e.content),!o.finish())throw new Error("Symmetric encryption failed.");e.encryptedContent.content=o.output}for(var a=0;a<e.recipients.length;++a){var u=e.recipients[a];if(void 0===u.encryptedContent.content){if(u.encryptedContent.algorithm!==forge$q.pki.oids.rsaEncryption)throw new Error("Unsupported asymmetric cipher, OID "+u.encryptedContent.algorithm);u.encryptedContent.content=u.encryptedContent.key.encrypt(e.encryptedContent.key.data)}}}},e};const forge$p=forge$X,pki=forge$p.pki,certificateForKey$1=(e,t)=>{const r=pki.setRsaPublicKey(t.n,t.e),n=pki.createCertificate();n.publicKey=r,n.serialNumber="01",n.validity.notBefore=new Date,n.validity.notAfter=new Date,n.validity.notAfter.setFullYear(n.validity.notBefore.getFullYear()+10);const i=[{name:"organizationName",value:"ipfs"},{shortName:"OU",value:"keystore"},{name:"commonName",value:e.id}];return n.setSubject(i),n.setIssuer(i),n.setExtensions([{name:"basicConstraints",cA:!0},{name:"keyUsage",keyCertSign:!0,digitalSignature:!0,nonRepudiation:!0,keyEncipherment:!0,dataEncipherment:!0},{name:"extKeyUsage",serverAuth:!0,clientAuth:!0,codeSigning:!0,emailProtection:!0,timeStamping:!0},{name:"nsCertType",client:!0,server:!0,email:!0,objsign:!0,sslCA:!0,emailCA:!0,objCA:!0}]),n.sign(t),n};async function findAsync$1(e,t){const r=e.map(t);return e[(await Promise.all(r)).findIndex((e=>e))]}var util$6={certificateForKey:certificateForKey$1,findAsync:findAsync$1};const forge$o=forge$X,{certificateForKey:certificateForKey,findAsync:findAsync}=util$6,errcode$V=errCode$m,{fromString:uint8ArrayFromString$p}=require$$3$1,{toString:uint8ArrayToString$s}=require$$1$5,privates$1=new WeakMap;class CMS$1{constructor(e,t){if(!e)throw errcode$V(new Error("keychain is required"),"ERR_KEYCHAIN_REQUIRED");this.keychain=e,privates$1.set(this,{dek:t})}async encrypt(e,t){if(!(t instanceof Uint8Array))throw errcode$V(new Error("Plain data must be a Uint8Array"),"ERR_INVALID_PARAMS");const r=await this.keychain.findKeyByName(e),n=await this.keychain._getPrivateKey(e),i=privates$1.get(this).dek,s=forge$o.pki.decryptRsaPrivateKey(n,i),o=await certificateForKey(r,s),a=forge$o.pkcs7.createEnvelopedData();a.addRecipient(o),a.content=forge$o.util.createBuffer(t),a.encrypt();const u=forge$o.asn1.toDer(a.toAsn1()).getBytes();return uint8ArrayFromString$p(u,"ascii")}async decrypt(e){if(!(e instanceof Uint8Array))throw errcode$V(new Error("CMS data is required"),"ERR_INVALID_PARAMS");let t;try{const r=forge$o.util.createBuffer(uint8ArrayToString$s(e,"ascii")),n=forge$o.asn1.fromDer(r);t=forge$o.pkcs7.messageFromAsn1(n)}catch(e){throw errcode$V(new Error("Invalid CMS: "+e.message),"ERR_INVALID_CMS")}const r=t.recipients.filter((e=>e.issuer.find((e=>"O"===e.shortName&&"ipfs"===e.value)))).filter((e=>e.issuer.find((e=>"CN"===e.shortName)))).map((e=>({recipient:e,keyId:e.issuer.find((e=>"CN"===e.shortName)).value}))),n=await findAsync(r,(async e=>{try{if(await this.keychain.findKeyById(e.keyId))return!0}catch(e){return!1}return!1}));if(!n){const e=r.map((e=>e.keyId));throw errcode$V(new Error("Decryption needs one of the key(s): "+e.join(", ")),"ERR_MISSING_KEYS",{missingKeys:e})}const i=await this.keychain.findKeyById(n.keyId);if(!i)throw errcode$V(new Error("No key available to decrypto"),"ERR_NO_KEY");const s=await this.keychain._getPrivateKey(i.name),o=privates$1.get(this).dek,a=forge$o.pki.decryptRsaPrivateKey(s,o);return t.decrypt(n.recipient,a),uint8ArrayFromString$p(t.content.getBytes(),"ascii")}}var cms=CMS$1;const debug$t=require$$0$b,log$o=Object.assign(debug$t("libp2p:keychain"),{error:debug$t("libp2p:keychain:err")}),sanitize=sanitizeFilename,mergeOptions$1=mergeOptions$5,crypto$e=src$g,{Key:Key$1}=require$$1$4,CMS=cms,errcode$U=errCode$m,{toString:uint8ArrayToString$r}=require$$1$5,{fromString:uint8ArrayFromString$o}=require$$3$1,keyPrefix="/pkcs8/",infoPrefix="/info/",privates=new WeakMap,NIST={minKeyLength:14,minSaltLength:16,minIterationCount:1e3},defaultOptions$1={dek:{keyLength:64,iterationCount:1e4,salt:"you should override this value with a crypto secure random number",hash:"sha2-512"}};function validateKeyName(e){return!!e&&("string"==typeof e&&e===sanitize(e.trim()))}async function throwDelayed(e){const t=800*Math.random()+200;throw await new Promise((e=>setTimeout(e,t))),e}function DsName(e){return new Key$1(keyPrefix+e)}function DsInfoName(e){return new Key$1(infoPrefix+e)}class Keychain$1{constructor(e,t){if(!e)throw new Error("store is required");if(this.store=e,this.opts=mergeOptions$1(defaultOptions$1,t),this.opts.pass&&this.opts.pass.length<20)throw new Error("pass must be least 20 characters");if(this.opts.dek.keyLength<NIST.minKeyLength)throw new Error(`dek.keyLength must be least ${NIST.minKeyLength} bytes`);if(this.opts.dek.salt.length<NIST.minSaltLength)throw new Error(`dek.saltLength must be least ${NIST.minSaltLength} bytes`);if(this.opts.dek.iterationCount<NIST.minIterationCount)throw new Error(`dek.iterationCount must be least ${NIST.minIterationCount}`);const r=this.opts.pass?crypto$e.pbkdf2(this.opts.pass,this.opts.dek.salt,this.opts.dek.iterationCount,this.opts.dek.keyLength,this.opts.dek.hash):"";privates.set(this,{dek:r})}get cms(){return new CMS(this,privates.get(this).dek)}static generateOptions(){const e=Object.assign({},defaultOptions$1),t=3*Math.ceil(NIST.minSaltLength/3);return e.dek.salt=uint8ArrayToString$r(crypto$e.randomBytes(t),"base64"),e}static get options(){return defaultOptions$1}async createKey(e,t,r=2048){const n=this;if(!validateKeyName(e)||"self"===e)return throwDelayed(errcode$U(new Error(`Invalid key name '${e}'`),"ERR_INVALID_KEY_NAME"));if("string"!=typeof t)return throwDelayed(errcode$U(new Error(`Invalid key type '${t}'`),"ERR_INVALID_KEY_TYPE"));const i=DsName(e);if(await n.store.has(i))return throwDelayed(errcode$U(new Error(`Key '${e}' already exists`),"ERR_KEY_ALREADY_EXISTS"));if("rsa"===t.toLowerCase())if(!Number.isSafeInteger(r)||r<2048)return throwDelayed(errcode$U(new Error(`Invalid RSA key size ${r}`),"ERR_INVALID_KEY_SIZE"));let s;try{const o=await crypto$e.keys.generateKeyPair(t,r),a=await o.id(),u=privates.get(this).dek,c=await o.export(u);s={name:e,id:a};const l=n.store.batch();l.put(i,uint8ArrayFromString$o(c)),l.put(DsInfoName(e),uint8ArrayFromString$o(JSON.stringify(s))),await l.commit()}catch(e){return throwDelayed(e)}return s}async listKeys(){const e=this,t={prefix:infoPrefix},r=[];for await(const n of e.store.query(t))r.push(JSON.parse(uint8ArrayToString$r(n.value)));return r}async findKeyById(e){try{return(await this.listKeys()).find((t=>t.id===e))}catch(e){return throwDelayed(e)}}async findKeyByName(e){if(!validateKeyName(e))return throwDelayed(errcode$U(new Error(`Invalid key name '${e}'`),"ERR_INVALID_KEY_NAME"));const t=DsInfoName(e);try{const e=await this.store.get(t);return JSON.parse(uint8ArrayToString$r(e))}catch(t){return throwDelayed(errcode$U(new Error(`Key '${e}' does not exist. ${t.message}`),"ERR_KEY_NOT_FOUND"))}}async removeKey(e){if(!validateKeyName(e)||"self"===e)return throwDelayed(errcode$U(new Error(`Invalid key name '${e}'`),"ERR_INVALID_KEY_NAME"));const t=DsName(e),r=await this.findKeyByName(e),n=this.store.batch();return n.delete(t),n.delete(DsInfoName(e)),await n.commit(),r}async renameKey(e,t){const r=this;if(!validateKeyName(e)||"self"===e)return throwDelayed(errcode$U(new Error(`Invalid old key name '${e}'`),"ERR_OLD_KEY_NAME_INVALID"));if(!validateKeyName(t)||"self"===t)return throwDelayed(errcode$U(new Error(`Invalid new key name '${t}'`),"ERR_NEW_KEY_NAME_INVALID"));const n=DsName(e),i=DsName(t),s=DsInfoName(e),o=DsInfoName(t);if(await r.store.has(i))return throwDelayed(errcode$U(new Error(`Key '${t}' already exists`),"ERR_KEY_ALREADY_EXISTS"));try{const e=await r.store.get(n),a=await r.store.get(s),u=JSON.parse(uint8ArrayToString$r(a));u.name=t;const c=r.store.batch();return c.put(i,e),c.put(o,uint8ArrayFromString$o(JSON.stringify(u))),c.delete(n),c.delete(s),await c.commit(),u}catch(e){return throwDelayed(e)}}async exportKey(e,t){if(!validateKeyName(e))return throwDelayed(errcode$U(new Error(`Invalid key name '${e}'`),"ERR_INVALID_KEY_NAME"));if(!t)return throwDelayed(errcode$U(new Error("Password is required"),"ERR_PASSWORD_REQUIRED"));const r=DsName(e);try{const e=await this.store.get(r),n=uint8ArrayToString$r(e),i=privates.get(this).dek;return(await crypto$e.keys.import(n,i)).export(t)}catch(e){return throwDelayed(e)}}async importKey(e,t,r){if(!validateKeyName(e)||"self"===e)return throwDelayed(errcode$U(new Error(`Invalid key name '${e}'`),"ERR_INVALID_KEY_NAME"));if(!t)return throwDelayed(errcode$U(new Error("PEM encoded key is required"),"ERR_PEM_REQUIRED"));const n=DsName(e);if(await this.store.has(n))return throwDelayed(errcode$U(new Error(`Key '${e}' already exists`),"ERR_KEY_ALREADY_EXISTS"));let i,s;try{i=await crypto$e.keys.import(t,r)}catch(e){return throwDelayed(errcode$U(new Error("Cannot read the key, most likely the password is wrong"),"ERR_CANNOT_READ_KEY"))}try{s=await i.id();const e=privates.get(this).dek;t=await i.export(e)}catch(e){return throwDelayed(e)}const o={name:e,id:s},a=this.store.batch();return a.put(n,uint8ArrayFromString$o(t)),a.put(DsInfoName(e),uint8ArrayFromString$o(JSON.stringify(o))),await a.commit(),o}async importPeer(e,t){const r=this;if(!validateKeyName(e))return throwDelayed(errcode$U(new Error(`Invalid key name '${e}'`),"ERR_INVALID_KEY_NAME"));if(!t||!t.privKey)return throwDelayed(errcode$U(new Error("Peer.privKey is required"),"ERR_MISSING_PRIVATE_KEY"));const n=t.privKey,i=DsName(e);if(await r.store.has(i))return throwDelayed(errcode$U(new Error(`Key '${e}' already exists`),"ERR_KEY_ALREADY_EXISTS"));try{const t=await n.id(),s=privates.get(this).dek,o=await n.export(s),a={name:e,id:t},u=r.store.batch();return u.put(i,uint8ArrayFromString$o(o)),u.put(DsInfoName(e),uint8ArrayFromString$o(JSON.stringify(a))),await u.commit(),a}catch(e){return throwDelayed(e)}}async _getPrivateKey(e){if(!validateKeyName(e))return throwDelayed(errcode$U(new Error(`Invalid key name '${e}'`),"ERR_INVALID_KEY_NAME"));try{const t=DsName(e),r=await this.store.get(t);return uint8ArrayToString$r(r)}catch(t){return throwDelayed(errcode$U(new Error(`Key '${e}' does not exist. ${t.message}`),"ERR_KEY_NOT_FOUND"))}}async rotateKeychainPass(e,t){if("string"!=typeof e)return throwDelayed(errcode$U(new Error(`Invalid old pass type '${typeof e}'`),"ERR_INVALID_OLD_PASS_TYPE"));if("string"!=typeof t)return throwDelayed(errcode$U(new Error(`Invalid new pass type '${typeof t}'`),"ERR_INVALID_NEW_PASS_TYPE"));if(t.length<20)return throwDelayed(errcode$U(new Error(`Invalid pass length ${t.length}`),"ERR_INVALID_PASS_LENGTH"));log$o("recreating keychain");const r=privates.get(this).dek;this.opts.pass=t;const n=t?crypto$e.pbkdf2(t,this.opts.dek.salt,this.opts.dek.iterationCount,this.opts.dek.keyLength,this.opts.dek.hash):"";privates.set(this,{dek:n});const i=await this.listKeys();for(const e of i){const t=await this.store.get(DsName(e.name)),i=uint8ArrayToString$r(t),s=await crypto$e.keys.import(i,r),o=n.toString(),a=await s.export(o),u=this.store.batch(),c={name:e.name,id:e.id};u.put(DsName(e.name),uint8ArrayFromString$o(a)),u.put(DsInfoName(e.name),uint8ArrayFromString$o(JSON.stringify(c))),await u.commit()}log$o("keychain reconstructed")}}var keychain=Keychain$1;!function(e){async function*t(e,t){let r=[];for await(const n of t)r.push(n),r.length===e&&(yield r,r=[]);r.length>0&&(yield r)}function*r(e,t){let r=[];for(const n of t)r.push(n),r.length===e&&(yield r,r=[]);r.length>0&&(yield r)}function n(e,i){return void 0===i?t=>n(e,t):i[Symbol.asyncIterator]?t(e,i):r(e,i)}function i(e){if("function"==typeof e.next)return e;if("function"==typeof e[Symbol.iterator])return e[Symbol.iterator]();if("function"==typeof e[Symbol.asyncIterator])return e[Symbol.asyncIterator]();throw new TypeError('"values" does not to conform to any of the iterator or iterable protocols')}function s(){let e,t;return{promise:new Promise(((r,n)=>{t=r,e=n})),reject:e,resolve:t}}function o(e,t){const r=i(t),n=[],o=[];let a=!1,u=!1;function c(){for(;o.length>0&&n.length>0;){const e=o.shift(),{error:t,value:r}=n.shift();t?e.reject(t):e.resolve({done:!1,value:r})}for(;o.length>0&&u;){const{resolve:e}=o.shift();e({done:!0,value:void 0})}}async function l(){if(!u&&!(a||n.length>=e)){a=!0;try{const{done:e,value:t}=await r.next();e?u=!0:n.push({value:t})}catch(e){u=!0,n.push({error:e})}c(),a=!1,l()}}async function h(){if(n.length>0){const{error:e,value:t}=n.shift();if(e)throw e;return l(),{done:!1,value:t}}if(u)return{done:!0,value:void 0};const e=s();return o.push(e),l(),e.promise}const d={next:h,[Symbol.asyncIterator]:()=>d};return d}function*a(e,t){const r=[];let n;try{for(const n of t)r.push(n),r.length<=e||(yield r.shift())}catch(e){n=e}for(const e of r)yield e;if(n)throw n}function u(e,t){return void 0===t?t=>u(e,t):0===e?t:t[Symbol.asyncIterator]?o(e,t):a(e,t)}async function c(e){const t=[];for await(const r of e)t.push(r);return t}function l(e){return e[Symbol.asyncIterator]?c(e):Array.from(e)}async function*h(e){for await(const t of e)yield*t}function*d(e){for(const t of e)yield*t}function f(...e){return e.find((e=>void 0!==e[Symbol.asyncIterator]))?h(e):d(e)}async function p(e){for await(const t of e);}function y(e){if(e[Symbol.asyncIterator])return p(e);for(const t of e);}async function*g(e,t){for await(const r of t)await e(r)&&(yield r)}function $(e,t){return void 0===t?t=>g(e,t):g(e,t)}async function*m(e){for await(const t of e)t&&"string"!=typeof t&&(t[Symbol.iterator]||t[Symbol.asyncIterator])?yield*m(t):yield t}async function*b(e,t){for await(const r of t)yield await e(r)}function v(e,t){return void 0===t?t=>b(e,t):b(e,t)}function _(e,t){return void 0===t?t=>_(e,t):$((e=>null!=e),m(v(e,t)))}function w(e,t,r){const n=i(r),o=[],a=[];let u=!1,c=!1,l=0,h=null;function d(){for(;a.length>0&&o.length>0;){const{resolve:e}=a.shift();e({done:!1,value:o.shift()})}for(;a.length>0&&0===l&&u;){const{resolve:e,reject:t}=a.shift();h?(t(h),h=null):e({done:!0,value:void 0})}}async function f(){if(u)d();else if(!(c||l+o.length>=e)){c=!0,l++;try{const{done:e,value:t}=await n.next();e?(u=!0,l--,d()):p(t)}catch(e){u=!0,l--,h=e,d()}c=!1,f()}}async function p(e){try{const r=await t(e);if(r&&r[Symbol.asyncIterator])for await(const e of r)o.push(e);else o.push(r)}catch(e){u=!0,h=e}l--,d(),f()}async function y(){if(0===o.length){const e=s();return a.push(e),f(),e.promise}const e=o.shift();return f(),{done:!1,value:e}}const g={next:y,[Symbol.asyncIterator]:()=>g};return g}function E(e,t,r){return void 0===t?(t,r)=>r?E(e,t,r):E(e,t):void 0===r?r=>E(e,t,r):$((e=>null!=e),m(w(e,t,r)))}async function S(e){return new Promise((t=>{e.once("readable",(()=>{t()}))}))}async function*A(e){for(;;){const t=e.read();if(null===t){if(e._readableState.ended)break;await S(e)}else yield t}}function T(e){return"function"==typeof e[Symbol.asyncIterator]?e:A(e)}async function*I(...e){const t=new Set(e.map(i));for(;t.size>0;)for(const e of t){const r=await e.next();r.done?t.delete(e):yield r.value}}function P(e,...t){let r=e();for(const e of t)r=e(r);return r}async function*R(e,t,r){let n=null;const s=e=>({value:t(e)}),o=async function*(e){for await(const t of e){if(n)return;yield t}},a=i(P((()=>r),u(1),o,v(s),u(e-1)));for(;;){const{value:e,done:t}=await a.next();if(t)break;try{const t=await e.value;n||(yield t)}catch(e){n=e}}if(n)throw n}function C(e,t,r){return void 0===t?(t,r)=>C(e,t,r):void 0===r?r=>C(e,t,r):1===e?v(t,r):R(e,t,r)}function B(e,t,r){return void 0===t?(t,r)=>r?B(e,t,r):B(e,t):void 0===r?r=>B(e,t,r):$((e=>null!=e),m(C(e,t,r)))}async function*k(...e){const t=e.map(i),r=new Set,n=new Map;let s=null,o=null,a=null;const u=e=>{s=e,o&&o(e)},c=e=>{a&&a(e)},l=()=>new Promise(((e,t)=>{if(s&&t(s),n.size>0)return e();a=e,o=t})),h=e=>{const t=Promise.resolve(e.next()).then((async({done:i,value:s})=>{i||n.set(e,s),r.delete(t)}));r.add(t),t.then(c,u)};for(const e of t)h(e);for(;;){if(0===r.size&&0===n.size)return;await l();for(const[e,t]of n)n.delete(e),yield t,h(e)}}async function K(e,t,r){let n=t;for await(const t of r)n=await e(n,t);return n}function O(e,t,r){return void 0===t?(t,r)=>r?K(e,t,r):O(e,t):void 0===r?r=>O(e,t,r):K(e,t,r)}async function*N(e,t){let r=0;for await(const n of t)if(yield await n,r++,r>=e)break}function*D(e,t){let r=0;for(const n of t)if(yield n,r++,r>=e)break}function M(e,t){return void 0===t?t=>M(e,t):t[Symbol.asyncIterator]?N(e,t):D(e,t)}async function*L(e,t){for await(const r of t)await e(r),yield r}function x(e,t){return void 0===t?t=>L(e,t):L(e,t)}function U(e,t){let r=e[0]+t[0],n=e[1]+t[1];if(n>=1e9){const e=n%1e9;r+=(n-e)/1e9,n=e}return[r,n]}async function*j(e,t){const r=t[Symbol.asyncIterator]();let n=[0,0];for(;;){const t=process.hrtime(),{value:i,done:s}=await r.next(),o=process.hrtime(t);if(n=U(n,o),e.progress&&e.progress(o,n),s)return e.total&&e.total(n),i;yield i}}function*q(e,t){const r=t[Symbol.iterator]();let n=[0,0];for(;;){const t=process.hrtime(),{value:i,done:s}=r.next(),o=process.hrtime(t);if(n=U(n,o),e.progress&&e.progress(o,n),s)return e.total&&e.total(n),i;yield i}}function F(e={},t){return void 0===t?t=>F(e,t):void 0!==t[Symbol.asyncIterator]?j(e,t):q(e,t)}function V(e,t,r){const n=i(r),o=[],a=[];let u=!1,c=!1,l=0,h=null;function d(){for(;a.length>0&&o.length>0;){const{resolve:e}=a.shift();e({done:!1,value:o.shift()})}for(;a.length>0&&0===l&&u;){const{resolve:e,reject:t}=a.shift();h?(t(h),h=null):e({done:!0,value:void 0})}}async function f(){if(u)d();else if(!(c||l+o.length>=e)){c=!0,l++;try{const{done:e,value:t}=await n.next();e?(u=!0,l--,d()):p(t)}catch(e){u=!0,l--,h=e,d()}c=!1,f()}}async function p(e){try{const r=await t(e);o.push(r)}catch(e){u=!0,h=e}l--,d(),f()}async function y(){if(0===o.length){const e=s();return a.push(e),f(),e.promise}const e=o.shift();return f(),{done:!1,value:e}}const g={next:y,[Symbol.asyncIterator]:()=>g};return g}function H(e,t,r){return void 0===t?(t,r)=>r?H(e,t,r):H(e,t):void 0===r?r=>H(e,t,r):V(e,t,r)}async function z(e,t){let r=null,n=null,i=null;const s=e=>{r=e,n&&n(e)},o=()=>{i&&i()},a=()=>{e.removeListener("error",s),e.removeListener("drain",o)};e.once("error",s);const u=()=>new Promise(((t,s)=>{if(r)return s(r);e.once("drain",o),i=t,n=s}));for await(const n of t)if(!1===e.write(n)&&await u(),r)break;if(a(),r)throw r}function G(e,t){return void 0===t?t=>z(e,t):z(e,t)}e.batch=n,e.buffer=u,e.collect=l,e.concat=f,e.consume=y,e.filter=$,e.flatMap=_,e.flatTransform=E,e.flatten=m,e.fromStream=T,e.getIterator=i,e.map=v,e.merge=I,e.parallelFlatMap=B,e.parallelMap=C,e.parallelMerge=k,e.pipeline=P,e.reduce=O,e.take=M,e.tap=x,e.time=F,e.transform=H,e.writeToStream=G,Object.defineProperty(e,"__esModule",{value:!0})}(exports);var dist$1=Object.freeze({__proto__:null}),require$$4$2=getAugmentedNamespace(dist$1),hashlru=function(e){if(!e)throw Error("hashlru must have a max value, of type number, greater than 0");var t=0,r=Object.create(null),n=Object.create(null);function i(i,s){r[i]=s,++t>=e&&(t=0,n=r,r=Object.create(null))}return{has:function(e){return void 0!==r[e]||void 0!==n[e]},remove:function(e){void 0!==r[e]&&(r[e]=void 0),void 0!==n[e]&&(n[e]=void 0)},get:function(e){var t=r[e];return void 0!==t?t:void 0!==(t=n[e])?(i(e,t),t):void 0},set:function(e,t){void 0!==r[e]?r[e]=t:i(e,t)},clear:function(){r=Object.create(null),n=Object.create(null)}}};const LRU=hashlru;var oldPeers=e=>{const t=LRU(e);return t.delete=t.remove,t},bignumber={exports:{}};!function(e){!function(t){var r,n=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,i=Math.ceil,s=Math.floor,o="[BigNumber Error] ",a=o+"Number primitive has more than 15 significant digits: ",u=1e14,c=14,l=9007199254740991,h=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],d=1e7,f=1e9;function p(e){var t=0|e;return e>0||e===t?t:t-1}function y(e){for(var t,r,n=1,i=e.length,s=e[0]+"";n<i;){for(t=e[n++]+"",r=c-t.length;r--;t="0"+t);s+=t}for(i=s.length;48===s.charCodeAt(--i););return s.slice(0,i+1||1)}function g(e,t){var r,n,i=e.c,s=t.c,o=e.s,a=t.s,u=e.e,c=t.e;if(!o||!a)return null;if(r=i&&!i[0],n=s&&!s[0],r||n)return r?n?0:-a:o;if(o!=a)return o;if(r=o<0,n=u==c,!i||!s)return n?0:!i^r?1:-1;if(!n)return u>c^r?1:-1;for(a=(u=i.length)<(c=s.length)?u:c,o=0;o<a;o++)if(i[o]!=s[o])return i[o]>s[o]^r?1:-1;return u==c?0:u>c^r?1:-1}function $(e,t,r,n){if(e<t||e>r||e!==s(e))throw Error(o+(n||"Argument")+("number"==typeof e?e<t||e>r?" out of range: ":" not an integer: ":" not a primitive number: ")+String(e))}function m(e){var t=e.c.length-1;return p(e.e/c)==t&&e.c[t]%2!=0}function b(e,t){return(e.length>1?e.charAt(0)+"."+e.slice(1):e)+(t<0?"e":"e+")+t}function v(e,t,r){var n,i;if(t<0){for(i=r+".";++t;i+=r);e=i+e}else if(++t>(n=e.length)){for(i=r,t-=n;--t;i+=r);e+=i}else t<n&&(e=e.slice(0,t)+"."+e.slice(t));return e}r=function e(t){var r,_,w,E,S,A,T,I,P,R,C=F.prototype={constructor:F,toString:null,valueOf:null},B=new F(1),k=20,K=4,O=-7,N=21,D=-1e7,M=1e7,L=!1,x=1,U=0,j={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"",suffix:""},q="0123456789abcdefghijklmnopqrstuvwxyz";function F(e,t){var r,i,o,u,h,d,f,p,y=this;if(!(y instanceof F))return new F(e,t);if(null==t){if(e&&!0===e._isBigNumber)return y.s=e.s,void(!e.c||e.e>M?y.c=y.e=null:e.e<D?y.c=[y.e=0]:(y.e=e.e,y.c=e.c.slice()));if((d="number"==typeof e)&&0*e==0){if(y.s=1/e<0?(e=-e,-1):1,e===~~e){for(u=0,h=e;h>=10;h/=10,u++);return void(u>M?y.c=y.e=null:(y.e=u,y.c=[e]))}p=String(e)}else{if(!n.test(p=String(e)))return w(y,p,d);y.s=45==p.charCodeAt(0)?(p=p.slice(1),-1):1}(u=p.indexOf("."))>-1&&(p=p.replace(".","")),(h=p.search(/e/i))>0?(u<0&&(u=h),u+=+p.slice(h+1),p=p.substring(0,h)):u<0&&(u=p.length)}else{if($(t,2,q.length,"Base"),10==t)return G(y=new F(e),k+y.e+1,K);if(p=String(e),d="number"==typeof e){if(0*e!=0)return w(y,p,d,t);if(y.s=1/e<0?(p=p.slice(1),-1):1,F.DEBUG&&p.replace(/^0\.0*|\./,"").length>15)throw Error(a+e)}else y.s=45===p.charCodeAt(0)?(p=p.slice(1),-1):1;for(r=q.slice(0,t),u=h=0,f=p.length;h<f;h++)if(r.indexOf(i=p.charAt(h))<0){if("."==i){if(h>u){u=f;continue}}else if(!o&&(p==p.toUpperCase()&&(p=p.toLowerCase())||p==p.toLowerCase()&&(p=p.toUpperCase()))){o=!0,h=-1,u=0;continue}return w(y,String(e),d,t)}d=!1,(u=(p=_(p,t,10,y.s)).indexOf("."))>-1?p=p.replace(".",""):u=p.length}for(h=0;48===p.charCodeAt(h);h++);for(f=p.length;48===p.charCodeAt(--f););if(p=p.slice(h,++f)){if(f-=h,d&&F.DEBUG&&f>15&&(e>l||e!==s(e)))throw Error(a+y.s*e);if((u=u-h-1)>M)y.c=y.e=null;else if(u<D)y.c=[y.e=0];else{if(y.e=u,y.c=[],h=(u+1)%c,u<0&&(h+=c),h<f){for(h&&y.c.push(+p.slice(0,h)),f-=c;h<f;)y.c.push(+p.slice(h,h+=c));h=c-(p=p.slice(h)).length}else h-=f;for(;h--;p+="0");y.c.push(+p)}}else y.c=[y.e=0]}function V(e,t,r,n){var i,s,o,a,u;if(null==r?r=K:$(r,0,8),!e.c)return e.toString();if(i=e.c[0],o=e.e,null==t)u=y(e.c),u=1==n||2==n&&(o<=O||o>=N)?b(u,o):v(u,o,"0");else if(s=(e=G(new F(e),t,r)).e,a=(u=y(e.c)).length,1==n||2==n&&(t<=s||s<=O)){for(;a<t;u+="0",a++);u=b(u,s)}else if(t-=o,u=v(u,s,"0"),s+1>a){if(--t>0)for(u+=".";t--;u+="0");}else if((t+=s-a)>0)for(s+1==a&&(u+=".");t--;u+="0");return e.s<0&&i?"-"+u:u}function H(e,t){for(var r,n=1,i=new F(e[0]);n<e.length;n++){if(!(r=new F(e[n])).s){i=r;break}t.call(i,r)&&(i=r)}return i}function z(e,t,r){for(var n=1,i=t.length;!t[--i];t.pop());for(i=t[0];i>=10;i/=10,n++);return(r=n+r*c-1)>M?e.c=e.e=null:r<D?e.c=[e.e=0]:(e.e=r,e.c=t),e}function G(e,t,r,n){var o,a,l,d,f,p,y,g=e.c,$=h;if(g){e:{for(o=1,d=g[0];d>=10;d/=10,o++);if((a=t-o)<0)a+=c,l=t,y=(f=g[p=0])/$[o-l-1]%10|0;else if((p=i((a+1)/c))>=g.length){if(!n)break e;for(;g.length<=p;g.push(0));f=y=0,o=1,l=(a%=c)-c+1}else{for(f=d=g[p],o=1;d>=10;d/=10,o++);y=(l=(a%=c)-c+o)<0?0:f/$[o-l-1]%10|0}if(n=n||t<0||null!=g[p+1]||(l<0?f:f%$[o-l-1]),n=r<4?(y||n)&&(0==r||r==(e.s<0?3:2)):y>5||5==y&&(4==r||n||6==r&&(a>0?l>0?f/$[o-l]:0:g[p-1])%10&1||r==(e.s<0?8:7)),t<1||!g[0])return g.length=0,n?(t-=e.e+1,g[0]=$[(c-t%c)%c],e.e=-t||0):g[0]=e.e=0,e;if(0==a?(g.length=p,d=1,p--):(g.length=p+1,d=$[c-a],g[p]=l>0?s(f/$[o-l]%$[l])*d:0),n)for(;;){if(0==p){for(a=1,l=g[0];l>=10;l/=10,a++);for(l=g[0]+=d,d=1;l>=10;l/=10,d++);a!=d&&(e.e++,g[0]==u&&(g[0]=1));break}if(g[p]+=d,g[p]!=u)break;g[p--]=0,d=1}for(a=g.length;0===g[--a];g.pop());}e.e>M?e.c=e.e=null:e.e<D&&(e.c=[e.e=0])}return e}function W(e){var t,r=e.e;return null===r?e.toString():(t=y(e.c),t=r<=O||r>=N?b(t,r):v(t,r,"0"),e.s<0?"-"+t:t)}return F.clone=e,F.ROUND_UP=0,F.ROUND_DOWN=1,F.ROUND_CEIL=2,F.ROUND_FLOOR=3,F.ROUND_HALF_UP=4,F.ROUND_HALF_DOWN=5,F.ROUND_HALF_EVEN=6,F.ROUND_HALF_CEIL=7,F.ROUND_HALF_FLOOR=8,F.EUCLID=9,F.config=F.set=function(e){var t,r;if(null!=e){if("object"!=typeof e)throw Error(o+"Object expected: "+e);if(e.hasOwnProperty(t="DECIMAL_PLACES")&&($(r=e[t],0,f,t),k=r),e.hasOwnProperty(t="ROUNDING_MODE")&&($(r=e[t],0,8,t),K=r),e.hasOwnProperty(t="EXPONENTIAL_AT")&&((r=e[t])&&r.pop?($(r[0],-f,0,t),$(r[1],0,f,t),O=r[0],N=r[1]):($(r,-f,f,t),O=-(N=r<0?-r:r))),e.hasOwnProperty(t="RANGE"))if((r=e[t])&&r.pop)$(r[0],-f,-1,t),$(r[1],1,f,t),D=r[0],M=r[1];else{if($(r,-f,f,t),!r)throw Error(o+t+" cannot be zero: "+r);D=-(M=r<0?-r:r)}if(e.hasOwnProperty(t="CRYPTO")){if((r=e[t])!==!!r)throw Error(o+t+" not true or false: "+r);if(r){if("undefined"==typeof crypto||!crypto||!crypto.getRandomValues&&!crypto.randomBytes)throw L=!r,Error(o+"crypto unavailable");L=r}else L=r}if(e.hasOwnProperty(t="MODULO_MODE")&&($(r=e[t],0,9,t),x=r),e.hasOwnProperty(t="POW_PRECISION")&&($(r=e[t],0,f,t),U=r),e.hasOwnProperty(t="FORMAT")){if("object"!=typeof(r=e[t]))throw Error(o+t+" not an object: "+r);j=r}if(e.hasOwnProperty(t="ALPHABET")){if("string"!=typeof(r=e[t])||/^.?$|[+\-.\s]|(.).*\1/.test(r))throw Error(o+t+" invalid: "+r);q=r}}return{DECIMAL_PLACES:k,ROUNDING_MODE:K,EXPONENTIAL_AT:[O,N],RANGE:[D,M],CRYPTO:L,MODULO_MODE:x,POW_PRECISION:U,FORMAT:j,ALPHABET:q}},F.isBigNumber=function(e){if(!e||!0!==e._isBigNumber)return!1;if(!F.DEBUG)return!0;var t,r,n=e.c,i=e.e,a=e.s;e:if("[object Array]"=={}.toString.call(n)){if((1===a||-1===a)&&i>=-f&&i<=f&&i===s(i)){if(0===n[0]){if(0===i&&1===n.length)return!0;break e}if((t=(i+1)%c)<1&&(t+=c),String(n[0]).length==t){for(t=0;t<n.length;t++)if((r=n[t])<0||r>=u||r!==s(r))break e;if(0!==r)return!0}}}else if(null===n&&null===i&&(null===a||1===a||-1===a))return!0;throw Error(o+"Invalid BigNumber: "+e)},F.maximum=F.max=function(){return H(arguments,C.lt)},F.minimum=F.min=function(){return H(arguments,C.gt)},F.random=(E=9007199254740992,S=Math.random()*E&2097151?function(){return s(Math.random()*E)}:function(){return 8388608*(1073741824*Math.random()|0)+(8388608*Math.random()|0)},function(e){var t,r,n,a,u,l=0,d=[],p=new F(B);if(null==e?e=k:$(e,0,f),a=i(e/c),L)if(crypto.getRandomValues){for(t=crypto.getRandomValues(new Uint32Array(a*=2));l<a;)(u=131072*t[l]+(t[l+1]>>>11))>=9e15?(r=crypto.getRandomValues(new Uint32Array(2)),t[l]=r[0],t[l+1]=r[1]):(d.push(u%1e14),l+=2);l=a/2}else{if(!crypto.randomBytes)throw L=!1,Error(o+"crypto unavailable");for(t=crypto.randomBytes(a*=7);l<a;)(u=281474976710656*(31&t[l])+1099511627776*t[l+1]+4294967296*t[l+2]+16777216*t[l+3]+(t[l+4]<<16)+(t[l+5]<<8)+t[l+6])>=9e15?crypto.randomBytes(7).copy(t,l):(d.push(u%1e14),l+=7);l=a/7}if(!L)for(;l<a;)(u=S())<9e15&&(d[l++]=u%1e14);for(a=d[--l],e%=c,a&&e&&(u=h[c-e],d[l]=s(a/u)*u);0===d[l];d.pop(),l--);if(l<0)d=[n=0];else{for(n=-1;0===d[0];d.splice(0,1),n-=c);for(l=1,u=d[0];u>=10;u/=10,l++);l<c&&(n-=c-l)}return p.e=n,p.c=d,p}),F.sum=function(){for(var e=1,t=arguments,r=new F(t[0]);e<t.length;)r=r.plus(t[e++]);return r},_=function(){var e="0123456789";function t(e,t,r,n){for(var i,s,o=[0],a=0,u=e.length;a<u;){for(s=o.length;s--;o[s]*=t);for(o[0]+=n.indexOf(e.charAt(a++)),i=0;i<o.length;i++)o[i]>r-1&&(null==o[i+1]&&(o[i+1]=0),o[i+1]+=o[i]/r|0,o[i]%=r)}return o.reverse()}return function(n,i,s,o,a){var u,c,l,h,d,f,p,g,$=n.indexOf("."),m=k,b=K;for($>=0&&(h=U,U=0,n=n.replace(".",""),f=(g=new F(i)).pow(n.length-$),U=h,g.c=t(v(y(f.c),f.e,"0"),10,s,e),g.e=g.c.length),l=h=(p=t(n,i,s,a?(u=q,e):(u=e,q))).length;0==p[--h];p.pop());if(!p[0])return u.charAt(0);if($<0?--l:(f.c=p,f.e=l,f.s=o,p=(f=r(f,g,m,b,s)).c,d=f.r,l=f.e),$=p[c=l+m+1],h=s/2,d=d||c<0||null!=p[c+1],d=b<4?(null!=$||d)&&(0==b||b==(f.s<0?3:2)):$>h||$==h&&(4==b||d||6==b&&1&p[c-1]||b==(f.s<0?8:7)),c<1||!p[0])n=d?v(u.charAt(1),-m,u.charAt(0)):u.charAt(0);else{if(p.length=c,d)for(--s;++p[--c]>s;)p[c]=0,c||(++l,p=[1].concat(p));for(h=p.length;!p[--h];);for($=0,n="";$<=h;n+=u.charAt(p[$++]));n=v(n,l,u.charAt(0))}return n}}(),r=function(){function e(e,t,r){var n,i,s,o,a=0,u=e.length,c=t%d,l=t/d|0;for(e=e.slice();u--;)a=((i=c*(s=e[u]%d)+(n=l*s+(o=e[u]/d|0)*c)%d*d+a)/r|0)+(n/d|0)+l*o,e[u]=i%r;return a&&(e=[a].concat(e)),e}function t(e,t,r,n){var i,s;if(r!=n)s=r>n?1:-1;else for(i=s=0;i<r;i++)if(e[i]!=t[i]){s=e[i]>t[i]?1:-1;break}return s}function r(e,t,r,n){for(var i=0;r--;)e[r]-=i,i=e[r]<t[r]?1:0,e[r]=i*n+e[r]-t[r];for(;!e[0]&&e.length>1;e.splice(0,1));}return function(n,i,o,a,l){var h,d,f,y,g,$,m,b,v,_,w,E,S,A,T,I,P,R=n.s==i.s?1:-1,C=n.c,B=i.c;if(!(C&&C[0]&&B&&B[0]))return new F(n.s&&i.s&&(C?!B||C[0]!=B[0]:B)?C&&0==C[0]||!B?0*R:R/0:NaN);for(v=(b=new F(R)).c=[],R=o+(d=n.e-i.e)+1,l||(l=u,d=p(n.e/c)-p(i.e/c),R=R/c|0),f=0;B[f]==(C[f]||0);f++);if(B[f]>(C[f]||0)&&d--,R<0)v.push(1),y=!0;else{for(A=C.length,I=B.length,f=0,R+=2,(g=s(l/(B[0]+1)))>1&&(B=e(B,g,l),C=e(C,g,l),I=B.length,A=C.length),S=I,w=(_=C.slice(0,I)).length;w<I;_[w++]=0);P=B.slice(),P=[0].concat(P),T=B[0],B[1]>=l/2&&T++;do{if(g=0,(h=t(B,_,I,w))<0){if(E=_[0],I!=w&&(E=E*l+(_[1]||0)),(g=s(E/T))>1)for(g>=l&&(g=l-1),m=($=e(B,g,l)).length,w=_.length;1==t($,_,m,w);)g--,r($,I<m?P:B,m,l),m=$.length,h=1;else 0==g&&(h=g=1),m=($=B.slice()).length;if(m<w&&($=[0].concat($)),r(_,$,w,l),w=_.length,-1==h)for(;t(B,_,I,w)<1;)g++,r(_,I<w?P:B,w,l),w=_.length}else 0===h&&(g++,_=[0]);v[f++]=g,_[0]?_[w++]=C[S]||0:(_=[C[S]],w=1)}while((S++<A||null!=_[0])&&R--);y=null!=_[0],v[0]||v.splice(0,1)}if(l==u){for(f=1,R=v[0];R>=10;R/=10,f++);G(b,o+(b.e=f+d*c-1)+1,a,y)}else b.e=d,b.r=+y;return b}}(),A=/^(-?)0([xbo])(?=\w[\w.]*$)/i,T=/^([^.]+)\.$/,I=/^\.([^.]+)$/,P=/^-?(Infinity|NaN)$/,R=/^\s*\+(?=[\w.])|^\s+|\s+$/g,w=function(e,t,r,n){var i,s=r?t:t.replace(R,"");if(P.test(s))e.s=isNaN(s)?null:s<0?-1:1;else{if(!r&&(s=s.replace(A,(function(e,t,r){return i="x"==(r=r.toLowerCase())?16:"b"==r?2:8,n&&n!=i?e:t})),n&&(i=n,s=s.replace(T,"$1").replace(I,"0.$1")),t!=s))return new F(s,i);if(F.DEBUG)throw Error(o+"Not a"+(n?" base "+n:"")+" number: "+t);e.s=null}e.c=e.e=null},C.absoluteValue=C.abs=function(){var e=new F(this);return e.s<0&&(e.s=1),e},C.comparedTo=function(e,t){return g(this,new F(e,t))},C.decimalPlaces=C.dp=function(e,t){var r,n,i,s=this;if(null!=e)return $(e,0,f),null==t?t=K:$(t,0,8),G(new F(s),e+s.e+1,t);if(!(r=s.c))return null;if(n=((i=r.length-1)-p(this.e/c))*c,i=r[i])for(;i%10==0;i/=10,n--);return n<0&&(n=0),n},C.dividedBy=C.div=function(e,t){return r(this,new F(e,t),k,K)},C.dividedToIntegerBy=C.idiv=function(e,t){return r(this,new F(e,t),0,1)},C.exponentiatedBy=C.pow=function(e,t){var r,n,a,u,l,h,d,f,p=this;if((e=new F(e)).c&&!e.isInteger())throw Error(o+"Exponent not an integer: "+W(e));if(null!=t&&(t=new F(t)),l=e.e>14,!p.c||!p.c[0]||1==p.c[0]&&!p.e&&1==p.c.length||!e.c||!e.c[0])return f=new F(Math.pow(+W(p),l?2-m(e):+W(e))),t?f.mod(t):f;if(h=e.s<0,t){if(t.c?!t.c[0]:!t.s)return new F(NaN);(n=!h&&p.isInteger()&&t.isInteger())&&(p=p.mod(t))}else{if(e.e>9&&(p.e>0||p.e<-1||(0==p.e?p.c[0]>1||l&&p.c[1]>=24e7:p.c[0]<8e13||l&&p.c[0]<=9999975e7)))return u=p.s<0&&m(e)?-0:0,p.e>-1&&(u=1/u),new F(h?1/u:u);U&&(u=i(U/c+2))}for(l?(r=new F(.5),h&&(e.s=1),d=m(e)):d=(a=Math.abs(+W(e)))%2,f=new F(B);;){if(d){if(!(f=f.times(p)).c)break;u?f.c.length>u&&(f.c.length=u):n&&(f=f.mod(t))}if(a){if(0===(a=s(a/2)))break;d=a%2}else if(G(e=e.times(r),e.e+1,1),e.e>14)d=m(e);else{if(0===(a=+W(e)))break;d=a%2}p=p.times(p),u?p.c&&p.c.length>u&&(p.c.length=u):n&&(p=p.mod(t))}return n?f:(h&&(f=B.div(f)),t?f.mod(t):u?G(f,U,K,undefined):f)},C.integerValue=function(e){var t=new F(this);return null==e?e=K:$(e,0,8),G(t,t.e+1,e)},C.isEqualTo=C.eq=function(e,t){return 0===g(this,new F(e,t))},C.isFinite=function(){return!!this.c},C.isGreaterThan=C.gt=function(e,t){return g(this,new F(e,t))>0},C.isGreaterThanOrEqualTo=C.gte=function(e,t){return 1===(t=g(this,new F(e,t)))||0===t},C.isInteger=function(){return!!this.c&&p(this.e/c)>this.c.length-2},C.isLessThan=C.lt=function(e,t){return g(this,new F(e,t))<0},C.isLessThanOrEqualTo=C.lte=function(e,t){return-1===(t=g(this,new F(e,t)))||0===t},C.isNaN=function(){return!this.s},C.isNegative=function(){return this.s<0},C.isPositive=function(){return this.s>0},C.isZero=function(){return!!this.c&&0==this.c[0]},C.minus=function(e,t){var r,n,i,s,o=this,a=o.s;if(t=(e=new F(e,t)).s,!a||!t)return new F(NaN);if(a!=t)return e.s=-t,o.plus(e);var l=o.e/c,h=e.e/c,d=o.c,f=e.c;if(!l||!h){if(!d||!f)return d?(e.s=-t,e):new F(f?o:NaN);if(!d[0]||!f[0])return f[0]?(e.s=-t,e):new F(d[0]?o:3==K?-0:0)}if(l=p(l),h=p(h),d=d.slice(),a=l-h){for((s=a<0)?(a=-a,i=d):(h=l,i=f),i.reverse(),t=a;t--;i.push(0));i.reverse()}else for(n=(s=(a=d.length)<(t=f.length))?a:t,a=t=0;t<n;t++)if(d[t]!=f[t]){s=d[t]<f[t];break}if(s&&(i=d,d=f,f=i,e.s=-e.s),(t=(n=f.length)-(r=d.length))>0)for(;t--;d[r++]=0);for(t=u-1;n>a;){if(d[--n]<f[n]){for(r=n;r&&!d[--r];d[r]=t);--d[r],d[n]+=u}d[n]-=f[n]}for(;0==d[0];d.splice(0,1),--h);return d[0]?z(e,d,h):(e.s=3==K?-1:1,e.c=[e.e=0],e)},C.modulo=C.mod=function(e,t){var n,i,s=this;return e=new F(e,t),!s.c||!e.s||e.c&&!e.c[0]?new F(NaN):!e.c||s.c&&!s.c[0]?new F(s):(9==x?(i=e.s,e.s=1,n=r(s,e,0,3),e.s=i,n.s*=i):n=r(s,e,0,x),(e=s.minus(n.times(e))).c[0]||1!=x||(e.s=s.s),e)},C.multipliedBy=C.times=function(e,t){var r,n,i,s,o,a,l,h,f,y,g,$,m,b,v,_=this,w=_.c,E=(e=new F(e,t)).c;if(!(w&&E&&w[0]&&E[0]))return!_.s||!e.s||w&&!w[0]&&!E||E&&!E[0]&&!w?e.c=e.e=e.s=null:(e.s*=_.s,w&&E?(e.c=[0],e.e=0):e.c=e.e=null),e;for(n=p(_.e/c)+p(e.e/c),e.s*=_.s,(l=w.length)<(y=E.length)&&(m=w,w=E,E=m,i=l,l=y,y=i),i=l+y,m=[];i--;m.push(0));for(b=u,v=d,i=y;--i>=0;){for(r=0,g=E[i]%v,$=E[i]/v|0,s=i+(o=l);s>i;)r=((h=g*(h=w[--o]%v)+(a=$*h+(f=w[o]/v|0)*g)%v*v+m[s]+r)/b|0)+(a/v|0)+$*f,m[s--]=h%b;m[s]=r}return r?++n:m.splice(0,1),z(e,m,n)},C.negated=function(){var e=new F(this);return e.s=-e.s||null,e},C.plus=function(e,t){var r,n=this,i=n.s;if(t=(e=new F(e,t)).s,!i||!t)return new F(NaN);if(i!=t)return e.s=-t,n.minus(e);var s=n.e/c,o=e.e/c,a=n.c,l=e.c;if(!s||!o){if(!a||!l)return new F(i/0);if(!a[0]||!l[0])return l[0]?e:new F(a[0]?n:0*i)}if(s=p(s),o=p(o),a=a.slice(),i=s-o){for(i>0?(o=s,r=l):(i=-i,r=a),r.reverse();i--;r.push(0));r.reverse()}for((i=a.length)-(t=l.length)<0&&(r=l,l=a,a=r,t=i),i=0;t;)i=(a[--t]=a[t]+l[t]+i)/u|0,a[t]=u===a[t]?0:a[t]%u;return i&&(a=[i].concat(a),++o),z(e,a,o)},C.precision=C.sd=function(e,t){var r,n,i,s=this;if(null!=e&&e!==!!e)return $(e,1,f),null==t?t=K:$(t,0,8),G(new F(s),e,t);if(!(r=s.c))return null;if(n=(i=r.length-1)*c+1,i=r[i]){for(;i%10==0;i/=10,n--);for(i=r[0];i>=10;i/=10,n++);}return e&&s.e+1>n&&(n=s.e+1),n},C.shiftedBy=function(e){return $(e,-9007199254740991,l),this.times("1e"+e)},C.squareRoot=C.sqrt=function(){var e,t,n,i,s,o=this,a=o.c,u=o.s,c=o.e,l=k+4,h=new F("0.5");if(1!==u||!a||!a[0])return new F(!u||u<0&&(!a||a[0])?NaN:a?o:1/0);if(0==(u=Math.sqrt(+W(o)))||u==1/0?(((t=y(a)).length+c)%2==0&&(t+="0"),u=Math.sqrt(+t),c=p((c+1)/2)-(c<0||c%2),n=new F(t=u==1/0?"5e"+c:(t=u.toExponential()).slice(0,t.indexOf("e")+1)+c)):n=new F(u+""),n.c[0])for((u=(c=n.e)+l)<3&&(u=0);;)if(s=n,n=h.times(s.plus(r(o,s,l,1))),y(s.c).slice(0,u)===(t=y(n.c)).slice(0,u)){if(n.e<c&&--u,"9999"!=(t=t.slice(u-3,u+1))&&(i||"4999"!=t)){+t&&(+t.slice(1)||"5"!=t.charAt(0))||(G(n,n.e+k+2,1),e=!n.times(n).eq(o));break}if(!i&&(G(s,s.e+k+2,0),s.times(s).eq(o))){n=s;break}l+=4,u+=4,i=1}return G(n,n.e+k+1,K,e)},C.toExponential=function(e,t){return null!=e&&($(e,0,f),e++),V(this,e,t,1)},C.toFixed=function(e,t){return null!=e&&($(e,0,f),e=e+this.e+1),V(this,e,t)},C.toFormat=function(e,t,r){var n,i=this;if(null==r)null!=e&&t&&"object"==typeof t?(r=t,t=null):e&&"object"==typeof e?(r=e,e=t=null):r=j;else if("object"!=typeof r)throw Error(o+"Argument not an object: "+r);if(n=i.toFixed(e,t),i.c){var s,a=n.split("."),u=+r.groupSize,c=+r.secondaryGroupSize,l=r.groupSeparator||"",h=a[0],d=a[1],f=i.s<0,p=f?h.slice(1):h,y=p.length;if(c&&(s=u,u=c,c=s,y-=s),u>0&&y>0){for(s=y%u||u,h=p.substr(0,s);s<y;s+=u)h+=l+p.substr(s,u);c>0&&(h+=l+p.slice(s)),f&&(h="-"+h)}n=d?h+(r.decimalSeparator||"")+((c=+r.fractionGroupSize)?d.replace(new RegExp("\\d{"+c+"}\\B","g"),"$&"+(r.fractionGroupSeparator||"")):d):h}return(r.prefix||"")+n+(r.suffix||"")},C.toFraction=function(e){var t,n,i,s,a,u,l,d,f,p,g,$,m=this,b=m.c;if(null!=e&&(!(l=new F(e)).isInteger()&&(l.c||1!==l.s)||l.lt(B)))throw Error(o+"Argument "+(l.isInteger()?"out of range: ":"not an integer: ")+W(l));if(!b)return new F(m);for(t=new F(B),f=n=new F(B),i=d=new F(B),$=y(b),a=t.e=$.length-m.e-1,t.c[0]=h[(u=a%c)<0?c+u:u],e=!e||l.comparedTo(t)>0?a>0?t:f:l,u=M,M=1/0,l=new F($),d.c[0]=0;p=r(l,t,0,1),1!=(s=n.plus(p.times(i))).comparedTo(e);)n=i,i=s,f=d.plus(p.times(s=f)),d=s,t=l.minus(p.times(s=t)),l=s;return s=r(e.minus(n),i,0,1),d=d.plus(s.times(f)),n=n.plus(s.times(i)),d.s=f.s=m.s,g=r(f,i,a*=2,K).minus(m).abs().comparedTo(r(d,n,a,K).minus(m).abs())<1?[f,i]:[d,n],M=u,g},C.toNumber=function(){return+W(this)},C.toPrecision=function(e,t){return null!=e&&$(e,1,f),V(this,e,t,2)},C.toString=function(e){var t,r=this,n=r.s,i=r.e;return null===i?n?(t="Infinity",n<0&&(t="-"+t)):t="NaN":(null==e?t=i<=O||i>=N?b(y(r.c),i):v(y(r.c),i,"0"):10===e?t=v(y((r=G(new F(r),k+i+1,K)).c),r.e,"0"):($(e,2,q.length,"Base"),t=_(v(y(r.c),i,"0"),10,e,n,!0)),n<0&&r.c[0]&&(t="-"+t)),t},C.valueOf=C.toJSON=function(){return W(this)},C._isBigNumber=!0,null!=t&&F.set(t),F}(),r.default=r.BigNumber=r,e.exports?e.exports=r:(t||(t="undefined"!=typeof self&&self?self:window),t.BigNumber=r)}(commonjsGlobal)}(bignumber);var movingAverage={exports:{}};!function(e,t){const r=Math.exp;e.exports=function(e){if("number"!=typeof e)throw new Error("must provide a timespan to the moving average constructor");if(e<=0)throw new Error("must provide a timespan > 0 to the moving average constructor");let t,n,i=0,s=0,o=0,a={};return a.push=function(a,u){if(n){const c=1-r(-(a-n)/e),l=u-t;t=c*u+(1-c)*t,i=(1-c)*(i+l*(c*l)),s=Math.sqrt(i),o=t+c*l}else t=u;n=a},a.movingAverage=function(){return t},a.variance=function(){return i},a.deviation=function(){return s},a.forecast=function(){return o},a}}(movingAverage);const{EventEmitter:EventEmitter$7}=require$$1$9,{BigNumber:Big}=bignumber.exports,MovingAverage=movingAverage.exports,retimer=retimer_1;class Stats$1 extends EventEmitter$7{constructor(e,t){super(),this._options=t,this._queue=[],this._stats={dataReceived:Big(0),dataSent:Big(0)},this._frequencyLastTime=Date.now(),this._frequencyAccumulators={},this._movingAverages={},this._update=this._update.bind(this);const r=this._options.movingAverageIntervals;for(let t=0;t<e.length;t++){const n=e[t];this._stats[n]=Big(0),this._movingAverages[n]={};for(let e=0;e<r.length;e++){const t=r[e];(this._movingAverages[n][t]=MovingAverage(t)).push(this._frequencyLastTime,0)}}}start(){this._queue.length&&this._resetComputeTimeout()}stop(){this._timeout&&(this._timeout.clear(),this._timeout=null)}get snapshot(){return Object.assign({},this._stats)}get movingAverages(){return Object.assign({},this._movingAverages)}toJSON(){const e=this.snapshot,t=this.movingAverages,r={dataReceived:e.dataReceived.toString(),dataSent:e.dataSent.toString(),movingAverages:{}},n=Object.keys(t);for(const e of n){r.movingAverages[e]={};for(const n of Object.keys(t[e]))r.movingAverages[e][n]=t[e][n].movingAverage()}return r}push(e,t){this._queue.push([e,t,Date.now()]),this._resetComputeTimeout()}_resetComputeTimeout(){this._timeout=retimer(this._update,this._nextTimeout())}_nextTimeout(){const e=this._queue.length/this._options.computeThrottleMaxQueueSize;return Math.max(this._options.computeThrottleTimeout*(1-e),0)}_update(){if(this._timeout=null,this._queue.length){let e;for(e of this._queue)this._applyOp(e);this._queue=[],this._updateFrequency(e[2]),this.emit("update",this._stats)}}_updateFrequency(e){const t=e-this._frequencyLastTime;Object.keys(this._stats).forEach((r=>{this._updateFrequencyFor(r,t,e)})),this._frequencyLastTime=e}_updateFrequencyFor(e,t,r){const n=this._frequencyAccumulators[e]||0;this._frequencyAccumulators[e]=0;const i=n/(t||1)*1e3;let s=this._movingAverages[e];s||(s=this._movingAverages[e]={});const o=this._options.movingAverageIntervals;for(let e=0;e<o.length;e++){const t=o[e];let n=s[t];n||(n=s[t]=MovingAverage(t)),n.push(r,i)}}_applyOp(e){const t=e[0],r=e[1];if("number"!=typeof r)throw new Error(`invalid increment number: ${r}`);let n;n=Object.prototype.hasOwnProperty.call(this._stats,t)?this._stats[t]:this._stats[t]=Big(0),this._stats[t]=n.plus(r),this._frequencyAccumulators[t]||(this._frequencyAccumulators[t]=0),this._frequencyAccumulators[t]+=r}}var stats=Stats$1;const mergeOptions=mergeOptions$5,{pipe:pipe$7}=itPipe.exports,{tap:tap}=require$$4$2,oldPeerLRU=oldPeers,{METRICS:defaultOptions}=constants$9,Stats=stats,initialCounters=["dataReceived","dataSent"],directionToEvent={in:"dataReceived",out:"dataSent"};class Metrics$1{constructor(e){this._options=mergeOptions(defaultOptions,e),this._globalStats=new Stats(initialCounters,this._options),this._peerStats=new Map,this._protocolStats=new Map,this._oldPeers=oldPeerLRU(this._options.maxOldPeersRetention),this._running=!1,this._onMessage=this._onMessage.bind(this),this._connectionManager=e.connectionManager,this._connectionManager.on("peer:disconnect",(e=>{this.onPeerDisconnected(e.remotePeer)}))}start(){this._running=!0}stop(){this._running=!1,this._globalStats.stop();for(const e of this._peerStats.values())e.stop();for(const e of this._protocolStats.values())e.stop()}get global(){return this._globalStats}get peers(){return Array.from(this._peerStats.keys())}forPeer(e){const t=e.toB58String();return this._peerStats.get(t)||this._oldPeers.get(t)}get protocols(){return Array.from(this._protocolStats.keys())}forProtocol(e){return this._protocolStats.get(e)}onPeerDisconnected(e){const t=e.toB58String(),r=this._peerStats.get(t);r&&(r.stop(),this._peerStats.delete(t),this._oldPeers.set(t,r))}_onMessage({remotePeer:e,protocol:t,direction:r,dataLength:n}){if(!this._running)return;const i=directionToEvent[r];let s=this.forPeer(e);if(s||(s=new Stats(initialCounters,this._options),this._peerStats.set(e.toB58String(),s)),s.push(i,n),this._globalStats.push(i,n),t){let e=this.forProtocol(t);e||(e=new Stats(initialCounters,this._options),this._protocolStats.set(t,e)),e.push(i,n)}}updatePlaceholder(e,t){if(!this._running)return;const r=this.forPeer(e),n=t.toB58String(),i=this.forPeer(t);let s=r;i&&(s=Metrics$1.mergeStats(i,s),this._oldPeers.delete(n)),this._peerStats.delete(e.toB58String()),this._peerStats.set(n,s),s.start()}trackStream({stream:e,remotePeer:t,protocol:r}){const n=this,i=e.source;e.source=tap((e=>n._onMessage({remotePeer:t,protocol:r,direction:"in",dataLength:e.length})))(i);const s=e.sink;return e.sink=e=>pipe$7(e,tap((e=>n._onMessage({remotePeer:t,protocol:r,direction:"out",dataLength:e.length}))),s),e}static mergeStats(e,t){return e.stop(),t.stop(),e._queue=[...e._queue,...t._queue],e}}var metrics=Metrics$1,src$f={},multistream$3={};const{Buffer:Buffer$7}=require$$0$7,symbol$2=Symbol.for("BufferList");function BufferList$7(e){if(!(this instanceof BufferList$7))return new BufferList$7(e);BufferList$7._init.call(this,e)}BufferList$7._init=function(e){Object.defineProperty(this,symbol$2,{value:!0}),this._bufs=[],this.length=0,e&&this.append(e)},BufferList$7.prototype._new=function(e){return new BufferList$7(e)},BufferList$7.prototype._offset=function(e){if(0===e)return[0,0];let t=0;for(let r=0;r<this._bufs.length;r++){const n=t+this._bufs[r].length;if(e<n||r===this._bufs.length-1)return[r,e-t];t=n}},BufferList$7.prototype._reverseOffset=function(e){const t=e[0];let r=e[1];for(let e=0;e<t;e++)r+=this._bufs[e].length;return r},BufferList$7.prototype.get=function(e){if(e>this.length||e<0)return;const t=this._offset(e);return this._bufs[t[0]][t[1]]},BufferList$7.prototype.slice=function(e,t){return"number"==typeof e&&e<0&&(e+=this.length),"number"==typeof t&&t<0&&(t+=this.length),this.copy(null,0,e,t)},BufferList$7.prototype.copy=function(e,t,r,n){if(("number"!=typeof r||r<0)&&(r=0),("number"!=typeof n||n>this.length)&&(n=this.length),r>=this.length)return e||Buffer$7.alloc(0);if(n<=0)return e||Buffer$7.alloc(0);const i=!!e,s=this._offset(r),o=n-r;let a=o,u=i&&t||0,c=s[1];if(0===r&&n===this.length){if(!i)return 1===this._bufs.length?this._bufs[0]:Buffer$7.concat(this._bufs,this.length);for(let t=0;t<this._bufs.length;t++)this._bufs[t].copy(e,u),u+=this._bufs[t].length;return e}if(a<=this._bufs[s[0]].length-c)return i?this._bufs[s[0]].copy(e,t,c,c+a):this._bufs[s[0]].slice(c,c+a);i||(e=Buffer$7.allocUnsafe(o));for(let t=s[0];t<this._bufs.length;t++){const r=this._bufs[t].length-c;if(!(a>r)){this._bufs[t].copy(e,u,c,c+a),u+=r;break}this._bufs[t].copy(e,u,c),u+=r,a-=r,c&&(c=0)}return e.length>u?e.slice(0,u):e},BufferList$7.prototype.shallowSlice=function(e,t){if(e=e||0,t="number"!=typeof t?this.length:t,e<0&&(e+=this.length),t<0&&(t+=this.length),e===t)return this._new();const r=this._offset(e),n=this._offset(t),i=this._bufs.slice(r[0],n[0]+1);return 0===n[1]?i.pop():i[i.length-1]=i[i.length-1].slice(0,n[1]),0!==r[1]&&(i[0]=i[0].slice(r[1])),this._new(i)},BufferList$7.prototype.toString=function(e,t,r){return this.slice(t,r).toString(e)},BufferList$7.prototype.consume=function(e){if(e=Math.trunc(e),Number.isNaN(e)||e<=0)return this;for(;this._bufs.length;){if(!(e>=this._bufs[0].length)){this._bufs[0]=this._bufs[0].slice(e),this.length-=e;break}e-=this._bufs[0].length,this.length-=this._bufs[0].length,this._bufs.shift()}return this},BufferList$7.prototype.duplicate=function(){const e=this._new();for(let t=0;t<this._bufs.length;t++)e.append(this._bufs[t]);return e},BufferList$7.prototype.append=function(e){if(null==e)return this;if(e.buffer)this._appendBuffer(Buffer$7.from(e.buffer,e.byteOffset,e.byteLength));else if(Array.isArray(e))for(let t=0;t<e.length;t++)this.append(e[t]);else if(this._isBufferList(e))for(let t=0;t<e._bufs.length;t++)this.append(e._bufs[t]);else"number"==typeof e&&(e=e.toString()),this._appendBuffer(Buffer$7.from(e));return this},BufferList$7.prototype._appendBuffer=function(e){this._bufs.push(e),this.length+=e.length},BufferList$7.prototype.indexOf=function(e,t,r){if(void 0===r&&"string"==typeof t&&(r=t,t=void 0),"function"==typeof e||Array.isArray(e))throw new TypeError('The "value" argument must be one of type string, Buffer, BufferList, or Uint8Array.');if("number"==typeof e?e=Buffer$7.from([e]):"string"==typeof e?e=Buffer$7.from(e,r):this._isBufferList(e)?e=e.slice():Array.isArray(e.buffer)?e=Buffer$7.from(e.buffer,e.byteOffset,e.byteLength):Buffer$7.isBuffer(e)||(e=Buffer$7.from(e)),t=Number(t||0),isNaN(t)&&(t=0),t<0&&(t=this.length+t),t<0&&(t=0),0===e.length)return t>this.length?this.length:t;const n=this._offset(t);let i=n[0],s=n[1];for(;i<this._bufs.length;i++){const t=this._bufs[i];for(;s<t.length;){if(t.length-s>=e.length){const r=t.indexOf(e,s);if(-1!==r)return this._reverseOffset([i,r]);s=t.length-e.length+1}else{const t=this._reverseOffset([i,s]);if(this._match(t,e))return t;s++}}s=0}return-1},BufferList$7.prototype._match=function(e,t){if(this.length-e<t.length)return!1;for(let r=0;r<t.length;r++)if(this.get(e+r)!==t[r])return!1;return!0},function(){const e={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1,readIntBE:null,readIntLE:null,readUIntBE:null,readUIntLE:null};for(const t in e)!function(t){BufferList$7.prototype[t]=null===e[t]?function(e,r){return this.slice(e,e+r)[t](0,r)}:function(r=0){return this.slice(r,r+e[t])[t](0)}}(t)}(),BufferList$7.prototype._isBufferList=function(e){return e instanceof BufferList$7||BufferList$7.isBufferList(e)},BufferList$7.isBufferList=function(e){return null!=e&&e[symbol$2]};var BufferList_1$2=BufferList$7;!function(e){const t=BufferList_1$2,r=src$i,n=itPipe.exports,i=errCode$m,{fromString:s}=require$$3$1,o=itFirst,a=s("\n");e.encode=e=>r.encode.single(new t([e,a])),e.write=(t,r)=>t.push(e.encode(r)),e.writeAll=(r,n)=>{r.push(n.reduce(((t,r)=>t.append(e.encode(r))),new t))},e.read=async e=>{let t=1;const s={[Symbol.asyncIterator](){return this},next:()=>e.next(t)},u=await n(s,r.decode({onLength:e=>{t=e}}),o);if(u.get(u.length-1)!==a[0])throw i(new Error("missing newline"),"ERR_INVALID_MULTISTREAM_SELECT_MESSAGE");return u.shallowSlice(0,-1)}}(multistream$3);const log$n=require$$0$b("mss:select"),errCode$9=errCode$m,multistream$2=multistream$3,handshake$2=src$h;var select$2=async(e,t,r)=>{t=Array.isArray(t)?[...t]:[t];const{reader:n,writer:i,rest:s,stream:o}=handshake$2(e),a=t.shift();r?(log$n('select: write ["%s", "%s"]',r,a),multistream$2.writeAll(i,[r,a])):(log$n('select: write "%s"',a),multistream$2.write(i,a));let u=(await multistream$2.read(n)).toString();if(log$n('select: read "%s"',u),u===r&&(u=(await multistream$2.read(n)).toString(),log$n('select: read "%s"',u)),u===a)return s(),{stream:o,protocol:a};for(const e of t){log$n('select: write "%s"',e),multistream$2.write(i,e);const t=(await multistream$2.read(n)).toString();if(log$n('select: read "%s" for "%s"',t,e),t===e)return s(),{stream:o,protocol:e}}throw s(),errCode$9(new Error("protocol selection failed"),"ERR_UNSUPPORTED_PROTOCOL")},constants$7={PROTOCOL_ID:"/multistream/1.0.0"};const log$m=require$$0$b("mss:handle"),BufferList$6=BufferList_1$2,multistream$1=multistream$3,handshake$1=src$h,{PROTOCOL_ID:PROTOCOL_ID$1}=constants$7;var handle$1=async(e,t)=>{t=Array.isArray(t)?t:[t];const{writer:r,reader:n,rest:i,stream:s}=handshake$1(e);for(;;){const e=(await multistream$1.read(n)).toString();if(log$m('read "%s"',e),e!==PROTOCOL_ID$1){if(t.includes(e))return multistream$1.write(r,e),log$m('respond with "%s" for "%s"',e,e),i(),{stream:s,protocol:e};"ls"!==e?(multistream$1.write(r,"na"),log$m('respond with "na" for "%s"',e)):(multistream$1.write(r,new BufferList$6(t.map((e=>multistream$1.encode(e))))),log$m('respond with "%s" for %s',t,e))}else log$m('respond with "%s" for "%s"',PROTOCOL_ID$1,e),multistream$1.write(r,PROTOCOL_ID$1)}};const Reader=itReader,log$l=require$$0$b("it-multistream-select:ls"),multistream=multistream$3,handshake=src$h,lp$3=src$i,pipe$6=itPipe.exports;var ls$1=async e=>{const{reader:t,writer:r,rest:n,stream:i}=handshake(e);log$l('write "ls"'),multistream.write(r,"ls"),n();const s=await multistream.read(t),o=Reader([s]),a=[];return await pipe$6(o,lp$3.decode(),(async e=>{for await(const t of e)a.push(t.shallowSlice(0,-1).toString())})),{stream:i,protocols:a}};const select$1=select$2,handle=handle$1,ls=ls$1,{PROTOCOL_ID:PROTOCOL_ID}=constants$7;src$f.PROTOCOL_ID=PROTOCOL_ID;class MultistreamSelect{constructor(e){this._stream=e,this._shaken=!1}async _handshake(){if(this._shaken)return;const{stream:e}=await select$1(this._stream,PROTOCOL_ID);this._stream=e,this._shaken=!0}}class Dialer$1 extends MultistreamSelect{select(e){return select$1(this._stream,e,this._shaken?null:PROTOCOL_ID)}async ls(){await this._handshake();const{stream:e,protocols:t}=await ls(this._stream);return this._stream=e,t}}src$f.Dialer=Dialer$1;class Listener extends MultistreamSelect{handle(e){return handle(this._stream,e)}}src$f.Listener=Listener;var connection$1={},src$e={exports:{}},$protobuf$c=minimal,$Reader$c=$protobuf$c.Reader,$Writer$c=$protobuf$c.Writer,$util$c=$protobuf$c.util,$root$c=$protobuf$c.roots["libp2p-crypto-keys"]||($protobuf$c.roots["libp2p-crypto-keys"]={});$root$c.KeyType=function(){var e={},t=Object.create(e);return t[e[0]="RSA"]=0,t[e[1]="Ed25519"]=1,t[e[2]="Secp256k1"]=2,t}(),$root$c.PublicKey=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.Type=0,e.prototype.Data=$util$c.newBuffer([]),e.encode=function(e,t){return t||(t=$Writer$c.create()),t.uint32(8).int32(e.Type),t.uint32(18).bytes(e.Data),t},e.decode=function(e,t){e instanceof $Reader$c||(e=$Reader$c.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root$c.PublicKey;e.pos<r;){var i=e.uint32();switch(i>>>3){case 1:n.Type=e.int32();break;case 2:n.Data=e.bytes();break;default:e.skipType(7&i)}}if(!n.hasOwnProperty("Type"))throw $util$c.ProtocolError("missing required 'Type'",{instance:n});if(!n.hasOwnProperty("Data"))throw $util$c.ProtocolError("missing required 'Data'",{instance:n});return n},e.fromObject=function(e){if(e instanceof $root$c.PublicKey)return e;var t=new $root$c.PublicKey;switch(e.Type){case"RSA":case 0:t.Type=0;break;case"Ed25519":case 1:t.Type=1;break;case"Secp256k1":case 2:t.Type=2}return null!=e.Data&&("string"==typeof e.Data?$util$c.base64.decode(e.Data,t.Data=$util$c.newBuffer($util$c.base64.length(e.Data)),0):e.Data.length&&(t.Data=e.Data)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.Type=t.enums===String?"RSA":0,t.bytes===String?r.Data="":(r.Data=[],t.bytes!==Array&&(r.Data=$util$c.newBuffer(r.Data)))),null!=e.Type&&e.hasOwnProperty("Type")&&(r.Type=t.enums===String?$root$c.KeyType[e.Type]:e.Type),null!=e.Data&&e.hasOwnProperty("Data")&&(r.Data=t.bytes===String?$util$c.base64.encode(e.Data,0,e.Data.length):t.bytes===Array?Array.prototype.slice.call(e.Data):e.Data),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf$c.util.toJSONOptions)},e}(),$root$c.PrivateKey=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.Type=0,e.prototype.Data=$util$c.newBuffer([]),e.encode=function(e,t){return t||(t=$Writer$c.create()),t.uint32(8).int32(e.Type),t.uint32(18).bytes(e.Data),t},e.decode=function(e,t){e instanceof $Reader$c||(e=$Reader$c.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root$c.PrivateKey;e.pos<r;){var i=e.uint32();switch(i>>>3){case 1:n.Type=e.int32();break;case 2:n.Data=e.bytes();break;default:e.skipType(7&i)}}if(!n.hasOwnProperty("Type"))throw $util$c.ProtocolError("missing required 'Type'",{instance:n});if(!n.hasOwnProperty("Data"))throw $util$c.ProtocolError("missing required 'Data'",{instance:n});return n},e.fromObject=function(e){if(e instanceof $root$c.PrivateKey)return e;var t=new $root$c.PrivateKey;switch(e.Type){case"RSA":case 0:t.Type=0;break;case"Ed25519":case 1:t.Type=1;break;case"Secp256k1":case 2:t.Type=2}return null!=e.Data&&("string"==typeof e.Data?$util$c.base64.decode(e.Data,t.Data=$util$c.newBuffer($util$c.base64.length(e.Data)),0):e.Data.length&&(t.Data=e.Data)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.Type=t.enums===String?"RSA":0,t.bytes===String?r.Data="":(r.Data=[],t.bytes!==Array&&(r.Data=$util$c.newBuffer(r.Data)))),null!=e.Type&&e.hasOwnProperty("Type")&&(r.Type=t.enums===String?$root$c.KeyType[e.Type]:e.Type),null!=e.Data&&e.hasOwnProperty("Data")&&(r.Data=t.bytes===String?$util$c.base64.encode(e.Data,0,e.Data.length):t.bytes===Array?Array.prototype.slice.call(e.Data):e.Data),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf$c.util.toJSONOptions)},e}();var keys$b=$root$c,webcrypto$o={get:(e=globalThis)=>{const t=e.crypto;if(!t||!t.subtle)throw Object.assign(new Error("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p-crypto/blob/master/README.md#web-crypto-api"),{code:"ERR_MISSING_WEB_CRYPTO"});return t}};const{concat:concat$4}=require$$2$2,{fromString:fromString$4}=require$$3$1,webcrypto$n=webcrypto$o;function create$4({algorithm:e="AES-GCM",nonceLength:t=12,keyLength:r=16,digest:n="SHA-256",saltLength:i=16,iterations:s=32767}={}){const o=webcrypto$n.get();return r*=8,{encrypt:async function(a,u){const c=o.getRandomValues(new Uint8Array(i)),l=o.getRandomValues(new Uint8Array(t)),h={name:e,iv:l},d={name:"PBKDF2",salt:c,iterations:s,hash:{name:n}},f=await o.subtle.importKey("raw",fromString$4(u),{name:"PBKDF2"},!1,["deriveKey","deriveBits"]),p=await o.subtle.deriveKey(d,f,{name:e,length:r},!0,["encrypt"]),y=await o.subtle.encrypt(h,p,a);return concat$4([c,h.iv,new Uint8Array(y)])},decrypt:async function(a,u){const c=a.slice(0,i),l=a.slice(i,i+t),h=a.slice(i+t),d={name:e,iv:l},f={name:"PBKDF2",salt:c,iterations:s,hash:{name:n}},p=await o.subtle.importKey("raw",fromString$4(u),{name:"PBKDF2"},!1,["deriveKey","deriveBits"]),y=await o.subtle.deriveKey(f,p,{name:e,length:r},!0,["decrypt"]),g=await o.subtle.decrypt(d,y,h);return new Uint8Array(g)}}}var aesGcm_browser$4={create:create$4};const{base64:base64$9}=require$$4$5,ciphers$a=aesGcm_browser$4;var importer$9={import:async function(e,t){const r=base64$9.decode(e),n=ciphers$a.create();return await n.decrypt(r,t)}},rsaBrowser$4={};const randomBytes$b=random_browser,errcode$T=errCode$m;var randomBytes_1$4=function(e){if(isNaN(e)||e<=0)throw errcode$T(new Error("random bytes length must be a Number bigger than 0"),"ERR_INVALID_LENGTH");return randomBytes$b(e)},rsaUtils$4={},util$5={};!function(e){const t=forge$X,{fromString:r}=require$$3$1,{toString:n}=require$$1$5,{concat:i}=require$$2$2;e.bigIntegerToUintBase64url=(e,t)=>{let r=Uint8Array.from(e.abs().toByteArray());if(r=0===r[0]?r.slice(1):r,null!=t){if(r.length>t)throw new Error("byte array longer than desired length");r=i([new Uint8Array(t-r.length),r])}return n(r,"base64url")},e.base64urlToBigInteger=r=>{const i=e.base64urlToBuffer(r);return new t.jsbn.BigInteger(n(i,"base16"),16)},e.base64urlToBuffer=(e,t)=>{let n=r(e,"base64urlpad");if(null!=t){if(n.length>t)throw new Error("byte array longer than desired length");n=i([new Uint8Array(t-n.length),n])}return n}}(util$5);const forge$n=forge$X,{bigIntegerToUintBase64url:bigIntegerToUintBase64url$4,base64urlToBigInteger:base64urlToBigInteger$9}=util$5,{fromString:uint8ArrayFromString$n}=require$$3$1,{toString:uint8ArrayToString$q}=require$$1$5;rsaUtils$4.pkcs1ToJwk=function(e){const t=forge$n.asn1.fromDer(uint8ArrayToString$q(e,"ascii")),r=forge$n.pki.privateKeyFromAsn1(t);return{kty:"RSA",n:bigIntegerToUintBase64url$4(r.n),e:bigIntegerToUintBase64url$4(r.e),d:bigIntegerToUintBase64url$4(r.d),p:bigIntegerToUintBase64url$4(r.p),q:bigIntegerToUintBase64url$4(r.q),dp:bigIntegerToUintBase64url$4(r.dP),dq:bigIntegerToUintBase64url$4(r.dQ),qi:bigIntegerToUintBase64url$4(r.qInv),alg:"RS256",kid:"2011-04-29"}},rsaUtils$4.jwkToPkcs1=function(e){const t=forge$n.pki.privateKeyToAsn1({n:base64urlToBigInteger$9(e.n),e:base64urlToBigInteger$9(e.e),d:base64urlToBigInteger$9(e.d),p:base64urlToBigInteger$9(e.p),q:base64urlToBigInteger$9(e.q),dP:base64urlToBigInteger$9(e.dp),dQ:base64urlToBigInteger$9(e.dq),qInv:base64urlToBigInteger$9(e.qi)});return uint8ArrayFromString$n(forge$n.asn1.toDer(t).getBytes(),"ascii")},rsaUtils$4.pkixToJwk=function(e){const t=forge$n.asn1.fromDer(uint8ArrayToString$q(e,"ascii")),r=forge$n.pki.publicKeyFromAsn1(t);return{kty:"RSA",n:bigIntegerToUintBase64url$4(r.n),e:bigIntegerToUintBase64url$4(r.e),alg:"RS256",kid:"2011-04-29"}},rsaUtils$4.jwkToPkix=function(e){const t=forge$n.pki.publicKeyToAsn1({n:base64urlToBigInteger$9(e.n),e:base64urlToBigInteger$9(e.e)});return uint8ArrayFromString$n(forge$n.asn1.toDer(t).getBytes(),"ascii")};const forge$m=forge$X,{base64urlToBigInteger:base64urlToBigInteger$8}=util$5;function convert$4(e,t){return t.map((t=>base64urlToBigInteger$8(e[t])))}function jwk2priv$9(e){return forge$m.pki.setRsaPrivateKey(...convert$4(e,["n","e","d","p","q","dp","dq","qi"]))}function jwk2pub$9(e){return forge$m.pki.setRsaPublicKey(...convert$4(e,["n","e"]))}var jwk2pem$4={jwk2pub:jwk2pub$9,jwk2priv:jwk2priv$9};const webcrypto$m=webcrypto$o,randomBytes$a=randomBytes_1$4,{toString:uint8ArrayToString$p}=require$$1$5,{fromString:uint8ArrayFromString$m}=require$$3$1;function exportKey$4(e){return Promise.all([webcrypto$m.get().subtle.exportKey("jwk",e.privateKey),webcrypto$m.get().subtle.exportKey("jwk",e.publicKey)])}function derivePublicFromPrivate$4(e){return webcrypto$m.get().subtle.importKey("jwk",{kty:e.kty,n:e.n,e:e.e},{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])}rsaBrowser$4.utils=rsaUtils$4,rsaBrowser$4.generateKey=async function(e){const t=await webcrypto$m.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),r=await exportKey$4(t);return{privateKey:r[0],publicKey:r[1]}},rsaBrowser$4.unmarshalPrivateKey=async function(e){const t=[await webcrypto$m.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),await derivePublicFromPrivate$4(e)],r=await exportKey$4({privateKey:t[0],publicKey:t[1]});return{privateKey:r[0],publicKey:r[1]}},rsaBrowser$4.getRandomValues=randomBytes$a,rsaBrowser$4.hashAndSign=async function(e,t){const r=await webcrypto$m.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),n=await webcrypto$m.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},r,Uint8Array.from(t));return new Uint8Array(n,n.byteOffset,n.byteLength)},rsaBrowser$4.hashAndVerify=async function(e,t,r){const n=await webcrypto$m.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return webcrypto$m.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},n,t,r)};const{jwk2pub:jwk2pub$8,jwk2priv:jwk2priv$8}=jwk2pem$4;function convertKey$4(e,t,r,n){const i=t?jwk2pub$8(e):jwk2priv$8(e),s=n(uint8ArrayToString$p(Uint8Array.from(r),"ascii"),i);return uint8ArrayFromString$m(s,"ascii")}rsaBrowser$4.encrypt=function(e,t){return convertKey$4(e,!0,t,((e,t)=>t.encrypt(e)))},rsaBrowser$4.decrypt=function(e,t){return convertKey$4(e,!1,t,((e,t)=>t.decrypt(e)))};const{base64:base64$8}=require$$4$5,ciphers$9=aesGcm_browser$4;var exporter$j={export:async function(e,t){const r=ciphers$9.create(),n=await r.encrypt(e,t);return base64$8.encode(n)}};const{sha256:sha256$l}=require$$4$3,errcode$S=errCode$m,{equals:uint8ArrayEquals$k}=require$$10$1,{toString:uint8ArrayToString$o}=require$$1$5,forge$l=forge$X,crypto$d=rsaBrowser$4,pbm$9=keys$b,exporter$i=exporter$j;class RsaPublicKey$4{constructor(e){this._key=e}async verify(e,t){return crypto$d.hashAndVerify(this._key,t,e)}marshal(){return crypto$d.utils.jwkToPkix(this._key)}get bytes(){return pbm$9.PublicKey.encode({Type:pbm$9.KeyType.RSA,Data:this.marshal()}).finish()}encrypt(e){return crypto$d.encrypt(this._key,e)}equals(e){return uint8ArrayEquals$k(this.bytes,e.bytes)}async hash(){const{bytes:e}=await sha256$l.digest(this.bytes);return e}}class RsaPrivateKey$4{constructor(e,t){this._key=e,this._publicKey=t}genSecret(){return crypto$d.getRandomValues(16)}async sign(e){return crypto$d.hashAndSign(this._key,e)}get public(){if(!this._publicKey)throw errcode$S(new Error("public key not provided"),"ERR_PUBKEY_NOT_PROVIDED");return new RsaPublicKey$4(this._publicKey)}decrypt(e){return crypto$d.decrypt(this._key,e)}marshal(){return crypto$d.utils.jwkToPkcs1(this._key)}get bytes(){return pbm$9.PrivateKey.encode({Type:pbm$9.KeyType.RSA,Data:this.marshal()}).finish()}equals(e){return uint8ArrayEquals$k(this.bytes,e.bytes)}async hash(){const{bytes:e}=await sha256$l.digest(this.bytes);return e}async id(){const e=await this.public.hash();return uint8ArrayToString$o(e,"base58btc")}async export(e,t="pkcs-8"){if("pkcs-8"===t){const t=new forge$l.util.ByteBuffer(this.marshal()),r=forge$l.asn1.fromDer(t),n=forge$l.pki.privateKeyFromAsn1(r),i={algorithm:"aes256",count:1e4,saltSize:16,prfAlgorithm:"sha512"};return forge$l.pki.encryptRsaPrivateKey(n,e,i)}if("libp2p-key"===t)return exporter$i.export(this.bytes,e);throw errcode$S(new Error(`export format '${t}' is not supported`),"ERR_INVALID_EXPORT_FORMAT")}}async function unmarshalRsaPrivateKey$4(e){const t=crypto$d.utils.pkcs1ToJwk(e),r=await crypto$d.unmarshalPrivateKey(t);return new RsaPrivateKey$4(r.privateKey,r.publicKey)}function unmarshalRsaPublicKey$4(e){const t=crypto$d.utils.pkixToJwk(e);return new RsaPublicKey$4(t)}async function fromJwk$4(e){const t=await crypto$d.unmarshalPrivateKey(e);return new RsaPrivateKey$4(t.privateKey,t.publicKey)}async function generateKeyPair$e(e){const t=await crypto$d.generateKey(e);return new RsaPrivateKey$4(t.privateKey,t.publicKey)}var rsaClass$4={RsaPublicKey:RsaPublicKey$4,RsaPrivateKey:RsaPrivateKey$4,unmarshalRsaPublicKey:unmarshalRsaPublicKey$4,unmarshalRsaPrivateKey:unmarshalRsaPrivateKey$4,generateKeyPair:generateKeyPair$e,fromJwk:fromJwk$4},ed25519$5={};!function(e){const t=ed25519$6.exports;function r(t,r){const n=new Uint8Array(e.privateKeyLength);for(let e=0;e<32;e++)n[e]=t[e],n[32+e]=r[e];return n}e.publicKeyLength=32,e.privateKeyLength=64,e.generateKey=async function(){const e=t.utils.randomPrivateKey(),n=await t.getPublicKey(e);return{privateKey:r(e,n),publicKey:n}},e.generateKeyFromSeed=async function(e){if(32!==e.length)throw new TypeError('"seed" must be 32 bytes in length.');if(!(e instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, or Uint8Array.');const n=e,i=await t.getPublicKey(n);return{privateKey:r(n,i),publicKey:i}},e.hashAndSign=function(e,r){const n=e.slice(0,32);return t.sign(r,n)},e.hashAndVerify=function(e,r,n){return t.verify(r,n,e)}}(ed25519$5);const errcode$R=errCode$m,{equals:uint8ArrayEquals$j}=require$$10$1,{sha256:sha256$k}=require$$4$3,{base58btc:base58btc$4}=require$$3$2,{identity:identity$4}=require$$13,crypto$c=ed25519$5,pbm$8=keys$b,exporter$h=exporter$j;class Ed25519PublicKey$4{constructor(e){this._key=ensureKey$4(e,crypto$c.publicKeyLength)}async verify(e,t){return crypto$c.hashAndVerify(this._key,t,e)}marshal(){return this._key}get bytes(){return pbm$8.PublicKey.encode({Type:pbm$8.KeyType.Ed25519,Data:this.marshal()}).finish()}equals(e){return uint8ArrayEquals$j(this.bytes,e.bytes)}async hash(){const{bytes:e}=await sha256$k.digest(this.bytes);return e}}class Ed25519PrivateKey$4{constructor(e,t){this._key=ensureKey$4(e,crypto$c.privateKeyLength),this._publicKey=ensureKey$4(t,crypto$c.publicKeyLength)}async sign(e){return crypto$c.hashAndSign(this._key,e)}get public(){return new Ed25519PublicKey$4(this._publicKey)}marshal(){return this._key}get bytes(){return pbm$8.PrivateKey.encode({Type:pbm$8.KeyType.Ed25519,Data:this.marshal()}).finish()}equals(e){return uint8ArrayEquals$j(this.bytes,e.bytes)}async hash(){const{bytes:e}=await sha256$k.digest(this.bytes);return e}async id(){const e=await identity$4.digest(this.public.bytes);return base58btc$4.encode(e.bytes).substring(1)}async export(e,t="libp2p-key"){if("libp2p-key"===t)return exporter$h.export(this.bytes,e);throw errcode$R(new Error(`export format '${t}' is not supported`),"ERR_INVALID_EXPORT_FORMAT")}}function unmarshalEd25519PrivateKey$4(e){if(e.length>crypto$c.privateKeyLength){const t=(e=ensureKey$4(e,crypto$c.privateKeyLength+crypto$c.publicKeyLength)).slice(0,crypto$c.privateKeyLength),r=e.slice(crypto$c.privateKeyLength,e.length);return new Ed25519PrivateKey$4(t,r)}const t=(e=ensureKey$4(e,crypto$c.privateKeyLength)).slice(0,crypto$c.privateKeyLength),r=e.slice(crypto$c.publicKeyLength);return new Ed25519PrivateKey$4(t,r)}function unmarshalEd25519PublicKey$4(e){return e=ensureKey$4(e,crypto$c.publicKeyLength),new Ed25519PublicKey$4(e)}async function generateKeyPair$d(){const{privateKey:e,publicKey:t}=await crypto$c.generateKey();return new Ed25519PrivateKey$4(e,t)}async function generateKeyPairFromSeed$9(e){const{privateKey:t,publicKey:r}=await crypto$c.generateKeyFromSeed(e);return new Ed25519PrivateKey$4(t,r)}function ensureKey$4(e,t){if((e=Uint8Array.from(e||[])).length!==t)throw errcode$R(new Error(`Key must be a Uint8Array of length ${t}, got ${e.length}`),"ERR_INVALID_KEY_TYPE");return e}var ed25519Class$4={Ed25519PublicKey:Ed25519PublicKey$4,Ed25519PrivateKey:Ed25519PrivateKey$4,unmarshalEd25519PrivateKey:unmarshalEd25519PrivateKey$4,unmarshalEd25519PublicKey:unmarshalEd25519PublicKey$4,generateKeyPair:generateKeyPair$d,generateKeyPairFromSeed:generateKeyPairFromSeed$9};const errcode$Q=errCode$m,secp$3=secp256k1$6.exports,{sha256:sha256$j}=require$$4$3;var secp256k1$4=()=>({generateKey:function(){return secp$3.utils.randomPrivateKey()},privateKeyLength:32,hashAndSign:async function(e,t){const{digest:r}=await sha256$j.digest(t);try{return await secp$3.sign(r,e)}catch(e){throw errcode$Q(e,"ERR_INVALID_INPUT")}},hashAndVerify:async function(e,t,r){try{const{digest:n}=await sha256$j.digest(r);return secp$3.verify(t,n,e)}catch(e){throw errcode$Q(e,"ERR_INVALID_INPUT")}},compressPublicKey:function(e){return secp$3.Point.fromHex(e).toRawBytes(!0)},decompressPublicKey:function(e){return secp$3.Point.fromHex(e).toRawBytes(!1)},validatePrivateKey:function(e){try{secp$3.getPublicKey(e,!0)}catch(e){throw errcode$Q(e,"ERR_INVALID_PRIVATE_KEY")}},validatePublicKey:function(e){try{secp$3.Point.fromHex(e)}catch(e){throw errcode$Q(e,"ERR_INVALID_PUBLIC_KEY")}},computePublicKey:function(e){try{return secp$3.getPublicKey(e,!0)}catch(e){throw errcode$Q(e,"ERR_INVALID_PRIVATE_KEY")}}});const{sha256:sha256$i}=require$$4$3,errcode$P=errCode$m,{equals:uint8ArrayEquals$i}=require$$10$1,{toString:uint8ArrayToString$n}=require$$1$5,exporter$g=exporter$j;var secp256k1Class$4=(e,t,r)=>{r=r||secp256k1$4();class n{constructor(e){r.validatePublicKey(e),this._key=e}verify(e,t){return r.hashAndVerify(this._key,t,e)}marshal(){return r.compressPublicKey(this._key)}get bytes(){return e.PublicKey.encode({Type:e.KeyType.Secp256k1,Data:this.marshal()}).finish()}equals(e){return uint8ArrayEquals$i(this.bytes,e.bytes)}async hash(){const{bytes:e}=await sha256$i.digest(this.bytes);return e}}class i{constructor(e,t){this._key=e,this._publicKey=t||r.computePublicKey(e),r.validatePrivateKey(this._key),r.validatePublicKey(this._publicKey)}sign(e){return r.hashAndSign(this._key,e)}get public(){return new n(this._publicKey)}marshal(){return this._key}get bytes(){return e.PrivateKey.encode({Type:e.KeyType.Secp256k1,Data:this.marshal()}).finish()}equals(e){return uint8ArrayEquals$i(this.bytes,e.bytes)}async hash(){const{bytes:e}=await sha256$i.digest(this.bytes);return e}async id(){const e=await this.public.hash();return uint8ArrayToString$n(e,"base58btc")}async export(e,t="libp2p-key"){if("libp2p-key"===t)return exporter$g.export(this.bytes,e);throw errcode$P(new Error(`export format '${t}' is not supported`),"ERR_INVALID_EXPORT_FORMAT")}}return{Secp256k1PublicKey:n,Secp256k1PrivateKey:i,unmarshalSecp256k1PrivateKey:function(e){return new i(e)},unmarshalSecp256k1PublicKey:function(e){return new n(e)},generateKeyPair:async function(){const e=await r.generateKey();return new i(e)}}},indexBrowser$4={},lengths$9={SHA1:20,SHA256:32,SHA512:64};const webcrypto$l=webcrypto$o,lengths$8=lengths$9,hashTypes$4={SHA1:"SHA-1",SHA256:"SHA-256",SHA512:"SHA-512"},sign$5=async(e,t)=>{const r=await webcrypto$l.get().subtle.sign({name:"HMAC"},e,t);return new Uint8Array(r,r.byteOffset,r.byteLength)};indexBrowser$4.create=async function(e,t){const r=hashTypes$4[e],n=await webcrypto$l.get().subtle.importKey("raw",t,{name:"HMAC",hash:{name:r}},!1,["sign"]);return{digest:async e=>sign$5(n,e),length:lengths$8[e]}};const errcode$O=errCode$m,{concat:uint8ArrayConcat$a}=require$$2$2,{fromString:uint8ArrayFromString$l}=require$$3$1,hmac$8=indexBrowser$4,cipherMap$4={"AES-128":{ivSize:16,keySize:16},"AES-256":{ivSize:16,keySize:32},Blowfish:{ivSize:8,cipherKeySize:32}};var keyStretcher$4=async(e,t,r)=>{const n=cipherMap$4[e];if(!n){const t=Object.keys(cipherMap$4).join(" / ");throw errcode$O(new Error(`unknown cipher type '${e}'. Must be ${t}`),"ERR_INVALID_CIPHER_TYPE")}if(!t)throw errcode$O(new Error("missing hash type"),"ERR_MISSING_HASH_TYPE");const i=n.keySize,s=n.ivSize,o=uint8ArrayFromString$l("key expansion"),a=2*(s+i+20),u=await hmac$8.create(t,r);let c=await u.digest(o);const l=[];let h=0;for(;h<a;){const e=await u.digest(uint8ArrayConcat$a([c,o]));let t=e.length;h+t>a&&(t=a-h),l.push(e),h+=t,c=await u.digest(c)}const d=a/2,f=uint8ArrayConcat$a(l),p=f.slice(0,d),y=f.slice(d,a),g=e=>({iv:e.slice(0,s),cipherKey:e.slice(s,s+i),macKey:e.slice(s+i)});return{k1:g(p),k2:g(y)}},ecdhBrowser$4={};const errcode$N=errCode$m;var validateCurveType$9=function(e,t){if(!e.includes(t)){const r=e.join(" / ");throw errcode$N(new Error(`Unknown curve: ${t}. Must be ${r}`),"ERR_INVALID_CURVE")}};const errcode$M=errCode$m,webcrypto$k=webcrypto$o,{base64urlToBuffer:base64urlToBuffer$4}=util$5,validateCurveType$8=validateCurveType$9,{toString:uint8ArrayToString$m}=require$$1$5,{concat:uint8ArrayConcat$9}=require$$2$2,{equals:uint8ArrayEquals$h}=require$$10$1,bits$4={"P-256":256,"P-384":384,"P-521":521};ecdhBrowser$4.generateEphmeralKeyPair=async function(e){validateCurveType$8(Object.keys(bits$4),e);const t=await webcrypto$k.get().subtle.generateKey({name:"ECDH",namedCurve:e},!0,["deriveBits"]);return{key:marshalPublicKey$9(await webcrypto$k.get().subtle.exportKey("jwk",t.publicKey)),genSharedKey:async(r,n)=>{let i;i=n?await webcrypto$k.get().subtle.importKey("jwk",unmarshalPrivateKey$9(e,n),{name:"ECDH",namedCurve:e},!1,["deriveBits"]):t.privateKey;const s=[await webcrypto$k.get().subtle.importKey("jwk",unmarshalPublicKey$9(e,r),{name:"ECDH",namedCurve:e},!1,[]),i],o=await webcrypto$k.get().subtle.deriveBits({name:"ECDH",namedCurve:e,public:s[0]},s[1],bits$4[e]);return new Uint8Array(o,o.byteOffset,o.byteLength)}}};const curveLengths$4={"P-256":32,"P-384":48,"P-521":66};function marshalPublicKey$9(e){const t=curveLengths$4[e.crv];return uint8ArrayConcat$9([Uint8Array.from([4]),base64urlToBuffer$4(e.x,t),base64urlToBuffer$4(e.y,t)],1+2*t)}function unmarshalPublicKey$9(e,t){const r=curveLengths$4[e];if(uint8ArrayEquals$h(!t.slice(0,1),Uint8Array.from([4])))throw errcode$M(new Error("Cannot unmarshal public key - invalid key format"),"ERR_INVALID_KEY_FORMAT");return{kty:"EC",crv:e,x:uint8ArrayToString$m(t.slice(1,r+1),"base64url"),y:uint8ArrayToString$m(t.slice(1+r),"base64url"),ext:!0}}const unmarshalPrivateKey$9=(e,t)=>({...unmarshalPublicKey$9(e,t.public),d:uint8ArrayToString$m(t.private,"base64url")}),ecdh$4=ecdhBrowser$4;var ephemeralKeys$4=async e=>ecdh$4.generateEphmeralKeyPair(e);const keysPBM$4=keys$b,forge$k=forge$X,errcode$L=errCode$m,{fromString:uint8ArrayFromString$k}=require$$3$1,importer$8=importer$9,supportedKeys$4={rsa:rsaClass$4,ed25519:ed25519Class$4,secp256k1:secp256k1Class$4(keysPBM$4)},ErrMissingSecp256K1$4={message:"secp256k1 support requires libp2p-crypto-secp256k1 package",code:"ERR_MISSING_PACKAGE"};function typeToKey$4(e){const t=supportedKeys$4[e.toLowerCase()];if(!t){const t=Object.keys(supportedKeys$4).join(" / ");throw errcode$L(new Error(`invalid or unsupported key type ${e}. Must be ${t}`),"ERR_UNSUPPORTED_KEY_TYPE")}return t}const generateKeyPair$c=async(e,t)=>typeToKey$4(e).generateKeyPair(t),generateKeyPairFromSeed$8=async(e,t,r)=>{const n=typeToKey$4(e);if("ed25519"!==e.toLowerCase())throw errcode$L(new Error("Seed key derivation is unimplemented for RSA or secp256k1"),"ERR_UNSUPPORTED_KEY_DERIVATION_TYPE");return n.generateKeyPairFromSeed(t,r)},unmarshalPublicKey$8=e=>{const t=keysPBM$4.PublicKey.decode(e),r=t.Data;switch(t.Type){case keysPBM$4.KeyType.RSA:return supportedKeys$4.rsa.unmarshalRsaPublicKey(r);case keysPBM$4.KeyType.Ed25519:return supportedKeys$4.ed25519.unmarshalEd25519PublicKey(r);case keysPBM$4.KeyType.Secp256k1:if(supportedKeys$4.secp256k1)return supportedKeys$4.secp256k1.unmarshalSecp256k1PublicKey(r);throw errcode$L(new Error(ErrMissingSecp256K1$4.message),ErrMissingSecp256K1$4.code);default:typeToKey$4(t.Type)}},marshalPublicKey$8=(e,t)=>(typeToKey$4(t=(t||"rsa").toLowerCase()),e.bytes),unmarshalPrivateKey$8=async e=>{const t=keysPBM$4.PrivateKey.decode(e),r=t.Data;switch(t.Type){case keysPBM$4.KeyType.RSA:return supportedKeys$4.rsa.unmarshalRsaPrivateKey(r);case keysPBM$4.KeyType.Ed25519:return supportedKeys$4.ed25519.unmarshalEd25519PrivateKey(r);case keysPBM$4.KeyType.Secp256k1:if(supportedKeys$4.secp256k1)return supportedKeys$4.secp256k1.unmarshalSecp256k1PrivateKey(r);throw errcode$L(new Error(ErrMissingSecp256K1$4.message),ErrMissingSecp256K1$4.code);default:typeToKey$4(t.Type)}},marshalPrivateKey$4=(e,t)=>(typeToKey$4(t=(t||"rsa").toLowerCase()),e.bytes),importKey$4=async(e,t)=>{try{const r=await importer$8.import(e,t);return unmarshalPrivateKey$8(r)}catch(e){}const r=forge$k.pki.decryptRsaPrivateKey(e,t);if(null===r)throw errcode$L(new Error("Cannot read the key, most likely the password is wrong or not a RSA key"),"ERR_CANNOT_DECRYPT_PEM");let n=forge$k.asn1.toDer(forge$k.pki.privateKeyToAsn1(r));return n=uint8ArrayFromString$k(n.getBytes(),"ascii"),supportedKeys$4.rsa.unmarshalRsaPrivateKey(n)};var keys$a={supportedKeys:supportedKeys$4,keysPBM:keysPBM$4,keyStretcher:keyStretcher$4,generateEphemeralKeyPair:ephemeralKeys$4,generateKeyPair:generateKeyPair$c,generateKeyPairFromSeed:generateKeyPairFromSeed$8,unmarshalPublicKey:unmarshalPublicKey$8,marshalPublicKey:marshalPublicKey$8,unmarshalPrivateKey:unmarshalPrivateKey$8,marshalPrivateKey:marshalPrivateKey$4,import:importKey$4},$protobuf$b=minimal,$Reader$b=$protobuf$b.Reader,$Writer$b=$protobuf$b.Writer,$util$b=$protobuf$b.util,$root$b=$protobuf$b.roots["libp2p-peer-id"]||($protobuf$b.roots["libp2p-peer-id"]={});$root$b.PeerIdProto=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.id=$util$b.newBuffer([]),e.prototype.pubKey=$util$b.newBuffer([]),e.prototype.privKey=$util$b.newBuffer([]),e.encode=function(e,t){return t||(t=$Writer$b.create()),t.uint32(10).bytes(e.id),null!=e.pubKey&&Object.hasOwnProperty.call(e,"pubKey")&&t.uint32(18).bytes(e.pubKey),null!=e.privKey&&Object.hasOwnProperty.call(e,"privKey")&&t.uint32(26).bytes(e.privKey),t},e.decode=function(e,t){e instanceof $Reader$b||(e=$Reader$b.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root$b.PeerIdProto;e.pos<r;){var i=e.uint32();switch(i>>>3){case 1:n.id=e.bytes();break;case 2:n.pubKey=e.bytes();break;case 3:n.privKey=e.bytes();break;default:e.skipType(7&i)}}if(!n.hasOwnProperty("id"))throw $util$b.ProtocolError("missing required 'id'",{instance:n});return n},e.fromObject=function(e){if(e instanceof $root$b.PeerIdProto)return e;var t=new $root$b.PeerIdProto;return null!=e.id&&("string"==typeof e.id?$util$b.base64.decode(e.id,t.id=$util$b.newBuffer($util$b.base64.length(e.id)),0):e.id.length&&(t.id=e.id)),null!=e.pubKey&&("string"==typeof e.pubKey?$util$b.base64.decode(e.pubKey,t.pubKey=$util$b.newBuffer($util$b.base64.length(e.pubKey)),0):e.pubKey.length&&(t.pubKey=e.pubKey)),null!=e.privKey&&("string"==typeof e.privKey?$util$b.base64.decode(e.privKey,t.privKey=$util$b.newBuffer($util$b.base64.length(e.privKey)),0):e.privKey.length&&(t.privKey=e.privKey)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(t.bytes===String?r.id="":(r.id=[],t.bytes!==Array&&(r.id=$util$b.newBuffer(r.id))),t.bytes===String?r.pubKey="":(r.pubKey=[],t.bytes!==Array&&(r.pubKey=$util$b.newBuffer(r.pubKey))),t.bytes===String?r.privKey="":(r.privKey=[],t.bytes!==Array&&(r.privKey=$util$b.newBuffer(r.privKey)))),null!=e.id&&e.hasOwnProperty("id")&&(r.id=t.bytes===String?$util$b.base64.encode(e.id,0,e.id.length):t.bytes===Array?Array.prototype.slice.call(e.id):e.id),null!=e.pubKey&&e.hasOwnProperty("pubKey")&&(r.pubKey=t.bytes===String?$util$b.base64.encode(e.pubKey,0,e.pubKey.length):t.bytes===Array?Array.prototype.slice.call(e.pubKey):e.pubKey),null!=e.privKey&&e.hasOwnProperty("privKey")&&(r.privKey=t.bytes===String?$util$b.base64.encode(e.privKey,0,e.privKey.length):t.bytes===Array?Array.prototype.slice.call(e.privKey):e.privKey),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf$b.util.toJSONOptions)},e}();var proto$3=$root$b;!function(e,t){const{CID:r}=require$$0$a,n=require$$1$8,i=require$$2$3,s=require$$3$2,o=require$$4$5,{base58btc:a}=require$$3$2,{base32:u}=require$$1$8,{base16:c}=require$$5$1,l=require$$6$1,h=keys$a,d=classIs.exports,{PeerIdProto:f}=proto$3,{equals:p}=require$$10$1,{fromString:y}=require$$3$1,{toString:g}=require$$1$5,{identity:$}=require$$13,m={...n,...i,...s,...o},b=Object.keys(m).reduce(((e,t)=>e.or(m[t])),u.decoder);const v=d(class{constructor(e,t,r){if(!(e instanceof Uint8Array))throw new Error("invalid id provided");if(t&&r&&!p(t.public.bytes,r.bytes))throw new Error("inconsistent arguments");this._id=e,this._idB58String=a.encode(this.id).substring(1),this._privKey=t,this._pubKey=r}get id(){return this._id}set id(e){throw new Error("Id is immutable")}get privKey(){return this._privKey}set privKey(e){this._privKey=e}get pubKey(){if(this._pubKey)return this._pubKey;if(this._privKey)return this._privKey.public;try{const e=l.decode(this.id);e.code===$.code&&(this._pubKey=h.unmarshalPublicKey(e.digest))}catch(e){}return this._pubKey}set pubKey(e){this._pubKey=e}marshalPubKey(){if(this.pubKey)return h.marshalPublicKey(this.pubKey)}marshalPrivKey(){if(this.privKey)return h.marshalPrivateKey(this.privKey)}marshal(e){return f.encode({id:this.toBytes(),pubKey:this.marshalPubKey(),privKey:e?null:this.marshalPrivKey()}).finish()}toPrint(){let e=this.toB58String();e.startsWith("Qm")&&(e=e.slice(2));let t=6;return e.length<t&&(t=e.length),"<peer.ID "+e.substr(0,t)+">"}toJSON(){return{id:this.toB58String(),privKey:S(this.marshalPrivKey()),pubKey:S(this.marshalPubKey())}}toHexString(){return c.encode(this.id).substring(1)}toBytes(){return this.id}toB58String(){return this._idB58String}toString(){if(!this._idCIDString){const e=r.createV1(114,l.decode(this.id));Object.defineProperty(this,"_idCIDString",{value:e.toString(),enumerable:!1})}return this._idCIDString}equals(e){if(e instanceof Uint8Array)return p(this.id,e);if(e.id)return p(this.id,e.id);throw new Error("not valid Id")}isEqual(e){return this.equals(e)}isValid(){return Boolean(this.privKey&&this.privKey.public&&this.privKey.public.bytes&&this.pubKey.bytes instanceof Uint8Array&&p(this.privKey.public.bytes,this.pubKey.bytes))}hasInlinePublicKey(){try{if(l.decode(this.id).code===$.code)return!0}catch(e){}return!1}},{className:"PeerId",symbolName:"@libp2p/js-peer-id/PeerId"});t=e.exports=v;const _=e=>e.bytes.length<=42?l.create($.code,e.bytes).bytes:e.hash(),w=async(e,t)=>{const r=await _(t);return new v(r,e,t)};t.create=async e=>{(e=e||{}).bits=e.bits||2048,e.keyType=e.keyType||"RSA";const t=await h.generateKeyPair(e.keyType,e.bits);return w(t,t.public)},t.createFromHexString=e=>new v(c.decode("f"+e)),t.createFromBytes=e=>{try{const n=r.decode(e);if(!E(n))throw new Error("Supplied PeerID CID is invalid");return t.createFromCID(n)}catch{if(l.decode(e).code!==$.code)throw new Error("Supplied PeerID CID is invalid");return new v(e)}},t.createFromB58String=e=>t.createFromBytes(a.decode("z"+e));const E=e=>114===e.code||112===e.code;function S(e){if(e)return g(e,"base64pad")}t.createFromCID=e=>{if(!(e=r.asCID(e))||!E(e))throw new Error("Supplied PeerID CID is invalid");return new v(e.multihash.bytes)},t.createFromPubKey=async e=>{let t=e;if("string"==typeof t&&(t=y(e,"base64pad")),!(t instanceof Uint8Array))throw new Error("Supplied key is neither a base64 string nor a Uint8Array");const r=await h.unmarshalPublicKey(t);return w(void 0,r)},t.createFromPrivKey=async e=>{if("string"==typeof e&&(e=y(e,"base64pad")),!(e instanceof Uint8Array))throw new Error("Supplied key is neither a base64 string nor a Uint8Array");const t=await h.unmarshalPrivateKey(e);return w(t,t.public)},t.createFromJSON=async e=>{const t=a.decode("z"+e.id),r=e.privKey&&y(e.privKey,"base64pad"),n=e.pubKey&&y(e.pubKey,"base64pad"),i=n&&await h.unmarshalPublicKey(n);if(!r)return new v(t,void 0,i);const s=await h.unmarshalPrivateKey(r),o=await _(s.public);let u;if(i&&(u=await _(i)),i&&!p(o,u))throw new Error("Public and private key do not match");if(t&&!p(o,t))throw new Error("Id and private key do not match");return new v(t,s,i)},t.createFromProtobuf=async e=>{"string"==typeof e&&(e=y(e,"base16"));let t,r,{id:n,privKey:i,pubKey:s}=f.decode(e);if(i=!!i&&await h.unmarshalPrivateKey(i),s=!!s&&await h.unmarshalPublicKey(s),i&&(r=await _(i.public)),s&&(t=await _(s)),i){if(s&&!p(r,t))throw new Error("Public and private key do not match");return new v(r,i,i.public)}if(s)return new v(t,void 0,s);if(n)return new v(n);throw new Error("Protobuf did not contain any usable key material")},t.parse=e=>("1"!==e.charAt(0)&&"Q"!==e.charAt(0)||(e=`z${e}`),t.createFromBytes(b.decode(e))),t.isPeerId=e=>Boolean("object"==typeof e&&e._id&&e._idB58String)}(src$e,src$e.exports);const STATUS={OPEN:"open",CLOSING:"closing",CLOSED:"closed"};var status=STATUS;const PeerId$d=src$e.exports,{Multiaddr:Multiaddr$9}=src$o,errCode$8=errCode$m,{OPEN:OPEN,CLOSING:CLOSING,CLOSED:CLOSED}=status,connectionSymbol=Symbol.for("@libp2p/interface-connection/connection");class Connection$1{constructor({localAddr:e,remoteAddr:t,localPeer:r,remotePeer:n,newStream:i,close:s,getStreams:o,stat:a}){validateArgs(e,r,n,i,s,o,a),this.id=parseInt(String(1e9*Math.random())).toString(36)+Date.now(),this.localAddr=e,this.remoteAddr=t,this.localPeer=r,this.remotePeer=n,this._stat={...a,status:OPEN},this._newStream=i,this._close=s,this._getStreams=o,this.registry=new Map,this.tags=[]}get[Symbol.toStringTag](){return"Connection"}get[connectionSymbol](){return!0}static isConnection(e){return Boolean(e&&e[connectionSymbol])}get stat(){return this._stat}get streams(){return this._getStreams()}async newStream(e){if(this.stat.status===CLOSING)throw errCode$8(new Error("the connection is being closed"),"ERR_CONNECTION_BEING_CLOSED");if(this.stat.status===CLOSED)throw errCode$8(new Error("the connection is closed"),"ERR_CONNECTION_CLOSED");Array.isArray(e)||(e=[e]);const{stream:t,protocol:r}=await this._newStream(e);return this.addStream(t,{protocol:r}),{stream:t,protocol:r}}addStream(e,{protocol:t,metadata:r={}}){this.registry.set(e.id,{protocol:t,...r})}removeStream(e){this.registry.delete(e)}async close(){if(this.stat.status!==CLOSED){if(this._closing)return this._closing;this.stat.status=CLOSING,this._closing=await this._close(),this._stat.timeline.close=Date.now(),this.stat.status=CLOSED}}}var connection=Connection$1;function validateArgs(e,t,r,n,i,s,o){if(e&&!Multiaddr$9.isMultiaddr(e))throw errCode$8(new Error("localAddr must be an instance of multiaddr"),"ERR_INVALID_PARAMETERS");if(!PeerId$d.isPeerId(t))throw errCode$8(new Error("localPeer must be an instance of peer-id"),"ERR_INVALID_PARAMETERS");if(!PeerId$d.isPeerId(r))throw errCode$8(new Error("remotePeer must be an instance of peer-id"),"ERR_INVALID_PARAMETERS");if("function"!=typeof n)throw errCode$8(new Error("new stream must be a function"),"ERR_INVALID_PARAMETERS");if("function"!=typeof i)throw errCode$8(new Error("close must be a function"),"ERR_INVALID_PARAMETERS");if("function"!=typeof s)throw errCode$8(new Error("getStreams must be a function"),"ERR_INVALID_PARAMETERS");if(!o)throw errCode$8(new Error("connection metadata object must be provided"),"ERR_INVALID_PARAMETERS");if("inbound"!==o.direction&&"outbound"!==o.direction)throw errCode$8(new Error('direction must be "inbound" or "outbound"'),"ERR_INVALID_PARAMETERS");if(!o.timeline)throw errCode$8(new Error("connection timeline object must be provided in the stat object"),"ERR_INVALID_PARAMETERS");if(!o.timeline.open)throw errCode$8(new Error("connection open timestamp must be provided"),"ERR_INVALID_PARAMETERS");if(!o.timeline.upgraded)throw errCode$8(new Error("connection upgraded timestamp must be provided"),"ERR_INVALID_PARAMETERS")}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}connection$1.Connection=connection;var build=function(e){var t=void 0,r=void 0;function n(e){if(!(e instanceof Object))throw new Error('Target "'+e+'" is not an object');r=e}function i(e){Object.keys(e).forEach((function(t){var r=e[t];if("function"!=typeof r)throw new Error('Trap "'+t+": "+r+'" is not a function');if(!Reflect[t])throw new Error('Trap "'+t+": "+r+'" is not a valid trap')})),t=e}n((function(){})),e&&n(e),i(Reflect);var s=new Proxy({},{get:function(e,n){return function(){for(var e=arguments.length,i=Array(e),s=0;s<e;s++)i[s]=arguments[s];return t[n].apply(null,[r].concat(_toConsumableArray(i.slice(1))))}}});return{setTarget:n,setHandler:i,getTarget:function(){return r},getHandler:function(){return t},proxy:new Proxy(r,s)}};const debug$s=require$$0$b,log$k=Object.assign(debug$s("libp2p:upgrader"),{error:debug$s("libp2p:upgrader:err")}),errCode$7=errCode$m,Multistream=src$f,{Connection:Connection}=connection$1,PeerId$c=src$q.exports,{pipe:pipe$5}=itPipe.exports,mutableProxy=build,{codes:codes$4}=errors$4;class Upgrader$1{constructor({localPeer:e,metrics:t,cryptos:r=new Map,muxers:n=new Map,onConnectionEnd:i=(()=>{}),onConnection:s=(()=>{})}){this.localPeer=e,this.metrics=t,this.cryptos=r,this.muxers=n,this.protector=null,this.protocols=new Map,this.onConnection=s,this.onConnectionEnd=i}async upgradeInbound(e){let t,r,n,i,s,o,a;if(this.metrics){({setTarget:o,proxy:a}=mutableProxy());const t=(1e9*Math.random()).toString(36)+Date.now();o({toB58String:()=>t}),e=this.metrics.trackStream({stream:e,remotePeer:a})}log$k("Starting the inbound connection upgrade");let u=e;this.protector&&(u=await this.protector.protect(e));try{({conn:t,remotePeer:r,protocol:s}=await this._encryptInbound(this.localPeer,u,this.cryptos)),this.muxers.size?({stream:n,Muxer:i}=await this._multiplexInbound(t,this.muxers)):n=t}catch(t){throw log$k.error("Failed to upgrade inbound connection",t),await e.close(t),t}return this.metrics&&(this.metrics.updatePlaceholder(a,r),o(r)),log$k("Successfully upgraded inbound connection"),this._createConnection({cryptoProtocol:s,direction:"inbound",maConn:e,upgradedConn:n,Muxer:i,remotePeer:r})}async upgradeOutbound(e){const t=e.remoteAddr.getPeerId();if(!t)throw errCode$7(new Error("outbound connection must have a peer id"),codes$4.ERR_INVALID_MULTIADDR);const r=PeerId$c.createFromB58String(t);let n,i,s,o,a,u,c;if(this.metrics){({setTarget:u,proxy:c}=mutableProxy());const t=(1e9*Math.random()).toString(36)+Date.now();u({toB58String:()=>t}),e=this.metrics.trackStream({stream:e,remotePeer:c})}log$k("Starting the outbound connection upgrade");let l=e;this.protector&&(l=await this.protector.protect(e));try{({conn:n,remotePeer:i,protocol:o}=await this._encryptOutbound(this.localPeer,l,r,this.cryptos)),this.muxers.size?({stream:s,Muxer:a}=await this._multiplexOutbound(n,this.muxers)):s=n}catch(t){throw log$k.error("Failed to upgrade outbound connection",t),await e.close(t),t}return this.metrics&&(this.metrics.updatePlaceholder(c,i),u(i)),log$k("Successfully upgraded outbound connection"),this._createConnection({cryptoProtocol:o,direction:"outbound",maConn:e,upgradedConn:s,Muxer:a,remotePeer:i})}_createConnection({cryptoProtocol:e,direction:t,maConn:r,upgradedConn:n,Muxer:i,remotePeer:s}){let o,a,u;i&&(o=new i({onStream:async e=>{if(!u)return;const r=new Multistream.Listener(e);try{const{stream:n,protocol:i}=await r.handle(Array.from(this.protocols.keys()));log$k("%s: incoming stream opened on %s",t,i),this.metrics&&this.metrics.trackStream({stream:n,remotePeer:s,protocol:i}),u.addStream(e,{protocol:i}),this._onStream({connection:u,stream:{...e,...n},protocol:i})}catch(e){log$k.error(e)}},onStreamEnd:e=>{u.removeStream(e.id)}}),a=async e=>{log$k("%s: starting new stream on %s",t,e);const r=o.newStream(),n=new Multistream.Dialer(r);try{const{stream:t,protocol:i}=await n.select(e);return this.metrics&&this.metrics.trackStream({stream:t,remotePeer:s,protocol:i}),{stream:{...r,...t},protocol:i}}catch(e){throw log$k.error("could not create new stream",e),errCode$7(e,codes$4.ERR_UNSUPPORTED_PROTOCOL)}},pipe$5(n,o,n).catch(log$k.error));const c=r.timeline;r.timeline=new Proxy(c,{set:(...e)=>(u&&"close"===e[1]&&e[2]&&!c.close&&(async()=>{try{"open"===u.stat.status&&await u.close()}catch(e){log$k.error(e)}finally{this.onConnectionEnd(u)}})(),Reflect.set(...e))}),r.timeline.upgraded=Date.now();const l=()=>{throw errCode$7(new Error("connection is not multiplexed"),"ERR_CONNECTION_NOT_MULTIPLEXED")};return u=new Connection({localAddr:r.localAddr,remoteAddr:r.remoteAddr,localPeer:this.localPeer,remotePeer:s,stat:{direction:t,timeline:r.timeline,multiplexer:i&&i.multicodec,encryption:e},newStream:a||l,getStreams:()=>o?o.streams:l(),close:async()=>{await r.close(),o&&o.streams.map((e=>e.abort()))}}),this.onConnection(u),u}_onStream({connection:e,stream:t,protocol:r}){this.protocols.get(r)({connection:e,stream:t,protocol:r})}async _encryptInbound(e,t,r){const n=new Multistream.Listener(t),i=Array.from(r.keys());log$k("handling inbound crypto protocol selection",i);try{const{stream:t,protocol:s}=await n.handle(i),o=r.get(s);if(log$k("encrypting inbound connection..."),!o)throw new Error(`no crypto module found for ${s}`);return{...await o.secureInbound(e,t),protocol:s}}catch(e){throw errCode$7(e,codes$4.ERR_ENCRYPTION_FAILED)}}async _encryptOutbound(e,t,r,n){const i=new Multistream.Dialer(t),s=Array.from(n.keys());log$k("selecting outbound crypto protocol",s);try{const{stream:t,protocol:o}=await i.select(s),a=n.get(o);if(log$k("encrypting outbound connection to %j",r),!a)throw new Error(`no crypto module found for ${o}`);return{...await a.secureOutbound(e,t,r),protocol:o}}catch(e){throw errCode$7(e,codes$4.ERR_ENCRYPTION_FAILED)}}async _multiplexOutbound(e,t){const r=new Multistream.Dialer(e),n=Array.from(t.keys());log$k("outbound selecting muxer %s",n);try{const{stream:e,protocol:i}=await r.select(n);log$k("%s selected as muxer protocol",i);return{stream:e,Muxer:t.get(i)}}catch(e){throw errCode$7(e,codes$4.ERR_MUXER_UNAVAILABLE)}}async _multiplexInbound(e,t){const r=new Multistream.Listener(e),n=Array.from(t.keys());log$k("inbound handling muxers %s",n);try{const{stream:e,protocol:i}=await r.handle(n);return{stream:e,Muxer:t.get(i)}}catch(e){throw errCode$7(e,codes$4.ERR_MUXER_UNAVAILABLE)}}}var upgrader=Upgrader$1;const errcode$K=errCode$m,PeerId$b=src$q.exports,{codes:{ERR_INVALID_PARAMETERS:ERR_INVALID_PARAMETERS$7}}=errors$4,passthrough=e=>e;class Book$4{constructor({peerStore:e,eventName:t,eventProperty:r,eventTransformer:n=passthrough}){this._ps=e,this.eventName=t,this.eventProperty=r,this.eventTransformer=n,this.data=new Map}set(e,t){throw errcode$K(new Error("set must be implemented by the subclass"),"ERR_NOT_IMPLEMENTED")}_setData(e,t,{emit:r=!0}={}){const n=e.toB58String();this.data.set(n,t),r&&this._emit(e,t)}_emit(e,t){this._ps.emit(this.eventName,{peerId:e,[this.eventProperty]:this.eventTransformer(t)})}get(e){if(!PeerId$b.isPeerId(e))throw errcode$K(new Error("peerId must be an instance of peer-id"),ERR_INVALID_PARAMETERS$7);const t=this.data.get(e.toB58String());return t?[...t]:void 0}delete(e){if(!PeerId$b.isPeerId(e))throw errcode$K(new Error("peerId must be an instance of peer-id"),ERR_INVALID_PARAMETERS$7);return!!this.data.delete(e.toB58String())&&(this._emit(e,[]),!0)}}var book=Book$4;const debug$r=require$$0$b,log$j=Object.assign(debug$r("libp2p:peer-store:address-book"),{error:debug$r("libp2p:peer-store:address-book:err")}),errcode$J=errCode$m,{Multiaddr:Multiaddr$8}=src$o,PeerId$a=src$q.exports,Book$3=book,PeerRecord$1=peerRecord,{codes:{ERR_INVALID_PARAMETERS:ERR_INVALID_PARAMETERS$6}}=errors$4,Envelope$1=envelope;class AddressBook$1 extends Book$3{constructor(e){super({peerStore:e,eventName:"change:multiaddrs",eventProperty:"multiaddrs",eventTransformer:e=>e.addresses?e.addresses.map((e=>e.multiaddr)):[]}),this.data=new Map}consumePeerRecord(e){let t;try{t=PeerRecord$1.createFromProtobuf(e.payload)}catch(e){return log$j.error("invalid peer record received"),!1}if(!t.peerId.equals(e.peerId))return log$j("signing key does not match PeerId in the PeerRecord"),!1;if(!t.multiaddrs||!t.multiaddrs.length)return!1;const r=t.peerId,n=r.toB58String(),i=(this.data.get(n)||{record:void 0}).record;if(i&&i.seqNumber>=t.seqNumber)return!1;const s=this._toAddresses(t.multiaddrs,!0);return this._setData(r,{addresses:s,record:{raw:e.marshal(),seqNumber:t.seqNumber}}),log$j(`stored provided peer record for ${n}`),!0}getRawEnvelope(e){const t=this.data.get(e.toB58String());if(t&&t.record&&t.record.raw)return t.record.raw}getPeerRecord(e){const t=this.getRawEnvelope(e);if(t)return Envelope$1.createFromProtobuf(t)}set(e,t){if(!PeerId$a.isPeerId(e))throw log$j.error("peerId must be an instance of peer-id to store data"),errcode$J(new Error("peerId must be an instance of peer-id"),ERR_INVALID_PARAMETERS$6);const r=this._toAddresses(t);if(!r.length)return this;const n=e.toB58String(),i=this.data.get(n);if(i&&i.addresses&&i.addresses.length===r.length){if(i.addresses.filter((e=>r.some((t=>e.multiaddr.equals(t.multiaddr))))).length===i.addresses.length)return log$j(`the addresses provided to store are equal to the already stored for ${n}`),this}return this._setData(e,{addresses:r,record:i&&i.record}),log$j(`stored provided multiaddrs for ${n}`),i||this._ps.emit("peer",e),this}add(e,t){if(!PeerId$a.isPeerId(e))throw log$j.error("peerId must be an instance of peer-id to store data"),errcode$J(new Error("peerId must be an instance of peer-id"),ERR_INVALID_PARAMETERS$6);const r=this._toAddresses(t),n=e.toB58String();if(!r.length)return this;const i=this.data.get(n);return i&&i.addresses&&(i.addresses.forEach((e=>{r.find((t=>t.multiaddr.equals(e.multiaddr)))||r.push(e)})),i.addresses.length===r.length)?(log$j(`the addresses provided to store are already stored for ${n}`),this):(this._setData(e,{addresses:r,record:i&&i.record}),log$j(`added provided multiaddrs for ${n}`),i&&i.addresses||this._ps.emit("peer",e),this)}get(e){if(!PeerId$a.isPeerId(e))throw errcode$J(new Error("peerId must be an instance of peer-id"),ERR_INVALID_PARAMETERS$6);const t=this.data.get(e.toB58String());return t&&t.addresses?[...t.addresses]:void 0}_toAddresses(e,t=!1){if(!e)throw log$j.error("multiaddrs must be provided to store data"),errcode$J(new Error("multiaddrs must be provided"),ERR_INVALID_PARAMETERS$6);const r=[];return e.forEach((e=>{if(!Multiaddr$8.isMultiaddr(e))throw log$j.error(`multiaddr ${e} must be an instance of multiaddr`),errcode$J(new Error(`multiaddr ${e} must be an instance of multiaddr`),ERR_INVALID_PARAMETERS$6);r.find((t=>t.multiaddr.equals(e)))||r.push({multiaddr:e,isCertified:t})})),r}getMultiaddrsForPeer(e,t=(e=>e)){if(!PeerId$a.isPeerId(e))throw errcode$J(new Error("peerId must be an instance of peer-id"),ERR_INVALID_PARAMETERS$6);const r=this.data.get(e.toB58String());if(r&&r.addresses)return t(r.addresses||[]).map((t=>{const r=t.multiaddr,n=r.getPeerId();return n&&n===e.toB58String()?r:r.encapsulate(`/p2p/${e.toB58String()}`)}))}}var addressBook$1=AddressBook$1;const debug$q=require$$0$b,log$i=Object.assign(debug$q("libp2p:peer-store:key-book"),{error:debug$q("libp2p:peer-store:key-book:err")}),errcode$I=errCode$m,PeerId$9=src$q.exports,Book$2=book,{codes:{ERR_INVALID_PARAMETERS:ERR_INVALID_PARAMETERS$5}}=errors$4;class KeyBook$1 extends Book$2{constructor(e){super({peerStore:e,eventName:"change:pubkey",eventProperty:"pubkey",eventTransformer:e=>e.pubKey}),this.data=new Map}set(e,t){if(!PeerId$9.isPeerId(e))throw log$i.error("peerId must be an instance of peer-id to store data"),errcode$I(new Error("peerId must be an instance of peer-id"),ERR_INVALID_PARAMETERS$5);const r=e.toB58String();return!this.data.get(r)&&t&&(e.pubKey=t,this._setData(e,e),log$i(`stored provided public key for ${r}`)),this}get(e){if(!PeerId$9.isPeerId(e))throw errcode$I(new Error("peerId must be an instance of peer-id"),ERR_INVALID_PARAMETERS$5);const t=this.data.get(e.toB58String());return t?t.pubKey:void 0}}var keyBook=KeyBook$1;const debug$p=require$$0$b,log$h=Object.assign(debug$p("libp2p:peer-store:proto-book"),{error:debug$p("libp2p:peer-store:proto-book:err")}),errcode$H=errCode$m,{equals:uint8ArrayEquals$g}=require$$10$1,PeerId$8=src$q.exports,Book$1=book,{codes:{ERR_INVALID_PARAMETERS:ERR_INVALID_PARAMETERS$4}}=errors$4;class MetadataBook$1 extends Book$1{constructor(e){super({peerStore:e,eventName:"change:metadata",eventProperty:"metadata"}),this.data=new Map}set(e,t,r){if(!PeerId$8.isPeerId(e))throw log$h.error("peerId must be an instance of peer-id to store data"),errcode$H(new Error("peerId must be an instance of peer-id"),ERR_INVALID_PARAMETERS$4);if("string"!=typeof t||!(r instanceof Uint8Array))throw log$h.error("valid key and value must be provided to store data"),errcode$H(new Error("valid key and value must be provided"),ERR_INVALID_PARAMETERS$4);return this._setValue(e,t,r),this}_setValue(e,t,r,{emit:n=!0}={}){const i=e.toB58String(),s=this.data.get(i)||new Map,o=s.get(t);o&&uint8ArrayEquals$g(r,o)?log$h(`the metadata provided to store is equal to the already stored for ${i} on ${t}`):(s.set(t,r),this.data.set(i,s),n&&this._emit(e,t))}get(e){if(!PeerId$8.isPeerId(e))throw errcode$H(new Error("peerId must be an instance of peer-id"),ERR_INVALID_PARAMETERS$4);return this.data.get(e.toB58String())}getValue(e,t){if(!PeerId$8.isPeerId(e))throw errcode$H(new Error("peerId must be an instance of peer-id"),ERR_INVALID_PARAMETERS$4);const r=this.data.get(e.toB58String());return r&&r.get(t)}delete(e){if(!PeerId$8.isPeerId(e))throw errcode$H(new Error("peerId must be an instance of peer-id"),ERR_INVALID_PARAMETERS$4);return!!this.data.delete(e.toB58String())&&(this._emit(e),!0)}deleteValue(e,t){if(!PeerId$8.isPeerId(e))throw errcode$H(new Error("peerId must be an instance of peer-id"),ERR_INVALID_PARAMETERS$4);const r=this.data.get(e.toB58String());return!(!r||!r.delete(t))&&(this._emit(e,t),!0)}}var metadataBook=MetadataBook$1;const debug$o=require$$0$b,log$g=Object.assign(debug$o("libp2p:peer-store:proto-book"),{error:debug$o("libp2p:peer-store:proto-book:err")}),errcode$G=errCode$m,PeerId$7=src$q.exports,Book=book,{codes:{ERR_INVALID_PARAMETERS:ERR_INVALID_PARAMETERS$3}}=errors$4;class ProtoBook$1 extends Book{constructor(e){super({peerStore:e,eventName:"change:protocols",eventProperty:"protocols",eventTransformer:e=>Array.from(e)}),this.data=new Map}set(e,t){if(!PeerId$7.isPeerId(e))throw log$g.error("peerId must be an instance of peer-id to store data"),errcode$G(new Error("peerId must be an instance of peer-id"),ERR_INVALID_PARAMETERS$3);if(!t)throw log$g.error("protocols must be provided to store data"),errcode$G(new Error("protocols must be provided"),ERR_INVALID_PARAMETERS$3);const r=e.toB58String(),n=this.data.get(r),i=new Set(t);return n&&((e,t)=>e.size===t.size&&[...e].every((e=>t.has(e))))(n,i)?(log$g(`the protocols provided to store are equal to the already stored for ${r}`),this):(this._setData(e,i),log$g(`stored provided protocols for ${r}`),this)}add(e,t){if(!PeerId$7.isPeerId(e))throw log$g.error("peerId must be an instance of peer-id to store data"),errcode$G(new Error("peerId must be an instance of peer-id"),ERR_INVALID_PARAMETERS$3);if(!t)throw log$g.error("protocols must be provided to store data"),errcode$G(new Error("protocols must be provided"),ERR_INVALID_PARAMETERS$3);const r=e.toB58String(),n=this.data.get(r)||new Set,i=new Set([...n,...t]);return n.size===i.size?(log$g(`the protocols provided to store are already stored for ${r}`),this):(this._setData(e,i),log$g(`added provided protocols for ${r}`),this)}remove(e,t){if(!PeerId$7.isPeerId(e))throw log$g.error("peerId must be an instance of peer-id to store data"),errcode$G(new Error("peerId must be an instance of peer-id"),ERR_INVALID_PARAMETERS$3);if(!t)throw log$g.error("protocols must be provided to store data"),errcode$G(new Error("protocols must be provided"),ERR_INVALID_PARAMETERS$3);const r=e.toB58String(),n=this.data.get(r);if(n){const i=new Set([...n].filter((e=>!t.includes(e))));if(n.size===i.size)return this;this._setData(e,i),log$g(`removed provided protocols for ${r}`)}return this}}var protoBook$1=ProtoBook$1;const errcode$F=errCode$m,{EventEmitter:EventEmitter$6}=require$$1$9,PeerId$6=src$q.exports,AddressBook=addressBook$1,KeyBook=keyBook,MetadataBook=metadataBook,ProtoBook=protoBook$1,{codes:{ERR_INVALID_PARAMETERS:ERR_INVALID_PARAMETERS$2}}=errors$4;class PeerStore$2 extends EventEmitter$6{constructor({peerId:e}){super(),this._peerId=e,this.addressBook=new AddressBook(this),this.keyBook=new KeyBook(this),this.metadataBook=new MetadataBook(this),this.protoBook=new ProtoBook(this)}start(){}stop(){}get peers(){const e=new Set([...this.addressBook.data.keys(),...this.keyBook.data.keys(),...this.protoBook.data.keys(),...this.metadataBook.data.keys()]);this._peerId&&e.delete(this._peerId.toB58String());const t=new Map;return e.forEach((e=>{t.set(e,this.get(PeerId$6.createFromB58String(e)))})),t}delete(e){const t=this.addressBook.delete(e),r=this.keyBook.delete(e),n=this.protoBook.delete(e),i=this.metadataBook.delete(e);return t||r||n||i}get(e){if(!PeerId$6.isPeerId(e))throw errcode$F(new Error("peerId must be an instance of peer-id"),ERR_INVALID_PARAMETERS$2);const t=this.keyBook.data.get(e.toB58String()),r=this.addressBook.get(e),n=this.metadataBook.get(e),i=this.protoBook.get(e);if(t||r||n||i)return{id:t||e,addresses:r||[],protocols:i||[],metadata:n}}}var peerStore=PeerStore$2;function pubsubAdapter(e,t,r){const n=new e(t,r);return n._subscribeAdapter=n.subscribe,n._unsubscribeAdapter=n.unsubscribe,n.subscribe=function(e,t){t&&n.on(e,t),n._subscribeAdapter(e)},n.unsubscribe=function(e,t){t?n.removeListener(e,t):n.removeAllListeners(e),0===n.listenerCount(e)&&n._unsubscribeAdapter(e)},n}var pubsubAdapter_1=pubsubAdapter,consts={NAMESPACE_COMMON:"/peers/",NAMESPACE_ADDRESS:"/peers/addrs/",NAMESPACE_KEYS:"/peers/keys/",NAMESPACE_METADATA:"/peers/metadata/",NAMESPACE_PROTOCOL:"/peers/protos/"},$protobuf$a=minimal,$Reader$a=$protobuf$a.Reader,$Writer$a=$protobuf$a.Writer,$util$a=$protobuf$a.util,$root$a=$protobuf$a.roots["libp2p-address-book"]||($protobuf$a.roots["libp2p-address-book"]={});$root$a.Addresses=function(){function e(e){if(this.addrs=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.addrs=$util$a.emptyArray,e.prototype.certifiedRecord=null,e.encode=function(e,t){if(t||(t=$Writer$a.create()),null!=e.addrs&&e.addrs.length)for(var r=0;r<e.addrs.length;++r)$root$a.Addresses.Address.encode(e.addrs[r],t.uint32(10).fork()).ldelim();return null!=e.certifiedRecord&&Object.hasOwnProperty.call(e,"certifiedRecord")&&$root$a.Addresses.CertifiedRecord.encode(e.certifiedRecord,t.uint32(18).fork()).ldelim(),t},e.decode=function(e,t){e instanceof $Reader$a||(e=$Reader$a.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root$a.Addresses;e.pos<r;){var i=e.uint32();switch(i>>>3){case 1:n.addrs&&n.addrs.length||(n.addrs=[]),n.addrs.push($root$a.Addresses.Address.decode(e,e.uint32()));break;case 2:n.certifiedRecord=$root$a.Addresses.CertifiedRecord.decode(e,e.uint32());break;default:e.skipType(7&i)}}return n},e.fromObject=function(e){if(e instanceof $root$a.Addresses)return e;var t=new $root$a.Addresses;if(e.addrs){if(!Array.isArray(e.addrs))throw TypeError(".Addresses.addrs: array expected");t.addrs=[];for(var r=0;r<e.addrs.length;++r){if("object"!=typeof e.addrs[r])throw TypeError(".Addresses.addrs: object expected");t.addrs[r]=$root$a.Addresses.Address.fromObject(e.addrs[r])}}if(null!=e.certifiedRecord){if("object"!=typeof e.certifiedRecord)throw TypeError(".Addresses.certifiedRecord: object expected");t.certifiedRecord=$root$a.Addresses.CertifiedRecord.fromObject(e.certifiedRecord)}return t},e.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.addrs=[]),t.defaults&&(r.certifiedRecord=null),e.addrs&&e.addrs.length){r.addrs=[];for(var n=0;n<e.addrs.length;++n)r.addrs[n]=$root$a.Addresses.Address.toObject(e.addrs[n],t)}return null!=e.certifiedRecord&&e.hasOwnProperty("certifiedRecord")&&(r.certifiedRecord=$root$a.Addresses.CertifiedRecord.toObject(e.certifiedRecord,t)),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf$a.util.toJSONOptions)},e.Address=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.multiaddr=$util$a.newBuffer([]),e.prototype.isCertified=!1,e.encode=function(e,t){return t||(t=$Writer$a.create()),null!=e.multiaddr&&Object.hasOwnProperty.call(e,"multiaddr")&&t.uint32(10).bytes(e.multiaddr),null!=e.isCertified&&Object.hasOwnProperty.call(e,"isCertified")&&t.uint32(16).bool(e.isCertified),t},e.decode=function(e,t){e instanceof $Reader$a||(e=$Reader$a.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root$a.Addresses.Address;e.pos<r;){var i=e.uint32();switch(i>>>3){case 1:n.multiaddr=e.bytes();break;case 2:n.isCertified=e.bool();break;default:e.skipType(7&i)}}return n},e.fromObject=function(e){if(e instanceof $root$a.Addresses.Address)return e;var t=new $root$a.Addresses.Address;return null!=e.multiaddr&&("string"==typeof e.multiaddr?$util$a.base64.decode(e.multiaddr,t.multiaddr=$util$a.newBuffer($util$a.base64.length(e.multiaddr)),0):e.multiaddr.length&&(t.multiaddr=e.multiaddr)),null!=e.isCertified&&(t.isCertified=Boolean(e.isCertified)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(t.bytes===String?r.multiaddr="":(r.multiaddr=[],t.bytes!==Array&&(r.multiaddr=$util$a.newBuffer(r.multiaddr))),r.isCertified=!1),null!=e.multiaddr&&e.hasOwnProperty("multiaddr")&&(r.multiaddr=t.bytes===String?$util$a.base64.encode(e.multiaddr,0,e.multiaddr.length):t.bytes===Array?Array.prototype.slice.call(e.multiaddr):e.multiaddr),null!=e.isCertified&&e.hasOwnProperty("isCertified")&&(r.isCertified=e.isCertified),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf$a.util.toJSONOptions)},e}(),e.CertifiedRecord=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.seq=$util$a.Long?$util$a.Long.fromBits(0,0,!0):0,e.prototype.raw=$util$a.newBuffer([]),e.encode=function(e,t){return t||(t=$Writer$a.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.raw&&Object.hasOwnProperty.call(e,"raw")&&t.uint32(18).bytes(e.raw),t},e.decode=function(e,t){e instanceof $Reader$a||(e=$Reader$a.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root$a.Addresses.CertifiedRecord;e.pos<r;){var i=e.uint32();switch(i>>>3){case 1:n.seq=e.uint64();break;case 2:n.raw=e.bytes();break;default:e.skipType(7&i)}}return n},e.fromObject=function(e){if(e instanceof $root$a.Addresses.CertifiedRecord)return e;var t=new $root$a.Addresses.CertifiedRecord;return null!=e.seq&&($util$a.Long?(t.seq=$util$a.Long.fromValue(e.seq)).unsigned=!0:"string"==typeof e.seq?t.seq=parseInt(e.seq,10):"number"==typeof e.seq?t.seq=e.seq:"object"==typeof e.seq&&(t.seq=new $util$a.LongBits(e.seq.low>>>0,e.seq.high>>>0).toNumber(!0))),null!=e.raw&&("string"==typeof e.raw?$util$a.base64.decode(e.raw,t.raw=$util$a.newBuffer($util$a.base64.length(e.raw)),0):e.raw.length&&(t.raw=e.raw)),t},e.toObject=function(e,t){t||(t={});var r={};if(t.defaults){if($util$a.Long){var n=new $util$a.Long(0,0,!0);r.seq=t.longs===String?n.toString():t.longs===Number?n.toNumber():n}else r.seq=t.longs===String?"0":0;t.bytes===String?r.raw="":(r.raw=[],t.bytes!==Array&&(r.raw=$util$a.newBuffer(r.raw)))}return null!=e.seq&&e.hasOwnProperty("seq")&&("number"==typeof e.seq?r.seq=t.longs===String?String(e.seq):e.seq:r.seq=t.longs===String?$util$a.Long.prototype.toString.call(e.seq):t.longs===Number?new $util$a.LongBits(e.seq.low>>>0,e.seq.high>>>0).toNumber(!0):e.seq),null!=e.raw&&e.hasOwnProperty("raw")&&(r.raw=t.bytes===String?$util$a.base64.encode(e.raw,0,e.raw.length):t.bytes===Array?Array.prototype.slice.call(e.raw):e.raw),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf$a.util.toJSONOptions)},e}(),e}();var addressBook=$root$a,$protobuf$9=minimal,$Reader$9=$protobuf$9.Reader,$Writer$9=$protobuf$9.Writer,$util$9=$protobuf$9.util,$root$9=$protobuf$9.roots["libp2p-proto-book"]||($protobuf$9.roots["libp2p-proto-book"]={});$root$9.Protocols=function(){function e(e){if(this.protocols=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.protocols=$util$9.emptyArray,e.encode=function(e,t){if(t||(t=$Writer$9.create()),null!=e.protocols&&e.protocols.length)for(var r=0;r<e.protocols.length;++r)t.uint32(10).string(e.protocols[r]);return t},e.decode=function(e,t){e instanceof $Reader$9||(e=$Reader$9.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root$9.Protocols;e.pos<r;){var i=e.uint32();if(i>>>3==1)n.protocols&&n.protocols.length||(n.protocols=[]),n.protocols.push(e.string());else e.skipType(7&i)}return n},e.fromObject=function(e){if(e instanceof $root$9.Protocols)return e;var t=new $root$9.Protocols;if(e.protocols){if(!Array.isArray(e.protocols))throw TypeError(".Protocols.protocols: array expected");t.protocols=[];for(var r=0;r<e.protocols.length;++r)t.protocols[r]=String(e.protocols[r])}return t},e.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.protocols=[]),e.protocols&&e.protocols.length){r.protocols=[];for(var n=0;n<e.protocols.length;++n)r.protocols[n]=e.protocols[n]}return r},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf$9.util.toJSONOptions)},e}();var protoBook=$root$9;const debug$n=require$$0$b,log$f=Object.assign(debug$n("libp2p:persistent-peer-store"),{error:debug$n("libp2p:persistent-peer-store:err")}),{Key:Key}=require$$1$4,{Multiaddr:Multiaddr$7}=src$o,PeerId$5=src$q.exports,{base32:base32}=require$$1$8,PeerStore$1=peerStore,{NAMESPACE_ADDRESS:NAMESPACE_ADDRESS,NAMESPACE_COMMON:NAMESPACE_COMMON,NAMESPACE_KEYS:NAMESPACE_KEYS,NAMESPACE_METADATA:NAMESPACE_METADATA,NAMESPACE_PROTOCOL:NAMESPACE_PROTOCOL}=consts,{Addresses:Addresses}=addressBook,{Protocols:Protocols}=protoBook;class PersistentPeerStore$1 extends PeerStore$1{constructor({peerId:e,datastore:t,threshold:r=5}){super({peerId:e}),this._datastore=t,this._dirtyPeers=new Set,this._dirtyMetadata=new Map,this.threshold=r,this._addDirtyPeer=this._addDirtyPeer.bind(this)}async start(){log$f("PeerStore is starting"),this.on("change:protocols",this._addDirtyPeer),this.on("change:multiaddrs",this._addDirtyPeer),this.on("change:pubkey",this._addDirtyPeerKey),this.on("change:metadata",this._addDirtyPeerMetadata);for await(const e of this._datastore.query({prefix:NAMESPACE_COMMON}))await this._processDatastoreEntry(e);log$f("PeerStore started")}async stop(){log$f("PeerStore is stopping"),this.removeAllListeners(),await this._commitData(),log$f("PeerStore stopped")}_addDirtyPeer({peerId:e}){const t=e.toB58String();log$f("add dirty peer",t),this._dirtyPeers.add(t),this._dirtyPeers.size>=this.threshold&&this._commitData().catch((e=>{log$f.error("error committing data",e)}))}_addDirtyPeerKey({peerId:e}){if(e.hasInlinePublicKey())return;const t=e.toB58String();log$f("add dirty peer key",t),this._dirtyPeers.add(t),this._dirtyPeers.size>=this.threshold&&this._commitData().catch((e=>{log$f.error("error committing data",e)}))}_addDirtyPeerMetadata({peerId:e,metadata:t}){const r=e.toB58String();log$f("add dirty metadata peer",r),this._dirtyPeers.add(r);const n=this._dirtyMetadata.get(r)||new Set;n.add(t),this._dirtyMetadata.set(r,n),this._dirtyPeers.size>=this.threshold&&this._commitData().catch((e=>{log$f.error("error committing data",e)}))}async _commitData(){const e=Array.from(this._dirtyPeers);if(!e.length)return;this._dirtyPeers.clear(),log$f("create batch commit");const t=this._datastore.batch();for(const r of e){const e=this.keyBook.data.get(r)||PeerId$5.createFromB58String(r);this._batchAddressBook(e,t),!e.hasInlinePublicKey()&&this._batchKeyBook(e,t),this._batchMetadataBook(e,t),this._batchProtoBook(e,t)}await t.commit(),log$f("batch committed")}_batchAddressBook(e,t){const r=e.toString(),n=new Key(`${NAMESPACE_ADDRESS}${r}`),i=this.addressBook.data.get(e.toB58String());try{if(!i)return void t.delete(n);const e=Addresses.encode({addrs:i.addresses.map((e=>({multiaddr:e.multiaddr.bytes,isCertified:e.isCertified}))),certifiedRecord:i.record?{seq:i.record.seqNumber,raw:i.record.raw}:void 0}).finish();t.put(n,e)}catch(e){log$f.error(e)}}_batchKeyBook(e,t){const r=e.toString(),n=new Key(`${NAMESPACE_KEYS}${r}`);try{if(!e.pubKey)return void t.delete(n);const r=e.marshalPubKey();t.put(n,r)}catch(e){log$f.error(e)}}_batchMetadataBook(e,t){const r=e.toString(),n=this._dirtyMetadata.get(e.toB58String())||[];try{n.forEach((n=>{const i=new Key(`${NAMESPACE_METADATA}${r}/${n}`),s=this.metadataBook.getValue(e,n);s?t.put(i,s):t.delete(i)}))}catch(e){log$f.error(e)}}_batchProtoBook(e,t){const r=e.toString(),n=new Key(`${NAMESPACE_PROTOCOL}${r}`),i=this.protoBook.get(e);try{if(!i)return void t.delete(n);const e=Protocols.encode({protocols:i}).finish();t.put(n,e)}catch(e){log$f.error(e)}}async _processDatastoreEntry({key:e,value:t}){try{const r=e.toString().split("/"),n=PeerId$5.createFromBytes(base32.decode(r[3]));let i;switch(r[2]){case"addrs":i=Addresses.decode(t),this.addressBook._setData(n,{addresses:i.addrs.map((e=>({multiaddr:new Multiaddr$7(e.multiaddr),isCertified:Boolean(e.isCertified)}))),record:i.certifiedRecord?{raw:i.certifiedRecord.raw,seqNumber:i.certifiedRecord.seq}:void 0},{emit:!1});break;case"keys":i=await PeerId$5.createFromPubKey(t),this.keyBook._setData(i,i,{emit:!1});break;case"metadata":this.metadataBook._setValue(n,r[4],t,{emit:!1});break;case"protos":i=Protocols.decode(t),this.protoBook._setData(n,new Set(i.protocols),{emit:!1});break;default:log$f("invalid data persisted for: ",e.toString())}}catch(e){log$f.error(e)}}}var persistent=PersistentPeerStore$1;const noop$3=()=>{},topologySymbol=Symbol.for("@libp2p/js-interfaces/topology");class Topology$2{constructor({min:e=0,max:t=1/0,handlers:r={}}){this.min=e,this.max=t,this._onConnect=r.onConnect||noop$3,this._onDisconnect=r.onDisconnect||noop$3,this.peers=new Set}get[Symbol.toStringTag](){return"Topology"}get[topologySymbol](){return!0}static isTopology(e){return Boolean(e&&e[topologySymbol])}set registrar(e){this._registrar=e}disconnect(e){this._onDisconnect(e)}}var topology=Topology$2;const debug$m=require$$0$b,log$e=Object.assign(debug$m("libp2p:registrar"),{error:debug$m("libp2p:registrar:err")}),errcode$E=errCode$m,{codes:{ERR_INVALID_PARAMETERS:ERR_INVALID_PARAMETERS$1}}=errors$4,Topology$1=topology;class Registrar$1{constructor({peerStore:e,connectionManager:t}){this.peerStore=e,this.connectionManager=t,this.topologies=new Map,this._handle=void 0,this._onDisconnect=this._onDisconnect.bind(this),this.connectionManager.on("peer:disconnect",this._onDisconnect)}get handle(){return this._handle}set handle(e){this._handle=e}getConnection(e){return this.connectionManager.get(e)}register(e){if(!Topology$1.isTopology(e))throw log$e.error("topology must be an instance of interfaces/topology"),errcode$E(new Error("topology must be an instance of interfaces/topology"),ERR_INVALID_PARAMETERS$1);const t=(1e9*Math.random()).toString(36)+Date.now();return this.topologies.set(t,e),e.registrar=this,t}unregister(e){return this.topologies.delete(e)}_onDisconnect(e){for(const[,t]of this.topologies)t.disconnect(e.remotePeer)}}var registrar=Registrar$1,ping$1={exports:{}},itBuffer={exports:{}};const{Buffer:Buffer$6}=require$$0$7,symbol$1=Symbol.for("BufferList");function BufferList$5(e){if(!(this instanceof BufferList$5))return new BufferList$5(e);BufferList$5._init.call(this,e)}BufferList$5._init=function(e){Object.defineProperty(this,symbol$1,{value:!0}),this._bufs=[],this.length=0,e&&this.append(e)},BufferList$5.prototype._new=function(e){return new BufferList$5(e)},BufferList$5.prototype._offset=function(e){if(0===e)return[0,0];let t=0;for(let r=0;r<this._bufs.length;r++){const n=t+this._bufs[r].length;if(e<n||r===this._bufs.length-1)return[r,e-t];t=n}},BufferList$5.prototype._reverseOffset=function(e){const t=e[0];let r=e[1];for(let e=0;e<t;e++)r+=this._bufs[e].length;return r},BufferList$5.prototype.get=function(e){if(e>this.length||e<0)return;const t=this._offset(e);return this._bufs[t[0]][t[1]]},BufferList$5.prototype.slice=function(e,t){return"number"==typeof e&&e<0&&(e+=this.length),"number"==typeof t&&t<0&&(t+=this.length),this.copy(null,0,e,t)},BufferList$5.prototype.copy=function(e,t,r,n){if(("number"!=typeof r||r<0)&&(r=0),("number"!=typeof n||n>this.length)&&(n=this.length),r>=this.length)return e||Buffer$6.alloc(0);if(n<=0)return e||Buffer$6.alloc(0);const i=!!e,s=this._offset(r),o=n-r;let a=o,u=i&&t||0,c=s[1];if(0===r&&n===this.length){if(!i)return 1===this._bufs.length?this._bufs[0]:Buffer$6.concat(this._bufs,this.length);for(let t=0;t<this._bufs.length;t++)this._bufs[t].copy(e,u),u+=this._bufs[t].length;return e}if(a<=this._bufs[s[0]].length-c)return i?this._bufs[s[0]].copy(e,t,c,c+a):this._bufs[s[0]].slice(c,c+a);i||(e=Buffer$6.allocUnsafe(o));for(let t=s[0];t<this._bufs.length;t++){const r=this._bufs[t].length-c;if(!(a>r)){this._bufs[t].copy(e,u,c,c+a),u+=r;break}this._bufs[t].copy(e,u,c),u+=r,a-=r,c&&(c=0)}return e.length>u?e.slice(0,u):e},BufferList$5.prototype.shallowSlice=function(e,t){if(e=e||0,t="number"!=typeof t?this.length:t,e<0&&(e+=this.length),t<0&&(t+=this.length),e===t)return this._new();const r=this._offset(e),n=this._offset(t),i=this._bufs.slice(r[0],n[0]+1);return 0===n[1]?i.pop():i[i.length-1]=i[i.length-1].slice(0,n[1]),0!==r[1]&&(i[0]=i[0].slice(r[1])),this._new(i)},BufferList$5.prototype.toString=function(e,t,r){return this.slice(t,r).toString(e)},BufferList$5.prototype.consume=function(e){if(e=Math.trunc(e),Number.isNaN(e)||e<=0)return this;for(;this._bufs.length;){if(!(e>=this._bufs[0].length)){this._bufs[0]=this._bufs[0].slice(e),this.length-=e;break}e-=this._bufs[0].length,this.length-=this._bufs[0].length,this._bufs.shift()}return this},BufferList$5.prototype.duplicate=function(){const e=this._new();for(let t=0;t<this._bufs.length;t++)e.append(this._bufs[t]);return e},BufferList$5.prototype.append=function(e){if(null==e)return this;if(e.buffer)this._appendBuffer(Buffer$6.from(e.buffer,e.byteOffset,e.byteLength));else if(Array.isArray(e))for(let t=0;t<e.length;t++)this.append(e[t]);else if(this._isBufferList(e))for(let t=0;t<e._bufs.length;t++)this.append(e._bufs[t]);else"number"==typeof e&&(e=e.toString()),this._appendBuffer(Buffer$6.from(e));return this},BufferList$5.prototype._appendBuffer=function(e){this._bufs.push(e),this.length+=e.length},BufferList$5.prototype.indexOf=function(e,t,r){if(void 0===r&&"string"==typeof t&&(r=t,t=void 0),"function"==typeof e||Array.isArray(e))throw new TypeError('The "value" argument must be one of type string, Buffer, BufferList, or Uint8Array.');if("number"==typeof e?e=Buffer$6.from([e]):"string"==typeof e?e=Buffer$6.from(e,r):this._isBufferList(e)?e=e.slice():Array.isArray(e.buffer)?e=Buffer$6.from(e.buffer,e.byteOffset,e.byteLength):Buffer$6.isBuffer(e)||(e=Buffer$6.from(e)),t=Number(t||0),isNaN(t)&&(t=0),t<0&&(t=this.length+t),t<0&&(t=0),0===e.length)return t>this.length?this.length:t;const n=this._offset(t);let i=n[0],s=n[1];for(;i<this._bufs.length;i++){const t=this._bufs[i];for(;s<t.length;){if(t.length-s>=e.length){const r=t.indexOf(e,s);if(-1!==r)return this._reverseOffset([i,r]);s=t.length-e.length+1}else{const t=this._reverseOffset([i,s]);if(this._match(t,e))return t;s++}}s=0}return-1},BufferList$5.prototype._match=function(e,t){if(this.length-e<t.length)return!1;for(let r=0;r<t.length;r++)if(this.get(e+r)!==t[r])return!1;return!0},function(){const e={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1,readIntBE:null,readIntLE:null,readUIntBE:null,readUIntLE:null};for(const t in e)!function(t){BufferList$5.prototype[t]=null===e[t]?function(e,r){return this.slice(e,e+r)[t](0,r)}:function(r=0){return this.slice(r,r+e[t])[t](0)}}(t)}(),BufferList$5.prototype._isBufferList=function(e){return e instanceof BufferList$5||BufferList$5.isBufferList(e)},BufferList$5.isBufferList=function(e){return null!=e&&e[symbol$1]};var BufferList_1$1=BufferList$5;!function(e){const{Buffer:t}=require$$0$7,r=BufferList_1$1;e.exports=async function*(e){for await(const n of e)t.isBuffer(n)?yield n:r.isBufferList(n)?yield n.slice():yield t.from(n)},e.exports.toBuffer=e.exports,e.exports.toList=async function*(e){for await(const n of e)t.isBuffer(n)?yield(new r).append(n):r.isBufferList(n)?yield n:yield(new r).append(t.from(n))}}(itBuffer);var constants$6={PROTOCOL:"/ipfs/ping/1.0.0",PING_LENGTH:32,PROTOCOL_VERSION:"1.0.0",PROTOCOL_NAME:"ping"};!function(e,t){const r=require$$0$b,n=Object.assign(r("libp2p:ping"),{error:r("libp2p:ping:err")}),i=errCode$m,s=src$g,{pipe:o}=itPipe.exports,{toBuffer:a}=itBuffer.exports,{collect:u,take:c}=require$$4$2,{equals:l}=require$$10$1,{PROTOCOL_NAME:h,PING_LENGTH:d,PROTOCOL_VERSION:f}=constants$6;t=e.exports=async function(e,t){const r=`/${e._config.protocolPrefix}/${h}/${f}`;n("dialing %s to %s",r,t.toB58String?t.toB58String():t);const p=await e.dial(t),{stream:y}=await p.newStream(r),g=Date.now(),$=s.randomBytes(d),[m]=await o([$],y,(e=>c(1,e)),a,u),b=Date.now();if(!l($,m))throw i(new Error("Received wrong ping ack"),"ERR_WRONG_PING_ACK");return b-g},t.mount=function(e){e.handle(`/${e._config.protocolPrefix}/${h}/${f}`,(({stream:e})=>o(e,e)))},t.unmount=function(e){e.unhandle(`/${e._config.protocolPrefix}/${h}/${f}`)}}(ping$1,ping$1.exports);var $protobuf$8=minimal,$Reader$8=$protobuf$8.Reader,$Writer$8=$protobuf$8.Writer,$util$8=$protobuf$8.util,$root$8=$protobuf$8.roots["libp2p-identify"]||($protobuf$8.roots["libp2p-identify"]={});$root$8.Identify=function(){function e(e){if(this.listenAddrs=[],this.protocols=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.protocolVersion="",e.prototype.agentVersion="",e.prototype.publicKey=$util$8.newBuffer([]),e.prototype.listenAddrs=$util$8.emptyArray,e.prototype.observedAddr=$util$8.newBuffer([]),e.prototype.protocols=$util$8.emptyArray,e.prototype.signedPeerRecord=$util$8.newBuffer([]),e.encode=function(e,t){if(t||(t=$Writer$8.create()),null!=e.publicKey&&Object.hasOwnProperty.call(e,"publicKey")&&t.uint32(10).bytes(e.publicKey),null!=e.listenAddrs&&e.listenAddrs.length)for(var r=0;r<e.listenAddrs.length;++r)t.uint32(18).bytes(e.listenAddrs[r]);if(null!=e.protocols&&e.protocols.length)for(r=0;r<e.protocols.length;++r)t.uint32(26).string(e.protocols[r]);return null!=e.observedAddr&&Object.hasOwnProperty.call(e,"observedAddr")&&t.uint32(34).bytes(e.observedAddr),null!=e.protocolVersion&&Object.hasOwnProperty.call(e,"protocolVersion")&&t.uint32(42).string(e.protocolVersion),null!=e.agentVersion&&Object.hasOwnProperty.call(e,"agentVersion")&&t.uint32(50).string(e.agentVersion),null!=e.signedPeerRecord&&Object.hasOwnProperty.call(e,"signedPeerRecord")&&t.uint32(66).bytes(e.signedPeerRecord),t},e.decode=function(e,t){e instanceof $Reader$8||(e=$Reader$8.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root$8.Identify;e.pos<r;){var i=e.uint32();switch(i>>>3){case 5:n.protocolVersion=e.string();break;case 6:n.agentVersion=e.string();break;case 1:n.publicKey=e.bytes();break;case 2:n.listenAddrs&&n.listenAddrs.length||(n.listenAddrs=[]),n.listenAddrs.push(e.bytes());break;case 4:n.observedAddr=e.bytes();break;case 3:n.protocols&&n.protocols.length||(n.protocols=[]),n.protocols.push(e.string());break;case 8:n.signedPeerRecord=e.bytes();break;default:e.skipType(7&i)}}return n},e.fromObject=function(e){if(e instanceof $root$8.Identify)return e;var t=new $root$8.Identify;if(null!=e.protocolVersion&&(t.protocolVersion=String(e.protocolVersion)),null!=e.agentVersion&&(t.agentVersion=String(e.agentVersion)),null!=e.publicKey&&("string"==typeof e.publicKey?$util$8.base64.decode(e.publicKey,t.publicKey=$util$8.newBuffer($util$8.base64.length(e.publicKey)),0):e.publicKey.length&&(t.publicKey=e.publicKey)),e.listenAddrs){if(!Array.isArray(e.listenAddrs))throw TypeError(".Identify.listenAddrs: array expected");t.listenAddrs=[];for(var r=0;r<e.listenAddrs.length;++r)"string"==typeof e.listenAddrs[r]?$util$8.base64.decode(e.listenAddrs[r],t.listenAddrs[r]=$util$8.newBuffer($util$8.base64.length(e.listenAddrs[r])),0):e.listenAddrs[r].length&&(t.listenAddrs[r]=e.listenAddrs[r])}if(null!=e.observedAddr&&("string"==typeof e.observedAddr?$util$8.base64.decode(e.observedAddr,t.observedAddr=$util$8.newBuffer($util$8.base64.length(e.observedAddr)),0):e.observedAddr.length&&(t.observedAddr=e.observedAddr)),e.protocols){if(!Array.isArray(e.protocols))throw TypeError(".Identify.protocols: array expected");t.protocols=[];for(r=0;r<e.protocols.length;++r)t.protocols[r]=String(e.protocols[r])}return null!=e.signedPeerRecord&&("string"==typeof e.signedPeerRecord?$util$8.base64.decode(e.signedPeerRecord,t.signedPeerRecord=$util$8.newBuffer($util$8.base64.length(e.signedPeerRecord)),0):e.signedPeerRecord.length&&(t.signedPeerRecord=e.signedPeerRecord)),t},e.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.listenAddrs=[],r.protocols=[]),t.defaults&&(t.bytes===String?r.publicKey="":(r.publicKey=[],t.bytes!==Array&&(r.publicKey=$util$8.newBuffer(r.publicKey))),t.bytes===String?r.observedAddr="":(r.observedAddr=[],t.bytes!==Array&&(r.observedAddr=$util$8.newBuffer(r.observedAddr))),r.protocolVersion="",r.agentVersion="",t.bytes===String?r.signedPeerRecord="":(r.signedPeerRecord=[],t.bytes!==Array&&(r.signedPeerRecord=$util$8.newBuffer(r.signedPeerRecord)))),null!=e.publicKey&&e.hasOwnProperty("publicKey")&&(r.publicKey=t.bytes===String?$util$8.base64.encode(e.publicKey,0,e.publicKey.length):t.bytes===Array?Array.prototype.slice.call(e.publicKey):e.publicKey),e.listenAddrs&&e.listenAddrs.length){r.listenAddrs=[];for(var n=0;n<e.listenAddrs.length;++n)r.listenAddrs[n]=t.bytes===String?$util$8.base64.encode(e.listenAddrs[n],0,e.listenAddrs[n].length):t.bytes===Array?Array.prototype.slice.call(e.listenAddrs[n]):e.listenAddrs[n]}if(e.protocols&&e.protocols.length){r.protocols=[];for(n=0;n<e.protocols.length;++n)r.protocols[n]=e.protocols[n]}return null!=e.observedAddr&&e.hasOwnProperty("observedAddr")&&(r.observedAddr=t.bytes===String?$util$8.base64.encode(e.observedAddr,0,e.observedAddr.length):t.bytes===Array?Array.prototype.slice.call(e.observedAddr):e.observedAddr),null!=e.protocolVersion&&e.hasOwnProperty("protocolVersion")&&(r.protocolVersion=e.protocolVersion),null!=e.agentVersion&&e.hasOwnProperty("agentVersion")&&(r.agentVersion=e.agentVersion),null!=e.signedPeerRecord&&e.hasOwnProperty("signedPeerRecord")&&(r.signedPeerRecord=t.bytes===String?$util$8.base64.encode(e.signedPeerRecord,0,e.signedPeerRecord.length):t.bytes===Array?Array.prototype.slice.call(e.signedPeerRecord):e.signedPeerRecord),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf$8.util.toJSONOptions)},e}();var message=$root$8;const debug$l=require$$0$b,log$d=Object.assign(debug$l("libp2p:identify"),{error:debug$l("libp2p:identify:err")}),errCode$6=errCode$m,lp$2=src$i,{pipe:pipe$4}=itPipe.exports,{collect:collect,take:take,consume:consume}=require$$4$2,{fromString:uint8ArrayFromString$j}=require$$3$1,PeerId$4=src$q.exports,{Multiaddr:Multiaddr$6}=src$o,{toBuffer:toBuffer}=itBuffer.exports,Message=message,Envelope=envelope,PeerRecord=peerRecord,{MULTICODEC_IDENTIFY:MULTICODEC_IDENTIFY,MULTICODEC_IDENTIFY_PUSH:MULTICODEC_IDENTIFY_PUSH,IDENTIFY_PROTOCOL_VERSION:IDENTIFY_PROTOCOL_VERSION,MULTICODEC_IDENTIFY_PROTOCOL_NAME:MULTICODEC_IDENTIFY_PROTOCOL_NAME,MULTICODEC_IDENTIFY_PUSH_PROTOCOL_NAME:MULTICODEC_IDENTIFY_PUSH_PROTOCOL_NAME,MULTICODEC_IDENTIFY_PROTOCOL_VERSION:MULTICODEC_IDENTIFY_PROTOCOL_VERSION,MULTICODEC_IDENTIFY_PUSH_PROTOCOL_VERSION:MULTICODEC_IDENTIFY_PUSH_PROTOCOL_VERSION}=consts$2,{codes:codes$3}=errors$4;class IdentifyService$1{static getProtocolStr(e){return{identifyProtocolStr:`/${e._config.protocolPrefix}/${MULTICODEC_IDENTIFY_PROTOCOL_NAME}/${MULTICODEC_IDENTIFY_PROTOCOL_VERSION}`,identifyPushProtocolStr:`/${e._config.protocolPrefix}/${MULTICODEC_IDENTIFY_PUSH_PROTOCOL_NAME}/${MULTICODEC_IDENTIFY_PUSH_PROTOCOL_VERSION}`}}constructor({libp2p:e}){this._libp2p=e,this.peerStore=e.peerStore,this.addressManager=e.addressManager,this.connectionManager=e.connectionManager,this.peerId=e.peerId,this.handleMessage=this.handleMessage.bind(this);const t=IdentifyService$1.getProtocolStr(e);this.identifyProtocolStr=t.identifyProtocolStr,this.identifyPushProtocolStr=t.identifyPushProtocolStr,this._host={protocolVersion:`${e._config.protocolPrefix}/${IDENTIFY_PROTOCOL_VERSION}`,...e._options.host},this.peerStore.metadataBook.set(this.peerId,"AgentVersion",uint8ArrayFromString$j(this._host.agentVersion)),this.peerStore.metadataBook.set(this.peerId,"ProtocolVersion",uint8ArrayFromString$j(this._host.protocolVersion)),this.connectionManager.on("peer:connect",(e=>{this.identify(e).catch(log$d.error)})),this.peerStore.on("change:multiaddrs",(({peerId:e})=>{e.toString()===this.peerId.toString()&&this.pushToPeerStore()})),this.peerStore.on("change:protocols",(({peerId:e})=>{e.toString()===this.peerId.toString()&&this.pushToPeerStore()}))}async push(e){const t=await this.peerStore.addressBook.getRawEnvelope(this.peerId),r=this._libp2p.multiaddrs.map((e=>e.bytes)),n=this.peerStore.protoBook.get(this.peerId)||[],i=e.map((async e=>{try{const{stream:i}=await e.newStream(this.identifyPushProtocolStr);await pipe$4([Message.Identify.encode({listenAddrs:r,signedPeerRecord:t,protocols:n}).finish()],lp$2.encode(),i,consume)}catch(e){log$d.error("could not push identify update to peer",e)}}));return Promise.all(i)}pushToPeerStore(){if(!this._libp2p.isStarted())return;const e=[];let t;for(const r of this.peerStore.peers.values())r.protocols.includes(this.identifyPushProtocolStr)&&(t=this.connectionManager.get(r.id))&&e.push(t);this.push(e)}async identify(e){const{stream:t}=await e.newStream(this.identifyProtocolStr),[r]=await pipe$4([],t,lp$2.decode(),take(1),toBuffer,collect);if(!r)throw errCode$6(new Error("No data could be retrieved"),codes$3.ERR_CONNECTION_ENDED);let n;try{n=Message.Identify.decode(r)}catch(e){throw errCode$6(e,codes$3.ERR_INVALID_MESSAGE)}const{publicKey:i,listenAddrs:s,protocols:o,observedAddr:a,signedPeerRecord:u}=n,c=await PeerId$4.createFromPubKey(i);if(e.remotePeer.toB58String()!==c.toB58String())throw errCode$6(new Error("identified peer does not match the expected peer"),codes$3.ERR_INVALID_PEER);const l=IdentifyService$1.getCleanMultiaddr(a);try{const e=await Envelope.openAndCertify(u,PeerRecord.DOMAIN);if(this.peerStore.addressBook.consumePeerRecord(e))return this.peerStore.protoBook.set(c,o),this.peerStore.metadataBook.set(c,"AgentVersion",uint8ArrayFromString$j(n.agentVersion)),void this.peerStore.metadataBook.set(c,"ProtocolVersion",uint8ArrayFromString$j(n.protocolVersion))}catch(e){log$d("received invalid envelope, discard it and fallback to listenAddrs is available",e)}try{this.peerStore.addressBook.set(c,s.map((e=>new Multiaddr$6(e))))}catch(e){log$d.error("received invalid addrs",e)}this.peerStore.protoBook.set(c,o),this.peerStore.metadataBook.set(c,"AgentVersion",uint8ArrayFromString$j(n.agentVersion)),this.peerStore.metadataBook.set(c,"ProtocolVersion",uint8ArrayFromString$j(n.protocolVersion)),log$d("received observed address of %s",l)}handleMessage({connection:e,stream:t,protocol:r}){switch(r){case this.identifyProtocolStr:return this._handleIdentify({connection:e,stream:t});case this.identifyPushProtocolStr:return this._handlePush({connection:e,stream:t});default:log$d.error("cannot handle unknown protocol %s",r)}}async _handleIdentify({connection:e,stream:t}){let r=new Uint8Array(0);this.peerId.pubKey&&(r=this.peerId.pubKey.bytes);const n=await this.peerStore.addressBook.getRawEnvelope(this.peerId),i=this.peerStore.protoBook.get(this.peerId)||[],s=Message.Identify.encode({protocolVersion:this._host.protocolVersion,agentVersion:this._host.agentVersion,publicKey:r,listenAddrs:this._libp2p.multiaddrs.map((e=>e.bytes)),signedPeerRecord:n,observedAddr:e.remoteAddr.bytes,protocols:i}).finish();try{await pipe$4([s],lp$2.encode(),t,consume)}catch(e){log$d.error("could not respond to identify request",e)}}async _handlePush({connection:e,stream:t}){let r;try{const[e]=await pipe$4([],t,lp$2.decode(),take(1),toBuffer,collect);r=Message.Identify.decode(e)}catch(e){return log$d.error("received invalid message",e)}const n=e.remotePeer;try{const e=await Envelope.openAndCertify(r.signedPeerRecord,PeerRecord.DOMAIN);if(this.peerStore.addressBook.consumePeerRecord(e))return void this.peerStore.protoBook.set(n,r.protocols)}catch(e){log$d("received invalid envelope, discard it and fallback to listenAddrs is available",e)}try{this.peerStore.addressBook.set(n,r.listenAddrs.map((e=>new Multiaddr$6(e))))}catch(e){log$d.error("received invalid addrs",e)}this.peerStore.protoBook.set(n,r.protocols)}static getCleanMultiaddr(e){if(e&&e.length>0)try{return new Multiaddr$6(e)}catch(e){return null}return null}}const multicodecs={IDENTIFY:MULTICODEC_IDENTIFY,IDENTIFY_PUSH:MULTICODEC_IDENTIFY_PUSH};IdentifyService$1.multicodecs=multicodecs,IdentifyService$1.Messsage=Message;var identify=IdentifyService$1,_nodeResolve_empty={},_nodeResolve_empty$1=Object.freeze({__proto__:null,default:_nodeResolve_empty}),require$$0$5=getAugmentedNamespace(_nodeResolve_empty$1),promisify$1={};function isElectron$2(){return"undefined"!=typeof window&&"object"==typeof window.process&&"renderer"===window.process.type||(!(void 0===process||"object"!=typeof process.versions||!process.versions.electron)||"object"==typeof navigator&&"string"==typeof navigator.userAgent&&navigator.userAgent.indexOf("Electron")>=0)}!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.promisify=t;function t(e){if("function"!=typeof e)throw new TypeError("Argument to promisify must be a function");var r=e["__ES6-PROMISIFY--CUSTOM-ARGUMENTS__"],n=t.Promise||Promise;if("function"!=typeof n)throw new Error("No Promise implementation found; do you need a polyfill?");return function(){for(var t=this,i=arguments.length,s=Array(i),o=0;o<i;o++)s[o]=arguments[o];return new n((function(n,i){s.push((function(e){if(e)return i(e);for(var t=arguments.length,s=Array(1<t?t-1:0),o=1;o<t;o++)s[o-1]=arguments[o];if(1===s.length||!r)return n(s[0]);var a={};s.forEach((function(e,t){var n=r[t];n&&(a[n]=e)})),n(a)})),e.apply(t,s)}))}}t.argumentNames="__ES6-PROMISIFY--CUSTOM-ARGUMENTS__",t.Promise=void 0}(promisify$1),module.exports=isElectron$2;var isElectron$3=Object.freeze({__proto__:null}),require$$0$4=getAugmentedNamespace(isElectron$3);const isElectron$1=require$$0$4,IS_ENV_WITH_DOM$1="object"==typeof window&&"object"==typeof document&&9===document.nodeType,IS_ELECTRON$1=isElectron$1(),IS_BROWSER$1=IS_ENV_WITH_DOM$1&&!IS_ELECTRON$1,IS_ELECTRON_MAIN$1=IS_ELECTRON$1&&!IS_ENV_WITH_DOM$1,IS_ELECTRON_RENDERER$1=IS_ELECTRON$1&&IS_ENV_WITH_DOM$1,IS_NODE$1="function"==typeof commonjsRequire&&void 0!==process&&void 0!==process.release&&"node"===process.release.name&&!IS_ELECTRON$1,IS_WEBWORKER$1="function"==typeof importScripts&&"undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope,IS_TEST$1=void 0!==process&&void 0!==process.env&&"test"===process.env.NODE_ENV;module.exports={isTest:IS_TEST$1,isElectron:IS_ELECTRON$1,isElectronMain:IS_ELECTRON_MAIN$1,isElectronRenderer:IS_ELECTRON_RENDERER$1,isNode:IS_NODE$1,isBrowser:IS_BROWSER$1,isWebWorker:IS_WEBWORKER$1,isEnvWithDom:IS_ENV_WITH_DOM$1};var src$d=Object.freeze({__proto__:null}),require$$4$1=getAugmentedNamespace(src$d),pRetry$1={exports:{}},retry$3={};function RetryOperation(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}var retry_operation=RetryOperation;RetryOperation.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},RetryOperation.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},RetryOperation.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=(new Date).getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(void 0===r){if(!this._cachedTimeouts)return!1;this._errors.splice(0,this._errors.length-1),r=this._cachedTimeouts.slice(-1)}var n=this;return this._timer=setTimeout((function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout((function(){n._operationTimeoutCb(n._attempts)}),n._operationTimeout),n._options.unref&&n._timeout.unref()),n._fn(n._attempts)}),r),this._options.unref&&this._timer.unref(),!0},RetryOperation.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout((function(){r._operationTimeoutCb()}),r._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},RetryOperation.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},RetryOperation.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},RetryOperation.prototype.start=RetryOperation.prototype.try,RetryOperation.prototype.errors=function(){return this._errors},RetryOperation.prototype.attempts=function(){return this._attempts},RetryOperation.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,r=0,n=0;n<this._errors.length;n++){var i=this._errors[n],s=i.message,o=(e[s]||0)+1;e[s]=o,o>=r&&(t=i,r=o)}return t},function(e){var t=retry_operation;e.operation=function(r){var n=e.timeouts(r);return new t(n,{forever:r&&(r.forever||r.retries===1/0),unref:r&&r.unref,maxRetryTime:r&&r.maxRetryTime})},e.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var r in e)t[r]=e[r];if(t.minTimeout>t.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var n=[],i=0;i<t.retries;i++)n.push(this.createTimeout(i,t));return e&&e.forever&&!n.length&&n.push(this.createTimeout(i,t)),n.sort((function(e,t){return e-t})),n},e.createTimeout=function(e,t){var r=t.randomize?Math.random()+1:1,n=Math.round(r*Math.max(t.minTimeout,1)*Math.pow(t.factor,e));return n=Math.min(n,t.maxTimeout)},e.wrap=function(t,r,n){if(r instanceof Array&&(n=r,r=null),!n)for(var i in n=[],t)"function"==typeof t[i]&&n.push(i);for(var s=0;s<n.length;s++){var o=n[s],a=t[o];t[o]=function(n){var i=e.operation(r),s=Array.prototype.slice.call(arguments,1),o=s.pop();s.push((function(e){i.retry(e)||(e&&(arguments[0]=i.mainError()),o.apply(this,arguments))})),i.attempt((function(){n.apply(t,s)}))}.bind(t,a),t[o].options=r}}}(retry$3);var retry$2=retry$3;const retry$1=retry$2,networkErrorMsgs=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class AbortError$2 extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,({message:e}=e)):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}const decorateErrorWithCounts=(e,t,r)=>{const n=r.retries-(t-1);return e.attemptNumber=t,e.retriesLeft=n,e},isNetworkError=e=>networkErrorMsgs.includes(e),pRetry=(e,t)=>new Promise(((r,n)=>{t={onFailedAttempt:()=>{},retries:10,...t};const i=retry$1.operation(t);i.attempt((async s=>{try{r(await e(s))}catch(e){if(!(e instanceof Error))return void n(new TypeError(`Non-error was thrown: "${e}". You should only throw errors.`));if(e instanceof AbortError$2)i.stop(),n(e.originalError);else if(e instanceof TypeError&&!isNetworkError(e.message))i.stop(),n(e);else{decorateErrorWithCounts(e,s,t);try{await t.onFailedAttempt(e)}catch(e){return void n(e)}i.retry(e)||n(i.mainError())}}}))}));function isLoopbackAddr$1(e){return/^127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(e)||/^::1$/.test(e)}pRetry$1.exports=pRetry,pRetry$1.exports.default=pRetry,pRetry$1.exports.AbortError=AbortError$2;var isLoopbackAddr_1=isLoopbackAddr$1;const isLoopbackAddr=isLoopbackAddr_1;function isLoopback$1(e){const{address:t}=e.nodeAddress();return isLoopbackAddr(t)}var isLoopback_1=isLoopback$1;const NatAPI=require$$0$5,debug$k=require$$0$b,{promisify:promisify}=promisify$1,{Multiaddr:Multiaddr$5}=src$o,log$c=Object.assign(debug$k("libp2p:nat"),{error:debug$k("libp2p:nat:err")}),{isBrowser:isBrowser}=require$$4$1,retry=pRetry$1.exports,isPrivateIp=privateIp,pkg=require$$7,errcode$D=errCode$m,{codes:{ERR_INVALID_PARAMETERS:ERR_INVALID_PARAMETERS}}=errors$4,isLoopback=isLoopback_1,DEFAULT_TTL=7200;function highPort(e=1024,t=65535){return Math.floor(Math.random()*(t-e+1)+e)}class NatManager$1{constructor({peerId:e,addressManager:t,transportManager:r,...n}){if(this._peerId=e,this._addressManager=t,this._transportManager=r,this._enabled=n.enabled,this._externalIp=n.externalIp,this._options={description:n.description||`${pkg.name}@${pkg.version} ${this._peerId}`,ttl:n.ttl||DEFAULT_TTL,autoUpdate:n.keepAlive||!0,gateway:n.gateway,enablePMP:Boolean(n.pmp&&n.pmp.enabled)},this._options.ttl<DEFAULT_TTL)throw errcode$D(new Error(`NatManager ttl should be at least ${DEFAULT_TTL} seconds`),ERR_INVALID_PARAMETERS)}start(){!isBrowser&&this._enabled&&this._start().catch((e=>{log$c.error(e)}))}async _start(){const e=this._transportManager.getAddrs();for(const t of e){const{family:e,host:r,port:n,transport:i}=t.toOptions();if(!t.isThinWaistAddress()||"tcp"!==i)continue;if(isLoopback(t))continue;if(4!==e)continue;const s=this._getClient(),o=this._externalIp||await s.externalIp();if(isPrivateIp(o))throw new Error(`${o} is private - please set config.nat.externalIp to an externally routable IP or ensure you are not behind a double NAT`);const a=highPort();log$c(`opening uPnP connection from ${o}:${a} to ${r}:${n}`),await s.map({publicPort:a,privatePort:n,protocol:i.toUpperCase()}),this._addressManager.addObservedAddr(Multiaddr$5.fromNodeAddress({family:4,address:o,port:a},i))}}_getClient(){if(this._client)return this._client;const e=new NatAPI(this._options),t=promisify(e.map.bind(e)),r=promisify(e.destroy.bind(e)),n=promisify(e.externalIp.bind(e));return this._client={map:(...e)=>retry((()=>t(...e)),{onFailedAttempt:log$c.error,unref:!0}),destroy:(...e)=>retry((()=>r(...e)),{onFailedAttempt:log$c.error,unref:!0}),externalIp:(...e)=>retry((()=>n(...e)),{onFailedAttempt:log$c.error,unref:!0})},this._client}async stop(){if(!isBrowser&&this._client)try{await this._client.destroy(),this._client=null}catch(e){log$c.error(e)}}}var natManager=NatManager$1;const debug$j=require$$0$b,log$b=Object.assign(debug$j("libp2p"),{error:debug$j("libp2p:err")}),{EventEmitter:EventEmitter$5}=require$$1$9,errCode$5=errCode$m,PeerId$3=src$q.exports,{Multiaddr:Multiaddr$4}=src$o,PeerRouting=peerRouting,ContentRouting=contentRouting,getPeer=getPeer_1,{validate:validateConfig}=config$2,{codes:codes$2,messages:messages}=errors$4,AddressManager=addressManager,ConnectionManager=connectionManager,AutoDialler=autoDialler,Circuit=transport$1,Relay=circuit,Dialer=dialer,Keychain=keychain,Metrics=metrics,TransportManager=transportManager,Upgrader=upgrader,PeerStore=peerStore,PubsubAdapter=pubsubAdapter_1,PersistentPeerStore=persistent,Registrar=registrar,ping=ping$1.exports,IdentifyService=identify,NatManager=natManager,{updateSelfPeerRecord:updateSelfPeerRecord}=utils$u;class Libp2p extends EventEmitter$5{static async create(e){if(e.peerId)return new Libp2p(e);const t=await PeerId$3.create();return e.peerId=t,new Libp2p(e)}constructor(e){if(super(),this._options=validateConfig(e),this.peerId=this._options.peerId,this.datastore=this._options.datastore,this.peerStore=this.datastore&&this._options.peerStore.persistence?new PersistentPeerStore({peerId:this.peerId,datastore:this.datastore,...this._options.peerStore}):new PeerStore({peerId:this.peerId}),this.addresses=this._options.addresses,this.addressManager=new AddressManager(this.peerId,this._options.addresses),this.addressManager.on("change:addresses",(()=>{updateSelfPeerRecord(this).catch((e=>{log$b.error("Error updating self peer record",e)}))})),this._modules=this._options.modules,this._config=this._options.config,this._transport=[],this._discovery=new Map,this.connectionManager=new ConnectionManager(this,{...this._options.connectionManager}),this._autodialler=new AutoDialler(this,{enabled:this._config.peerDiscovery.autoDial,minConnections:this._options.connectionManager.minConnections,autoDialInterval:this._options.connectionManager.autoDialInterval}),this._options.metrics.enabled&&(this.metrics=new Metrics({...this._options.metrics,connectionManager:this.connectionManager})),this._options.keychain&&this._options.keychain.datastore){log$b("creating keychain");const e=Keychain.generateOptions();this.keychain=new Keychain(this._options.keychain.datastore,{...e,...this._options.keychain}),log$b("keychain constructed")}if(this.upgrader=new Upgrader({localPeer:this.peerId,metrics:this.metrics,onConnection:e=>this.connectionManager.onConnect(e),onConnectionEnd:e=>this.connectionManager.onDisconnect(e)}),this.transportManager=new TransportManager({libp2p:this,upgrader:this.upgrader,faultTolerance:this._options.transportManager.faultTolerance}),this.natManager=new NatManager({peerId:this.peerId,addressManager:this.addressManager,transportManager:this.transportManager,...this._options.config.nat}),this.registrar=new Registrar({peerStore:this.peerStore,connectionManager:this.connectionManager}),this.handle=this.handle.bind(this),this.registrar.handle=this.handle,!this._modules.connEncryption||!this._modules.connEncryption.length)throw errCode$5(new Error(messages.CONN_ENCRYPTION_REQUIRED),codes$2.CONN_ENCRYPTION_REQUIRED);if(this._modules.connEncryption.forEach((e=>{this.upgrader.cryptos.set(e.protocol,e)})),this.dialer=new Dialer({transportManager:this.transportManager,peerStore:this.peerStore,...this._options.dialer}),this._modules.transport.forEach((e=>{const t=e.prototype[Symbol.toStringTag],r=this._config.transport[t];this.transportManager.add(t,e,r)})),this._config.relay.enabled&&(this.transportManager.add(Circuit.prototype[Symbol.toStringTag],Circuit),this.relay=new Relay(this)),this._modules.streamMuxer){this._modules.streamMuxer.forEach((e=>{this.upgrader.muxers.set(e.multicodec,e)})),this.identifyService=new IdentifyService({libp2p:this}),this.handle(Object.values(IdentifyService.getProtocolStr(this)),this.identifyService.handleMessage)}if(this._modules.connProtector)this.upgrader.protector=this._modules.connProtector;else if(void 0!==globalThis.process&&globalThis.process.env&&globalThis.process.env.LIBP2P_FORCE_PNET)throw new Error("Private network is enforced, but no protector was provided");if(this._modules.dht){const e=this._modules.dht;this._dht=e.create({libp2p:this,...this._config.dht})}if(this._modules.pubsub){const e=this._modules.pubsub;this.pubsub=PubsubAdapter(e,this,this._config.pubsub)}this.peerRouting=new PeerRouting(this),this.contentRouting=new ContentRouting(this),ping.mount(this),this._onDiscoveryPeer=this._onDiscoveryPeer.bind(this)}emit(e,...t){return"error"!==e||this._events.error?super.emit(e,...t):(log$b.error(t),!1)}async start(){log$b("libp2p is starting");try{await this._onStarting(),await this._onDidStart(),log$b("libp2p has started")}catch(e){throw this.emit("error",e),log$b.error("An error occurred starting libp2p",e),await this.stop(),e}}async stop(){log$b("libp2p is stopping");try{this._isStarted=!1,this.relay&&this.relay.stop(),this.peerRouting.stop(),this._autodialler.stop(),await(this._dht&&this._dht.stop());for(const e of this._discovery.values())e.removeListener("peer",this._onDiscoveryPeer);await Promise.all(Array.from(this._discovery.values(),(e=>e.stop()))),this._discovery=new Map,await this.peerStore.stop(),await this.connectionManager.stop(),await Promise.all([this.pubsub&&this.pubsub.stop(),this.metrics&&this.metrics.stop()]),await this.natManager.stop(),await this.transportManager.close(),ping.unmount(this),this.dialer.destroy()}catch(e){e&&(log$b.error(e),this.emit("error",e))}log$b("libp2p has stopped")}async loadKeychain(){if(this.keychain)try{await this.keychain.findKeyByName("self")}catch(e){await this.keychain.importPeer("self",this.peerId)}}isStarted(){return this._isStarted}get connections(){return this.connectionManager.connections}dial(e,t){return this._dial(e,t)}async dialProtocol(e,t,r){if(!t||!t.length)throw errCode$5(new Error("no protocols were provided to open a stream"),codes$2.ERR_INVALID_PROTOCOLS_FOR_STREAM);return(await this._dial(e,r)).newStream(t)}async _dial(e,t){const{id:r,multiaddrs:n}=getPeer(e);if(r.equals(this.peerId))throw errCode$5(new Error("Cannot dial self"),codes$2.ERR_DIALED_SELF);let i=this.connectionManager.get(r);return i?n&&this.peerStore.addressBook.add(r,n):i=await this.dialer.connectToPeer(e,t),i}get multiaddrs(){let e=this.addressManager.getAnnounceAddrs().map((e=>e.toString()));e.length||(e=this.transportManager.getAddrs().map((e=>e.toString()))),e=e.concat(this.addressManager.getObservedAddrs().map((e=>e.toString())));const t=this._options.addresses.announceFilter,r=new Set(e);return t(Array.from(r).map((e=>new Multiaddr$4(e))))}async hangUp(e){const{id:t}=getPeer(e),r=this.connectionManager.connections.get(t.toB58String());r&&await Promise.all(r.map((e=>e.close())))}ping(e){const{id:t,multiaddrs:r}=getPeer(e);return ping(this,r?r[0]:t)}handle(e,t){(e=Array.isArray(e)?e:[e]).forEach((e=>{this.upgrader.protocols.set(e,t)})),this.peerStore.protoBook.add(this.peerId,e)}unhandle(e){(e=Array.isArray(e)?e:[e]).forEach((e=>{this.upgrader.protocols.delete(e)})),this.peerStore.protoBook.remove(this.peerId,e)}async _onStarting(){const e=this.addressManager.getListenAddrs();await this.transportManager.listen(e),this.natManager.start(),await this.peerStore.start(),this._config.pubsub.enabled&&this.pubsub&&this.pubsub.start(),this._config.dht.enabled&&(this._dht&&await this._dht.start(),this._dht.on("peer",this._onDiscoveryPeer)),this.metrics&&this.metrics.start()}async _onDidStart(){this._isStarted=!0,this.peerStore.on("peer",(e=>{this.emit("peer:discovery",e),this._maybeConnect(e)}));for(const e of this.peerStore.peers.values())this.emit("peer:discovery",e.id);this.connectionManager.start(),this._autodialler.start(),await this._setupPeerDiscovery(),this.relay&&this.relay.start(),this.peerRouting.start()}_onDiscoveryPeer(e){e.id.toB58String()!==this.peerId.toB58String()?(e.multiaddrs&&this.peerStore.addressBook.add(e.id,e.multiaddrs),e.protocols&&this.peerStore.protoBook.set(e.id,e.protocols)):log$b.error(new Error(codes$2.ERR_DISCOVERED_SELF))}async _maybeConnect(e){if(!0===this._config.peerDiscovery.autoDial&&!this.connectionManager.get(e)){if((this._options.connectionManager.minConnections||0)>this.connectionManager.size){log$b("connecting to discovered peer %s",e.toB58String());try{await this.dialer.connectToPeer(e)}catch(t){log$b.error(`could not connect to discovered peer ${e.toB58String()} with ${t}`)}}}}async _setupPeerDiscovery(){const e=e=>{let t={enabled:!0};if(e.tag&&this._config.peerDiscovery&&this._config.peerDiscovery[e.tag]&&(t={...t,...this._config.peerDiscovery[e.tag]}),t.enabled&&!this._discovery.has(e.tag)){let r;r="function"==typeof e?new e(Object.assign({},t,{peerId:this.peerId,libp2p:this})):e,r.on("peer",this._onDiscoveryPeer),this._discovery.set(e.tag,r)}};for(const t of this._modules.peerDiscovery||[])e(t);for(const t of this.transportManager.getTransports())t.discovery&&e(t.discovery);await Promise.all(Array.from(this._discovery.values(),(e=>e.start())))}}var src$c=Libp2p,client={exports:{}},webSocket="undefined"==typeof WebSocket?require$$0$5:WebSocket,dom={},eventIterator={};Object.defineProperty(eventIterator,"__esModule",{value:!0});class EventQueue{constructor(){this.pullQueue=[],this.pushQueue=[],this.eventHandlers={},this.isPaused=!1,this.isStopped=!1}push(e){if(this.isStopped)return;const t={value:e,done:!1};if(this.pullQueue.length){const e=this.pullQueue.shift();e&&e.resolve(t)}else this.pushQueue.push(Promise.resolve(t)),void 0!==this.highWaterMark&&this.pushQueue.length>=this.highWaterMark&&!this.isPaused&&(this.isPaused=!0,this.eventHandlers.highWater?this.eventHandlers.highWater():console&&console.warn(`EventIterator queue reached ${this.pushQueue.length} items`))}stop(){if(!this.isStopped){this.isStopped=!0,this.remove();for(const e of this.pullQueue)e.resolve({value:void 0,done:!0});this.pullQueue.length=0}}fail(e){if(!this.isStopped)if(this.isStopped=!0,this.remove(),this.pullQueue.length){for(const t of this.pullQueue)t.reject(e);this.pullQueue.length=0}else{const t=Promise.reject(e);t.catch((()=>{})),this.pushQueue.push(t)}}remove(){Promise.resolve().then((()=>{this.removeCallback&&this.removeCallback()}))}[Symbol.asyncIterator](){return{next:e=>{const t=this.pushQueue.shift();return t?(void 0!==this.lowWaterMark&&this.pushQueue.length<=this.lowWaterMark&&this.isPaused&&(this.isPaused=!1,this.eventHandlers.lowWater&&this.eventHandlers.lowWater()),t):this.isStopped?Promise.resolve({value:void 0,done:!0}):new Promise(((e,t)=>{this.pullQueue.push({resolve:e,reject:t})}))},return:()=>(this.isStopped=!0,this.pushQueue.length=0,this.remove(),Promise.resolve({value:void 0,done:!0}))}}}class EventIterator$1{constructor(e,{highWaterMark:t=100,lowWaterMark:r=1}={}){const n=new EventQueue;n.highWaterMark=t,n.lowWaterMark=r,n.removeCallback=e({push:e=>n.push(e),stop:()=>n.stop(),fail:e=>n.fail(e),on:(e,t)=>{n.eventHandlers[e]=t}})||(()=>{}),this[Symbol.asyncIterator]=()=>n[Symbol.asyncIterator](),Object.freeze(this)}}eventIterator.EventIterator=EventIterator$1,eventIterator.default=EventIterator$1,Object.defineProperty(dom,"__esModule",{value:!0});const event_iterator_1=eventIterator;function subscribe(e,t,r){return new event_iterator_1.EventIterator((({push:r})=>(this.addEventListener(e,r,t),()=>this.removeEventListener(e,r,t))),r)}dom.EventIterator=event_iterator_1.EventIterator,dom.subscribe=subscribe,dom.default=event_iterator_1.EventIterator;const{Buffer:Buffer$5}=require$$0$7,{EventIterator:EventIterator}=dom;function isArrayBuffer(e){return e instanceof ArrayBuffer||null!=e&&null!=e.constructor&&"ArrayBuffer"===e.constructor.name&&"number"==typeof e.byteLength}var source$2=e=>{const t=e.removeEventListener||e.removeListener,r=async function*(){const r=new EventIterator((({push:r,stop:n,fail:i})=>(e.addEventListener("message",r),e.addEventListener("error",i),e.addEventListener("close",n),()=>{t.call(e,"message",r),t.call(e,"error",i),t.call(e,"close",n)})),{highWaterMark:1/0});for await(const{data:e}of r)yield isArrayBuffer(e)?Buffer$5.from(e):e}();let n,i=1===e.readyState;return e.addEventListener("open",(()=>{i=!0,n=null})),e.addEventListener("close",(()=>{i=!1,n=null})),e.addEventListener("error",(e=>{i||(n=e)})),r.connected=()=>new Promise(((r,s)=>{if(i)return r();if(n)return s(n);const o=r=>{t.call(e,"open",a),t.call(e,"error",u),r()},a=()=>o(r),u=e=>o((()=>s(e)));e.addEventListener("open",a),e.addEventListener("error",u)})),r},ready$1=async e=>{if(e.readyState>=2)throw new Error("socket closed");if(1!==e.readyState)return new Promise(((t,r)=>{const n=e&&(e.removeEventListener||e.removeListener);function i(){"function"==typeof n&&(n.call(e,"open",s),n.call(e,"error",o))}function s(){i(),t()}function o(e){i(),r(e)}e.addEventListener("open",s),e.addEventListener("error",o)}))};const ready=ready$1;var sink$2=(e,t)=>((t=t||{}).closeOnEnd=!1!==t.closeOnEnd,async r=>{for await(const t of r){try{await ready(e)}catch(e){if("socket closed"===e.message)break;throw e}e.send(t)}if(t.closeOnEnd&&e.readyState<=1)return new Promise(((t,r)=>{e.addEventListener("close",(e=>{if(e.wasClean||1006===e.code)t();else{const t=Object.assign(new Error("ws error"),{event:e});r(t)}})),setTimeout((()=>e.close()))}))});const source$1=source$2,sink$1=sink$2;var duplex$2=(e,t)=>{(t=t||{}).binaryType?e.binaryType=t.binaryType:t.binary&&(e.binaryType="arraybuffer");const r={sink:sink$1(e,t),source:source$1(e),connected:()=>r.source.connected()};return r};const isReactNative$1="undefined"!=typeof navigator&&"ReactNative"===navigator.product;function getDefaultBase(){return isReactNative$1?"http://localhost":self.location?self.location.protocol+"//"+self.location.host:""}const URL$1=self.URL,defaultBase$1=getDefaultBase();class URLWithLegacySupport$2{constructor(e="",t=defaultBase$1){this.super=new URL$1(e,t),this.path=this.pathname+this.search,this.auth=this.username&&this.password?this.username+":"+this.password:null,this.query=this.search&&this.search.startsWith("?")?this.search.slice(1):null}get hash(){return this.super.hash}get host(){return this.super.host}get hostname(){return this.super.hostname}get href(){return this.super.href}get origin(){return this.super.origin}get password(){return this.super.password}get pathname(){return this.super.pathname}get port(){return this.super.port}get protocol(){return this.super.protocol}get search(){return this.super.search}get searchParams(){return this.super.searchParams}get username(){return this.super.username}set hash(e){this.super.hash=e}set host(e){this.super.host=e}set hostname(e){this.super.hostname=e}set href(e){this.super.href=e}set password(e){this.super.password=e}set pathname(e){this.super.pathname=e}set port(e){this.super.port=e}set protocol(e){this.super.protocol=e}set search(e){this.super.search=e}set username(e){this.super.username=e}static createObjectURL(e){return URL$1.createObjectURL(e)}static revokeObjectURL(e){URL$1.revokeObjectURL(e)}toJSON(){return this.super.toJSON()}toString(){return this.super.toString()}format(){return this.toString()}}function format$3(e){if("string"==typeof e){return new URL$1(e).toString()}if(!(e instanceof URL$1)){const t=e.username&&e.password?`${e.username}:${e.password}@`:"",r=e.auth?e.auth+"@":"",n=e.port?":"+e.port:"",i=e.protocol?e.protocol+"//":"",s=e.host||"",o=e.hostname||"",a=e.search||(e.query?"?"+e.query:""),u=e.hash||"",c=e.pathname||"";return`${i}${t||r}${s||o+n}${e.path||c+a}${u}`}}var urlBrowser={URLWithLegacySupport:URLWithLegacySupport$2,URLSearchParams:self.URLSearchParams,defaultBase:defaultBase$1,format:format$3};const{URLWithLegacySupport:URLWithLegacySupport$1,format:format$2}=urlBrowser;var relative$2=(e,t={},r={},n)=>{let i,s=t.protocol?t.protocol.replace(":",""):"http";s=(r[s]||n||s)+":";try{i=new URLWithLegacySupport$1(e)}catch(e){i={}}const o=Object.assign({},t,{protocol:s||i.protocol,host:t.host||i.host});return new URLWithLegacySupport$1(e,format$2(o)).toString()};const{URLWithLegacySupport:URLWithLegacySupport,format:format$1,URLSearchParams:URLSearchParams,defaultBase:defaultBase}=urlBrowser,relative$1=relative$2;var isoUrl={URL:URLWithLegacySupport,URLSearchParams:URLSearchParams,format:format$1,relative:relative$1,defaultBase:defaultBase};const{relative:relative}=isoUrl,map$1={http:"ws",https:"wss"},def="ws";var wsUrl=(e,t)=>relative(e,t,map$1,def);!function(e){var t=webSocket,r=duplex$2,n=wsUrl;e.exports=function(e,i={}){const s="undefined"==typeof window?{}:window.location,o=n(e,s),a=new t(o,i.websocket),u=r(a,i);return u.remoteAddress=o,u.close=()=>new Promise(((e,t)=>{a.addEventListener("close",e),a.close()})),u.destroy=()=>{a.terminate?a.terminate():a.close()},u.socket=a,u},e.exports.connect=e.exports}(client);const{Multiaddr:Multiaddr$3}=src$o,reduceValue=(e,t)=>t,tcpUri=(e,t,r,n)=>{if(n&&!1===n.assumeHttp)return`tcp://${e}:${t}`;let i="tcp",s=`:${t}`;return"tcp"===r[r.length-1].protocol&&(i="443"===t?"https":"http",s="443"===t||"80"===t?"":s),`${i}://${e}${s}`},Reducers={ip4:reduceValue,ip6:(e,t,r,n)=>1===n.length&&"ip6"===n[0].protocol?t:`[${t}]`,tcp:(e,t,r,n,i)=>n.some((e=>["http","https","ws","wss"].includes(e.protocol)))?`${e}:${t}`:tcpUri(e,t,n,i),udp:(e,t)=>`udp://${e}:${t}`,dnsaddr:reduceValue,dns4:reduceValue,dns6:reduceValue,ipfs:(e,t)=>`${e}/ipfs/${t}`,p2p:(e,t)=>`${e}/p2p/${t}`,http:e=>`http://${e}`,https:e=>`https://${e}`,ws:e=>`ws://${e}`,wss:e=>`wss://${e}`,"p2p-websocket-star":e=>`${e}/p2p-websocket-star`,"p2p-webrtc-star":e=>`${e}/p2p-webrtc-star`,"p2p-webrtc-direct":e=>`${e}/p2p-webrtc-direct`};var multiaddrToUri=(e,t)=>{const r=new Multiaddr$3(e),n=e.toString().split("/").slice(1);return r.tuples().map((e=>({protocol:n.shift(),content:e[1]?n.shift():null}))).reduce(((e,r,n,i)=>{const s=Reducers[r.protocol];if(!s)throw new Error(`Unsupported protocol ${r.protocol}`);return s(e,r.content,n,i,t)}),"")};const isElectron=require$$0$4,IS_ENV_WITH_DOM="object"==typeof window&&"object"==typeof document&&9===document.nodeType,IS_ELECTRON=isElectron(),IS_BROWSER=IS_ENV_WITH_DOM&&!IS_ELECTRON,IS_ELECTRON_MAIN=IS_ELECTRON&&!IS_ENV_WITH_DOM,IS_ELECTRON_RENDERER=IS_ELECTRON&&IS_ENV_WITH_DOM,IS_NODE="function"==typeof commonjsRequire&&void 0!==process&&void 0!==process.release&&"node"===process.release.name&&!IS_ELECTRON,IS_WEBWORKER="function"==typeof importScripts&&"undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope,IS_TEST=void 0!==process&&void 0!==process.env&&"test"===process.env.NODE_ENV,IS_REACT_NATIVE="undefined"!=typeof navigator&&"ReactNative"===navigator.product;module.exports={isTest:IS_TEST,isElectron:IS_ELECTRON,isElectronMain:IS_ELECTRON_MAIN,isElectronRenderer:IS_ELECTRON_RENDERER,isNode:IS_NODE,isBrowser:IS_BROWSER,isWebWorker:IS_WEBWORKER,isEnvWithDom:IS_ENV_WITH_DOM,isReactNative:IS_REACT_NATIVE};var env$1=Object.freeze({__proto__:null}),require$$6=getAugmentedNamespace(env$1),listener_browser=function(){throw new Error("WebSocket Servers can not be created in the browser!")},constants$5={CODE_P2P:421,CODE_CIRCUIT:290,CODE_TCP:6,CODE_WS:477,CODE_WSS:478,CLOSE_TIMEOUT:2e3},ipPortToMultiaddr$1={exports:{}},ipAddress={},ipv4={},common$8={};function isInSubnet(e){return!(this.subnetMask<e.subnetMask)&&this.mask(e.subnetMask)===e.mask()}function isCorrect(e){return function(){return this.addressMinusSuffix===this.correctForm()&&(this.subnetMask===e&&!this.parsedSubnet||this.parsedSubnet===String(this.subnetMask))}}Object.defineProperty(common$8,"__esModule",{value:!0}),common$8.isCorrect=common$8.isInSubnet=void 0,common$8.isInSubnet=isInSubnet,common$8.isCorrect=isCorrect;var constants$4={};Object.defineProperty(constants$4,"__esModule",{value:!0}),constants$4.RE_SUBNET_STRING=constants$4.RE_ADDRESS=constants$4.GROUPS=constants$4.BITS=void 0,constants$4.BITS=32,constants$4.GROUPS=4,constants$4.RE_ADDRESS=/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/g,constants$4.RE_SUBNET_STRING=/\/\d{1,2}$/;var addressError={},__extends=commonjsGlobal&&commonjsGlobal.__extends||(extendStatics=function(e,t){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},extendStatics(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}extendStatics(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),extendStatics;Object.defineProperty(addressError,"__esModule",{value:!0}),addressError.AddressError=void 0;var AddressError=function(e){function t(t,r){var n=e.call(this,t)||this;return n.name="AddressError",null!==r&&(n.parseMessage=r),n}return __extends(t,e),t}(Error);addressError.AddressError=AddressError;var jsbn={exports:{}};!function(e,t){(function(){var t;function r(e,t,r){null!=e&&("number"==typeof e?this.fromNumber(e,t,r):null==t&&"string"!=typeof e?this.fromString(e,256):this.fromString(e,t))}function n(){return new r(null)}var i="undefined"!=typeof navigator;i&&"Microsoft Internet Explorer"==navigator.appName?(r.prototype.am=function(e,t,r,n,i,s){for(var o=32767&t,a=t>>15;--s>=0;){var u=32767&this[e],c=this[e++]>>15,l=a*u+c*o;i=((u=o*u+((32767&l)<<15)+r[n]+(1073741823&i))>>>30)+(l>>>15)+a*c+(i>>>30),r[n++]=1073741823&u}return i},t=30):i&&"Netscape"!=navigator.appName?(r.prototype.am=function(e,t,r,n,i,s){for(;--s>=0;){var o=t*this[e++]+r[n]+i;i=Math.floor(o/67108864),r[n++]=67108863&o}return i},t=26):(r.prototype.am=function(e,t,r,n,i,s){for(var o=16383&t,a=t>>14;--s>=0;){var u=16383&this[e],c=this[e++]>>14,l=a*u+c*o;i=((u=o*u+((16383&l)<<14)+r[n]+i)>>28)+(l>>14)+a*c,r[n++]=268435455&u}return i},t=28),r.prototype.DB=t,r.prototype.DM=(1<<t)-1,r.prototype.DV=1<<t;r.prototype.FV=Math.pow(2,52),r.prototype.F1=52-t,r.prototype.F2=2*t-52;var s,o,a=new Array;for(s="0".charCodeAt(0),o=0;o<=9;++o)a[s++]=o;for(s="a".charCodeAt(0),o=10;o<36;++o)a[s++]=o;for(s="A".charCodeAt(0),o=10;o<36;++o)a[s++]=o;function u(e){return"0123456789abcdefghijklmnopqrstuvwxyz".charAt(e)}function c(e,t){var r=a[e.charCodeAt(t)];return null==r?-1:r}function l(e){var t=n();return t.fromInt(e),t}function h(e){var t,r=1;return 0!=(t=e>>>16)&&(e=t,r+=16),0!=(t=e>>8)&&(e=t,r+=8),0!=(t=e>>4)&&(e=t,r+=4),0!=(t=e>>2)&&(e=t,r+=2),0!=(t=e>>1)&&(e=t,r+=1),r}function d(e){this.m=e}function f(e){this.m=e,this.mp=e.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function p(e,t){return e&t}function y(e,t){return e|t}function g(e,t){return e^t}function $(e,t){return e&~t}function m(e){if(0==e)return-1;var t=0;return 0==(65535&e)&&(e>>=16,t+=16),0==(255&e)&&(e>>=8,t+=8),0==(15&e)&&(e>>=4,t+=4),0==(3&e)&&(e>>=2,t+=2),0==(1&e)&&++t,t}function b(e){for(var t=0;0!=e;)e&=e-1,++t;return t}function v(){}function _(e){return e}function w(e){this.r2=n(),this.q3=n(),r.ONE.dlShiftTo(2*e.t,this.r2),this.mu=this.r2.divide(e),this.m=e}d.prototype.convert=function(e){return e.s<0||e.compareTo(this.m)>=0?e.mod(this.m):e},d.prototype.revert=function(e){return e},d.prototype.reduce=function(e){e.divRemTo(this.m,null,e)},d.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r),this.reduce(r)},d.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},f.prototype.convert=function(e){var t=n();return e.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),e.s<0&&t.compareTo(r.ZERO)>0&&this.m.subTo(t,t),t},f.prototype.revert=function(e){var t=n();return e.copyTo(t),this.reduce(t),t},f.prototype.reduce=function(e){for(;e.t<=this.mt2;)e[e.t++]=0;for(var t=0;t<this.m.t;++t){var r=32767&e[t],n=r*this.mpl+((r*this.mph+(e[t]>>15)*this.mpl&this.um)<<15)&e.DM;for(e[r=t+this.m.t]+=this.m.am(0,n,e,t,0,this.m.t);e[r]>=e.DV;)e[r]-=e.DV,e[++r]++}e.clamp(),e.drShiftTo(this.m.t,e),e.compareTo(this.m)>=0&&e.subTo(this.m,e)},f.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r),this.reduce(r)},f.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},r.prototype.copyTo=function(e){for(var t=this.t-1;t>=0;--t)e[t]=this[t];e.t=this.t,e.s=this.s},r.prototype.fromInt=function(e){this.t=1,this.s=e<0?-1:0,e>0?this[0]=e:e<-1?this[0]=e+this.DV:this.t=0},r.prototype.fromString=function(e,t){var n;if(16==t)n=4;else if(8==t)n=3;else if(256==t)n=8;else if(2==t)n=1;else if(32==t)n=5;else{if(4!=t)return void this.fromRadix(e,t);n=2}this.t=0,this.s=0;for(var i=e.length,s=!1,o=0;--i>=0;){var a=8==n?255&e[i]:c(e,i);a<0?"-"==e.charAt(i)&&(s=!0):(s=!1,0==o?this[this.t++]=a:o+n>this.DB?(this[this.t-1]|=(a&(1<<this.DB-o)-1)<<o,this[this.t++]=a>>this.DB-o):this[this.t-1]|=a<<o,(o+=n)>=this.DB&&(o-=this.DB))}8==n&&0!=(128&e[0])&&(this.s=-1,o>0&&(this[this.t-1]|=(1<<this.DB-o)-1<<o)),this.clamp(),s&&r.ZERO.subTo(this,this)},r.prototype.clamp=function(){for(var e=this.s&this.DM;this.t>0&&this[this.t-1]==e;)--this.t},r.prototype.dlShiftTo=function(e,t){var r;for(r=this.t-1;r>=0;--r)t[r+e]=this[r];for(r=e-1;r>=0;--r)t[r]=0;t.t=this.t+e,t.s=this.s},r.prototype.drShiftTo=function(e,t){for(var r=e;r<this.t;++r)t[r-e]=this[r];t.t=Math.max(this.t-e,0),t.s=this.s},r.prototype.lShiftTo=function(e,t){var r,n=e%this.DB,i=this.DB-n,s=(1<<i)-1,o=Math.floor(e/this.DB),a=this.s<<n&this.DM;for(r=this.t-1;r>=0;--r)t[r+o+1]=this[r]>>i|a,a=(this[r]&s)<<n;for(r=o-1;r>=0;--r)t[r]=0;t[o]=a,t.t=this.t+o+1,t.s=this.s,t.clamp()},r.prototype.rShiftTo=function(e,t){t.s=this.s;var r=Math.floor(e/this.DB);if(r>=this.t)t.t=0;else{var n=e%this.DB,i=this.DB-n,s=(1<<n)-1;t[0]=this[r]>>n;for(var o=r+1;o<this.t;++o)t[o-r-1]|=(this[o]&s)<<i,t[o-r]=this[o]>>n;n>0&&(t[this.t-r-1]|=(this.s&s)<<i),t.t=this.t-r,t.clamp()}},r.prototype.subTo=function(e,t){for(var r=0,n=0,i=Math.min(e.t,this.t);r<i;)n+=this[r]-e[r],t[r++]=n&this.DM,n>>=this.DB;if(e.t<this.t){for(n-=e.s;r<this.t;)n+=this[r],t[r++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;r<e.t;)n-=e[r],t[r++]=n&this.DM,n>>=this.DB;n-=e.s}t.s=n<0?-1:0,n<-1?t[r++]=this.DV+n:n>0&&(t[r++]=n),t.t=r,t.clamp()},r.prototype.multiplyTo=function(e,t){var n=this.abs(),i=e.abs(),s=n.t;for(t.t=s+i.t;--s>=0;)t[s]=0;for(s=0;s<i.t;++s)t[s+n.t]=n.am(0,i[s],t,s,0,n.t);t.s=0,t.clamp(),this.s!=e.s&&r.ZERO.subTo(t,t)},r.prototype.squareTo=function(e){for(var t=this.abs(),r=e.t=2*t.t;--r>=0;)e[r]=0;for(r=0;r<t.t-1;++r){var n=t.am(r,t[r],e,2*r,0,1);(e[r+t.t]+=t.am(r+1,2*t[r],e,2*r+1,n,t.t-r-1))>=t.DV&&(e[r+t.t]-=t.DV,e[r+t.t+1]=1)}e.t>0&&(e[e.t-1]+=t.am(r,t[r],e,2*r,0,1)),e.s=0,e.clamp()},r.prototype.divRemTo=function(e,t,i){var s=e.abs();if(!(s.t<=0)){var o=this.abs();if(o.t<s.t)return null!=t&&t.fromInt(0),void(null!=i&&this.copyTo(i));null==i&&(i=n());var a=n(),u=this.s,c=e.s,l=this.DB-h(s[s.t-1]);l>0?(s.lShiftTo(l,a),o.lShiftTo(l,i)):(s.copyTo(a),o.copyTo(i));var d=a.t,f=a[d-1];if(0!=f){var p=f*(1<<this.F1)+(d>1?a[d-2]>>this.F2:0),y=this.FV/p,g=(1<<this.F1)/p,$=1<<this.F2,m=i.t,b=m-d,v=null==t?n():t;for(a.dlShiftTo(b,v),i.compareTo(v)>=0&&(i[i.t++]=1,i.subTo(v,i)),r.ONE.dlShiftTo(d,v),v.subTo(a,a);a.t<d;)a[a.t++]=0;for(;--b>=0;){var _=i[--m]==f?this.DM:Math.floor(i[m]*y+(i[m-1]+$)*g);if((i[m]+=a.am(0,_,i,b,0,d))<_)for(a.dlShiftTo(b,v),i.subTo(v,i);i[m]<--_;)i.subTo(v,i)}null!=t&&(i.drShiftTo(d,t),u!=c&&r.ZERO.subTo(t,t)),i.t=d,i.clamp(),l>0&&i.rShiftTo(l,i),u<0&&r.ZERO.subTo(i,i)}}},r.prototype.invDigit=function(){if(this.t<1)return 0;var e=this[0];if(0==(1&e))return 0;var t=3&e;return(t=(t=(t=(t=t*(2-(15&e)*t)&15)*(2-(255&e)*t)&255)*(2-((65535&e)*t&65535))&65535)*(2-e*t%this.DV)%this.DV)>0?this.DV-t:-t},r.prototype.isEven=function(){return 0==(this.t>0?1&this[0]:this.s)},r.prototype.exp=function(e,t){if(e>4294967295||e<1)return r.ONE;var i=n(),s=n(),o=t.convert(this),a=h(e)-1;for(o.copyTo(i);--a>=0;)if(t.sqrTo(i,s),(e&1<<a)>0)t.mulTo(s,o,i);else{var u=i;i=s,s=u}return t.revert(i)},r.prototype.toString=function(e){if(this.s<0)return"-"+this.negate().toString(e);var t;if(16==e)t=4;else if(8==e)t=3;else if(2==e)t=1;else if(32==e)t=5;else{if(4!=e)return this.toRadix(e);t=2}var r,n=(1<<t)-1,i=!1,s="",o=this.t,a=this.DB-o*this.DB%t;if(o-- >0)for(a<this.DB&&(r=this[o]>>a)>0&&(i=!0,s=u(r));o>=0;)a<t?(r=(this[o]&(1<<a)-1)<<t-a,r|=this[--o]>>(a+=this.DB-t)):(r=this[o]>>(a-=t)&n,a<=0&&(a+=this.DB,--o)),r>0&&(i=!0),i&&(s+=u(r));return i?s:"0"},r.prototype.negate=function(){var e=n();return r.ZERO.subTo(this,e),e},r.prototype.abs=function(){return this.s<0?this.negate():this},r.prototype.compareTo=function(e){var t=this.s-e.s;if(0!=t)return t;var r=this.t;if(0!=(t=r-e.t))return this.s<0?-t:t;for(;--r>=0;)if(0!=(t=this[r]-e[r]))return t;return 0},r.prototype.bitLength=function(){return this.t<=0?0:this.DB*(this.t-1)+h(this[this.t-1]^this.s&this.DM)},r.prototype.mod=function(e){var t=n();return this.abs().divRemTo(e,null,t),this.s<0&&t.compareTo(r.ZERO)>0&&e.subTo(t,t),t},r.prototype.modPowInt=function(e,t){var r;return r=e<256||t.isEven()?new d(t):new f(t),this.exp(e,r)},r.ZERO=l(0),r.ONE=l(1),v.prototype.convert=_,v.prototype.revert=_,v.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r)},v.prototype.sqrTo=function(e,t){e.squareTo(t)},w.prototype.convert=function(e){if(e.s<0||e.t>2*this.m.t)return e.mod(this.m);if(e.compareTo(this.m)<0)return e;var t=n();return e.copyTo(t),this.reduce(t),t},w.prototype.revert=function(e){return e},w.prototype.reduce=function(e){for(e.drShiftTo(this.m.t-1,this.r2),e.t>this.m.t+1&&(e.t=this.m.t+1,e.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);e.compareTo(this.r2)<0;)e.dAddOffset(1,this.m.t+1);for(e.subTo(this.r2,e);e.compareTo(this.m)>=0;)e.subTo(this.m,e)},w.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r),this.reduce(r)},w.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)};var E,S,A,T=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],I=(1<<26)/T[T.length-1];function P(){var e;e=(new Date).getTime(),S[A++]^=255&e,S[A++]^=e>>8&255,S[A++]^=e>>16&255,S[A++]^=e>>24&255,A>=N&&(A-=N)}if(r.prototype.chunkSize=function(e){return Math.floor(Math.LN2*this.DB/Math.log(e))},r.prototype.toRadix=function(e){if(null==e&&(e=10),0==this.signum()||e<2||e>36)return"0";var t=this.chunkSize(e),r=Math.pow(e,t),i=l(r),s=n(),o=n(),a="";for(this.divRemTo(i,s,o);s.signum()>0;)a=(r+o.intValue()).toString(e).substr(1)+a,s.divRemTo(i,s,o);return o.intValue().toString(e)+a},r.prototype.fromRadix=function(e,t){this.fromInt(0),null==t&&(t=10);for(var n=this.chunkSize(t),i=Math.pow(t,n),s=!1,o=0,a=0,u=0;u<e.length;++u){var l=c(e,u);l<0?"-"==e.charAt(u)&&0==this.signum()&&(s=!0):(a=t*a+l,++o>=n&&(this.dMultiply(i),this.dAddOffset(a,0),o=0,a=0))}o>0&&(this.dMultiply(Math.pow(t,o)),this.dAddOffset(a,0)),s&&r.ZERO.subTo(this,this)},r.prototype.fromNumber=function(e,t,n){if("number"==typeof t)if(e<2)this.fromInt(1);else for(this.fromNumber(e,n),this.testBit(e-1)||this.bitwiseTo(r.ONE.shiftLeft(e-1),y,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(t);)this.dAddOffset(2,0),this.bitLength()>e&&this.subTo(r.ONE.shiftLeft(e-1),this);else{var i=new Array,s=7&e;i.length=1+(e>>3),t.nextBytes(i),s>0?i[0]&=(1<<s)-1:i[0]=0,this.fromString(i,256)}},r.prototype.bitwiseTo=function(e,t,r){var n,i,s=Math.min(e.t,this.t);for(n=0;n<s;++n)r[n]=t(this[n],e[n]);if(e.t<this.t){for(i=e.s&this.DM,n=s;n<this.t;++n)r[n]=t(this[n],i);r.t=this.t}else{for(i=this.s&this.DM,n=s;n<e.t;++n)r[n]=t(i,e[n]);r.t=e.t}r.s=t(this.s,e.s),r.clamp()},r.prototype.changeBit=function(e,t){var n=r.ONE.shiftLeft(e);return this.bitwiseTo(n,t,n),n},r.prototype.addTo=function(e,t){for(var r=0,n=0,i=Math.min(e.t,this.t);r<i;)n+=this[r]+e[r],t[r++]=n&this.DM,n>>=this.DB;if(e.t<this.t){for(n+=e.s;r<this.t;)n+=this[r],t[r++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;r<e.t;)n+=e[r],t[r++]=n&this.DM,n>>=this.DB;n+=e.s}t.s=n<0?-1:0,n>0?t[r++]=n:n<-1&&(t[r++]=this.DV+n),t.t=r,t.clamp()},r.prototype.dMultiply=function(e){this[this.t]=this.am(0,e-1,this,0,0,this.t),++this.t,this.clamp()},r.prototype.dAddOffset=function(e,t){if(0!=e){for(;this.t<=t;)this[this.t++]=0;for(this[t]+=e;this[t]>=this.DV;)this[t]-=this.DV,++t>=this.t&&(this[this.t++]=0),++this[t]}},r.prototype.multiplyLowerTo=function(e,t,r){var n,i=Math.min(this.t+e.t,t);for(r.s=0,r.t=i;i>0;)r[--i]=0;for(n=r.t-this.t;i<n;++i)r[i+this.t]=this.am(0,e[i],r,i,0,this.t);for(n=Math.min(e.t,t);i<n;++i)this.am(0,e[i],r,i,0,t-i);r.clamp()},r.prototype.multiplyUpperTo=function(e,t,r){--t;var n=r.t=this.t+e.t-t;for(r.s=0;--n>=0;)r[n]=0;for(n=Math.max(t-this.t,0);n<e.t;++n)r[this.t+n-t]=this.am(t-n,e[n],r,0,0,this.t+n-t);r.clamp(),r.drShiftTo(1,r)},r.prototype.modInt=function(e){if(e<=0)return 0;var t=this.DV%e,r=this.s<0?e-1:0;if(this.t>0)if(0==t)r=this[0]%e;else for(var n=this.t-1;n>=0;--n)r=(t*r+this[n])%e;return r},r.prototype.millerRabin=function(e){var t=this.subtract(r.ONE),i=t.getLowestSetBit();if(i<=0)return!1;var s=t.shiftRight(i);(e=e+1>>1)>T.length&&(e=T.length);for(var o=n(),a=0;a<e;++a){o.fromInt(T[Math.floor(Math.random()*T.length)]);var u=o.modPow(s,this);if(0!=u.compareTo(r.ONE)&&0!=u.compareTo(t)){for(var c=1;c++<i&&0!=u.compareTo(t);)if(0==(u=u.modPowInt(2,this)).compareTo(r.ONE))return!1;if(0!=u.compareTo(t))return!1}}return!0},r.prototype.clone=function(){var e=n();return this.copyTo(e),e},r.prototype.intValue=function(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]},r.prototype.byteValue=function(){return 0==this.t?this.s:this[0]<<24>>24},r.prototype.shortValue=function(){return 0==this.t?this.s:this[0]<<16>>16},r.prototype.signum=function(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1},r.prototype.toByteArray=function(){var e=this.t,t=new Array;t[0]=this.s;var r,n=this.DB-e*this.DB%8,i=0;if(e-- >0)for(n<this.DB&&(r=this[e]>>n)!=(this.s&this.DM)>>n&&(t[i++]=r|this.s<<this.DB-n);e>=0;)n<8?(r=(this[e]&(1<<n)-1)<<8-n,r|=this[--e]>>(n+=this.DB-8)):(r=this[e]>>(n-=8)&255,n<=0&&(n+=this.DB,--e)),0!=(128&r)&&(r|=-256),0==i&&(128&this.s)!=(128&r)&&++i,(i>0||r!=this.s)&&(t[i++]=r);return t},r.prototype.equals=function(e){return 0==this.compareTo(e)},r.prototype.min=function(e){return this.compareTo(e)<0?this:e},r.prototype.max=function(e){return this.compareTo(e)>0?this:e},r.prototype.and=function(e){var t=n();return this.bitwiseTo(e,p,t),t},r.prototype.or=function(e){var t=n();return this.bitwiseTo(e,y,t),t},r.prototype.xor=function(e){var t=n();return this.bitwiseTo(e,g,t),t},r.prototype.andNot=function(e){var t=n();return this.bitwiseTo(e,$,t),t},r.prototype.not=function(){for(var e=n(),t=0;t<this.t;++t)e[t]=this.DM&~this[t];return e.t=this.t,e.s=~this.s,e},r.prototype.shiftLeft=function(e){var t=n();return e<0?this.rShiftTo(-e,t):this.lShiftTo(e,t),t},r.prototype.shiftRight=function(e){var t=n();return e<0?this.lShiftTo(-e,t):this.rShiftTo(e,t),t},r.prototype.getLowestSetBit=function(){for(var e=0;e<this.t;++e)if(0!=this[e])return e*this.DB+m(this[e]);return this.s<0?this.t*this.DB:-1},r.prototype.bitCount=function(){for(var e=0,t=this.s&this.DM,r=0;r<this.t;++r)e+=b(this[r]^t);return e},r.prototype.testBit=function(e){var t=Math.floor(e/this.DB);return t>=this.t?0!=this.s:0!=(this[t]&1<<e%this.DB)},r.prototype.setBit=function(e){return this.changeBit(e,y)},r.prototype.clearBit=function(e){return this.changeBit(e,$)},r.prototype.flipBit=function(e){return this.changeBit(e,g)},r.prototype.add=function(e){var t=n();return this.addTo(e,t),t},r.prototype.subtract=function(e){var t=n();return this.subTo(e,t),t},r.prototype.multiply=function(e){var t=n();return this.multiplyTo(e,t),t},r.prototype.divide=function(e){var t=n();return this.divRemTo(e,t,null),t},r.prototype.remainder=function(e){var t=n();return this.divRemTo(e,null,t),t},r.prototype.divideAndRemainder=function(e){var t=n(),r=n();return this.divRemTo(e,t,r),new Array(t,r)},r.prototype.modPow=function(e,t){var r,i,s=e.bitLength(),o=l(1);if(s<=0)return o;r=s<18?1:s<48?3:s<144?4:s<768?5:6,i=s<8?new d(t):t.isEven()?new w(t):new f(t);var a=new Array,u=3,c=r-1,p=(1<<r)-1;if(a[1]=i.convert(this),r>1){var y=n();for(i.sqrTo(a[1],y);u<=p;)a[u]=n(),i.mulTo(y,a[u-2],a[u]),u+=2}var g,$,m=e.t-1,b=!0,v=n();for(s=h(e[m])-1;m>=0;){for(s>=c?g=e[m]>>s-c&p:(g=(e[m]&(1<<s+1)-1)<<c-s,m>0&&(g|=e[m-1]>>this.DB+s-c)),u=r;0==(1&g);)g>>=1,--u;if((s-=u)<0&&(s+=this.DB,--m),b)a[g].copyTo(o),b=!1;else{for(;u>1;)i.sqrTo(o,v),i.sqrTo(v,o),u-=2;u>0?i.sqrTo(o,v):($=o,o=v,v=$),i.mulTo(v,a[g],o)}for(;m>=0&&0==(e[m]&1<<s);)i.sqrTo(o,v),$=o,o=v,v=$,--s<0&&(s=this.DB-1,--m)}return i.revert(o)},r.prototype.modInverse=function(e){var t=e.isEven();if(this.isEven()&&t||0==e.signum())return r.ZERO;for(var n=e.clone(),i=this.clone(),s=l(1),o=l(0),a=l(0),u=l(1);0!=n.signum();){for(;n.isEven();)n.rShiftTo(1,n),t?(s.isEven()&&o.isEven()||(s.addTo(this,s),o.subTo(e,o)),s.rShiftTo(1,s)):o.isEven()||o.subTo(e,o),o.rShiftTo(1,o);for(;i.isEven();)i.rShiftTo(1,i),t?(a.isEven()&&u.isEven()||(a.addTo(this,a),u.subTo(e,u)),a.rShiftTo(1,a)):u.isEven()||u.subTo(e,u),u.rShiftTo(1,u);n.compareTo(i)>=0?(n.subTo(i,n),t&&s.subTo(a,s),o.subTo(u,o)):(i.subTo(n,i),t&&a.subTo(s,a),u.subTo(o,u))}return 0!=i.compareTo(r.ONE)?r.ZERO:u.compareTo(e)>=0?u.subtract(e):u.signum()<0?(u.addTo(e,u),u.signum()<0?u.add(e):u):u},r.prototype.pow=function(e){return this.exp(e,new v)},r.prototype.gcd=function(e){var t=this.s<0?this.negate():this.clone(),r=e.s<0?e.negate():e.clone();if(t.compareTo(r)<0){var n=t;t=r,r=n}var i=t.getLowestSetBit(),s=r.getLowestSetBit();if(s<0)return t;for(i<s&&(s=i),s>0&&(t.rShiftTo(s,t),r.rShiftTo(s,r));t.signum()>0;)(i=t.getLowestSetBit())>0&&t.rShiftTo(i,t),(i=r.getLowestSetBit())>0&&r.rShiftTo(i,r),t.compareTo(r)>=0?(t.subTo(r,t),t.rShiftTo(1,t)):(r.subTo(t,r),r.rShiftTo(1,r));return s>0&&r.lShiftTo(s,r),r},r.prototype.isProbablePrime=function(e){var t,r=this.abs();if(1==r.t&&r[0]<=T[T.length-1]){for(t=0;t<T.length;++t)if(r[0]==T[t])return!0;return!1}if(r.isEven())return!1;for(t=1;t<T.length;){for(var n=T[t],i=t+1;i<T.length&&n<I;)n*=T[i++];for(n=r.modInt(n);t<i;)if(n%T[t++]==0)return!1}return r.millerRabin(e)},r.prototype.square=function(){var e=n();return this.squareTo(e),e},r.prototype.Barrett=w,null==S){var R;if(S=new Array,A=0,"undefined"!=typeof window&&window.crypto)if(window.crypto.getRandomValues){var C=new Uint8Array(32);for(window.crypto.getRandomValues(C),R=0;R<32;++R)S[A++]=C[R]}else if("Netscape"==navigator.appName&&navigator.appVersion<"5"){var B=window.crypto.random(32);for(R=0;R<B.length;++R)S[A++]=255&B.charCodeAt(R)}for(;A<N;)R=Math.floor(65536*Math.random()),S[A++]=R>>>8,S[A++]=255&R;A=0,P()}function k(){if(null==E){for(P(),(E=new O).init(S),A=0;A<S.length;++A)S[A]=0;A=0}return E.next()}function K(){}function O(){this.i=0,this.j=0,this.S=new Array}K.prototype.nextBytes=function(e){var t;for(t=0;t<e.length;++t)e[t]=k()},O.prototype.init=function(e){var t,r,n;for(t=0;t<256;++t)this.S[t]=t;for(r=0,t=0;t<256;++t)r=r+this.S[t]+e[t%e.length]&255,n=this.S[t],this.S[t]=this.S[r],this.S[r]=n;this.i=0,this.j=0},O.prototype.next=function(){var e;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,e=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=e,this.S[e+this.S[this.i]&255]};var N=256;e.exports={default:r,BigInteger:r,SecureRandom:K}}).call(commonjsGlobal)}(jsbn);var sprintf={};!function(e){!function(){var t={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/};function r(e){return i(o(e),arguments)}function n(e,t){return r.apply(null,[e].concat(t||[]))}function i(e,n){var i,s,o,a,u,c,l,h,d,f=1,p=e.length,y="";for(s=0;s<p;s++)if("string"==typeof e[s])y+=e[s];else if("object"==typeof e[s]){if((a=e[s]).keys)for(i=n[f],o=0;o<a.keys.length;o++){if(null==i)throw new Error(r('[sprintf] Cannot access property "%s" of undefined value "%s"',a.keys[o],a.keys[o-1]));i=i[a.keys[o]]}else i=a.param_no?n[a.param_no]:n[f++];if(t.not_type.test(a.type)&&t.not_primitive.test(a.type)&&i instanceof Function&&(i=i()),t.numeric_arg.test(a.type)&&"number"!=typeof i&&isNaN(i))throw new TypeError(r("[sprintf] expecting number but found %T",i));switch(t.number.test(a.type)&&(h=i>=0),a.type){case"b":i=parseInt(i,10).toString(2);break;case"c":i=String.fromCharCode(parseInt(i,10));break;case"d":case"i":i=parseInt(i,10);break;case"j":i=JSON.stringify(i,null,a.width?parseInt(a.width):0);break;case"e":i=a.precision?parseFloat(i).toExponential(a.precision):parseFloat(i).toExponential();break;case"f":i=a.precision?parseFloat(i).toFixed(a.precision):parseFloat(i);break;case"g":i=a.precision?String(Number(i.toPrecision(a.precision))):parseFloat(i);break;case"o":i=(parseInt(i,10)>>>0).toString(8);break;case"s":i=String(i),i=a.precision?i.substring(0,a.precision):i;break;case"t":i=String(!!i),i=a.precision?i.substring(0,a.precision):i;break;case"T":i=Object.prototype.toString.call(i).slice(8,-1).toLowerCase(),i=a.precision?i.substring(0,a.precision):i;break;case"u":i=parseInt(i,10)>>>0;break;case"v":i=i.valueOf(),i=a.precision?i.substring(0,a.precision):i;break;case"x":i=(parseInt(i,10)>>>0).toString(16);break;case"X":i=(parseInt(i,10)>>>0).toString(16).toUpperCase()}t.json.test(a.type)?y+=i:(!t.number.test(a.type)||h&&!a.sign?d="":(d=h?"+":"-",i=i.toString().replace(t.sign,"")),c=a.pad_char?"0"===a.pad_char?"0":a.pad_char.charAt(1):" ",l=a.width-(d+i).length,u=a.width&&l>0?c.repeat(l):"",y+=a.align?d+i+u:"0"===c?d+u+i:u+d+i)}return y}var s=Object.create(null);function o(e){if(s[e])return s[e];for(var r,n=e,i=[],o=0;n;){if(null!==(r=t.text.exec(n)))i.push(r[0]);else if(null!==(r=t.modulo.exec(n)))i.push("%");else{if(null===(r=t.placeholder.exec(n)))throw new SyntaxError("[sprintf] unexpected placeholder");if(r[2]){o|=1;var a=[],u=r[2],c=[];if(null===(c=t.key.exec(u)))throw new SyntaxError("[sprintf] failed to parse named argument key");for(a.push(c[1]);""!==(u=u.substring(c[0].length));)if(null!==(c=t.key_access.exec(u)))a.push(c[1]);else{if(null===(c=t.index_access.exec(u)))throw new SyntaxError("[sprintf] failed to parse named argument key");a.push(c[1])}r[2]=a}else o|=2;if(3===o)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");i.push({placeholder:r[0],param_no:r[1],keys:r[2],sign:r[3],pad_char:r[4],align:r[5],width:r[6],precision:r[7],type:r[8]})}n=n.substring(r[0].length)}return s[e]=i}e.sprintf=r,e.vsprintf=n,"undefined"!=typeof window&&(window.sprintf=r,window.vsprintf=n)}()}(sprintf);var __createBinding$5=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),__setModuleDefault$5=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar$5=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding$5(t,e,r);return __setModuleDefault$5(t,e),t};Object.defineProperty(ipv4,"__esModule",{value:!0}),ipv4.Address4=void 0;var common$7=__importStar$5(common$8),constants$3=__importStar$5(constants$4),address_error_1$1=addressError,jsbn_1$1=jsbn.exports,sprintf_js_1$3=sprintf,Address4$1=function(){function e(e){this.groups=constants$3.GROUPS,this.parsedAddress=[],this.parsedSubnet="",this.subnet="/32",this.subnetMask=32,this.v4=!0,this.isCorrect=common$7.isCorrect(constants$3.BITS),this.isInSubnet=common$7.isInSubnet,this.address=e;var t=constants$3.RE_SUBNET_STRING.exec(e);if(t){if(this.parsedSubnet=t[0].replace("/",""),this.subnetMask=parseInt(this.parsedSubnet,10),this.subnet="/"+this.subnetMask,this.subnetMask<0||this.subnetMask>constants$3.BITS)throw new address_error_1$1.AddressError("Invalid subnet mask.");e=e.replace(constants$3.RE_SUBNET_STRING,"")}this.addressMinusSuffix=e,this.parsedAddress=this.parse(e)}return e.isValid=function(t){try{return new e(t),!0}catch(e){return!1}},e.prototype.parse=function(e){var t=e.split(".");if(!e.match(constants$3.RE_ADDRESS))throw new address_error_1$1.AddressError("Invalid IPv4 address.");return t},e.prototype.correctForm=function(){return this.parsedAddress.map((function(e){return parseInt(e,10)})).join(".")},e.fromHex=function(t){var r,n=t.replace(/:/g,"").padStart(8,"0"),i=[];for(r=0;r<8;r+=2){var s=n.slice(r,r+2);i.push(parseInt(s,16))}return new e(i.join("."))},e.fromInteger=function(t){return e.fromHex(t.toString(16))},e.fromArpa=function(t){return new e(t.replace(/(\.in-addr\.arpa)?\.$/,"").split(".").reverse().join("."))},e.prototype.toHex=function(){return this.parsedAddress.map((function(e){return sprintf_js_1$3.sprintf("%02x",parseInt(e,10))})).join(":")},e.prototype.toArray=function(){return this.parsedAddress.map((function(e){return parseInt(e,10)}))},e.prototype.toGroup6=function(){var e,t=[];for(e=0;e<constants$3.GROUPS;e+=2){var r=sprintf_js_1$3.sprintf("%02x%02x",parseInt(this.parsedAddress[e],10),parseInt(this.parsedAddress[e+1],10));t.push(sprintf_js_1$3.sprintf("%x",parseInt(r,16)))}return t.join(":")},e.prototype.bigInteger=function(){return new jsbn_1$1.BigInteger(this.parsedAddress.map((function(e){return sprintf_js_1$3.sprintf("%02x",parseInt(e,10))})).join(""),16)},e.prototype._startAddress=function(){return new jsbn_1$1.BigInteger(this.mask()+"0".repeat(constants$3.BITS-this.subnetMask),2)},e.prototype.startAddress=function(){return e.fromBigInteger(this._startAddress())},e.prototype.startAddressExclusive=function(){var t=new jsbn_1$1.BigInteger("1");return e.fromBigInteger(this._startAddress().add(t))},e.prototype._endAddress=function(){return new jsbn_1$1.BigInteger(this.mask()+"1".repeat(constants$3.BITS-this.subnetMask),2)},e.prototype.endAddress=function(){return e.fromBigInteger(this._endAddress())},e.prototype.endAddressExclusive=function(){var t=new jsbn_1$1.BigInteger("1");return e.fromBigInteger(this._endAddress().subtract(t))},e.fromBigInteger=function(t){return e.fromInteger(parseInt(t.toString(),10))},e.prototype.mask=function(e){return void 0===e&&(e=this.subnetMask),this.getBitsBase2(0,e)},e.prototype.getBitsBase2=function(e,t){return this.binaryZeroPad().slice(e,t)},e.prototype.reverseForm=function(e){e||(e={});var t=this.correctForm().split(".").reverse().join(".");return e.omitSuffix?t:sprintf_js_1$3.sprintf("%s.in-addr.arpa.",t)},e.prototype.isMulticast=function(){return this.isInSubnet(new e("224.0.0.0/4"))},e.prototype.binaryZeroPad=function(){return this.bigInteger().toString(2).padStart(constants$3.BITS,"0")},e.prototype.groupForV6=function(){var e=this.parsedAddress;return this.address.replace(constants$3.RE_ADDRESS,sprintf_js_1$3.sprintf('<span class="hover-group group-v4 group-6">%s</span>.<span class="hover-group group-v4 group-7">%s</span>',e.slice(0,2).join("."),e.slice(2,4).join(".")))},e}();ipv4.Address4=Address4$1;var ipv6={},constants$2={};Object.defineProperty(constants$2,"__esModule",{value:!0}),constants$2.RE_URL_WITH_PORT=constants$2.RE_URL=constants$2.RE_ZONE_STRING=constants$2.RE_SUBNET_STRING=constants$2.RE_BAD_ADDRESS=constants$2.RE_BAD_CHARACTERS=constants$2.TYPES=constants$2.SCOPES=constants$2.GROUPS=constants$2.BITS=void 0,constants$2.BITS=128,constants$2.GROUPS=8,constants$2.SCOPES={0:"Reserved",1:"Interface local",2:"Link local",4:"Admin local",5:"Site local",8:"Organization local",14:"Global",15:"Reserved"},constants$2.TYPES={"ff01::1/128":"Multicast (All nodes on this interface)","ff01::2/128":"Multicast (All routers on this interface)","ff02::1/128":"Multicast (All nodes on this link)","ff02::2/128":"Multicast (All routers on this link)","ff05::2/128":"Multicast (All routers in this site)","ff02::5/128":"Multicast (OSPFv3 AllSPF routers)","ff02::6/128":"Multicast (OSPFv3 AllDR routers)","ff02::9/128":"Multicast (RIP routers)","ff02::a/128":"Multicast (EIGRP routers)","ff02::d/128":"Multicast (PIM routers)","ff02::16/128":"Multicast (MLDv2 reports)","ff01::fb/128":"Multicast (mDNSv6)","ff02::fb/128":"Multicast (mDNSv6)","ff05::fb/128":"Multicast (mDNSv6)","ff02::1:2/128":"Multicast (All DHCP servers and relay agents on this link)","ff05::1:2/128":"Multicast (All DHCP servers and relay agents in this site)","ff02::1:3/128":"Multicast (All DHCP servers on this link)","ff05::1:3/128":"Multicast (All DHCP servers in this site)","::/128":"Unspecified","::1/128":"Loopback","ff00::/8":"Multicast","fe80::/10":"Link-local unicast"},constants$2.RE_BAD_CHARACTERS=/([^0-9a-f:/%])/gi,constants$2.RE_BAD_ADDRESS=/([0-9a-f]{5,}|:{3,}|[^:]:$|^:[^:]|\/$)/gi,constants$2.RE_SUBNET_STRING=/\/\d{1,3}(?=%|$)/,constants$2.RE_ZONE_STRING=/%.*$/,constants$2.RE_URL=new RegExp(/^\[{0,1}([0-9a-f:]+)\]{0,1}/),constants$2.RE_URL_WITH_PORT=new RegExp(/\[([0-9a-f:]+)\]:([0-9]{1,5})/);var helpers$1={};Object.defineProperty(helpers$1,"__esModule",{value:!0}),helpers$1.simpleGroup=helpers$1.spanLeadingZeroes=helpers$1.spanAll=helpers$1.spanAllZeroes=void 0;var sprintf_js_1$2=sprintf;function spanAllZeroes(e){return e.replace(/(0+)/g,'<span class="zero">$1</span>')}function spanAll(e,t){return void 0===t&&(t=0),e.split("").map((function(e,r){return sprintf_js_1$2.sprintf('<span class="digit value-%s position-%d">%s</span>',e,r+t,spanAllZeroes(e))})).join("")}function spanLeadingZeroesSimple(e){return e.replace(/^(0+)/,'<span class="zero">$1</span>')}function spanLeadingZeroes(e){return e.split(":").map((function(e){return spanLeadingZeroesSimple(e)})).join(":")}function simpleGroup(e,t){return void 0===t&&(t=0),e.split(":").map((function(e,r){return/group-v4/.test(e)?e:sprintf_js_1$2.sprintf('<span class="hover-group group-%d">%s</span>',r+t,spanLeadingZeroesSimple(e))}))}helpers$1.spanAllZeroes=spanAllZeroes,helpers$1.spanAll=spanAll,helpers$1.spanLeadingZeroes=spanLeadingZeroes,helpers$1.simpleGroup=simpleGroup;var regularExpressions={},__createBinding$4=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),__setModuleDefault$4=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar$4=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding$4(t,e,r);return __setModuleDefault$4(t,e),t};Object.defineProperty(regularExpressions,"__esModule",{value:!0}),regularExpressions.possibleElisions=regularExpressions.simpleRegularExpression=regularExpressions.ADDRESS_BOUNDARY=regularExpressions.padGroup=regularExpressions.groupPossibilities=void 0;var v6=__importStar$4(constants$2),sprintf_js_1$1=sprintf;function groupPossibilities(e){return sprintf_js_1$1.sprintf("(%s)",e.join("|"))}function padGroup(e){return e.length<4?sprintf_js_1$1.sprintf("0{0,%d}%s",4-e.length,e):e}function simpleRegularExpression(e){var t=[];e.forEach((function(e,r){0===parseInt(e,16)&&t.push(r)}));var r=t.map((function(t){return e.map((function(e,r){if(r===t){var n=0===r||r===v6.GROUPS-1?":":"";return groupPossibilities([padGroup(e),n])}return padGroup(e)})).join(":")}));return r.push(e.map(padGroup).join(":")),groupPossibilities(r)}function possibleElisions(e,t,r){var n=t?"":":",i=r?"":":",s=[];t||r||s.push("::"),t&&r&&s.push(""),(r&&!t||!r&&t)&&s.push(":"),s.push(sprintf_js_1$1.sprintf("%s(:0{1,4}){1,%d}",n,e-1)),s.push(sprintf_js_1$1.sprintf("(0{1,4}:){1,%d}%s",e-1,i)),s.push(sprintf_js_1$1.sprintf("(0{1,4}:){%d}0{1,4}",e-1));for(var o=1;o<e-1;o++)for(var a=1;a<e-o;a++)s.push(sprintf_js_1$1.sprintf("(0{1,4}:){%d}:(0{1,4}:){%d}0{1,4}",a,e-a-o-1));return groupPossibilities(s)}regularExpressions.groupPossibilities=groupPossibilities,regularExpressions.padGroup=padGroup,regularExpressions.ADDRESS_BOUNDARY="[^A-Fa-f0-9:]",regularExpressions.simpleRegularExpression=simpleRegularExpression,regularExpressions.possibleElisions=possibleElisions;var __createBinding$3=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),__setModuleDefault$3=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar$3=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding$3(t,e,r);return __setModuleDefault$3(t,e),t},__spreadArray=commonjsGlobal&&commonjsGlobal.__spreadArray||function(e,t){for(var r=0,n=t.length,i=e.length;r<n;r++,i++)e[i]=t[r];return e};Object.defineProperty(ipv6,"__esModule",{value:!0}),ipv6.Address6=void 0;var common$6=__importStar$3(common$8),constants4=__importStar$3(constants$4),constants6=__importStar$3(constants$2),helpers=__importStar$3(helpers$1),ipv4_1=ipv4,regular_expressions_1=regularExpressions,address_error_1=addressError,jsbn_1=jsbn.exports,sprintf_js_1=sprintf;function assert$h(e){if(!e)throw new Error("Assertion failed.")}function addCommas(e){for(var t=/(\d+)(\d{3})/;t.test(e);)e=e.replace(t,"$1,$2");return e}function spanLeadingZeroes4(e){return e=(e=e.replace(/^(0{1,})([1-9]+)$/,'<span class="parse-error">$1</span>$2')).replace(/^(0{1,})(0)$/,'<span class="parse-error">$1</span>$2')}function compact(e,t){var r,n=[],i=[];for(r=0;r<e.length;r++)r<t[0]?n.push(e[r]):r>t[1]&&i.push(e[r]);return n.concat(["compact"]).concat(i)}function paddedHex(e){return sprintf_js_1.sprintf("%04x",parseInt(e,16))}function unsignByte(e){return 255&e}var Address6$1=function(){function e(e,t){this.addressMinusSuffix="",this.parsedSubnet="",this.subnet="/128",this.subnetMask=128,this.v4=!1,this.zone="",this.isInSubnet=common$6.isInSubnet,this.isCorrect=common$6.isCorrect(constants6.BITS),this.groups=void 0===t?constants6.GROUPS:t,this.address=e;var r=constants6.RE_SUBNET_STRING.exec(e);if(r){if(this.parsedSubnet=r[0].replace("/",""),this.subnetMask=parseInt(this.parsedSubnet,10),this.subnet="/"+this.subnetMask,Number.isNaN(this.subnetMask)||this.subnetMask<0||this.subnetMask>constants6.BITS)throw new address_error_1.AddressError("Invalid subnet mask.");e=e.replace(constants6.RE_SUBNET_STRING,"")}else if(/\//.test(e))throw new address_error_1.AddressError("Invalid subnet mask.");var n=constants6.RE_ZONE_STRING.exec(e);n&&(this.zone=n[0],e=e.replace(constants6.RE_ZONE_STRING,"")),this.addressMinusSuffix=e,this.parsedAddress=this.parse(this.addressMinusSuffix)}return e.isValid=function(t){try{return new e(t),!0}catch(e){return!1}},e.fromBigInteger=function(t){var r,n=t.toString(16).padStart(32,"0"),i=[];for(r=0;r<constants6.GROUPS;r++)i.push(n.slice(4*r,4*(r+1)));return new e(i.join(":"))},e.fromURL=function(t){var r,n,i=null;if(-1!==t.indexOf("[")&&-1!==t.indexOf("]:")){if(null===(n=constants6.RE_URL_WITH_PORT.exec(t)))return{error:"failed to parse address with port",address:null,port:null};r=n[1],i=n[2]}else if(-1!==t.indexOf("/")){if(t=t.replace(/^[a-z0-9]+:\/\//,""),null===(n=constants6.RE_URL.exec(t)))return{error:"failed to parse address from URL",address:null,port:null};r=n[1]}else r=t;return i?((i=parseInt(i,10))<0||i>65536)&&(i=null):i=null,{address:new e(r),port:i}},e.fromAddress4=function(t){var r=new ipv4_1.Address4(t),n=constants6.BITS-(constants4.BITS-r.subnetMask);return new e("::ffff:"+r.correctForm()+"/"+n)},e.fromArpa=function(t){var r=t.replace(/(\.ip6\.arpa)?\.$/,"");if(63!==r.length)throw new address_error_1.AddressError("Invalid 'ip6.arpa' form.");for(var n=r.split(".").reverse(),i=7;i>0;i--){var s=4*i;n.splice(s,0,":")}return new e(r=n.join(""))},e.prototype.microsoftTranscription=function(){return sprintf_js_1.sprintf("%s.ipv6-literal.net",this.correctForm().replace(/:/g,"-"))},e.prototype.mask=function(e){return void 0===e&&(e=this.subnetMask),this.getBitsBase2(0,e)},e.prototype.possibleSubnets=function(e){void 0===e&&(e=128);var t=constants6.BITS-this.subnetMask-Math.abs(e-constants6.BITS);return t<0?"0":addCommas(new jsbn_1.BigInteger("2",10).pow(t).toString(10))},e.prototype._startAddress=function(){return new jsbn_1.BigInteger(this.mask()+"0".repeat(constants6.BITS-this.subnetMask),2)},e.prototype.startAddress=function(){return e.fromBigInteger(this._startAddress())},e.prototype.startAddressExclusive=function(){var t=new jsbn_1.BigInteger("1");return e.fromBigInteger(this._startAddress().add(t))},e.prototype._endAddress=function(){return new jsbn_1.BigInteger(this.mask()+"1".repeat(constants6.BITS-this.subnetMask),2)},e.prototype.endAddress=function(){return e.fromBigInteger(this._endAddress())},e.prototype.endAddressExclusive=function(){var t=new jsbn_1.BigInteger("1");return e.fromBigInteger(this._endAddress().subtract(t))},e.prototype.getScope=function(){var e=constants6.SCOPES[this.getBits(12,16).intValue()];return"Global unicast"===this.getType()&&"Link local"!==e&&(e="Global"),e||"Unknown"},e.prototype.getType=function(){for(var t=0,r=Object.keys(constants6.TYPES);t<r.length;t++){var n=r[t];if(this.isInSubnet(new e(n)))return constants6.TYPES[n]}return"Global unicast"},e.prototype.getBits=function(e,t){return new jsbn_1.BigInteger(this.getBitsBase2(e,t),2)},e.prototype.getBitsBase2=function(e,t){return this.binaryZeroPad().slice(e,t)},e.prototype.getBitsBase16=function(e,t){var r=t-e;if(r%4!=0)throw new Error("Length of bits to retrieve must be divisible by four");return this.getBits(e,t).toString(16).padStart(r/4,"0")},e.prototype.getBitsPastSubnet=function(){return this.getBitsBase2(this.subnetMask,constants6.BITS)},e.prototype.reverseForm=function(e){e||(e={});var t=Math.floor(this.subnetMask/4),r=this.canonicalForm().replace(/:/g,"").split("").slice(0,t).reverse().join(".");return t>0?e.omitSuffix?r:sprintf_js_1.sprintf("%s.ip6.arpa.",r):e.omitSuffix?"":"ip6.arpa."},e.prototype.correctForm=function(){var e,t=[],r=0,n=[];for(e=0;e<this.parsedAddress.length;e++){var i=parseInt(this.parsedAddress[e],16);0===i&&r++,0!==i&&r>0&&(r>1&&n.push([e-r,e-1]),r=0)}r>1&&n.push([this.parsedAddress.length-r,this.parsedAddress.length-1]);var s=n.map((function(e){return e[1]-e[0]+1}));if(n.length>0){var o=s.indexOf(Math.max.apply(Math,s));t=compact(this.parsedAddress,n[o])}else t=this.parsedAddress;for(e=0;e<t.length;e++)"compact"!==t[e]&&(t[e]=parseInt(t[e],16).toString(16));var a=t.join(":");return a=(a=(a=a.replace(/^compact$/,"::")).replace(/^compact|compact$/,":")).replace(/compact/,"")},e.prototype.binaryZeroPad=function(){return this.bigInteger().toString(2).padStart(constants6.BITS,"0")},e.prototype.parse4in6=function(e){var t=e.split(":"),r=t.slice(-1)[0].match(constants4.RE_ADDRESS);if(r){this.parsedAddress4=r[0],this.address4=new ipv4_1.Address4(this.parsedAddress4);for(var n=0;n<this.address4.groups;n++)if(/^0[0-9]+/.test(this.address4.parsedAddress[n]))throw new address_error_1.AddressError("IPv4 addresses can't have leading zeroes.",e.replace(constants4.RE_ADDRESS,this.address4.parsedAddress.map(spanLeadingZeroes4).join(".")));this.v4=!0,t[t.length-1]=this.address4.toGroup6(),e=t.join(":")}return e},e.prototype.parse=function(e){var t=(e=this.parse4in6(e)).match(constants6.RE_BAD_CHARACTERS);if(t)throw new address_error_1.AddressError(sprintf_js_1.sprintf("Bad character%s detected in address: %s",t.length>1?"s":"",t.join("")),e.replace(constants6.RE_BAD_CHARACTERS,'<span class="parse-error">$1</span>'));var r=e.match(constants6.RE_BAD_ADDRESS);if(r)throw new address_error_1.AddressError(sprintf_js_1.sprintf("Address failed regex: %s",r.join("")),e.replace(constants6.RE_BAD_ADDRESS,'<span class="parse-error">$1</span>'));var n=[],i=e.split("::");if(2===i.length){var s=i[0].split(":"),o=i[1].split(":");1===s.length&&""===s[0]&&(s=[]),1===o.length&&""===o[0]&&(o=[]);var a=this.groups-(s.length+o.length);if(!a)throw new address_error_1.AddressError("Error parsing groups");this.elidedGroups=a,this.elisionBegin=s.length,this.elisionEnd=s.length+this.elidedGroups,n=n.concat(s);for(var u=0;u<a;u++)n.push("0");n=n.concat(o)}else{if(1!==i.length)throw new address_error_1.AddressError("Too many :: groups found");n=e.split(":"),this.elidedGroups=0}if((n=n.map((function(e){return sprintf_js_1.sprintf("%x",parseInt(e,16))}))).length!==this.groups)throw new address_error_1.AddressError("Incorrect number of groups found");return n},e.prototype.canonicalForm=function(){return this.parsedAddress.map(paddedHex).join(":")},e.prototype.decimal=function(){return this.parsedAddress.map((function(e){return sprintf_js_1.sprintf("%05d",parseInt(e,16))})).join(":")},e.prototype.bigInteger=function(){return new jsbn_1.BigInteger(this.parsedAddress.map(paddedHex).join(""),16)},e.prototype.to4=function(){var e=this.binaryZeroPad().split("");return ipv4_1.Address4.fromHex(new jsbn_1.BigInteger(e.slice(96,128).join(""),2).toString(16))},e.prototype.to4in6=function(){var t=this.to4(),r=new e(this.parsedAddress.slice(0,6).join(":"),6).correctForm(),n="";return/:$/.test(r)||(n=":"),r+n+t.address},e.prototype.inspectTeredo=function(){var e=this.getBitsBase16(0,32),t=this.getBits(80,96).xor(new jsbn_1.BigInteger("ffff",16)).toString(),r=ipv4_1.Address4.fromHex(this.getBitsBase16(32,64)),n=ipv4_1.Address4.fromHex(this.getBits(96,128).xor(new jsbn_1.BigInteger("ffffffff",16)).toString(16)),i=this.getBits(64,80),s=this.getBitsBase2(64,80),o=i.testBit(15),a=i.testBit(14),u=i.testBit(8),c=i.testBit(9),l=new jsbn_1.BigInteger(s.slice(2,6)+s.slice(8,16),2).toString(10);return{prefix:sprintf_js_1.sprintf("%s:%s",e.slice(0,4),e.slice(4,8)),server4:r.address,client4:n.address,flags:s,coneNat:o,microsoft:{reserved:a,universalLocal:c,groupIndividual:u,nonce:l},udpPort:t}},e.prototype.inspect6to4=function(){var e=this.getBitsBase16(0,16),t=ipv4_1.Address4.fromHex(this.getBitsBase16(16,48));return{prefix:sprintf_js_1.sprintf("%s",e.slice(0,4)),gateway:t.address}},e.prototype.to6to4=function(){return this.is4()?new e(["2002",this.getBitsBase16(96,112),this.getBitsBase16(112,128),"","/16"].join(":")):null},e.prototype.toByteArray=function(){var e=this.bigInteger().toByteArray();return 17===e.length&&0===e[0]?e.slice(1):e},e.prototype.toUnsignedByteArray=function(){return this.toByteArray().map(unsignByte)},e.fromByteArray=function(e){return this.fromUnsignedByteArray(e.map(unsignByte))},e.fromUnsignedByteArray=function(t){for(var r=new jsbn_1.BigInteger("256",10),n=new jsbn_1.BigInteger("0",10),i=new jsbn_1.BigInteger("1",10),s=t.length-1;s>=0;s--)n=n.add(i.multiply(new jsbn_1.BigInteger(t[s].toString(10),10))),i=i.multiply(r);return e.fromBigInteger(n)},e.prototype.isCanonical=function(){return this.addressMinusSuffix===this.canonicalForm()},e.prototype.isLinkLocal=function(){return"1111111010000000000000000000000000000000000000000000000000000000"===this.getBitsBase2(0,64)},e.prototype.isMulticast=function(){return"Multicast"===this.getType()},e.prototype.is4=function(){return this.v4},e.prototype.isTeredo=function(){return this.isInSubnet(new e("2001::/32"))},e.prototype.is6to4=function(){return this.isInSubnet(new e("2002::/16"))},e.prototype.isLoopback=function(){return"Loopback"===this.getType()},e.prototype.href=function(e){return e=void 0===e?"":sprintf_js_1.sprintf(":%s",e),sprintf_js_1.sprintf("http://[%s]%s/",this.correctForm(),e)},e.prototype.link=function(e){e||(e={}),void 0===e.className&&(e.className=""),void 0===e.prefix&&(e.prefix="/#address="),void 0===e.v4&&(e.v4=!1);var t=this.correctForm;return e.v4&&(t=this.to4in6),e.className?sprintf_js_1.sprintf('<a href="%1$s%2$s" class="%3$s">%2$s</a>',e.prefix,t.call(this),e.className):sprintf_js_1.sprintf('<a href="%1$s%2$s">%2$s</a>',e.prefix,t.call(this))},e.prototype.group=function(){if(0===this.elidedGroups)return helpers.simpleGroup(this.address).join(":");assert$h("number"==typeof this.elidedGroups),assert$h("number"==typeof this.elisionBegin);var e=[],t=this.address.split("::"),r=t[0],n=t[1];r.length?e.push.apply(e,helpers.simpleGroup(r)):e.push("");for(var i=["hover-group"],s=this.elisionBegin;s<this.elisionBegin+this.elidedGroups;s++)i.push(sprintf_js_1.sprintf("group-%d",s));return e.push(sprintf_js_1.sprintf('<span class="%s"></span>',i.join(" "))),n.length?e.push.apply(e,helpers.simpleGroup(n,this.elisionEnd)):e.push(""),this.is4()&&(assert$h(this.address4 instanceof ipv4_1.Address4),e.pop(),e.push(this.address4.groupForV6())),e.join(":")},e.prototype.regularExpressionString=function(t){void 0===t&&(t=!1);var r=[],n=new e(this.correctForm());if(0===n.elidedGroups)r.push(regular_expressions_1.simpleRegularExpression(n.parsedAddress));else if(n.elidedGroups===constants6.GROUPS)r.push(regular_expressions_1.possibleElisions(constants6.GROUPS));else{var i=n.address.split("::");i[0].length&&r.push(regular_expressions_1.simpleRegularExpression(i[0].split(":"))),assert$h("number"==typeof n.elidedGroups),r.push(regular_expressions_1.possibleElisions(n.elidedGroups,0!==i[0].length,0!==i[1].length)),i[1].length&&r.push(regular_expressions_1.simpleRegularExpression(i[1].split(":"))),r=[r.join(":")]}return t||(r=__spreadArray(__spreadArray(["(?=^|",regular_expressions_1.ADDRESS_BOUNDARY,"|[^\\w\\:])("],r),[")(?=[^\\w\\:]|",regular_expressions_1.ADDRESS_BOUNDARY,"|$)"])),r.join("")},e.prototype.regularExpression=function(e){return void 0===e&&(e=!1),new RegExp(this.regularExpressionString(e),"i")},e}();ipv6.Address6=Address6$1,function(e){var t=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),r=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&t(n,e,i);return r(n,e),n};Object.defineProperty(e,"__esModule",{value:!0}),e.v6=e.AddressError=e.Address6=e.Address4=void 0;var i=ipv4;Object.defineProperty(e,"Address4",{enumerable:!0,get:function(){return i.Address4}});var s=ipv6;Object.defineProperty(e,"Address6",{enumerable:!0,get:function(){return s.Address6}});var o=addressError;Object.defineProperty(e,"AddressError",{enumerable:!0,get:function(){return o.AddressError}});var a=n(helpers$1);e.v6={helpers:a}}(ipAddress);const debug$i=require$$0$b,log$a=Object.assign(debug$i("libp2p:ip-port-to-multiaddr"),{error:debug$i("libp2p:ip-port-to-multiaddr:err")}),{Multiaddr:Multiaddr$2}=src$o,errCode$4=errCode$m,{Address4:Address4,Address6:Address6}=ipAddress,errors$3={ERR_INVALID_IP_PARAMETER:"ERR_INVALID_IP_PARAMETER",ERR_INVALID_PORT_PARAMETER:"ERR_INVALID_PORT_PARAMETER",ERR_INVALID_IP:"ERR_INVALID_IP"};function ipPortToMultiaddr(e,t){if("string"!=typeof e)throw errCode$4(new Error(`invalid ip provided: ${e}`),errors$3.ERR_INVALID_IP_PARAMETER);if("string"==typeof t&&(t=parseInt(t)),isNaN(t))throw errCode$4(new Error(`invalid port provided: ${t}`),errors$3.ERR_INVALID_PORT_PARAMETER);try{return new Address4(e),new Multiaddr$2(`/ip4/${e}/tcp/${t}`)}catch{}try{const r=new Address6(e);return r.is4()?new Multiaddr$2(`/ip4/${r.to4().correctForm()}/tcp/${t}`):new Multiaddr$2(`/ip6/${e}/tcp/${t}`)}catch(r){const n=`invalid ip:port for creating a multiaddr: ${e}:${t}`;throw log$a.error(n),errCode$4(new Error(n),errors$3.ERR_INVALID_IP)}}ipPortToMultiaddr$1.exports=ipPortToMultiaddr,ipPortToMultiaddr$1.exports.Errors=errors$3;var pTimeout$4={exports:{}};class TimeoutError$1 extends Error{constructor(e){super(e),this.name="TimeoutError"}}const pTimeout$3=(e,t,r,n)=>{let i;const s=new Promise(((s,o)=>{if("number"!=typeof t||t<0)throw new TypeError("Expected `milliseconds` to be a positive number");t!==1/0?(n={customTimers:{setTimeout:setTimeout,clearTimeout:clearTimeout},...n},i=n.customTimers.setTimeout.call(void 0,(()=>{if("function"==typeof r){try{s(r())}catch(e){o(e)}return}const n=r instanceof Error?r:new TimeoutError$1("string"==typeof r?r:`Promise timed out after ${t} milliseconds`);"function"==typeof e.cancel&&e.cancel(),o(n)}),t),(async()=>{try{s(await e)}catch(e){o(e)}finally{n.customTimers.clearTimeout.call(void 0,i)}})()):s(e)}));return s.clear=()=>{clearTimeout(i),i=void 0},s};pTimeout$4.exports=pTimeout$3,pTimeout$4.exports.default=pTimeout$3,pTimeout$4.exports.TimeoutError=TimeoutError$1;const abortable$4=abortableIterator.exports,{CLOSE_TIMEOUT:CLOSE_TIMEOUT$1}=constants$5,toMultiaddr$1=ipPortToMultiaddr$1.exports,pTimeout$2=pTimeout$4.exports,debug$h=require$$0$b,log$9=debug$h("libp2p:websockets:socket");log$9.error=debug$h("libp2p:websockets:socket:error");var socketToConn$1=(e,t={})=>{const r={async sink(r){t.signal&&(r=abortable$4(r,t.signal));try{await e.sink(async function*(){for await(const e of r)yield e instanceof Uint8Array?e:e.slice()}())}catch(e){"aborted"!==e.type&&log$9.error(e)}},source:t.signal?abortable$4(e.source,t.signal):e.source,conn:e,localAddr:t.localAddr||(e.localAddress&&e.localPort?toMultiaddr$1(e.localAddress,e.localPort):void 0),remoteAddr:t.remoteAddr||toMultiaddr$1(e.remoteAddress,e.remotePort),timeline:{open:Date.now()},async close(){const t=Date.now();try{await pTimeout$2(e.close(),CLOSE_TIMEOUT$1)}catch(n){const{host:i,port:s}=r.remoteAddr.toOptions();log$9("timeout closing stream to %s:%s after %dms, destroying it manually",i,s,Date.now()-t),e.destroy()}finally{r.timeline.close=Date.now()}}};return e.socket.once&&e.socket.once("close",(()=>{r.timeline.close||(r.timeline.close=Date.now())})),r};const mafmt$1=src$j,{CODE_CIRCUIT:CODE_CIRCUIT$1,CODE_P2P:CODE_P2P$1,CODE_TCP:CODE_TCP,CODE_WS:CODE_WS,CODE_WSS:CODE_WSS}=constants$5;var filters$1={all:e=>e.filter((e=>{if(e.protoCodes().includes(CODE_CIRCUIT$1))return!1;const t=e.decapsulateCode(CODE_P2P$1);return mafmt$1.WebSockets.matches(t)||mafmt$1.WebSocketsSecure.matches(t)})),dnsWss:e=>e.filter((e=>{if(e.protoCodes().includes(CODE_CIRCUIT$1))return!1;const t=e.decapsulateCode(CODE_P2P$1);return mafmt$1.WebSocketsSecure.matches(t)&&mafmt$1.DNS.matches(t.decapsulateCode(CODE_TCP).decapsulateCode(CODE_WSS))})),dnsWsOrWss:e=>e.filter((e=>{if(e.protoCodes().includes(CODE_CIRCUIT$1))return!1;const t=e.decapsulateCode(CODE_P2P$1);return mafmt$1.WebSockets.matches(t)?mafmt$1.DNS.matches(t.decapsulateCode(CODE_TCP).decapsulateCode(CODE_WS)):mafmt$1.WebSocketsSecure.matches(t)&&mafmt$1.DNS.matches(t.decapsulateCode(CODE_TCP).decapsulateCode(CODE_WSS))}))};const connect=client.exports,withIs$1=classIs.exports,toUri=multiaddrToUri,{AbortError:AbortError$1}=abortableIterator.exports,pDefer$1=pDefer_1,debug$g=require$$0$b,log$8=debug$g("libp2p:websockets");log$8.error=debug$g("libp2p:websockets:error");const env=require$$6,createListener$1=listener_browser,toConnection$2=socketToConn$1,filters=filters$1;class WebSockets{constructor({upgrader:e,filter:t}){if(!e)throw new Error("An upgrader must be provided. See https://github.com/libp2p/interface-transport#upgrader.");this._upgrader=e,this._filter=t}async dial(e,t={}){log$8("dialing %s",e);const r=await this._connect(e,t),n=toConnection$2(r,{remoteAddr:e,signal:t.signal});log$8("new outbound connection %s",n.remoteAddr);const i=await this._upgrader.upgradeOutbound(n);return log$8("outbound connection %s upgraded",n.remoteAddr),i}async _connect(e,t={}){if(t.signal&&t.signal.aborted)throw new AbortError$1;const r=e.toOptions();log$8("dialing %s:%s",r.host,r.port);const n=pDefer$1(),i=e=>{const t=`connection error: ${e.message}`;log$8.error(t),n.reject(e)},s=connect(toUri(e),Object.assign({binary:!0},t));if(s.socket.on?s.socket.on("error",i):s.socket.onerror=i,!t.signal)return await Promise.race([s.connected(),n.promise]),log$8("connected %s",e),s;let o;const a=new Promise(((e,r)=>{if(o=()=>{r(new AbortError$1),setTimeout((()=>{s.close()}))},t.signal.aborted)return o();t.signal.addEventListener("abort",o)}));try{await Promise.race([a,n.promise,s.connected()])}finally{t.signal.removeEventListener("abort",o)}return log$8("connected %s",e),s}createListener(e={},t){return"function"==typeof e&&(t=e,e={}),createListener$1({handler:t,upgrader:this._upgrader})}filter(e){return e=Array.isArray(e)?e:[e],this._filter?this._filter(e):env.isBrowser||env.isWebWorker?filters.dnsWss(e):filters.all(e)}}var src$b=withIs$1(WebSockets,{className:"WebSockets",symbolName:"@libp2p/js-libp2p-websockets/websockets"}),getBrowserRtc=function(){if("undefined"==typeof globalThis)return null;var e={RTCPeerConnection:globalThis.RTCPeerConnection||globalThis.mozRTCPeerConnection||globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription||globalThis.mozRTCSessionDescription||globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate||globalThis.mozRTCIceCandidate||globalThis.webkitRTCIceCandidate};return e.RTCPeerConnection?e:null},safeBuffer={exports:{}};!function(e,t){var r=require$$0$7,n=r.Buffer;function i(e,t){for(var r in e)t[r]=e[r]}function s(e,t,r){return n(e,t,r)}n.from&&n.alloc&&n.allocUnsafe&&n.allocUnsafeSlow?e.exports=r:(i(r,t),t.Buffer=s),i(n,s),s.from=function(e,t,r){if("number"==typeof e)throw new TypeError("Argument must not be a number");return n(e,t,r)},s.alloc=function(e,t,r){if("number"!=typeof e)throw new TypeError("Argument must be a number");var i=n(e);return void 0!==t?"string"==typeof r?i.fill(t,r):i.fill(t):i.fill(0),i},s.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return n(e)},s.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)}}(safeBuffer,safeBuffer.exports);var MAX_BYTES=65536,MAX_UINT32=4294967295;function oldBrowser(){throw new Error("Secure random number generation is not supported by this browser.\nUse Chrome, Firefox or Internet Explorer 11")}var Buffer$4=safeBuffer.exports.Buffer,crypto$b=global$1.crypto||global$1.msCrypto;function randomBytes$9(e,t){if(e>MAX_UINT32)throw new RangeError("requested too many random bytes");var r=Buffer$4.allocUnsafe(e);if(e>0)if(e>MAX_BYTES)for(var n=0;n<e;n+=MAX_BYTES)crypto$b.getRandomValues(r.slice(n,n+MAX_BYTES));else crypto$b.getRandomValues(r);return"function"==typeof t?process.nextTick((function(){t(null,r)})):r}crypto$b&&crypto$b.getRandomValues?module.exports=randomBytes$9:module.exports=oldBrowser;var browser$2=Object.freeze({__proto__:null}),require$$2$1=getAugmentedNamespace(browser$2),readableBrowser={exports:{}},streamBrowser=require$$1$9.EventEmitter,inherits$6;inherits$6="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e};var inherits$7=inherits$6,formatRegExp=/%[sdj%]/g;function format(e){if(!isString(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(inspect$1(arguments[r]));return t.join(" ")}r=1;for(var n=arguments,i=n.length,s=String(e).replace(formatRegExp,(function(e){if("%%"===e)return"%";if(r>=i)return e;switch(e){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(e){return"[Circular]"}default:return e}})),o=n[r];r<i;o=n[++r])isNull(o)||!isObject$1(o)?s+=" "+o:s+=" "+inspect$1(o);return s}function deprecate$1(e,t){if(isUndefined(global$1.process))return function(){return deprecate$1(e,t).apply(this,arguments)};if(!0===process.noDeprecation)return e;var r=!1;return function(){if(!r){if(process.throwDeprecation)throw new Error(t);process.traceDeprecation?console.trace(t):console.error(t),r=!0}return e.apply(this,arguments)}}var debugs={},debugEnviron;function debuglog(e){if(isUndefined(debugEnviron)&&(debugEnviron=process.env.NODE_DEBUG||""),e=e.toUpperCase(),!debugs[e])if(new RegExp("\\b"+e+"\\b","i").test(debugEnviron)){debugs[e]=function(){var t=format.apply(null,arguments);console.error("%s %d: %s",e,0,t)}}else debugs[e]=function(){};return debugs[e]}function inspect$1(e,t){var r={seen:[],stylize:stylizeNoColor};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),isBoolean(t)?r.showHidden=t:t&&_extend(r,t),isUndefined(r.showHidden)&&(r.showHidden=!1),isUndefined(r.depth)&&(r.depth=2),isUndefined(r.colors)&&(r.colors=!1),isUndefined(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=stylizeWithColor),formatValue(r,e,r.depth)}function stylizeWithColor(e,t){var r=inspect$1.styles[t];return r?"["+inspect$1.colors[r][0]+"m"+e+"["+inspect$1.colors[r][1]+"m":e}function stylizeNoColor(e,t){return e}function arrayToHash(e){var t={};return e.forEach((function(e,r){t[e]=!0})),t}function formatValue(e,t,r){if(e.customInspect&&t&&isFunction(t.inspect)&&t.inspect!==inspect$1&&(!t.constructor||t.constructor.prototype!==t)){var n=t.inspect(r,e);return isString(n)||(n=formatValue(e,n,r)),n}var i=formatPrimitive(e,t);if(i)return i;var s=Object.keys(t),o=arrayToHash(s);if(e.showHidden&&(s=Object.getOwnPropertyNames(t)),isError(t)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return formatError(t);if(0===s.length){if(isFunction(t)){var a=t.name?": "+t.name:"";return e.stylize("[Function"+a+"]","special")}if(isRegExp(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(isDate(t))return e.stylize(Date.prototype.toString.call(t),"date");if(isError(t))return formatError(t)}var u,c="",l=!1,h=["{","}"];(isArray(t)&&(l=!0,h=["[","]"]),isFunction(t))&&(c=" [Function"+(t.name?": "+t.name:"")+"]");return isRegExp(t)&&(c=" "+RegExp.prototype.toString.call(t)),isDate(t)&&(c=" "+Date.prototype.toUTCString.call(t)),isError(t)&&(c=" "+formatError(t)),0!==s.length||l&&0!=t.length?r<0?isRegExp(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special"):(e.seen.push(t),u=l?formatArray(e,t,r,o,s):s.map((function(n){return formatProperty(e,t,r,o,n,l)})),e.seen.pop(),reduceToSingleString(u,c,h)):h[0]+c+h[1]}function formatPrimitive(e,t){if(isUndefined(t))return e.stylize("undefined","undefined");if(isString(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}return isNumber(t)?e.stylize(""+t,"number"):isBoolean(t)?e.stylize(""+t,"boolean"):isNull(t)?e.stylize("null","null"):void 0}function formatError(e){return"["+Error.prototype.toString.call(e)+"]"}function formatArray(e,t,r,n,i){for(var s=[],o=0,a=t.length;o<a;++o)hasOwnProperty(t,String(o))?s.push(formatProperty(e,t,r,n,String(o),!0)):s.push("");return i.forEach((function(i){i.match(/^\d+$/)||s.push(formatProperty(e,t,r,n,i,!0))})),s}function formatProperty(e,t,r,n,i,s){var o,a,u;if((u=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?a=u.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):u.set&&(a=e.stylize("[Setter]","special")),hasOwnProperty(n,i)||(o="["+i+"]"),a||(e.seen.indexOf(u.value)<0?(a=isNull(r)?formatValue(e,u.value,null):formatValue(e,u.value,r-1)).indexOf("\n")>-1&&(a=s?a.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+a.split("\n").map((function(e){return"   "+e})).join("\n")):a=e.stylize("[Circular]","special")),isUndefined(o)){if(s&&i.match(/^\d+$/))return a;(o=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=e.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=e.stylize(o,"string"))}return o+": "+a}function reduceToSingleString(e,t,r){var n=e.reduce((function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0);return n>60?r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1]:r[0]+t+" "+e.join(", ")+" "+r[1]}function isArray(e){return Array.isArray(e)}function isBoolean(e){return"boolean"==typeof e}function isNull(e){return null===e}function isNullOrUndefined(e){return null==e}function isNumber(e){return"number"==typeof e}function isString(e){return"string"==typeof e}function isSymbol$1(e){return"symbol"==typeof e}function isUndefined(e){return void 0===e}function isRegExp(e){return isObject$1(e)&&"[object RegExp]"===objectToString$1(e)}function isObject$1(e){return"object"==typeof e&&null!==e}function isDate(e){return isObject$1(e)&&"[object Date]"===objectToString$1(e)}function isError(e){return isObject$1(e)&&("[object Error]"===objectToString$1(e)||e instanceof Error)}function isFunction(e){return"function"==typeof e}function isPrimitive(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e}function isBuffer$2(e){return Buffer$f.isBuffer(e)}function objectToString$1(e){return Object.prototype.toString.call(e)}function pad(e){return e<10?"0"+e.toString(10):e.toString(10)}inspect$1.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},inspect$1.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function timestamp(){var e=new Date,t=[pad(e.getHours()),pad(e.getMinutes()),pad(e.getSeconds())].join(":");return[e.getDate(),months[e.getMonth()],t].join(" ")}function log$7(){console.log("%s - %s",timestamp(),format.apply(null,arguments))}function _extend(e,t){if(!t||!isObject$1(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e}function hasOwnProperty(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var _polyfillNode_util={inherits:inherits$7,_extend:_extend,log:log$7,isBuffer:isBuffer$2,isPrimitive:isPrimitive,isFunction:isFunction,isError:isError,isDate:isDate,isObject:isObject$1,isRegExp:isRegExp,isUndefined:isUndefined,isSymbol:isSymbol$1,isString:isString,isNumber:isNumber,isNullOrUndefined:isNullOrUndefined,isNull:isNull,isBoolean:isBoolean,isArray:isArray,inspect:inspect$1,deprecate:deprecate$1,format:format,debuglog:debuglog},_polyfillNode_util$1=Object.freeze({__proto__:null,format:format,deprecate:deprecate$1,debuglog:debuglog,inspect:inspect$1,isArray:isArray,isBoolean:isBoolean,isNull:isNull,isNullOrUndefined:isNullOrUndefined,isNumber:isNumber,isString:isString,isSymbol:isSymbol$1,isUndefined:isUndefined,isRegExp:isRegExp,isObject:isObject$1,isDate:isDate,isError:isError,isFunction:isFunction,isPrimitive:isPrimitive,isBuffer:isBuffer$2,log:log$7,inherits:inherits$7,_extend:_extend,default:_polyfillNode_util}),require$$3=getAugmentedNamespace(_polyfillNode_util$1);function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach((function(t){_defineProperty$1(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _defineProperty$1(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}var _require$2=require$$0$7,Buffer$3=_require$2.Buffer,_require2=require$$3,inspect=_require2.inspect,custom=inspect&&inspect.custom||"inspect";function copyBuffer(e,t,r){Buffer$3.prototype.copy.call(e,t,r)}var buffer_list=function(){function e(){_classCallCheck(this,e),this.head=null,this.tail=null,this.length=0}return _createClass(e,[{key:"push",value:function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length}},{key:"unshift",value:function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length}},{key:"shift",value:function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(e){if(0===this.length)return"";for(var t=this.head,r=""+t.data;t=t.next;)r+=e+t.data;return r}},{key:"concat",value:function(e){if(0===this.length)return Buffer$3.alloc(0);for(var t=Buffer$3.allocUnsafe(e>>>0),r=this.head,n=0;r;)copyBuffer(r.data,t,n),n+=r.data.length,r=r.next;return t}},{key:"consume",value:function(e,t){var r;return e<this.head.data.length?(r=this.head.data.slice(0,e),this.head.data=this.head.data.slice(e)):r=e===this.head.data.length?this.shift():t?this._getString(e):this._getBuffer(e),r}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(e){var t=this.head,r=1,n=t.data;for(e-=n.length;t=t.next;){var i=t.data,s=e>i.length?i.length:e;if(s===i.length?n+=i:n+=i.slice(0,e),0===(e-=s)){s===i.length?(++r,t.next?this.head=t.next:this.head=this.tail=null):(this.head=t,t.data=i.slice(s));break}++r}return this.length-=r,n}},{key:"_getBuffer",value:function(e){var t=Buffer$3.allocUnsafe(e),r=this.head,n=1;for(r.data.copy(t),e-=r.data.length;r=r.next;){var i=r.data,s=e>i.length?i.length:e;if(i.copy(t,t.length-e,0,s),0===(e-=s)){s===i.length?(++n,r.next?this.head=r.next:this.head=this.tail=null):(this.head=r,r.data=i.slice(s));break}++n}return this.length-=n,t}},{key:custom,value:function(e,t){return inspect(this,_objectSpread({},t,{depth:0,customInspect:!1}))}}]),e}();function destroy(e,t){var r=this,n=this._readableState&&this._readableState.destroyed,i=this._writableState&&this._writableState.destroyed;return n||i?(t?t(e):e&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,process.nextTick(emitErrorNT,this,e)):process.nextTick(emitErrorNT,this,e)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,(function(e){!t&&e?r._writableState?r._writableState.errorEmitted?process.nextTick(emitCloseNT,r):(r._writableState.errorEmitted=!0,process.nextTick(emitErrorAndCloseNT,r,e)):process.nextTick(emitErrorAndCloseNT,r,e):t?(process.nextTick(emitCloseNT,r),t(e)):process.nextTick(emitCloseNT,r)})),this)}function emitErrorAndCloseNT(e,t){emitErrorNT(e,t),emitCloseNT(e)}function emitCloseNT(e){e._writableState&&!e._writableState.emitClose||e._readableState&&!e._readableState.emitClose||e.emit("close")}function undestroy(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function emitErrorNT(e,t){e.emit("error",t)}function errorOrDestroy$2(e,t){var r=e._readableState,n=e._writableState;r&&r.autoDestroy||n&&n.autoDestroy?e.destroy(t):e.emit("error",t)}module.exports={destroy:destroy,undestroy:undestroy,errorOrDestroy:errorOrDestroy$2};var destroy$1=Object.freeze({__proto__:null}),require$$5=getAugmentedNamespace(destroy$1),errorsBrowser={};function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var codes$1={};function createErrorType(e,t,r){r||(r=Error);var n=function(e){function r(r,n,i){return e.call(this,function(e,r,n){return"string"==typeof t?t:t(e,r,n)}(r,n,i))||this}return _inheritsLoose(r,e),r}(r);n.prototype.name=r.name,n.prototype.code=e,codes$1[e]=n}function oneOf(e,t){if(Array.isArray(e)){var r=e.length;return e=e.map((function(e){return String(e)})),r>2?"one of ".concat(t," ").concat(e.slice(0,r-1).join(", "),", or ")+e[r-1]:2===r?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])}return"of ".concat(t," ").concat(String(e))}function startsWith(e,t,r){return e.substr(!r||r<0?0:+r,t.length)===t}function endsWith(e,t,r){return(void 0===r||r>e.length)&&(r=e.length),e.substring(r-t.length,r)===t}function includes(e,t,r){return"number"!=typeof r&&(r=0),!(r+t.length>e.length)&&-1!==e.indexOf(t,r)}createErrorType("ERR_INVALID_OPT_VALUE",(function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'}),TypeError),createErrorType("ERR_INVALID_ARG_TYPE",(function(e,t,r){var n,i;if("string"==typeof t&&startsWith(t,"not ")?(n="must not be",t=t.replace(/^not /,"")):n="must be",endsWith(e," argument"))i="The ".concat(e," ").concat(n," ").concat(oneOf(t,"type"));else{var s=includes(e,".")?"property":"argument";i='The "'.concat(e,'" ').concat(s," ").concat(n," ").concat(oneOf(t,"type"))}return i+=". Received type ".concat(typeof r)}),TypeError),createErrorType("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),createErrorType("ERR_METHOD_NOT_IMPLEMENTED",(function(e){return"The "+e+" method is not implemented"})),createErrorType("ERR_STREAM_PREMATURE_CLOSE","Premature close"),createErrorType("ERR_STREAM_DESTROYED",(function(e){return"Cannot call "+e+" after a stream was destroyed"})),createErrorType("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),createErrorType("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),createErrorType("ERR_STREAM_WRITE_AFTER_END","write after end"),createErrorType("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),createErrorType("ERR_UNKNOWN_ENCODING",(function(e){return"Unknown encoding: "+e}),TypeError),createErrorType("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),errorsBrowser.codes=codes$1;var ERR_INVALID_OPT_VALUE=errorsBrowser.codes.ERR_INVALID_OPT_VALUE;function highWaterMarkFrom(e,t,r){return null!=e.highWaterMark?e.highWaterMark:t?e[r]:null}function getHighWaterMark$2(e,t,r,n){var i=highWaterMarkFrom(t,n,r);if(null!=i){if(!isFinite(i)||Math.floor(i)!==i||i<0)throw new ERR_INVALID_OPT_VALUE(n?r:"highWaterMark",i);return Math.floor(i)}return e.objectMode?16:16384}var state={getHighWaterMark:getHighWaterMark$2},inherits$4;inherits$4="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e};var inherits$5=inherits$4,_polyfillNode_inherits=Object.freeze({__proto__:null,default:inherits$5}),require$$1$3=getAugmentedNamespace(_polyfillNode_inherits),require$$0$3=getAugmentedNamespace(_stream_readable);function deprecate(e,t){if(config$1("noDeprecation"))return e;var r=!1;return function(){if(!r){if(config$1("throwDeprecation"))throw new Error(t);config$1("traceDeprecation")?console.trace(t):console.warn(t),r=!0}return e.apply(this,arguments)}}function config$1(e){try{if(!global$1.localStorage)return!1}catch(e){return!1}var t=global$1.localStorage[e];return null!=t&&"true"===String(t).toLowerCase()}module.exports=deprecate;var browser$1=Object.freeze({__proto__:null}),require$$0$2=getAugmentedNamespace(browser$1),require$$2=getAugmentedNamespace(_stream_duplex),Duplex$3;function CorkedRequest(e){var t=this;this.next=null,this.entry=null,this.finish=function(){onCorkedFinish(t,e)}}module.exports=Writable$1,Writable$1.WritableState=WritableState;var internalUtil={deprecate:require$$0$2},Stream$1=streamBrowser,Buffer$2=require$$0$7.Buffer,OurUint8Array$1=global$1.Uint8Array||function(){};function _uint8ArrayToBuffer$1(e){return Buffer$2.from(e)}function _isUint8Array$1(e){return Buffer$2.isBuffer(e)||e instanceof OurUint8Array$1}var destroyImpl$1=require$$5,_require$1=state,getHighWaterMark$1=_require$1.getHighWaterMark,_require$codes$3=errorsBrowser.codes,ERR_INVALID_ARG_TYPE$1=_require$codes$3.ERR_INVALID_ARG_TYPE,ERR_METHOD_NOT_IMPLEMENTED$2=_require$codes$3.ERR_METHOD_NOT_IMPLEMENTED,ERR_MULTIPLE_CALLBACK$1=_require$codes$3.ERR_MULTIPLE_CALLBACK,ERR_STREAM_CANNOT_PIPE=_require$codes$3.ERR_STREAM_CANNOT_PIPE,ERR_STREAM_DESTROYED$1=_require$codes$3.ERR_STREAM_DESTROYED,ERR_STREAM_NULL_VALUES=_require$codes$3.ERR_STREAM_NULL_VALUES,ERR_STREAM_WRITE_AFTER_END=_require$codes$3.ERR_STREAM_WRITE_AFTER_END,ERR_UNKNOWN_ENCODING=_require$codes$3.ERR_UNKNOWN_ENCODING,errorOrDestroy$1=destroyImpl$1.errorOrDestroy,realHasInstance;function nop(){}function WritableState(e,t,r){Duplex$3=Duplex$3||require$$2,e=e||{},"boolean"!=typeof r&&(r=t instanceof Duplex$3),this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.writableObjectMode),this.highWaterMark=getHighWaterMark$1(this,e,"writableHighWaterMark",r),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var n=!1===e.decodeStrings;this.decodeStrings=!n,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){onwrite(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new CorkedRequest(this)}function Writable$1(e){var t=this instanceof(Duplex$3=Duplex$3||require$$2);if(!t&&!realHasInstance.call(Writable$1,this))return new Writable$1(e);this._writableState=new WritableState(e,this,t),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),Stream$1.call(this)}function writeAfterEnd(e,t){var r=new ERR_STREAM_WRITE_AFTER_END;errorOrDestroy$1(e,r),process.nextTick(t,r)}function validChunk(e,t,r,n){var i;return null===r?i=new ERR_STREAM_NULL_VALUES:"string"==typeof r||t.objectMode||(i=new ERR_INVALID_ARG_TYPE$1("chunk",["string","Buffer"],r)),!i||(errorOrDestroy$1(e,i),process.nextTick(n,i),!1)}function decodeChunk(e,t,r){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=Buffer$2.from(t,r)),t}function writeOrBuffer(e,t,r,n,i,s){if(!r){var o=decodeChunk(t,n,i);n!==o&&(r=!0,i="buffer",n=o)}var a=t.objectMode?1:n.length;t.length+=a;var u=t.length<t.highWaterMark;if(u||(t.needDrain=!0),t.writing||t.corked){var c=t.lastBufferedRequest;t.lastBufferedRequest={chunk:n,encoding:i,isBuf:r,callback:s,next:null},c?c.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else doWrite(e,t,!1,a,n,i,s);return u}function doWrite(e,t,r,n,i,s,o){t.writelen=n,t.writecb=o,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new ERR_STREAM_DESTROYED$1("write")):r?e._writev(i,t.onwrite):e._write(i,s,t.onwrite),t.sync=!1}function onwriteError(e,t,r,n,i){--t.pendingcb,r?(process.nextTick(i,n),process.nextTick(finishMaybe,e,t),e._writableState.errorEmitted=!0,errorOrDestroy$1(e,n)):(i(n),e._writableState.errorEmitted=!0,errorOrDestroy$1(e,n),finishMaybe(e,t))}function onwriteStateUpdate(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}function onwrite(e,t){var r=e._writableState,n=r.sync,i=r.writecb;if("function"!=typeof i)throw new ERR_MULTIPLE_CALLBACK$1;if(onwriteStateUpdate(r),t)onwriteError(e,r,n,t,i);else{var s=needFinish(r)||e.destroyed;s||r.corked||r.bufferProcessing||!r.bufferedRequest||clearBuffer(e,r),n?process.nextTick(afterWrite,e,r,s,i):afterWrite(e,r,s,i)}}function afterWrite(e,t,r,n){r||onwriteDrain(e,t),t.pendingcb--,n(),finishMaybe(e,t)}function onwriteDrain(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}function clearBuffer(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var n=t.bufferedRequestCount,i=new Array(n),s=t.corkedRequestsFree;s.entry=r;for(var o=0,a=!0;r;)i[o]=r,r.isBuf||(a=!1),r=r.next,o+=1;i.allBuffers=a,doWrite(e,t,!0,t.length,i,"",s.finish),t.pendingcb++,t.lastBufferedRequest=null,s.next?(t.corkedRequestsFree=s.next,s.next=null):t.corkedRequestsFree=new CorkedRequest(t),t.bufferedRequestCount=0}else{for(;r;){var u=r.chunk,c=r.encoding,l=r.callback;if(doWrite(e,t,!1,t.objectMode?1:u.length,u,c,l),r=r.next,t.bufferedRequestCount--,t.writing)break}null===r&&(t.lastBufferedRequest=null)}t.bufferedRequest=r,t.bufferProcessing=!1}function needFinish(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function callFinal(e,t){e._final((function(r){t.pendingcb--,r&&errorOrDestroy$1(e,r),t.prefinished=!0,e.emit("prefinish"),finishMaybe(e,t)}))}function prefinish$1(e,t){t.prefinished||t.finalCalled||("function"!=typeof e._final||t.destroyed?(t.prefinished=!0,e.emit("prefinish")):(t.pendingcb++,t.finalCalled=!0,process.nextTick(callFinal,e,t)))}function finishMaybe(e,t){var r=needFinish(t);if(r&&(prefinish$1(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"),t.autoDestroy))){var n=e._readableState;(!n||n.autoDestroy&&n.endEmitted)&&e.destroy()}return r}function endWritable(e,t,r){t.ending=!0,finishMaybe(e,t),r&&(t.finished?process.nextTick(r):e.once("finish",r)),t.ended=!0,e.writable=!1}function onCorkedFinish(e,t,r){var n=e.entry;for(e.entry=null;n;){var i=n.callback;t.pendingcb--,i(r),n=n.next}t.corkedRequestsFree.next=e}require$$1$3(Writable$1,Stream$1),WritableState.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(WritableState.prototype,"buffer",{get:internalUtil.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(realHasInstance=Function.prototype[Symbol.hasInstance],Object.defineProperty(Writable$1,Symbol.hasInstance,{value:function(e){return!!realHasInstance.call(this,e)||this===Writable$1&&(e&&e._writableState instanceof WritableState)}})):realHasInstance=function(e){return e instanceof this},Writable$1.prototype.pipe=function(){errorOrDestroy$1(this,new ERR_STREAM_CANNOT_PIPE)},Writable$1.prototype.write=function(e,t,r){var n=this._writableState,i=!1,s=!n.objectMode&&_isUint8Array$1(e);return s&&!Buffer$2.isBuffer(e)&&(e=_uint8ArrayToBuffer$1(e)),"function"==typeof t&&(r=t,t=null),s?t="buffer":t||(t=n.defaultEncoding),"function"!=typeof r&&(r=nop),n.ending?writeAfterEnd(this,r):(s||validChunk(this,n,e,r))&&(n.pendingcb++,i=writeOrBuffer(this,n,s,e,t,r)),i},Writable$1.prototype.cork=function(){this._writableState.corked++},Writable$1.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.bufferProcessing||!e.bufferedRequest||clearBuffer(this,e))},Writable$1.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new ERR_UNKNOWN_ENCODING(e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(Writable$1.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(Writable$1.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Writable$1.prototype._write=function(e,t,r){r(new ERR_METHOD_NOT_IMPLEMENTED$2("_write()"))},Writable$1.prototype._writev=null,Writable$1.prototype.end=function(e,t,r){var n=this._writableState;return"function"==typeof e?(r=e,e=null,t=null):"function"==typeof t&&(r=t,t=null),null!=e&&this.write(e,t),n.corked&&(n.corked=1,this.uncork()),n.ending||endWritable(this,n,r),this},Object.defineProperty(Writable$1.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(Writable$1.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),Writable$1.prototype.destroy=destroyImpl$1.destroy,Writable$1.prototype._undestroy=destroyImpl$1.undestroy,Writable$1.prototype._destroy=function(e,t){t(e)};var _stream_writable=Object.freeze({__proto__:null}),require$$1$2=getAugmentedNamespace(_stream_writable),objectKeys=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t};module.exports=Duplex$2;var Readable$1=require$$0$3,Writable=require$$1$2;require$$1$3(Duplex$2,Readable$1);for(var keys$9=objectKeys(Writable.prototype),v=0;v<keys$9.length;v++){var method=keys$9[v];Duplex$2.prototype[method]||(Duplex$2.prototype[method]=Writable.prototype[method])}function Duplex$2(e){if(!(this instanceof Duplex$2))return new Duplex$2(e);Readable$1.call(this,e),Writable.call(this,e),this.allowHalfOpen=!0,e&&(!1===e.readable&&(this.readable=!1),!1===e.writable&&(this.writable=!1),!1===e.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",onend)))}function onend(){this._writableState.ended||process.nextTick(onEndNT,this)}function onEndNT(e){e.end()}Object.defineProperty(Duplex$2.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(Duplex$2.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(Duplex$2.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(Duplex$2.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}});var isBufferEncoding=Buffer$f.isEncoding||function(e){switch(e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function assertEncoding(e){if(e&&!isBufferEncoding(e))throw new Error("Unknown encoding: "+e)}function StringDecoder$1(e){switch(this.encoding=(e||"utf8").toLowerCase().replace(/[-_]/,""),assertEncoding(e),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=utf16DetectIncompleteChar;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=base64DetectIncompleteChar;break;default:return void(this.write=passThroughWrite)}this.charBuffer=new Buffer$f(6),this.charReceived=0,this.charLength=0}function passThroughWrite(e){return e.toString(this.encoding)}function utf16DetectIncompleteChar(e){this.charReceived=e.length%2,this.charLength=this.charReceived?2:0}function base64DetectIncompleteChar(e){this.charReceived=e.length%3,this.charLength=this.charReceived?3:0}StringDecoder$1.prototype.write=function(e){for(var t="";this.charLength;){var r=e.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:e.length;if(e.copy(this.charBuffer,this.charReceived,0,r),this.charReceived+=r,this.charReceived<this.charLength)return"";if(e=e.slice(r,e.length),!((i=(t=this.charBuffer.slice(0,this.charLength).toString(this.encoding)).charCodeAt(t.length-1))>=55296&&i<=56319)){if(this.charReceived=this.charLength=0,0===e.length)return t;break}this.charLength+=this.surrogateSize,t=""}this.detectIncompleteChar(e);var n=e.length;this.charLength&&(e.copy(this.charBuffer,0,e.length-this.charReceived,n),n-=this.charReceived);var i;n=(t+=e.toString(this.encoding,0,n)).length-1;if((i=t.charCodeAt(n))>=55296&&i<=56319){var s=this.surrogateSize;return this.charLength+=s,this.charReceived+=s,this.charBuffer.copy(this.charBuffer,s,0,s),e.copy(this.charBuffer,0,0,s),t.substring(0,n)}return t},StringDecoder$1.prototype.detectIncompleteChar=function(e){for(var t=e.length>=3?3:e.length;t>0;t--){var r=e[e.length-t];if(1==t&&r>>5==6){this.charLength=2;break}if(t<=2&&r>>4==14){this.charLength=3;break}if(t<=3&&r>>3==30){this.charLength=4;break}}this.charReceived=t},StringDecoder$1.prototype.end=function(e){var t="";if(e&&e.length&&(t=this.write(e)),this.charReceived){var r=this.charReceived,n=this.charBuffer,i=this.encoding;t+=n.slice(0,r).toString(i)}return t};var _polyfillNode_string_decoder=Object.freeze({__proto__:null,StringDecoder:StringDecoder$1}),require$$10=getAugmentedNamespace(_polyfillNode_string_decoder),ERR_STREAM_PREMATURE_CLOSE=errorsBrowser.codes.ERR_STREAM_PREMATURE_CLOSE;function once$1(e){var t=!1;return function(){if(!t){t=!0;for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];e.apply(this,n)}}}function noop$2(){}function isRequest$1(e){return e.setHeader&&"function"==typeof e.abort}function eos$1(e,t,r){if("function"==typeof t)return eos$1(e,null,t);t||(t={}),r=once$1(r||noop$2);var n=t.readable||!1!==t.readable&&e.readable,i=t.writable||!1!==t.writable&&e.writable,s=function(){e.writable||a()},o=e._writableState&&e._writableState.finished,a=function(){i=!1,o=!0,n||r.call(e)},u=e._readableState&&e._readableState.endEmitted,c=function(){n=!1,u=!0,i||r.call(e)},l=function(t){r.call(e,t)},h=function(){var t;return n&&!u?(e._readableState&&e._readableState.ended||(t=new ERR_STREAM_PREMATURE_CLOSE),r.call(e,t)):i&&!o?(e._writableState&&e._writableState.ended||(t=new ERR_STREAM_PREMATURE_CLOSE),r.call(e,t)):void 0},d=function(){e.req.on("finish",a)};return isRequest$1(e)?(e.on("complete",a),e.on("abort",h),e.req?d():e.on("request",d)):i&&!e._writableState&&(e.on("end",s),e.on("close",s)),e.on("end",c),e.on("finish",a),!1!==t.error&&e.on("error",l),e.on("close",h),function(){e.removeListener("complete",a),e.removeListener("abort",h),e.removeListener("request",d),e.req&&e.req.removeListener("finish",a),e.removeListener("end",s),e.removeListener("close",s),e.removeListener("finish",a),e.removeListener("end",c),e.removeListener("error",l),e.removeListener("close",h)}}var endOfStream=eos$1,_Object$setPrototypeO;function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var finished=endOfStream,kLastResolve=Symbol("lastResolve"),kLastReject=Symbol("lastReject"),kError=Symbol("error"),kEnded=Symbol("ended"),kLastPromise=Symbol("lastPromise"),kHandlePromise=Symbol("handlePromise"),kStream=Symbol("stream");function createIterResult(e,t){return{value:e,done:t}}function readAndResolve(e){var t=e[kLastResolve];if(null!==t){var r=e[kStream].read();null!==r&&(e[kLastPromise]=null,e[kLastResolve]=null,e[kLastReject]=null,t(createIterResult(r,!1)))}}function onReadable(e){process.nextTick(readAndResolve,e)}function wrapForNext(e,t){return function(r,n){e.then((function(){t[kEnded]?r(createIterResult(void 0,!0)):t[kHandlePromise](r,n)}),n)}}var AsyncIteratorPrototype=Object.getPrototypeOf((function(){})),ReadableStreamAsyncIteratorPrototype=Object.setPrototypeOf((_Object$setPrototypeO={get stream(){return this[kStream]},next:function(){var e=this,t=this[kError];if(null!==t)return Promise.reject(t);if(this[kEnded])return Promise.resolve(createIterResult(void 0,!0));if(this[kStream].destroyed)return new Promise((function(t,r){process.nextTick((function(){e[kError]?r(e[kError]):t(createIterResult(void 0,!0))}))}));var r,n=this[kLastPromise];if(n)r=new Promise(wrapForNext(n,this));else{var i=this[kStream].read();if(null!==i)return Promise.resolve(createIterResult(i,!1));r=new Promise(this[kHandlePromise])}return this[kLastPromise]=r,r}},_defineProperty(_Object$setPrototypeO,Symbol.asyncIterator,(function(){return this})),_defineProperty(_Object$setPrototypeO,"return",(function(){var e=this;return new Promise((function(t,r){e[kStream].destroy(null,(function(e){e?r(e):t(createIterResult(void 0,!0))}))}))})),_Object$setPrototypeO),AsyncIteratorPrototype),createReadableStreamAsyncIterator$1=function(e){var t,r=Object.create(ReadableStreamAsyncIteratorPrototype,(_defineProperty(t={},kStream,{value:e,writable:!0}),_defineProperty(t,kLastResolve,{value:null,writable:!0}),_defineProperty(t,kLastReject,{value:null,writable:!0}),_defineProperty(t,kError,{value:null,writable:!0}),_defineProperty(t,kEnded,{value:e._readableState.endEmitted,writable:!0}),_defineProperty(t,kHandlePromise,{value:function(e,t){var n=r[kStream].read();n?(r[kLastPromise]=null,r[kLastResolve]=null,r[kLastReject]=null,e(createIterResult(n,!1))):(r[kLastResolve]=e,r[kLastReject]=t)},writable:!0}),t));return r[kLastPromise]=null,finished(e,(function(e){if(e&&"ERR_STREAM_PREMATURE_CLOSE"!==e.code){var t=r[kLastReject];return null!==t&&(r[kLastPromise]=null,r[kLastResolve]=null,r[kLastReject]=null,t(e)),void(r[kError]=e)}var n=r[kLastResolve];null!==n&&(r[kLastPromise]=null,r[kLastResolve]=null,r[kLastReject]=null,n(createIterResult(void 0,!0))),r[kEnded]=!0})),e.on("readable",onReadable.bind(null,r)),r};module.exports=createReadableStreamAsyncIterator$1;var async_iterator=Object.freeze({__proto__:null}),require$$11=getAugmentedNamespace(async_iterator),fromBrowser=function(){throw new Error("Readable.from is not available in the browser")},Duplex$1;module.exports=Readable,Readable.ReadableState=ReadableState,require$$1$9.EventEmitter;var EElistenerCount=function(e,t){return e.listeners(t).length},Stream=streamBrowser,Buffer$1=require$$0$7.Buffer,OurUint8Array=global$1.Uint8Array||function(){};function _uint8ArrayToBuffer(e){return Buffer$1.from(e)}function _isUint8Array(e){return Buffer$1.isBuffer(e)||e instanceof OurUint8Array}var debugUtil=require$$3,debug$f;debug$f=debugUtil&&debugUtil.debuglog?debugUtil.debuglog("stream"):function(){};var BufferList$4=buffer_list,destroyImpl=require$$5,_require=state,getHighWaterMark=_require.getHighWaterMark,_require$codes$2=errorsBrowser.codes,ERR_INVALID_ARG_TYPE=_require$codes$2.ERR_INVALID_ARG_TYPE,ERR_STREAM_PUSH_AFTER_EOF=_require$codes$2.ERR_STREAM_PUSH_AFTER_EOF,ERR_METHOD_NOT_IMPLEMENTED$1=_require$codes$2.ERR_METHOD_NOT_IMPLEMENTED,ERR_STREAM_UNSHIFT_AFTER_END_EVENT=_require$codes$2.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,StringDecoder,createReadableStreamAsyncIterator,from;require$$1$3(Readable,Stream);var errorOrDestroy=destroyImpl.errorOrDestroy,kProxyEvents=["error","close","destroy","pause","resume"];function prependListener(e,t,r){if("function"==typeof e.prependListener)return e.prependListener(t,r);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]:e.on(t,r)}function ReadableState(e,t,r){Duplex$1=Duplex$1||require$$2,e=e||{},"boolean"!=typeof r&&(r=t instanceof Duplex$1),this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.readableObjectMode),this.highWaterMark=getHighWaterMark(this,e,"readableHighWaterMark",r),this.buffer=new BufferList$4,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(StringDecoder||(StringDecoder=require$$10.StringDecoder),this.decoder=new StringDecoder(e.encoding),this.encoding=e.encoding)}function Readable(e){if(Duplex$1=Duplex$1||require$$2,!(this instanceof Readable))return new Readable(e);var t=this instanceof Duplex$1;this._readableState=new ReadableState(e,this,t),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),Stream.call(this)}function readableAddChunk(e,t,r,n,i){debug$f("readableAddChunk",t);var s,o=e._readableState;if(null===t)o.reading=!1,onEofChunk(e,o);else if(i||(s=chunkInvalid(o,t)),s)errorOrDestroy(e,s);else if(o.objectMode||t&&t.length>0)if("string"==typeof t||o.objectMode||Object.getPrototypeOf(t)===Buffer$1.prototype||(t=_uint8ArrayToBuffer(t)),n)o.endEmitted?errorOrDestroy(e,new ERR_STREAM_UNSHIFT_AFTER_END_EVENT):addChunk(e,o,t,!0);else if(o.ended)errorOrDestroy(e,new ERR_STREAM_PUSH_AFTER_EOF);else{if(o.destroyed)return!1;o.reading=!1,o.decoder&&!r?(t=o.decoder.write(t),o.objectMode||0!==t.length?addChunk(e,o,t,!1):maybeReadMore(e,o)):addChunk(e,o,t,!1)}else n||(o.reading=!1,maybeReadMore(e,o));return!o.ended&&(o.length<o.highWaterMark||0===o.length)}function addChunk(e,t,r,n){t.flowing&&0===t.length&&!t.sync?(t.awaitDrain=0,e.emit("data",r)):(t.length+=t.objectMode?1:r.length,n?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&emitReadable(e)),maybeReadMore(e,t)}function chunkInvalid(e,t){var r;return _isUint8Array(t)||"string"==typeof t||void 0===t||e.objectMode||(r=new ERR_INVALID_ARG_TYPE("chunk",["string","Buffer","Uint8Array"],t)),r}Object.defineProperty(Readable.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),Readable.prototype.destroy=destroyImpl.destroy,Readable.prototype._undestroy=destroyImpl.undestroy,Readable.prototype._destroy=function(e,t){t(e)},Readable.prototype.push=function(e,t){var r,n=this._readableState;return n.objectMode?r=!0:"string"==typeof e&&((t=t||n.defaultEncoding)!==n.encoding&&(e=Buffer$1.from(e,t),t=""),r=!0),readableAddChunk(this,e,t,!1,r)},Readable.prototype.unshift=function(e){return readableAddChunk(this,e,null,!0,!1)},Readable.prototype.isPaused=function(){return!1===this._readableState.flowing},Readable.prototype.setEncoding=function(e){StringDecoder||(StringDecoder=require$$10.StringDecoder);var t=new StringDecoder(e);this._readableState.decoder=t,this._readableState.encoding=this._readableState.decoder.encoding;for(var r=this._readableState.buffer.head,n="";null!==r;)n+=t.write(r.data),r=r.next;return this._readableState.buffer.clear(),""!==n&&this._readableState.buffer.push(n),this._readableState.length=n.length,this};var MAX_HWM=1073741824;function computeNewHighWaterMark(e){return e>=MAX_HWM?e=MAX_HWM:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}function howMuchToRead(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=computeNewHighWaterMark(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function onEofChunk(e,t){if(debug$f("onEofChunk"),!t.ended){if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,t.sync?emitReadable(e):(t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,emitReadable_(e)))}}function emitReadable(e){var t=e._readableState;debug$f("emitReadable",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||(debug$f("emitReadable",t.flowing),t.emittedReadable=!0,process.nextTick(emitReadable_,e))}function emitReadable_(e){var t=e._readableState;debug$f("emitReadable_",t.destroyed,t.length,t.ended),t.destroyed||!t.length&&!t.ended||(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,flow(e)}function maybeReadMore(e,t){t.readingMore||(t.readingMore=!0,process.nextTick(maybeReadMore_,e,t))}function maybeReadMore_(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&0===t.length);){var r=t.length;if(debug$f("maybeReadMore read 0"),e.read(0),r===t.length)break}t.readingMore=!1}function pipeOnDrain(e){return function(){var t=e._readableState;debug$f("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&EElistenerCount(e,"data")&&(t.flowing=!0,flow(e))}}function updateReadableListening(e){var t=e._readableState;t.readableListening=e.listenerCount("readable")>0,t.resumeScheduled&&!t.paused?t.flowing=!0:e.listenerCount("data")>0&&e.resume()}function nReadingNextTick(e){debug$f("readable nexttick read 0"),e.read(0)}function resume(e,t){t.resumeScheduled||(t.resumeScheduled=!0,process.nextTick(resume_,e,t))}function resume_(e,t){debug$f("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),flow(e),t.flowing&&!t.reading&&e.read(0)}function flow(e){var t=e._readableState;for(debug$f("flow",t.flowing);t.flowing&&null!==e.read(););}function fromList(e,t){return 0===t.length?null:(t.objectMode?r=t.buffer.shift():!e||e>=t.length?(r=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.first():t.buffer.concat(t.length),t.buffer.clear()):r=t.buffer.consume(e,t.decoder),r);var r}function endReadable(e){var t=e._readableState;debug$f("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,process.nextTick(endReadableNT,t,e))}function endReadableNT(e,t){if(debug$f("endReadableNT",e.endEmitted,e.length),!e.endEmitted&&0===e.length&&(e.endEmitted=!0,t.readable=!1,t.emit("end"),e.autoDestroy)){var r=t._writableState;(!r||r.autoDestroy&&r.finished)&&t.destroy()}}function indexOf(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}Readable.prototype.read=function(e){debug$f("read",e),e=parseInt(e,10);var t=this._readableState,r=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&((0!==t.highWaterMark?t.length>=t.highWaterMark:t.length>0)||t.ended))return debug$f("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?endReadable(this):emitReadable(this),null;if(0===(e=howMuchToRead(e,t))&&t.ended)return 0===t.length&&endReadable(this),null;var n,i=t.needReadable;return debug$f("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&debug$f("length less than watermark",i=!0),t.ended||t.reading?debug$f("reading or ended",i=!1):i&&(debug$f("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=howMuchToRead(r,t))),null===(n=e>0?fromList(e,t):null)?(t.needReadable=t.length<=t.highWaterMark,e=0):(t.length-=e,t.awaitDrain=0),0===t.length&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&endReadable(this)),null!==n&&this.emit("data",n),n},Readable.prototype._read=function(e){errorOrDestroy(this,new ERR_METHOD_NOT_IMPLEMENTED$1("_read()"))},Readable.prototype.pipe=function(e,t){var r=this,n=this._readableState;switch(n.pipesCount){case 0:n.pipes=e;break;case 1:n.pipes=[n.pipes,e];break;default:n.pipes.push(e)}n.pipesCount+=1,debug$f("pipe count=%d opts=%j",n.pipesCount,t);var i=(!t||!1!==t.end)&&e!==process.stdout&&e!==process.stderr?o:f;function s(t,i){debug$f("onunpipe"),t===r&&i&&!1===i.hasUnpiped&&(i.hasUnpiped=!0,debug$f("cleanup"),e.removeListener("close",h),e.removeListener("finish",d),e.removeListener("drain",a),e.removeListener("error",l),e.removeListener("unpipe",s),r.removeListener("end",o),r.removeListener("end",f),r.removeListener("data",c),u=!0,!n.awaitDrain||e._writableState&&!e._writableState.needDrain||a())}function o(){debug$f("onend"),e.end()}n.endEmitted?process.nextTick(i):r.once("end",i),e.on("unpipe",s);var a=pipeOnDrain(r);e.on("drain",a);var u=!1;function c(t){debug$f("ondata");var i=e.write(t);debug$f("dest.write",i),!1===i&&((1===n.pipesCount&&n.pipes===e||n.pipesCount>1&&-1!==indexOf(n.pipes,e))&&!u&&(debug$f("false write response, pause",n.awaitDrain),n.awaitDrain++),r.pause())}function l(t){debug$f("onerror",t),f(),e.removeListener("error",l),0===EElistenerCount(e,"error")&&errorOrDestroy(e,t)}function h(){e.removeListener("finish",d),f()}function d(){debug$f("onfinish"),e.removeListener("close",h),f()}function f(){debug$f("unpipe"),r.unpipe(e)}return r.on("data",c),prependListener(e,"error",l),e.once("close",h),e.once("finish",d),e.emit("pipe",r),n.flowing||(debug$f("pipe resume"),r.resume()),e},Readable.prototype.unpipe=function(e){var t=this._readableState,r={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,r)),this;if(!e){var n=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var s=0;s<i;s++)n[s].emit("unpipe",this,{hasUnpiped:!1});return this}var o=indexOf(t.pipes,e);return-1===o||(t.pipes.splice(o,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,r)),this},Readable.prototype.on=function(e,t){var r=Stream.prototype.on.call(this,e,t),n=this._readableState;return"data"===e?(n.readableListening=this.listenerCount("readable")>0,!1!==n.flowing&&this.resume()):"readable"===e&&(n.endEmitted||n.readableListening||(n.readableListening=n.needReadable=!0,n.flowing=!1,n.emittedReadable=!1,debug$f("on readable",n.length,n.reading),n.length?emitReadable(this):n.reading||process.nextTick(nReadingNextTick,this))),r},Readable.prototype.addListener=Readable.prototype.on,Readable.prototype.removeListener=function(e,t){var r=Stream.prototype.removeListener.call(this,e,t);return"readable"===e&&process.nextTick(updateReadableListening,this),r},Readable.prototype.removeAllListeners=function(e){var t=Stream.prototype.removeAllListeners.apply(this,arguments);return"readable"!==e&&void 0!==e||process.nextTick(updateReadableListening,this),t},Readable.prototype.resume=function(){var e=this._readableState;return e.flowing||(debug$f("resume"),e.flowing=!e.readableListening,resume(this,e)),e.paused=!1,this},Readable.prototype.pause=function(){return debug$f("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(debug$f("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},Readable.prototype.wrap=function(e){var t=this,r=this._readableState,n=!1;for(var i in e.on("end",(function(){if(debug$f("wrapped end"),r.decoder&&!r.ended){var e=r.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(i){(debug$f("wrapped data"),r.decoder&&(i=r.decoder.write(i)),r.objectMode&&null==i)||(r.objectMode||i&&i.length)&&(t.push(i)||(n=!0,e.pause()))})),e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var s=0;s<kProxyEvents.length;s++)e.on(kProxyEvents[s],this.emit.bind(this,kProxyEvents[s]));return this._read=function(t){debug$f("wrapped _read",t),n&&(n=!1,e.resume())},this},"function"==typeof Symbol&&(Readable.prototype[Symbol.asyncIterator]=function(){return void 0===createReadableStreamAsyncIterator&&(createReadableStreamAsyncIterator=require$$11),createReadableStreamAsyncIterator(this)}),Object.defineProperty(Readable.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(Readable.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(Readable.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}}),Readable._fromList=fromList,Object.defineProperty(Readable.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof Symbol&&(Readable.from=function(e,t){return void 0===from&&(from=fromBrowser),from(Readable,e,t)});var _stream_transform=Transform$1,_require$codes$1=errorsBrowser.codes,ERR_METHOD_NOT_IMPLEMENTED=_require$codes$1.ERR_METHOD_NOT_IMPLEMENTED,ERR_MULTIPLE_CALLBACK=_require$codes$1.ERR_MULTIPLE_CALLBACK,ERR_TRANSFORM_ALREADY_TRANSFORMING=_require$codes$1.ERR_TRANSFORM_ALREADY_TRANSFORMING,ERR_TRANSFORM_WITH_LENGTH_0=_require$codes$1.ERR_TRANSFORM_WITH_LENGTH_0,Duplex=require$$2;function afterTransform(e,t){var r=this._transformState;r.transforming=!1;var n=r.writecb;if(null===n)return this.emit("error",new ERR_MULTIPLE_CALLBACK);r.writechunk=null,r.writecb=null,null!=t&&this.push(t),n(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function Transform$1(e){if(!(this instanceof Transform$1))return new Transform$1(e);Duplex.call(this,e),this._transformState={afterTransform:afterTransform.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",prefinish)}function prefinish(){var e=this;"function"!=typeof this._flush||this._readableState.destroyed?done(this,null,null):this._flush((function(t,r){done(e,t,r)}))}function done(e,t,r){if(t)return e.emit("error",t);if(null!=r&&e.push(r),e._writableState.length)throw new ERR_TRANSFORM_WITH_LENGTH_0;if(e._transformState.transforming)throw new ERR_TRANSFORM_ALREADY_TRANSFORMING;return e.push(null)}require$$1$3(Transform$1,Duplex),Transform$1.prototype.push=function(e,t){return this._transformState.needTransform=!1,Duplex.prototype.push.call(this,e,t)},Transform$1.prototype._transform=function(e,t,r){r(new ERR_METHOD_NOT_IMPLEMENTED("_transform()"))},Transform$1.prototype._write=function(e,t,r){var n=this._transformState;if(n.writecb=r,n.writechunk=e,n.writeencoding=t,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},Transform$1.prototype._read=function(e){var t=this._transformState;null===t.writechunk||t.transforming?t.needTransform=!0:(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform))},Transform$1.prototype._destroy=function(e,t){Duplex.prototype._destroy.call(this,e,(function(e){t(e)}))};var _stream_passthrough=PassThrough,Transform=_stream_transform,eos;function PassThrough(e){if(!(this instanceof PassThrough))return new PassThrough(e);Transform.call(this,e)}function once(e){var t=!1;return function(){t||(t=!0,e.apply(void 0,arguments))}}require$$1$3(PassThrough,Transform),PassThrough.prototype._transform=function(e,t,r){r(null,e)};var _require$codes=errorsBrowser.codes,ERR_MISSING_ARGS=_require$codes.ERR_MISSING_ARGS,ERR_STREAM_DESTROYED=_require$codes.ERR_STREAM_DESTROYED;function noop$1(e){if(e)throw e}function isRequest(e){return e.setHeader&&"function"==typeof e.abort}function destroyer(e,t,r,n){n=once(n);var i=!1;e.on("close",(function(){i=!0})),void 0===eos&&(eos=endOfStream),eos(e,{readable:t,writable:r},(function(e){if(e)return n(e);i=!0,n()}));var s=!1;return function(t){if(!i&&!s)return s=!0,isRequest(e)?e.abort():"function"==typeof e.destroy?e.destroy():void n(t||new ERR_STREAM_DESTROYED("pipe"))}}function call(e){e()}function pipe$3(e,t){return e.pipe(t)}function popCallback(e){return e.length?"function"!=typeof e[e.length-1]?noop$1:e.pop():noop$1}function pipeline(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n,i=popCallback(t);if(Array.isArray(t[0])&&(t=t[0]),t.length<2)throw new ERR_MISSING_ARGS("streams");var s=t.map((function(e,r){var o=r<t.length-1;return destroyer(e,o,r>0,(function(e){n||(n=e),e&&s.forEach(call),o||(s.forEach(call),i(n))}))}));return t.reduce(pipe$3)}var pipeline_1=pipeline;
/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */
let promise;!function(e,t){(t=e.exports=require$$0$3).Stream=t,t.Readable=t,t.Writable=require$$1$2,t.Duplex=require$$2,t.Transform=_stream_transform,t.PassThrough=_stream_passthrough,t.finished=endOfStream,t.pipeline=pipeline_1}(readableBrowser,readableBrowser.exports),module.exports="function"==typeof queueMicrotask?queueMicrotask.bind("undefined"!=typeof window?window:global$1):e=>(promise||(promise=Promise.resolve())).then(e).catch((e=>setTimeout((()=>{throw e}),0)));var queueMicrotask$2=Object.freeze({__proto__:null}),require$$4=getAugmentedNamespace(queueMicrotask$2);function assign(e,t){for(const r in t)Object.defineProperty(e,r,{value:t[r],enumerable:!0,configurable:!0});return e}function createError(e,t,r){if(!e||"string"==typeof e)throw new TypeError("Please pass an Error to err-code");r||(r={}),"object"==typeof t&&(r=t,t=void 0),null!=t&&(r.code=t);try{return assign(e,r)}catch(t){r.message=e.message,r.stack=e.stack;const n=function(){};return n.prototype=Object.create(Object.getPrototypeOf(e)),assign(new n,r)}}var errCode$3=createError,debug$e=require$$0$b("simple-peer"),getBrowserRTC=getBrowserRtc,randombytes=require$$2$1,stream$2=readableBrowser.exports,queueMicrotask$1=require$$4,errCode$2=errCode$3,MAX_BUFFERED_AMOUNT=65536,ICECOMPLETE_TIMEOUT=5e3,CHANNEL_CLOSING_TIMEOUT=5e3;
/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */function filterTrickle(e){return e.replace(/a=ice-options:trickle\s\n/g,"")}function warn(e){console.warn(e)}class Peer extends stream$2.Duplex{constructor(e){if(super(e=Object.assign({allowHalfOpen:!1},e)),this._id=randombytes(4).toString("hex").slice(0,7),this._debug("new peer %o",e),this.channelName=e.initiator?e.channelName||randombytes(20).toString("hex"):null,this.initiator=e.initiator||!1,this.channelConfig=e.channelConfig||Peer.channelConfig,this.negotiated=this.channelConfig.negotiated,this.config=Object.assign({},Peer.config,e.config),this.offerOptions=e.offerOptions||{},this.answerOptions=e.answerOptions||{},this.sdpTransform=e.sdpTransform||(e=>e),this.streams=e.streams||(e.stream?[e.stream]:[]),this.trickle=void 0===e.trickle||e.trickle,this.allowHalfTrickle=void 0!==e.allowHalfTrickle&&e.allowHalfTrickle,this.iceCompleteTimeout=e.iceCompleteTimeout||ICECOMPLETE_TIMEOUT,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,this._wrtc=e.wrtc&&"object"==typeof e.wrtc?e.wrtc:getBrowserRTC(),!this._wrtc)throw"undefined"==typeof window?errCode$2(new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"),"ERR_WEBRTC_SUPPORT"):errCode$2(new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!this.negotiated&&!this.initiator,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._senderMap=new Map,this._firstStable=!0,this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new this._wrtc.RTCPeerConnection(this.config)}catch(e){return void queueMicrotask$1((()=>this.destroy(errCode$2(e,"ERR_PC_CONSTRUCTOR"))))}this._isReactNativeWebrtc="number"==typeof this._pc._peerConnectionId,this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=e=>{this._onIceCandidate(e)},this.initiator||this.negotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=e=>{this._setupData(e)},this.streams&&this.streams.forEach((e=>{this.addStream(e)})),this._pc.ontrack=e=>{this._onTrack(e)},this.initiator&&this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&"open"===this._channel.readyState}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(e){if(this.destroyed)throw errCode$2(new Error("cannot signal after peer is destroyed"),"ERR_SIGNALING");if("string"==typeof e)try{e=JSON.parse(e)}catch(t){e={}}this._debug("signal()"),e.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),e.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(e.transceiverRequest.kind,e.transceiverRequest.init)),e.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(e.candidate):this._pendingCandidates.push(e.candidate)),e.sdp&&this._pc.setRemoteDescription(new this._wrtc.RTCSessionDescription(e)).then((()=>{this.destroyed||(this._pendingCandidates.forEach((e=>{this._addIceCandidate(e)})),this._pendingCandidates=[],"offer"===this._pc.remoteDescription.type&&this._createAnswer())})).catch((e=>{this.destroy(errCode$2(e,"ERR_SET_REMOTE_DESCRIPTION"))})),e.sdp||e.candidate||e.renegotiate||e.transceiverRequest||this.destroy(errCode$2(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}_addIceCandidate(e){var t=new this._wrtc.RTCIceCandidate(e);this._pc.addIceCandidate(t).catch((e=>{!t.address||t.address.endsWith(".local")?warn("Ignoring unsupported ICE candidate."):this.destroy(errCode$2(e,"ERR_ADD_ICE_CANDIDATE"))}))}send(e){this._channel.send(e)}addTransceiver(e,t){if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(e,t),this._needsNegotiation()}catch(e){this.destroy(errCode$2(e,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{transceiverRequest:{kind:e,init:t}})}addStream(e){this._debug("addStream()"),e.getTracks().forEach((t=>{this.addTrack(t,e)}))}addTrack(e,t){this._debug("addTrack()");var r=this._senderMap.get(e)||new Map,n=r.get(t);if(n)throw n.removed?errCode$2(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):errCode$2(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED");n=this._pc.addTrack(e,t),r.set(t,n),this._senderMap.set(e,r),this._needsNegotiation()}replaceTrack(e,t,r){this._debug("replaceTrack()");var n=this._senderMap.get(e),i=n?n.get(r):null;if(!i)throw errCode$2(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");t&&this._senderMap.set(t,n),null!=i.replaceTrack?i.replaceTrack(t):this.destroy(errCode$2(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK"))}removeTrack(e,t){this._debug("removeSender()");var r=this._senderMap.get(e),n=r?r.get(t):null;if(!n)throw errCode$2(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{n.removed=!0,this._pc.removeTrack(n)}catch(e){"NS_ERROR_UNEXPECTED"===e.name?this._sendersAwaitingStable.push(n):this.destroy(errCode$2(e,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(e){this._debug("removeSenders()"),e.getTracks().forEach((t=>{this.removeTrack(t,e)}))}_needsNegotiation(){this._debug("_needsNegotiation"),this._batchedNegotiation||(this._batchedNegotiation=!0,queueMicrotask$1((()=>{this._batchedNegotiation=!1,this._debug("starting batched negotiation"),this.negotiate()})))}negotiate(){this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout((()=>{this._createOffer()}),0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{renegotiate:!0})),this._isNegotiating=!0}_destroy(e,t){if(this._debug("destroy (error: %s)",e&&(e.message||e)),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch(e){}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch(e){}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,t(e)}_setupData(e){if(!e.channel)return this.destroy(errCode$2(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=e.channel,this._channel.binaryType="arraybuffer","number"==typeof this._channel.bufferedAmountLowThreshold&&(this._channel.bufferedAmountLowThreshold=MAX_BUFFERED_AMOUNT),this.channelName=this._channel.label,this._channel.onmessage=e=>{this._onChannelMessage(e)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=e=>{this.destroy(errCode$2(e,"ERR_DATA_CHANNEL"))};var t=!1;this._closingInterval=setInterval((()=>{this._channel&&"closing"===this._channel.readyState?(t&&this._onChannelClose(),t=!0):t=!1}),CHANNEL_CLOSING_TIMEOUT)}_read(){}_write(e,t,r){if(this.destroyed)return r(errCode$2(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(e)}catch(e){return this.destroy(errCode$2(e,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>MAX_BUFFERED_AMOUNT?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=r):r(null)}else this._debug("write before connect"),this._chunk=e,this._cb=r}_onFinish(){if(this.destroyed)return;const e=()=>{setTimeout((()=>this.destroy()),1e3)};this._connected?e():this.once("connect",e)}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout((()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))}),this.iceCompleteTimeout))}_createOffer(){this.destroyed||this._pc.createOffer(this.offerOptions).then((e=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(e.sdp=filterTrickle(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const t=()=>{if(!this.destroyed){var t=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:t.type,sdp:t.sdp})}};this._pc.setLocalDescription(e).then((()=>{this._debug("createOffer success"),this.destroyed||(this.trickle||this._iceComplete?t():this.once("_iceComplete",t))})).catch((e=>{this.destroy(errCode$2(e,"ERR_SET_LOCAL_DESCRIPTION"))}))})).catch((e=>{this.destroy(errCode$2(e,"ERR_CREATE_OFFER"))}))}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach((e=>{e.mid||!e.sender.track||e.requested||(e.requested=!0,this.addTransceiver(e.sender.track.kind))}))}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then((e=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(e.sdp=filterTrickle(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const t=()=>{if(!this.destroyed){var t=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:t.type,sdp:t.sdp}),this.initiator||this._requestMissingTransceivers()}};this._pc.setLocalDescription(e).then((()=>{this.destroyed||(this.trickle||this._iceComplete?t():this.once("_iceComplete",t))})).catch((e=>{this.destroy(errCode$2(e,"ERR_SET_LOCAL_DESCRIPTION"))}))})).catch((e=>{this.destroy(errCode$2(e,"ERR_CREATE_ANSWER"))}))}_onConnectionStateChange(){this.destroyed||"failed"===this._pc.connectionState&&this.destroy(errCode$2(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(!this.destroyed){var e=this._pc.iceConnectionState,t=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",e,t),this.emit("iceStateChange",e,t),"connected"!==e&&"completed"!==e||(this._pcReady=!0,this._maybeReady()),"failed"===e&&this.destroy(errCode$2(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),"closed"===e&&this.destroy(errCode$2(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}}getStats(e){const t=e=>("[object Array]"===Object.prototype.toString.call(e.values)&&e.values.forEach((t=>{Object.assign(e,t)})),e);0===this._pc.getStats.length||this._isReactNativeWebrtc?this._pc.getStats().then((r=>{var n=[];r.forEach((e=>{n.push(t(e))})),e(null,n)}),(t=>e(t))):this._pc.getStats.length>0?this._pc.getStats((r=>{if(!this.destroyed){var n=[];r.result().forEach((e=>{var r={};e.names().forEach((t=>{r[t]=e.stat(t)})),r.id=e.id,r.type=e.type,r.timestamp=e.timestamp,n.push(t(r))})),e(null,n)}}),(t=>e(t))):e(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const e=()=>{this.destroyed||this.getStats(((t,r)=>{if(this.destroyed)return;t&&(r=[]);var n={},i={},s={},o=!1;r.forEach((e=>{"remotecandidate"!==e.type&&"remote-candidate"!==e.type||(n[e.id]=e),"localcandidate"!==e.type&&"local-candidate"!==e.type||(i[e.id]=e),"candidatepair"!==e.type&&"candidate-pair"!==e.type||(s[e.id]=e)}));const a=e=>{o=!0;var t=i[e.localCandidateId];t&&(t.ip||t.address)?(this.localAddress=t.ip||t.address,this.localPort=Number(t.port)):t&&t.ipAddress?(this.localAddress=t.ipAddress,this.localPort=Number(t.portNumber)):"string"==typeof e.googLocalAddress&&(t=e.googLocalAddress.split(":"),this.localAddress=t[0],this.localPort=Number(t[1])),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");var r=n[e.remoteCandidateId];r&&(r.ip||r.address)?(this.remoteAddress=r.ip||r.address,this.remotePort=Number(r.port)):r&&r.ipAddress?(this.remoteAddress=r.ipAddress,this.remotePort=Number(r.portNumber)):"string"==typeof e.googRemoteAddress&&(r=e.googRemoteAddress.split(":"),this.remoteAddress=r[0],this.remotePort=Number(r[1])),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(r.forEach((e=>{"transport"===e.type&&e.selectedCandidatePairId&&a(s[e.selectedCandidatePairId]),("googCandidatePair"===e.type&&"true"===e.googActiveConnection||("candidatepair"===e.type||"candidate-pair"===e.type)&&e.selected)&&a(e)})),o||Object.keys(s).length&&!Object.keys(i).length){if(this._connecting=!1,this._connected=!0,this._chunk){try{this.send(this._chunk)}catch(t){return this.destroy(errCode$2(t,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');var u=this._cb;this._cb=null,u(null)}"number"!=typeof this._channel.bufferedAmountLowThreshold&&(this._interval=setInterval((()=>this._onInterval()),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")}else setTimeout(e,100)}))};e()}_onInterval(){!this._cb||!this._channel||this._channel.bufferedAmount>MAX_BUFFERED_AMOUNT||this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||("stable"!==this._pc.signalingState||this._firstStable||(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach((e=>{this._pc.removeTrack(e),this._queuedNegotiation=!0})),this._sendersAwaitingStable=[],this._queuedNegotiation&&(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()),this._debug("negotiate"),this.emit("negotiate")),this._firstStable=!1,this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(e){this.destroyed||(e.candidate&&this.trickle?this.emit("signal",{candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}}):e.candidate||this._iceComplete||(this._iceComplete=!0,this.emit("_iceComplete")),e.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(e){if(!this.destroyed){var t=e.data;t instanceof ArrayBuffer&&(t=new Uint8Array(t)),this.push(t)}}_onChannelBufferedAmountLow(){if(!this.destroyed&&this._cb){this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);var e=this._cb;this._cb=null,e(null)}}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.destroy())}_onTrack(e){this.destroyed||e.streams.forEach((t=>{this._debug("on track"),this.emit("track",e.track,t),this._remoteTracks.push({track:e.track,stream:t}),this._remoteStreams.some((e=>e.id===t.id))||(this._remoteStreams.push(t),queueMicrotask$1((()=>{this.emit("stream",t)})))}))}_debug(){var e=[].slice.call(arguments);e[0]="["+this._id+"] "+e[0],debug$e.apply(null,e)}}Peer.WEBRTC_SUPPORT=!!getBrowserRTC(),Peer.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"},Peer.channelConfig={};var libp2pWebrtcPeer=Peer,supports={supportsFileReader:"undefined"!=typeof self&&"FileReader"in self,supportsWebRTC:"RTCPeerConnection"in globalThis&&"undefined"!=typeof navigator&&void 0!==navigator.mediaDevices&&"getUserMedia"in navigator.mediaDevices,supportsWebRTCDataChannels:"RTCPeerConnection"in globalThis},src$a={exports:{}},$protobuf$7=minimal,$Reader$7=$protobuf$7.Reader,$Writer$7=$protobuf$7.Writer,$util$7=$protobuf$7.util,$root$7=$protobuf$7.roots["libp2p-crypto-keys"]||($protobuf$7.roots["libp2p-crypto-keys"]={});$root$7.KeyType=function(){var e={},t=Object.create(e);return t[e[0]="RSA"]=0,t[e[1]="Ed25519"]=1,t[e[2]="Secp256k1"]=2,t}(),$root$7.PublicKey=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.Type=0,e.prototype.Data=$util$7.newBuffer([]),e.encode=function(e,t){return t||(t=$Writer$7.create()),t.uint32(8).int32(e.Type),t.uint32(18).bytes(e.Data),t},e.decode=function(e,t){e instanceof $Reader$7||(e=$Reader$7.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root$7.PublicKey;e.pos<r;){var i=e.uint32();switch(i>>>3){case 1:n.Type=e.int32();break;case 2:n.Data=e.bytes();break;default:e.skipType(7&i)}}if(!n.hasOwnProperty("Type"))throw $util$7.ProtocolError("missing required 'Type'",{instance:n});if(!n.hasOwnProperty("Data"))throw $util$7.ProtocolError("missing required 'Data'",{instance:n});return n},e.fromObject=function(e){if(e instanceof $root$7.PublicKey)return e;var t=new $root$7.PublicKey;switch(e.Type){case"RSA":case 0:t.Type=0;break;case"Ed25519":case 1:t.Type=1;break;case"Secp256k1":case 2:t.Type=2}return null!=e.Data&&("string"==typeof e.Data?$util$7.base64.decode(e.Data,t.Data=$util$7.newBuffer($util$7.base64.length(e.Data)),0):e.Data.length&&(t.Data=e.Data)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.Type=t.enums===String?"RSA":0,t.bytes===String?r.Data="":(r.Data=[],t.bytes!==Array&&(r.Data=$util$7.newBuffer(r.Data)))),null!=e.Type&&e.hasOwnProperty("Type")&&(r.Type=t.enums===String?$root$7.KeyType[e.Type]:e.Type),null!=e.Data&&e.hasOwnProperty("Data")&&(r.Data=t.bytes===String?$util$7.base64.encode(e.Data,0,e.Data.length):t.bytes===Array?Array.prototype.slice.call(e.Data):e.Data),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf$7.util.toJSONOptions)},e}(),$root$7.PrivateKey=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.Type=0,e.prototype.Data=$util$7.newBuffer([]),e.encode=function(e,t){return t||(t=$Writer$7.create()),t.uint32(8).int32(e.Type),t.uint32(18).bytes(e.Data),t},e.decode=function(e,t){e instanceof $Reader$7||(e=$Reader$7.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root$7.PrivateKey;e.pos<r;){var i=e.uint32();switch(i>>>3){case 1:n.Type=e.int32();break;case 2:n.Data=e.bytes();break;default:e.skipType(7&i)}}if(!n.hasOwnProperty("Type"))throw $util$7.ProtocolError("missing required 'Type'",{instance:n});if(!n.hasOwnProperty("Data"))throw $util$7.ProtocolError("missing required 'Data'",{instance:n});return n},e.fromObject=function(e){if(e instanceof $root$7.PrivateKey)return e;var t=new $root$7.PrivateKey;switch(e.Type){case"RSA":case 0:t.Type=0;break;case"Ed25519":case 1:t.Type=1;break;case"Secp256k1":case 2:t.Type=2}return null!=e.Data&&("string"==typeof e.Data?$util$7.base64.decode(e.Data,t.Data=$util$7.newBuffer($util$7.base64.length(e.Data)),0):e.Data.length&&(t.Data=e.Data)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.Type=t.enums===String?"RSA":0,t.bytes===String?r.Data="":(r.Data=[],t.bytes!==Array&&(r.Data=$util$7.newBuffer(r.Data)))),null!=e.Type&&e.hasOwnProperty("Type")&&(r.Type=t.enums===String?$root$7.KeyType[e.Type]:e.Type),null!=e.Data&&e.hasOwnProperty("Data")&&(r.Data=t.bytes===String?$util$7.base64.encode(e.Data,0,e.Data.length):t.bytes===Array?Array.prototype.slice.call(e.Data):e.Data),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf$7.util.toJSONOptions)},e}();var keys$8=$root$7,webcrypto$j={get:(e=globalThis)=>{const t=e.crypto;if(!t||!t.subtle)throw Object.assign(new Error("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p-crypto/blob/master/README.md#web-crypto-api"),{code:"ERR_MISSING_WEB_CRYPTO"});return t}};const{concat:concat$3}=require$$2$2,{fromString:fromString$3}=require$$3$1,webcrypto$i=webcrypto$j;function create$3({algorithm:e="AES-GCM",nonceLength:t=12,keyLength:r=16,digest:n="SHA-256",saltLength:i=16,iterations:s=32767}={}){const o=webcrypto$i.get();return r*=8,{encrypt:async function(a,u){const c=o.getRandomValues(new Uint8Array(i)),l=o.getRandomValues(new Uint8Array(t)),h={name:e,iv:l},d={name:"PBKDF2",salt:c,iterations:s,hash:{name:n}},f=await o.subtle.importKey("raw",fromString$3(u),{name:"PBKDF2"},!1,["deriveKey","deriveBits"]),p=await o.subtle.deriveKey(d,f,{name:e,length:r},!0,["encrypt"]),y=await o.subtle.encrypt(h,p,a);return concat$3([c,h.iv,new Uint8Array(y)])},decrypt:async function(a,u){const c=a.slice(0,i),l=a.slice(i,i+t),h=a.slice(i+t),d={name:e,iv:l},f={name:"PBKDF2",salt:c,iterations:s,hash:{name:n}},p=await o.subtle.importKey("raw",fromString$3(u),{name:"PBKDF2"},!1,["deriveKey","deriveBits"]),y=await o.subtle.deriveKey(f,p,{name:e,length:r},!0,["decrypt"]),g=await o.subtle.decrypt(d,y,h);return new Uint8Array(g)}}}var aesGcm_browser$3={create:create$3};const{base64:base64$7}=require$$4$5,ciphers$8=aesGcm_browser$3;var importer$7={import:async function(e,t){const r=base64$7.decode(e),n=ciphers$8.create();return await n.decrypt(r,t)}},rsaBrowser$3={};const randomBytes$8=random_browser,errcode$C=errCode$m;var randomBytes_1$3=function(e){if(isNaN(e)||e<=0)throw errcode$C(new Error("random bytes length must be a Number bigger than 0"),"ERR_INVALID_LENGTH");return randomBytes$8(e)},rsaUtils$3={},util$4={};!function(e){const t=forge$X,{fromString:r}=require$$3$1,{toString:n}=require$$1$5,{concat:i}=require$$2$2;e.bigIntegerToUintBase64url=(e,t)=>{let r=Uint8Array.from(e.abs().toByteArray());if(r=0===r[0]?r.slice(1):r,null!=t){if(r.length>t)throw new Error("byte array longer than desired length");r=i([new Uint8Array(t-r.length),r])}return n(r,"base64url")},e.base64urlToBigInteger=r=>{const i=e.base64urlToBuffer(r);return new t.jsbn.BigInteger(n(i,"base16"),16)},e.base64urlToBuffer=(e,t)=>{let n=r(e,"base64urlpad");if(null!=t){if(n.length>t)throw new Error("byte array longer than desired length");n=i([new Uint8Array(t-n.length),n])}return n}}(util$4);const forge$j=forge$X,{bigIntegerToUintBase64url:bigIntegerToUintBase64url$3,base64urlToBigInteger:base64urlToBigInteger$7}=util$4,{fromString:uint8ArrayFromString$i}=require$$3$1,{toString:uint8ArrayToString$l}=require$$1$5;rsaUtils$3.pkcs1ToJwk=function(e){const t=forge$j.asn1.fromDer(uint8ArrayToString$l(e,"ascii")),r=forge$j.pki.privateKeyFromAsn1(t);return{kty:"RSA",n:bigIntegerToUintBase64url$3(r.n),e:bigIntegerToUintBase64url$3(r.e),d:bigIntegerToUintBase64url$3(r.d),p:bigIntegerToUintBase64url$3(r.p),q:bigIntegerToUintBase64url$3(r.q),dp:bigIntegerToUintBase64url$3(r.dP),dq:bigIntegerToUintBase64url$3(r.dQ),qi:bigIntegerToUintBase64url$3(r.qInv),alg:"RS256",kid:"2011-04-29"}},rsaUtils$3.jwkToPkcs1=function(e){const t=forge$j.pki.privateKeyToAsn1({n:base64urlToBigInteger$7(e.n),e:base64urlToBigInteger$7(e.e),d:base64urlToBigInteger$7(e.d),p:base64urlToBigInteger$7(e.p),q:base64urlToBigInteger$7(e.q),dP:base64urlToBigInteger$7(e.dp),dQ:base64urlToBigInteger$7(e.dq),qInv:base64urlToBigInteger$7(e.qi)});return uint8ArrayFromString$i(forge$j.asn1.toDer(t).getBytes(),"ascii")},rsaUtils$3.pkixToJwk=function(e){const t=forge$j.asn1.fromDer(uint8ArrayToString$l(e,"ascii")),r=forge$j.pki.publicKeyFromAsn1(t);return{kty:"RSA",n:bigIntegerToUintBase64url$3(r.n),e:bigIntegerToUintBase64url$3(r.e),alg:"RS256",kid:"2011-04-29"}},rsaUtils$3.jwkToPkix=function(e){const t=forge$j.pki.publicKeyToAsn1({n:base64urlToBigInteger$7(e.n),e:base64urlToBigInteger$7(e.e)});return uint8ArrayFromString$i(forge$j.asn1.toDer(t).getBytes(),"ascii")};const forge$i=forge$X,{base64urlToBigInteger:base64urlToBigInteger$6}=util$4;function convert$3(e,t){return t.map((t=>base64urlToBigInteger$6(e[t])))}function jwk2priv$7(e){return forge$i.pki.setRsaPrivateKey(...convert$3(e,["n","e","d","p","q","dp","dq","qi"]))}function jwk2pub$7(e){return forge$i.pki.setRsaPublicKey(...convert$3(e,["n","e"]))}var jwk2pem$3={jwk2pub:jwk2pub$7,jwk2priv:jwk2priv$7};const webcrypto$h=webcrypto$j,randomBytes$7=randomBytes_1$3,{toString:uint8ArrayToString$k}=require$$1$5,{fromString:uint8ArrayFromString$h}=require$$3$1;function exportKey$3(e){return Promise.all([webcrypto$h.get().subtle.exportKey("jwk",e.privateKey),webcrypto$h.get().subtle.exportKey("jwk",e.publicKey)])}function derivePublicFromPrivate$3(e){return webcrypto$h.get().subtle.importKey("jwk",{kty:e.kty,n:e.n,e:e.e},{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])}rsaBrowser$3.utils=rsaUtils$3,rsaBrowser$3.generateKey=async function(e){const t=await webcrypto$h.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),r=await exportKey$3(t);return{privateKey:r[0],publicKey:r[1]}},rsaBrowser$3.unmarshalPrivateKey=async function(e){const t=[await webcrypto$h.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),await derivePublicFromPrivate$3(e)],r=await exportKey$3({privateKey:t[0],publicKey:t[1]});return{privateKey:r[0],publicKey:r[1]}},rsaBrowser$3.getRandomValues=randomBytes$7,rsaBrowser$3.hashAndSign=async function(e,t){const r=await webcrypto$h.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),n=await webcrypto$h.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},r,Uint8Array.from(t));return new Uint8Array(n,n.byteOffset,n.byteLength)},rsaBrowser$3.hashAndVerify=async function(e,t,r){const n=await webcrypto$h.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return webcrypto$h.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},n,t,r)};const{jwk2pub:jwk2pub$6,jwk2priv:jwk2priv$6}=jwk2pem$3;function convertKey$3(e,t,r,n){const i=t?jwk2pub$6(e):jwk2priv$6(e),s=n(uint8ArrayToString$k(Uint8Array.from(r),"ascii"),i);return uint8ArrayFromString$h(s,"ascii")}rsaBrowser$3.encrypt=function(e,t){return convertKey$3(e,!0,t,((e,t)=>t.encrypt(e)))},rsaBrowser$3.decrypt=function(e,t){return convertKey$3(e,!1,t,((e,t)=>t.decrypt(e)))};const{base64:base64$6}=require$$4$5,ciphers$7=aesGcm_browser$3;var exporter$f={export:async function(e,t){const r=ciphers$7.create(),n=await r.encrypt(e,t);return base64$6.encode(n)}};const{sha256:sha256$h}=require$$4$3,errcode$B=errCode$m,{equals:uint8ArrayEquals$f}=require$$10$1,{toString:uint8ArrayToString$j}=require$$1$5,forge$h=forge$X,crypto$a=rsaBrowser$3,pbm$7=keys$8,exporter$e=exporter$f;class RsaPublicKey$3{constructor(e){this._key=e}async verify(e,t){return crypto$a.hashAndVerify(this._key,t,e)}marshal(){return crypto$a.utils.jwkToPkix(this._key)}get bytes(){return pbm$7.PublicKey.encode({Type:pbm$7.KeyType.RSA,Data:this.marshal()}).finish()}encrypt(e){return crypto$a.encrypt(this._key,e)}equals(e){return uint8ArrayEquals$f(this.bytes,e.bytes)}async hash(){const{bytes:e}=await sha256$h.digest(this.bytes);return e}}class RsaPrivateKey$3{constructor(e,t){this._key=e,this._publicKey=t}genSecret(){return crypto$a.getRandomValues(16)}async sign(e){return crypto$a.hashAndSign(this._key,e)}get public(){if(!this._publicKey)throw errcode$B(new Error("public key not provided"),"ERR_PUBKEY_NOT_PROVIDED");return new RsaPublicKey$3(this._publicKey)}decrypt(e){return crypto$a.decrypt(this._key,e)}marshal(){return crypto$a.utils.jwkToPkcs1(this._key)}get bytes(){return pbm$7.PrivateKey.encode({Type:pbm$7.KeyType.RSA,Data:this.marshal()}).finish()}equals(e){return uint8ArrayEquals$f(this.bytes,e.bytes)}async hash(){const{bytes:e}=await sha256$h.digest(this.bytes);return e}async id(){const e=await this.public.hash();return uint8ArrayToString$j(e,"base58btc")}async export(e,t="pkcs-8"){if("pkcs-8"===t){const t=new forge$h.util.ByteBuffer(this.marshal()),r=forge$h.asn1.fromDer(t),n=forge$h.pki.privateKeyFromAsn1(r),i={algorithm:"aes256",count:1e4,saltSize:16,prfAlgorithm:"sha512"};return forge$h.pki.encryptRsaPrivateKey(n,e,i)}if("libp2p-key"===t)return exporter$e.export(this.bytes,e);throw errcode$B(new Error(`export format '${t}' is not supported`),"ERR_INVALID_EXPORT_FORMAT")}}async function unmarshalRsaPrivateKey$3(e){const t=crypto$a.utils.pkcs1ToJwk(e),r=await crypto$a.unmarshalPrivateKey(t);return new RsaPrivateKey$3(r.privateKey,r.publicKey)}function unmarshalRsaPublicKey$3(e){const t=crypto$a.utils.pkixToJwk(e);return new RsaPublicKey$3(t)}async function fromJwk$3(e){const t=await crypto$a.unmarshalPrivateKey(e);return new RsaPrivateKey$3(t.privateKey,t.publicKey)}async function generateKeyPair$b(e){const t=await crypto$a.generateKey(e);return new RsaPrivateKey$3(t.privateKey,t.publicKey)}var rsaClass$3={RsaPublicKey:RsaPublicKey$3,RsaPrivateKey:RsaPrivateKey$3,unmarshalRsaPublicKey:unmarshalRsaPublicKey$3,unmarshalRsaPrivateKey:unmarshalRsaPrivateKey$3,generateKeyPair:generateKeyPair$b,fromJwk:fromJwk$3},ed25519$4={};!function(e){const t=ed25519$6.exports;function r(t,r){const n=new Uint8Array(e.privateKeyLength);for(let e=0;e<32;e++)n[e]=t[e],n[32+e]=r[e];return n}e.publicKeyLength=32,e.privateKeyLength=64,e.generateKey=async function(){const e=t.utils.randomPrivateKey(),n=await t.getPublicKey(e);return{privateKey:r(e,n),publicKey:n}},e.generateKeyFromSeed=async function(e){if(32!==e.length)throw new TypeError('"seed" must be 32 bytes in length.');if(!(e instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, or Uint8Array.');const n=e,i=await t.getPublicKey(n);return{privateKey:r(n,i),publicKey:i}},e.hashAndSign=function(e,r){const n=e.slice(0,32);return t.sign(r,n)},e.hashAndVerify=function(e,r,n){return t.verify(r,n,e)}}(ed25519$4);const errcode$A=errCode$m,{equals:uint8ArrayEquals$e}=require$$10$1,{sha256:sha256$g}=require$$4$3,{base58btc:base58btc$3}=require$$3$2,{identity:identity$3}=require$$13,crypto$9=ed25519$4,pbm$6=keys$8,exporter$d=exporter$f;class Ed25519PublicKey$3{constructor(e){this._key=ensureKey$3(e,crypto$9.publicKeyLength)}async verify(e,t){return crypto$9.hashAndVerify(this._key,t,e)}marshal(){return this._key}get bytes(){return pbm$6.PublicKey.encode({Type:pbm$6.KeyType.Ed25519,Data:this.marshal()}).finish()}equals(e){return uint8ArrayEquals$e(this.bytes,e.bytes)}async hash(){const{bytes:e}=await sha256$g.digest(this.bytes);return e}}class Ed25519PrivateKey$3{constructor(e,t){this._key=ensureKey$3(e,crypto$9.privateKeyLength),this._publicKey=ensureKey$3(t,crypto$9.publicKeyLength)}async sign(e){return crypto$9.hashAndSign(this._key,e)}get public(){return new Ed25519PublicKey$3(this._publicKey)}marshal(){return this._key}get bytes(){return pbm$6.PrivateKey.encode({Type:pbm$6.KeyType.Ed25519,Data:this.marshal()}).finish()}equals(e){return uint8ArrayEquals$e(this.bytes,e.bytes)}async hash(){const{bytes:e}=await sha256$g.digest(this.bytes);return e}async id(){const e=await identity$3.digest(this.public.bytes);return base58btc$3.encode(e.bytes).substring(1)}async export(e,t="libp2p-key"){if("libp2p-key"===t)return exporter$d.export(this.bytes,e);throw errcode$A(new Error(`export format '${t}' is not supported`),"ERR_INVALID_EXPORT_FORMAT")}}function unmarshalEd25519PrivateKey$3(e){if(e.length>crypto$9.privateKeyLength){const t=(e=ensureKey$3(e,crypto$9.privateKeyLength+crypto$9.publicKeyLength)).slice(0,crypto$9.privateKeyLength),r=e.slice(crypto$9.privateKeyLength,e.length);return new Ed25519PrivateKey$3(t,r)}const t=(e=ensureKey$3(e,crypto$9.privateKeyLength)).slice(0,crypto$9.privateKeyLength),r=e.slice(crypto$9.publicKeyLength);return new Ed25519PrivateKey$3(t,r)}function unmarshalEd25519PublicKey$3(e){return e=ensureKey$3(e,crypto$9.publicKeyLength),new Ed25519PublicKey$3(e)}async function generateKeyPair$a(){const{privateKey:e,publicKey:t}=await crypto$9.generateKey();return new Ed25519PrivateKey$3(e,t)}async function generateKeyPairFromSeed$7(e){const{privateKey:t,publicKey:r}=await crypto$9.generateKeyFromSeed(e);return new Ed25519PrivateKey$3(t,r)}function ensureKey$3(e,t){if((e=Uint8Array.from(e||[])).length!==t)throw errcode$A(new Error(`Key must be a Uint8Array of length ${t}, got ${e.length}`),"ERR_INVALID_KEY_TYPE");return e}var ed25519Class$3={Ed25519PublicKey:Ed25519PublicKey$3,Ed25519PrivateKey:Ed25519PrivateKey$3,unmarshalEd25519PrivateKey:unmarshalEd25519PrivateKey$3,unmarshalEd25519PublicKey:unmarshalEd25519PublicKey$3,generateKeyPair:generateKeyPair$a,generateKeyPairFromSeed:generateKeyPairFromSeed$7};const errcode$z=errCode$m,secp$2=secp256k1$6.exports,{sha256:sha256$f}=require$$4$3;var secp256k1$3=()=>({generateKey:function(){return secp$2.utils.randomPrivateKey()},privateKeyLength:32,hashAndSign:async function(e,t){const{digest:r}=await sha256$f.digest(t);try{return await secp$2.sign(r,e)}catch(e){throw errcode$z(e,"ERR_INVALID_INPUT")}},hashAndVerify:async function(e,t,r){try{const{digest:n}=await sha256$f.digest(r);return secp$2.verify(t,n,e)}catch(e){throw errcode$z(e,"ERR_INVALID_INPUT")}},compressPublicKey:function(e){return secp$2.Point.fromHex(e).toRawBytes(!0)},decompressPublicKey:function(e){return secp$2.Point.fromHex(e).toRawBytes(!1)},validatePrivateKey:function(e){try{secp$2.getPublicKey(e,!0)}catch(e){throw errcode$z(e,"ERR_INVALID_PRIVATE_KEY")}},validatePublicKey:function(e){try{secp$2.Point.fromHex(e)}catch(e){throw errcode$z(e,"ERR_INVALID_PUBLIC_KEY")}},computePublicKey:function(e){try{return secp$2.getPublicKey(e,!0)}catch(e){throw errcode$z(e,"ERR_INVALID_PRIVATE_KEY")}}});const{sha256:sha256$e}=require$$4$3,errcode$y=errCode$m,{equals:uint8ArrayEquals$d}=require$$10$1,{toString:uint8ArrayToString$i}=require$$1$5,exporter$c=exporter$f;var secp256k1Class$3=(e,t,r)=>{r=r||secp256k1$3();class n{constructor(e){r.validatePublicKey(e),this._key=e}verify(e,t){return r.hashAndVerify(this._key,t,e)}marshal(){return r.compressPublicKey(this._key)}get bytes(){return e.PublicKey.encode({Type:e.KeyType.Secp256k1,Data:this.marshal()}).finish()}equals(e){return uint8ArrayEquals$d(this.bytes,e.bytes)}async hash(){const{bytes:e}=await sha256$e.digest(this.bytes);return e}}class i{constructor(e,t){this._key=e,this._publicKey=t||r.computePublicKey(e),r.validatePrivateKey(this._key),r.validatePublicKey(this._publicKey)}sign(e){return r.hashAndSign(this._key,e)}get public(){return new n(this._publicKey)}marshal(){return this._key}get bytes(){return e.PrivateKey.encode({Type:e.KeyType.Secp256k1,Data:this.marshal()}).finish()}equals(e){return uint8ArrayEquals$d(this.bytes,e.bytes)}async hash(){const{bytes:e}=await sha256$e.digest(this.bytes);return e}async id(){const e=await this.public.hash();return uint8ArrayToString$i(e,"base58btc")}async export(e,t="libp2p-key"){if("libp2p-key"===t)return exporter$c.export(this.bytes,e);throw errcode$y(new Error(`export format '${t}' is not supported`),"ERR_INVALID_EXPORT_FORMAT")}}return{Secp256k1PublicKey:n,Secp256k1PrivateKey:i,unmarshalSecp256k1PrivateKey:function(e){return new i(e)},unmarshalSecp256k1PublicKey:function(e){return new n(e)},generateKeyPair:async function(){const e=await r.generateKey();return new i(e)}}},indexBrowser$3={},lengths$7={SHA1:20,SHA256:32,SHA512:64};const webcrypto$g=webcrypto$j,lengths$6=lengths$7,hashTypes$3={SHA1:"SHA-1",SHA256:"SHA-256",SHA512:"SHA-512"},sign$4=async(e,t)=>{const r=await webcrypto$g.get().subtle.sign({name:"HMAC"},e,t);return new Uint8Array(r,r.byteOffset,r.byteLength)};indexBrowser$3.create=async function(e,t){const r=hashTypes$3[e],n=await webcrypto$g.get().subtle.importKey("raw",t,{name:"HMAC",hash:{name:r}},!1,["sign"]);return{digest:async e=>sign$4(n,e),length:lengths$6[e]}};const errcode$x=errCode$m,{concat:uint8ArrayConcat$8}=require$$2$2,{fromString:uint8ArrayFromString$g}=require$$3$1,hmac$7=indexBrowser$3,cipherMap$3={"AES-128":{ivSize:16,keySize:16},"AES-256":{ivSize:16,keySize:32},Blowfish:{ivSize:8,cipherKeySize:32}};var keyStretcher$3=async(e,t,r)=>{const n=cipherMap$3[e];if(!n){const t=Object.keys(cipherMap$3).join(" / ");throw errcode$x(new Error(`unknown cipher type '${e}'. Must be ${t}`),"ERR_INVALID_CIPHER_TYPE")}if(!t)throw errcode$x(new Error("missing hash type"),"ERR_MISSING_HASH_TYPE");const i=n.keySize,s=n.ivSize,o=uint8ArrayFromString$g("key expansion"),a=2*(s+i+20),u=await hmac$7.create(t,r);let c=await u.digest(o);const l=[];let h=0;for(;h<a;){const e=await u.digest(uint8ArrayConcat$8([c,o]));let t=e.length;h+t>a&&(t=a-h),l.push(e),h+=t,c=await u.digest(c)}const d=a/2,f=uint8ArrayConcat$8(l),p=f.slice(0,d),y=f.slice(d,a),g=e=>({iv:e.slice(0,s),cipherKey:e.slice(s,s+i),macKey:e.slice(s+i)});return{k1:g(p),k2:g(y)}},ecdhBrowser$3={};const errcode$w=errCode$m;var validateCurveType$7=function(e,t){if(!e.includes(t)){const r=e.join(" / ");throw errcode$w(new Error(`Unknown curve: ${t}. Must be ${r}`),"ERR_INVALID_CURVE")}};const errcode$v=errCode$m,webcrypto$f=webcrypto$j,{base64urlToBuffer:base64urlToBuffer$3}=util$4,validateCurveType$6=validateCurveType$7,{toString:uint8ArrayToString$h}=require$$1$5,{concat:uint8ArrayConcat$7}=require$$2$2,{equals:uint8ArrayEquals$c}=require$$10$1,bits$3={"P-256":256,"P-384":384,"P-521":521};ecdhBrowser$3.generateEphmeralKeyPair=async function(e){validateCurveType$6(Object.keys(bits$3),e);const t=await webcrypto$f.get().subtle.generateKey({name:"ECDH",namedCurve:e},!0,["deriveBits"]);return{key:marshalPublicKey$7(await webcrypto$f.get().subtle.exportKey("jwk",t.publicKey)),genSharedKey:async(r,n)=>{let i;i=n?await webcrypto$f.get().subtle.importKey("jwk",unmarshalPrivateKey$7(e,n),{name:"ECDH",namedCurve:e},!1,["deriveBits"]):t.privateKey;const s=[await webcrypto$f.get().subtle.importKey("jwk",unmarshalPublicKey$7(e,r),{name:"ECDH",namedCurve:e},!1,[]),i],o=await webcrypto$f.get().subtle.deriveBits({name:"ECDH",namedCurve:e,public:s[0]},s[1],bits$3[e]);return new Uint8Array(o,o.byteOffset,o.byteLength)}}};const curveLengths$3={"P-256":32,"P-384":48,"P-521":66};function marshalPublicKey$7(e){const t=curveLengths$3[e.crv];return uint8ArrayConcat$7([Uint8Array.from([4]),base64urlToBuffer$3(e.x,t),base64urlToBuffer$3(e.y,t)],1+2*t)}function unmarshalPublicKey$7(e,t){const r=curveLengths$3[e];if(uint8ArrayEquals$c(!t.slice(0,1),Uint8Array.from([4])))throw errcode$v(new Error("Cannot unmarshal public key - invalid key format"),"ERR_INVALID_KEY_FORMAT");return{kty:"EC",crv:e,x:uint8ArrayToString$h(t.slice(1,r+1),"base64url"),y:uint8ArrayToString$h(t.slice(1+r),"base64url"),ext:!0}}const unmarshalPrivateKey$7=(e,t)=>({...unmarshalPublicKey$7(e,t.public),d:uint8ArrayToString$h(t.private,"base64url")}),ecdh$3=ecdhBrowser$3;var ephemeralKeys$3=async e=>ecdh$3.generateEphmeralKeyPair(e);const keysPBM$3=keys$8,forge$g=forge$X,errcode$u=errCode$m,{fromString:uint8ArrayFromString$f}=require$$3$1,importer$6=importer$7,supportedKeys$3={rsa:rsaClass$3,ed25519:ed25519Class$3,secp256k1:secp256k1Class$3(keysPBM$3)},ErrMissingSecp256K1$3={message:"secp256k1 support requires libp2p-crypto-secp256k1 package",code:"ERR_MISSING_PACKAGE"};function typeToKey$3(e){const t=supportedKeys$3[e.toLowerCase()];if(!t){const t=Object.keys(supportedKeys$3).join(" / ");throw errcode$u(new Error(`invalid or unsupported key type ${e}. Must be ${t}`),"ERR_UNSUPPORTED_KEY_TYPE")}return t}const generateKeyPair$9=async(e,t)=>typeToKey$3(e).generateKeyPair(t),generateKeyPairFromSeed$6=async(e,t,r)=>{const n=typeToKey$3(e);if("ed25519"!==e.toLowerCase())throw errcode$u(new Error("Seed key derivation is unimplemented for RSA or secp256k1"),"ERR_UNSUPPORTED_KEY_DERIVATION_TYPE");return n.generateKeyPairFromSeed(t,r)},unmarshalPublicKey$6=e=>{const t=keysPBM$3.PublicKey.decode(e),r=t.Data;switch(t.Type){case keysPBM$3.KeyType.RSA:return supportedKeys$3.rsa.unmarshalRsaPublicKey(r);case keysPBM$3.KeyType.Ed25519:return supportedKeys$3.ed25519.unmarshalEd25519PublicKey(r);case keysPBM$3.KeyType.Secp256k1:if(supportedKeys$3.secp256k1)return supportedKeys$3.secp256k1.unmarshalSecp256k1PublicKey(r);throw errcode$u(new Error(ErrMissingSecp256K1$3.message),ErrMissingSecp256K1$3.code);default:typeToKey$3(t.Type)}},marshalPublicKey$6=(e,t)=>(typeToKey$3(t=(t||"rsa").toLowerCase()),e.bytes),unmarshalPrivateKey$6=async e=>{const t=keysPBM$3.PrivateKey.decode(e),r=t.Data;switch(t.Type){case keysPBM$3.KeyType.RSA:return supportedKeys$3.rsa.unmarshalRsaPrivateKey(r);case keysPBM$3.KeyType.Ed25519:return supportedKeys$3.ed25519.unmarshalEd25519PrivateKey(r);case keysPBM$3.KeyType.Secp256k1:if(supportedKeys$3.secp256k1)return supportedKeys$3.secp256k1.unmarshalSecp256k1PrivateKey(r);throw errcode$u(new Error(ErrMissingSecp256K1$3.message),ErrMissingSecp256K1$3.code);default:typeToKey$3(t.Type)}},marshalPrivateKey$3=(e,t)=>(typeToKey$3(t=(t||"rsa").toLowerCase()),e.bytes),importKey$3=async(e,t)=>{try{const r=await importer$6.import(e,t);return unmarshalPrivateKey$6(r)}catch(e){}const r=forge$g.pki.decryptRsaPrivateKey(e,t);if(null===r)throw errcode$u(new Error("Cannot read the key, most likely the password is wrong or not a RSA key"),"ERR_CANNOT_DECRYPT_PEM");let n=forge$g.asn1.toDer(forge$g.pki.privateKeyToAsn1(r));return n=uint8ArrayFromString$f(n.getBytes(),"ascii"),supportedKeys$3.rsa.unmarshalRsaPrivateKey(n)};var keys$7={supportedKeys:supportedKeys$3,keysPBM:keysPBM$3,keyStretcher:keyStretcher$3,generateEphemeralKeyPair:ephemeralKeys$3,generateKeyPair:generateKeyPair$9,generateKeyPairFromSeed:generateKeyPairFromSeed$6,unmarshalPublicKey:unmarshalPublicKey$6,marshalPublicKey:marshalPublicKey$6,unmarshalPrivateKey:unmarshalPrivateKey$6,marshalPrivateKey:marshalPrivateKey$3,import:importKey$3},$protobuf$6=minimal,$Reader$6=$protobuf$6.Reader,$Writer$6=$protobuf$6.Writer,$util$6=$protobuf$6.util,$root$6=$protobuf$6.roots["libp2p-peer-id"]||($protobuf$6.roots["libp2p-peer-id"]={});$root$6.PeerIdProto=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.id=$util$6.newBuffer([]),e.prototype.pubKey=$util$6.newBuffer([]),e.prototype.privKey=$util$6.newBuffer([]),e.encode=function(e,t){return t||(t=$Writer$6.create()),t.uint32(10).bytes(e.id),null!=e.pubKey&&Object.hasOwnProperty.call(e,"pubKey")&&t.uint32(18).bytes(e.pubKey),null!=e.privKey&&Object.hasOwnProperty.call(e,"privKey")&&t.uint32(26).bytes(e.privKey),t},e.decode=function(e,t){e instanceof $Reader$6||(e=$Reader$6.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root$6.PeerIdProto;e.pos<r;){var i=e.uint32();switch(i>>>3){case 1:n.id=e.bytes();break;case 2:n.pubKey=e.bytes();break;case 3:n.privKey=e.bytes();break;default:e.skipType(7&i)}}if(!n.hasOwnProperty("id"))throw $util$6.ProtocolError("missing required 'id'",{instance:n});return n},e.fromObject=function(e){if(e instanceof $root$6.PeerIdProto)return e;var t=new $root$6.PeerIdProto;return null!=e.id&&("string"==typeof e.id?$util$6.base64.decode(e.id,t.id=$util$6.newBuffer($util$6.base64.length(e.id)),0):e.id.length&&(t.id=e.id)),null!=e.pubKey&&("string"==typeof e.pubKey?$util$6.base64.decode(e.pubKey,t.pubKey=$util$6.newBuffer($util$6.base64.length(e.pubKey)),0):e.pubKey.length&&(t.pubKey=e.pubKey)),null!=e.privKey&&("string"==typeof e.privKey?$util$6.base64.decode(e.privKey,t.privKey=$util$6.newBuffer($util$6.base64.length(e.privKey)),0):e.privKey.length&&(t.privKey=e.privKey)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(t.bytes===String?r.id="":(r.id=[],t.bytes!==Array&&(r.id=$util$6.newBuffer(r.id))),t.bytes===String?r.pubKey="":(r.pubKey=[],t.bytes!==Array&&(r.pubKey=$util$6.newBuffer(r.pubKey))),t.bytes===String?r.privKey="":(r.privKey=[],t.bytes!==Array&&(r.privKey=$util$6.newBuffer(r.privKey)))),null!=e.id&&e.hasOwnProperty("id")&&(r.id=t.bytes===String?$util$6.base64.encode(e.id,0,e.id.length):t.bytes===Array?Array.prototype.slice.call(e.id):e.id),null!=e.pubKey&&e.hasOwnProperty("pubKey")&&(r.pubKey=t.bytes===String?$util$6.base64.encode(e.pubKey,0,e.pubKey.length):t.bytes===Array?Array.prototype.slice.call(e.pubKey):e.pubKey),null!=e.privKey&&e.hasOwnProperty("privKey")&&(r.privKey=t.bytes===String?$util$6.base64.encode(e.privKey,0,e.privKey.length):t.bytes===Array?Array.prototype.slice.call(e.privKey):e.privKey),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf$6.util.toJSONOptions)},e}();var proto$2=$root$6;!function(e,t){const{CID:r}=require$$0$a,n=require$$1$8,i=require$$2$3,s=require$$3$2,o=require$$4$5,{base58btc:a}=require$$3$2,{base32:u}=require$$1$8,{base16:c}=require$$5$1,l=require$$6$1,h=keys$7,d=classIs.exports,{PeerIdProto:f}=proto$2,{equals:p}=require$$10$1,{fromString:y}=require$$3$1,{toString:g}=require$$1$5,{identity:$}=require$$13,m={...n,...i,...s,...o},b=Object.keys(m).reduce(((e,t)=>e.or(m[t])),u.decoder);const v=d(class{constructor(e,t,r){if(!(e instanceof Uint8Array))throw new Error("invalid id provided");if(t&&r&&!p(t.public.bytes,r.bytes))throw new Error("inconsistent arguments");this._id=e,this._idB58String=a.encode(this.id).substring(1),this._privKey=t,this._pubKey=r}get id(){return this._id}set id(e){throw new Error("Id is immutable")}get privKey(){return this._privKey}set privKey(e){this._privKey=e}get pubKey(){if(this._pubKey)return this._pubKey;if(this._privKey)return this._privKey.public;try{const e=l.decode(this.id);e.code===$.code&&(this._pubKey=h.unmarshalPublicKey(e.digest))}catch(e){}return this._pubKey}set pubKey(e){this._pubKey=e}marshalPubKey(){if(this.pubKey)return h.marshalPublicKey(this.pubKey)}marshalPrivKey(){if(this.privKey)return h.marshalPrivateKey(this.privKey)}marshal(e){return f.encode({id:this.toBytes(),pubKey:this.marshalPubKey(),privKey:e?null:this.marshalPrivKey()}).finish()}toPrint(){let e=this.toB58String();e.startsWith("Qm")&&(e=e.slice(2));let t=6;return e.length<t&&(t=e.length),"<peer.ID "+e.substr(0,t)+">"}toJSON(){return{id:this.toB58String(),privKey:S(this.marshalPrivKey()),pubKey:S(this.marshalPubKey())}}toHexString(){return c.encode(this.id).substring(1)}toBytes(){return this.id}toB58String(){return this._idB58String}toString(){if(!this._idCIDString){const e=r.createV1(114,l.decode(this.id));Object.defineProperty(this,"_idCIDString",{value:e.toString(),enumerable:!1})}return this._idCIDString}equals(e){if(e instanceof Uint8Array)return p(this.id,e);if(e.id)return p(this.id,e.id);throw new Error("not valid Id")}isEqual(e){return this.equals(e)}isValid(){return Boolean(this.privKey&&this.privKey.public&&this.privKey.public.bytes&&this.pubKey.bytes instanceof Uint8Array&&p(this.privKey.public.bytes,this.pubKey.bytes))}hasInlinePublicKey(){try{if(l.decode(this.id).code===$.code)return!0}catch(e){}return!1}},{className:"PeerId",symbolName:"@libp2p/js-peer-id/PeerId"});t=e.exports=v;const _=e=>e.bytes.length<=42?l.create($.code,e.bytes).bytes:e.hash(),w=async(e,t)=>{const r=await _(t);return new v(r,e,t)};t.create=async e=>{(e=e||{}).bits=e.bits||2048,e.keyType=e.keyType||"RSA";const t=await h.generateKeyPair(e.keyType,e.bits);return w(t,t.public)},t.createFromHexString=e=>new v(c.decode("f"+e)),t.createFromBytes=e=>{try{const n=r.decode(e);if(!E(n))throw new Error("Supplied PeerID CID is invalid");return t.createFromCID(n)}catch{if(l.decode(e).code!==$.code)throw new Error("Supplied PeerID CID is invalid");return new v(e)}},t.createFromB58String=e=>t.createFromBytes(a.decode("z"+e));const E=e=>114===e.code||112===e.code;function S(e){if(e)return g(e,"base64pad")}t.createFromCID=e=>{if(!(e=r.asCID(e))||!E(e))throw new Error("Supplied PeerID CID is invalid");return new v(e.multihash.bytes)},t.createFromPubKey=async e=>{let t=e;if("string"==typeof t&&(t=y(e,"base64pad")),!(t instanceof Uint8Array))throw new Error("Supplied key is neither a base64 string nor a Uint8Array");const r=await h.unmarshalPublicKey(t);return w(void 0,r)},t.createFromPrivKey=async e=>{if("string"==typeof e&&(e=y(e,"base64pad")),!(e instanceof Uint8Array))throw new Error("Supplied key is neither a base64 string nor a Uint8Array");const t=await h.unmarshalPrivateKey(e);return w(t,t.public)},t.createFromJSON=async e=>{const t=a.decode("z"+e.id),r=e.privKey&&y(e.privKey,"base64pad"),n=e.pubKey&&y(e.pubKey,"base64pad"),i=n&&await h.unmarshalPublicKey(n);if(!r)return new v(t,void 0,i);const s=await h.unmarshalPrivateKey(r),o=await _(s.public);let u;if(i&&(u=await _(i)),i&&!p(o,u))throw new Error("Public and private key do not match");if(t&&!p(o,t))throw new Error("Id and private key do not match");return new v(t,s,i)},t.createFromProtobuf=async e=>{"string"==typeof e&&(e=y(e,"base16"));let t,r,{id:n,privKey:i,pubKey:s}=f.decode(e);if(i=!!i&&await h.unmarshalPrivateKey(i),s=!!s&&await h.unmarshalPublicKey(s),i&&(r=await _(i.public)),s&&(t=await _(s)),i){if(s&&!p(r,t))throw new Error("Public and private key do not match");return new v(r,i,i.public)}if(s)return new v(t,void 0,s);if(n)return new v(n);throw new Error("Protobuf did not contain any usable key material")},t.parse=e=>("1"!==e.charAt(0)&&"Q"!==e.charAt(0)||(e=`z${e}`),t.createFromBytes(b.decode(e))),t.isPeerId=e=>Boolean("object"==typeof e&&e._id&&e._idB58String)}(src$a,src$a.exports);var constants$1={CODE_P2P:421,CODE_CIRCUIT:290,CLOSE_TIMEOUT:2e3},cjs$3={exports:{}},url$1={},re=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,parts=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],parseuri=function(e){var t=e,r=e.indexOf("["),n=e.indexOf("]");-1!=r&&-1!=n&&(e=e.substring(0,r)+e.substring(r,n).replace(/:/g,";")+e.substring(n,e.length));for(var i=re.exec(e||""),s={},o=14;o--;)s[parts[o]]=i[o]||"";return-1!=r&&-1!=n&&(s.source=t,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=pathNames(s,s.path),s.queryKey=queryKey(s,s.query),s};function pathNames(e,t){var r=t.replace(/\/{2,9}/g,"/").split("/");return"/"!=t.substr(0,1)&&0!==t.length||r.splice(0,1),"/"==t.substr(t.length-1,1)&&r.splice(r.length-1,1),r}function queryKey(e,t){var r={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(e,t,n){t&&(r[t]=n)})),r}var __importDefault$c=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(url$1,"__esModule",{value:!0}),url$1.url=void 0;const parseuri_1$1=__importDefault$c(parseuri),debug_1$7=__importDefault$c(require$$0$b),debug$d=debug_1$7.default("socket.io-client:url");function url(e,t="",r){let n=e;r=r||"undefined"!=typeof location&&location,null==e&&(e=r.protocol+"//"+r.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?r.protocol+e:r.host+e),/^(https?|wss?):\/\//.test(e)||(debug$d("protocol-less url %s",e),e=void 0!==r?r.protocol+"//"+e:"https://"+e),debug$d("parse %s",e),n=parseuri_1$1.default(e)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";const i=-1!==n.host.indexOf(":")?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+i+":"+n.port+t,n.href=n.protocol+"://"+i+(r&&r.port===n.port?"":":"+n.port),n}url$1.url=url;var manager={},cjs$2={},socket$1={},transports={},pollingXhr={},xmlhttprequest_browser={},hasCors={exports:{}};try{hasCors.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){hasCors.exports=!1}var globalThis_browser={};Object.defineProperty(globalThis_browser,"__esModule",{value:!0}),globalThis_browser.default="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();var __importDefault$b=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(xmlhttprequest_browser,"__esModule",{value:!0});const has_cors_1=__importDefault$b(hasCors.exports),globalThis_js_1$3=__importDefault$b(globalThis_browser);function default_1(e){const t=e.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!t||has_cors_1.default))return new XMLHttpRequest}catch(e){}if(!t)try{return new(globalThis_js_1$3.default[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}xmlhttprequest_browser.default=default_1;var util$3={},__importDefault$a=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(util$3,"__esModule",{value:!0}),util$3.installTimerFunctions=util$3.pick=void 0;const globalThis_js_1$2=__importDefault$a(globalThis_browser);function pick(e,...t){return t.reduce(((t,r)=>(e.hasOwnProperty(r)&&(t[r]=e[r]),t)),{})}util$3.pick=pick;const NATIVE_SET_TIMEOUT=setTimeout,NATIVE_CLEAR_TIMEOUT=clearTimeout;function installTimerFunctions(e,t){t.useNativeTimers?(e.setTimeoutFn=NATIVE_SET_TIMEOUT.bind(globalThis_js_1$2.default),e.clearTimeoutFn=NATIVE_CLEAR_TIMEOUT.bind(globalThis_js_1$2.default)):(e.setTimeoutFn=setTimeout.bind(globalThis_js_1$2.default),e.clearTimeoutFn=clearTimeout.bind(globalThis_js_1$2.default))}util$3.installTimerFunctions=installTimerFunctions;var componentEmitter={};function Emitter(e){if(e)return mixin(e)}function mixin(e){for(var t in Emitter.prototype)e[t]=Emitter.prototype[t];return e}componentEmitter.Emitter=Emitter,Emitter.prototype.on=Emitter.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},Emitter.prototype.once=function(e,t){function r(){this.off(e,r),t.apply(this,arguments)}return r.fn=t,this.on(e,r),this},Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r,n=this._callbacks["$"+e];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var i=0;i<n.length;i++)if((r=n[i])===t||r.fn===t){n.splice(i,1);break}return 0===n.length&&delete this._callbacks["$"+e],this},Emitter.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),r=this._callbacks["$"+e],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(r){n=0;for(var i=(r=r.slice(0)).length;n<i;++n)r[n].apply(this,t)}return this},Emitter.prototype.emitReserved=Emitter.prototype.emit,Emitter.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},Emitter.prototype.hasListeners=function(e){return!!this.listeners(e).length};var polling={},transport={},cjs$1={},encodePacket_browser={},commons={};Object.defineProperty(commons,"__esModule",{value:!0}),commons.ERROR_PACKET=commons.PACKET_TYPES_REVERSE=commons.PACKET_TYPES=void 0;const PACKET_TYPES=Object.create(null);commons.PACKET_TYPES=PACKET_TYPES,PACKET_TYPES.open="0",PACKET_TYPES.close="1",PACKET_TYPES.ping="2",PACKET_TYPES.pong="3",PACKET_TYPES.message="4",PACKET_TYPES.upgrade="5",PACKET_TYPES.noop="6";const PACKET_TYPES_REVERSE=Object.create(null);commons.PACKET_TYPES_REVERSE=PACKET_TYPES_REVERSE,Object.keys(PACKET_TYPES).forEach((e=>{PACKET_TYPES_REVERSE[PACKET_TYPES[e]]=e}));const ERROR_PACKET={type:"error",data:"parser error"};commons.ERROR_PACKET=ERROR_PACKET,Object.defineProperty(encodePacket_browser,"__esModule",{value:!0});const commons_js_1$1=commons,withNativeBlob$1="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),withNativeArrayBuffer$2="function"==typeof ArrayBuffer,isView$1=e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,encodePacket=({type:e,data:t},r,n)=>withNativeBlob$1&&t instanceof Blob?r?n(t):encodeBlobAsBase64(t,n):withNativeArrayBuffer$2&&(t instanceof ArrayBuffer||isView$1(t))?r?n(t):encodeBlobAsBase64(new Blob([t]),n):n(commons_js_1$1.PACKET_TYPES[e]+(t||"")),encodeBlobAsBase64=(e,t)=>{const r=new FileReader;return r.onload=function(){const e=r.result.split(",")[1];t("b"+e)},r.readAsDataURL(e)};encodePacket_browser.default=encodePacket;for(var decodePacket_browser={},chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lookup="undefined"==typeof Uint8Array?[]:new Uint8Array(256),i$1=0;i$1<chars.length;i$1++)lookup[chars.charCodeAt(i$1)]=i$1;var encode$1=function(e){var t,r=new Uint8Array(e),n=r.length,i="";for(t=0;t<n;t+=3)i+=chars[r[t]>>2],i+=chars[(3&r[t])<<4|r[t+1]>>4],i+=chars[(15&r[t+1])<<2|r[t+2]>>6],i+=chars[63&r[t+2]];return n%3==2?i=i.substring(0,i.length-1)+"=":n%3==1&&(i=i.substring(0,i.length-2)+"=="),i},decode$2=function(e){var t,r,n,i,s,o=.75*e.length,a=e.length,u=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);var c=new ArrayBuffer(o),l=new Uint8Array(c);for(t=0;t<a;t+=4)r=lookup[e.charCodeAt(t)],n=lookup[e.charCodeAt(t+1)],i=lookup[e.charCodeAt(t+2)],s=lookup[e.charCodeAt(t+3)],l[u++]=r<<2|n>>4,l[u++]=(15&n)<<4|i>>2,l[u++]=(3&i)<<6|63&s;return c},base64Arraybuffer_es5=Object.freeze({__proto__:null,decode:decode$2,encode:encode$1}),require$$1$1=getAugmentedNamespace(base64Arraybuffer_es5);Object.defineProperty(decodePacket_browser,"__esModule",{value:!0});const commons_js_1=commons,base64_arraybuffer_1=require$$1$1,withNativeArrayBuffer$1="function"==typeof ArrayBuffer,decodePacket=(e,t)=>{if("string"!=typeof e)return{type:"message",data:mapBinary(e,t)};const r=e.charAt(0);if("b"===r)return{type:"message",data:decodeBase64Packet(e.substring(1),t)};return commons_js_1.PACKET_TYPES_REVERSE[r]?e.length>1?{type:commons_js_1.PACKET_TYPES_REVERSE[r],data:e.substring(1)}:{type:commons_js_1.PACKET_TYPES_REVERSE[r]}:commons_js_1.ERROR_PACKET},decodeBase64Packet=(e,t)=>{if(withNativeArrayBuffer$1){const r=(0,base64_arraybuffer_1.decode)(e);return mapBinary(r,t)}return{base64:!0,data:e}},mapBinary=(e,t)=>"blob"===t&&e instanceof ArrayBuffer?new Blob([e]):e;decodePacket_browser.default=decodePacket,Object.defineProperty(cjs$1,"__esModule",{value:!0}),cjs$1.decodePayload=cjs$1.decodePacket=cjs$1.encodePayload=cjs$1.encodePacket=cjs$1.protocol=void 0;const encodePacket_js_1=encodePacket_browser;cjs$1.encodePacket=encodePacket_js_1.default;const decodePacket_js_1=decodePacket_browser;cjs$1.decodePacket=decodePacket_js_1.default;const SEPARATOR=String.fromCharCode(30),encodePayload=(e,t)=>{const r=e.length,n=new Array(r);let i=0;e.forEach(((e,s)=>{(0,encodePacket_js_1.default)(e,!1,(e=>{n[s]=e,++i===r&&t(n.join(SEPARATOR))}))}))};cjs$1.encodePayload=encodePayload;const decodePayload$1=(e,t)=>{const r=e.split(SEPARATOR),n=[];for(let e=0;e<r.length;e++){const i=(0,decodePacket_js_1.default)(r[e],t);if(n.push(i),"error"===i.type)break}return n};cjs$1.decodePayload=decodePayload$1,cjs$1.protocol=4;var __importDefault$9=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(transport,"__esModule",{value:!0}),transport.Transport=void 0;const engine_io_parser_1$3=cjs$1,component_emitter_1$4=componentEmitter,util_js_1$3=util$3,debug_1$6=__importDefault$9(require$$0$b),debug$c=(0,debug_1$6.default)("engine.io-client:transport");class Transport extends component_emitter_1$4.Emitter{constructor(e){super(),this.writable=!1,(0,util_js_1$3.installTimerFunctions)(this,e),this.opts=e,this.query=e.query,this.readyState="",this.socket=e.socket}onError(e,t){const r=new Error(e);return r.type="TransportError",r.description=t,super.emit("error",r),this}open(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(e){"open"===this.readyState?this.write(e):debug$c("transport is not open, discarding packets")}onOpen(){this.readyState="open",this.writable=!0,super.emit("open")}onData(e){const t=(0,engine_io_parser_1$3.decodePacket)(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emit("packet",e)}onClose(){this.readyState="closed",super.emit("close")}}transport.Transport=Transport;var alphabet="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),length=64,map={},seed=0,i=0,prev;function encode(e){var t="";do{t=alphabet[e%length]+t,e=Math.floor(e/length)}while(e>0);return t}function decode$1(e){var t=0;for(i=0;i<e.length;i++)t=t*length+map[e.charAt(i)];return t}function yeast(){var e=encode(+new Date);return e!==prev?(seed=0,prev=e):e+"."+encode(seed++)}for(;i<length;i++)map[alphabet[i]]=i;yeast.encode=encode,yeast.decode=decode$1;var yeast_1$2=yeast,parseqs={encode:function(e){var t="";for(var r in e)e.hasOwnProperty(r)&&(t.length&&(t+="&"),t+=encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t},decode:function(e){for(var t={},r=e.split("&"),n=0,i=r.length;n<i;n++){var s=r[n].split("=");t[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return t}},__importDefault$8=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(polling,"__esModule",{value:!0}),polling.Polling=void 0;const transport_js_1$1=transport,debug_1$5=__importDefault$8(require$$0$b),yeast_1$1=__importDefault$8(yeast_1$2),parseqs_1$2=__importDefault$8(parseqs),engine_io_parser_1$2=cjs$1,debug$b=(0,debug_1$5.default)("engine.io-client:polling");class Polling extends transport_js_1$1.Transport{constructor(){super(...arguments),this.polling=!1}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{debug$b("paused"),this.readyState="paused",e()};if(this.polling||!this.writable){let e=0;this.polling&&(debug$b("we are currently polling - waiting to pause"),e++,this.once("pollComplete",(function(){debug$b("pre-pause polling complete"),--e||t()}))),this.writable||(debug$b("we are currently writing - waiting to pause"),e++,this.once("drain",(function(){debug$b("pre-pause writing complete"),--e||t()})))}else t()}poll(){debug$b("polling"),this.polling=!0,this.doPoll(),this.emit("poll")}onData(e){debug$b("polling got data %s",e);(0,engine_io_parser_1$2.decodePayload)(e,this.socket.binaryType).forEach((e=>{if("opening"===this.readyState&&"open"===e.type&&this.onOpen(),"close"===e.type)return this.onClose(),!1;this.onPacket(e)})),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():debug$b('ignoring poll - transport state "%s"',this.readyState))}doClose(){const e=()=>{debug$b("writing close packet"),this.write([{type:"close"}])};"open"===this.readyState?(debug$b("transport open - closing"),e()):(debug$b("transport not open - deferring close"),this.once("open",e))}write(e){this.writable=!1,(0,engine_io_parser_1$2.encodePayload)(e,(e=>{this.doWrite(e,(()=>{this.writable=!0,this.emit("drain")}))}))}uri(){let e=this.query||{};const t=this.opts.secure?"https":"http";let r="";!1!==this.opts.timestampRequests&&(e[this.opts.timestampParam]=(0,yeast_1$1.default)()),this.supportsBinary||e.sid||(e.b64=1),this.opts.port&&("https"===t&&443!==Number(this.opts.port)||"http"===t&&80!==Number(this.opts.port))&&(r=":"+this.opts.port);const n=parseqs_1$2.default.encode(e);return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(n.length?"?"+n:"")}}polling.Polling=Polling;var __importDefault$7=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(pollingXhr,"__esModule",{value:!0}),pollingXhr.Request=pollingXhr.XHR=void 0;const xmlhttprequest_js_1=__importDefault$7(xmlhttprequest_browser),debug_1$4=__importDefault$7(require$$0$b),globalThis_js_1$1=__importDefault$7(globalThis_browser),util_js_1$2=util$3,component_emitter_1$3=componentEmitter,polling_js_1=polling,debug$a=(0,debug_1$4.default)("engine.io-client:polling-xhr");function empty$1(){}const hasXHR2=null!=new xmlhttprequest_js_1.default({xdomain:!1}).responseType;class XHR extends polling_js_1.Polling{constructor(e){if(super(e),"undefined"!=typeof location){const t="https:"===location.protocol;let r=location.port;r||(r=t?"443":"80"),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||r!==e.port,this.xs=e.secure!==t}const t=e&&e.forceBase64;this.supportsBinary=hasXHR2&&!t}request(e={}){return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new Request(this.uri(),e)}doWrite(e,t){const r=this.request({method:"POST",data:e});r.on("success",t),r.on("error",(e=>{this.onError("xhr post error",e)}))}doPoll(){debug$a("xhr poll");const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(e=>{this.onError("xhr poll error",e)})),this.pollXhr=e}}pollingXhr.XHR=XHR;class Request extends component_emitter_1$3.Emitter{constructor(e,t){super(),(0,util_js_1$2.installTimerFunctions)(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.async=!1!==t.async,this.data=void 0!==t.data?t.data:null,this.create()}create(){const e=(0,util_js_1$2.pick)(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this.opts.xd,e.xscheme=!!this.opts.xs;const t=this.xhr=new xmlhttprequest_js_1.default(e);try{debug$a("xhr open %s: %s",this.method,this.uri),t.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0);for(let e in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(e)&&t.setRequestHeader(e,this.opts.extraHeaders[e])}}catch(e){}if("POST"===this.method)try{t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{t.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in t&&(t.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(t.timeout=this.opts.requestTimeout),t.onreadystatechange=()=>{4===t.readyState&&(200===t.status||1223===t.status?this.onLoad():this.setTimeoutFn((()=>{this.onError("number"==typeof t.status?t.status:0)}),0))},debug$a("xhr data %s",this.data),t.send(this.data)}catch(e){return void this.setTimeoutFn((()=>{this.onError(e)}),0)}"undefined"!=typeof document&&(this.index=Request.requestsCount++,Request.requests[this.index]=this)}onSuccess(){this.emit("success"),this.cleanup()}onData(e){this.emit("data",e),this.onSuccess()}onError(e){this.emit("error",e),this.cleanup(!0)}cleanup(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=empty$1,e)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete Request.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;null!==e&&this.onData(e)}abort(){this.cleanup()}}if(pollingXhr.Request=Request,Request.requestsCount=0,Request.requests={},"undefined"!=typeof document)if("function"==typeof attachEvent)attachEvent("onunload",unloadHandler);else if("function"==typeof addEventListener){const e="onpagehide"in globalThis_js_1$1.default?"pagehide":"unload";addEventListener(e,unloadHandler,!1)}function unloadHandler(){for(let e in Request.requests)Request.requests.hasOwnProperty(e)&&Request.requests[e].abort()}var websocketConstructor_browser={},__importDefault$6=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(websocketConstructor_browser,"__esModule",{value:!0}),websocketConstructor_browser.defaultBinaryType=websocketConstructor_browser.usingBrowserWebSocket=websocketConstructor_browser.WebSocket=websocketConstructor_browser.nextTick=void 0;const globalThis_js_1=__importDefault$6(globalThis_browser);websocketConstructor_browser.nextTick="function"==typeof Promise&&"function"==typeof Promise.resolve?e=>Promise.resolve().then(e):(e,t)=>t(e,0),websocketConstructor_browser.WebSocket=globalThis_js_1.default.WebSocket||globalThis_js_1.default.MozWebSocket,websocketConstructor_browser.usingBrowserWebSocket=!0,websocketConstructor_browser.defaultBinaryType="arraybuffer";var __importDefault$5=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.WS=void 0;const transport_js_1=transport,parseqs_1$1=__importDefault$5(parseqs),yeast_1=__importDefault$5(yeast_1$2),util_js_1$1=util$3,websocket_constructor_js_1=websocketConstructor_browser,debug_1$3=__importDefault$5(require$$0$b),engine_io_parser_1$1=cjs$1,debug$9=(0,debug_1$3.default)("engine.io-client:websocket"),isReactNative="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();class WS extends transport_js_1.Transport{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,r=isReactNative?{}:(0,util_js_1$1.pick)(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=websocket_constructor_js_1.usingBrowserWebSocket&&!isReactNative?t?new websocket_constructor_js_1.WebSocket(e,t):new websocket_constructor_js_1.WebSocket(e):new websocket_constructor_js_1.WebSocket(e,t,r)}catch(e){return this.emit("error",e)}this.ws.binaryType=this.socket.binaryType||websocket_constructor_js_1.defaultBinaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=this.onClose.bind(this),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const r=e[t],n=t===e.length-1;(0,engine_io_parser_1$1.encodePacket)(r,this.supportsBinary,(e=>{const t={};if(!websocket_constructor_js_1.usingBrowserWebSocket&&(r.options&&(t.compress=r.options.compress),this.opts.perMessageDeflate)){("string"==typeof e?Buffer$f.byteLength(e):e.length)<this.opts.perMessageDeflate.threshold&&(t.compress=!1)}try{websocket_constructor_js_1.usingBrowserWebSocket?this.ws.send(e):this.ws.send(e,t)}catch(e){debug$9("websocket closed before onclose event")}n&&(0,websocket_constructor_js_1.nextTick)((()=>{this.writable=!0,this.emit("drain")}),this.setTimeoutFn)}))}}doClose(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}uri(){let e=this.query||{};const t=this.opts.secure?"wss":"ws";let r="";this.opts.port&&("wss"===t&&443!==Number(this.opts.port)||"ws"===t&&80!==Number(this.opts.port))&&(r=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=(0,yeast_1.default)()),this.supportsBinary||(e.b64=1);const n=parseqs_1$1.default.encode(e);return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(n.length?"?"+n:"")}check(){return!(!websocket_constructor_js_1.WebSocket||"__initialize"in websocket_constructor_js_1.WebSocket&&this.name===WS.prototype.name)}}exports.WS=WS;var websocket=Object.freeze({__proto__:null}),require$$1=getAugmentedNamespace(websocket);Object.defineProperty(transports,"__esModule",{value:!0}),transports.transports=void 0;const polling_xhr_js_1=pollingXhr,websocket_js_1=require$$1;transports.transports={websocket:websocket_js_1.WS,polling:polling_xhr_js_1.XHR};var __importDefault$4=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(socket$1,"__esModule",{value:!0}),socket$1.Socket=void 0;const index_js_1=transports,util_js_1=util$3,parseqs_1=__importDefault$4(parseqs),parseuri_1=__importDefault$4(parseuri),debug_1$2=__importDefault$4(require$$0$b),component_emitter_1$2=componentEmitter,engine_io_parser_1=cjs$1,debug$8=(0,debug_1$2.default)("engine.io-client:socket");class Socket$1 extends component_emitter_1$2.Emitter{constructor(e,t={}){super(),e&&"object"==typeof e&&(t=e,e=null),e?(e=(0,parseuri_1.default)(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=(0,parseuri_1.default)(t.host).host),(0,util_js_1.installTimerFunctions)(this,t),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},t),this.opts.path=this.opts.path.replace(/\/$/,"")+"/","string"==typeof this.opts.query&&(this.opts.query=parseqs_1.default.decode(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&addEventListener("beforeunload",(()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())}),!1),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close")},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){debug$8('creating transport "%s"',e);const t=clone(this.opts.query);t.EIO=engine_io_parser_1.protocol,t.transport=e,this.id&&(t.sid=this.id);const r=Object.assign({},this.opts.transportOptions[e],this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return debug$8("options: %j",r),new index_js_1.transports[e](r)}open(){let e;if(this.opts.rememberUpgrade&&Socket$1.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn((()=>{this.emitReserved("error","No transports available")}),0);e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return debug$8("error while creating transport: %s",e),this.transports.shift(),void this.open()}e.open(),this.setTransport(e)}setTransport(e){debug$8("setting transport %s",e.name),this.transport&&(debug$8("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(()=>{this.onClose("transport close")}))}probe(e){debug$8('probing transport "%s"',e);let t=this.createTransport(e),r=!1;Socket$1.priorWebsocketSuccess=!1;const n=()=>{r||(debug$8('probe transport "%s" opened',e),t.send([{type:"ping",data:"probe"}]),t.once("packet",(n=>{if(!r)if("pong"===n.type&&"probe"===n.data){if(debug$8('probe transport "%s" pong',e),this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;Socket$1.priorWebsocketSuccess="websocket"===t.name,debug$8('pausing current transport "%s"',this.transport.name),this.transport.pause((()=>{r||"closed"!==this.readyState&&(debug$8("changing transport and sending upgrade packet"),c(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())}))}else{debug$8('probe transport "%s" failed',e);const r=new Error("probe error");r.transport=t.name,this.emitReserved("upgradeError",r)}})))};function i(){r||(r=!0,c(),t.close(),t=null)}const s=r=>{const n=new Error("probe error: "+r);n.transport=t.name,i(),debug$8('probe transport "%s" failed because of error: %s',e,r),this.emitReserved("upgradeError",n)};function o(){s("transport closed")}function a(){s("socket closed")}function u(e){t&&e.name!==t.name&&(debug$8('"%s" works - aborting "%s"',e.name,t.name),i())}const c=()=>{t.removeListener("open",n),t.removeListener("error",s),t.removeListener("close",o),this.off("close",a),this.off("upgrading",u)};t.once("open",n),t.once("error",s),t.once("close",o),this.once("close",a),this.once("upgrading",u),t.open()}onOpen(){if(debug$8("socket open"),this.readyState="open",Socket$1.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade&&this.transport.pause){debug$8("starting upgrade probes");let e=0;const t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(debug$8('socket receive: type "%s", data "%s"',e.type,e.data),this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}else debug$8('packet received with socket readyState "%s"',this.readyState)}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn((()=>{this.onClose("ping timeout")}),this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(debug$8("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emitReserved("flush"))}write(e,t,r){return this.sendPacket("message",e,t,r),this}send(e,t,r){return this.sendPacket("message",e,t,r),this}sendPacket(e,t,r,n){if("function"==typeof t&&(n=t,t=void 0),"function"==typeof r&&(n=r,r=null),"closing"===this.readyState||"closed"===this.readyState)return;(r=r||{}).compress=!1!==r.compress;const i={type:e,data:t,options:r};this.emitReserved("packetCreate",i),this.writeBuffer.push(i),n&&this.once("flush",n),this.flush()}close(){const e=()=>{this.onClose("forced close"),debug$8("socket closing - telling transport to close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},r=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(()=>{this.upgrading?r():e()})):this.upgrading?r():e()),this}onError(e){debug$8("socket error %j",e),Socket$1.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(debug$8('socket close with reason: "%s"',e),this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&removeEventListener("offline",this.offlineEventListener,!1),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const t=[];let r=0;const n=e.length;for(;r<n;r++)~this.transports.indexOf(e[r])&&t.push(e[r]);return t}}function clone(e){const t={};for(let r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}socket$1.Socket=Socket$1,Socket$1.protocol=engine_io_parser_1.protocol,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.installTimerFunctions=e.transports=e.Transport=e.protocol=e.Socket=void 0;const t=socket$1;Object.defineProperty(e,"Socket",{enumerable:!0,get:function(){return t.Socket}}),e.protocol=t.Socket.protocol;var r=transport;Object.defineProperty(e,"Transport",{enumerable:!0,get:function(){return r.Transport}});var n=transports;Object.defineProperty(e,"transports",{enumerable:!0,get:function(){return n.transports}});var i=util$3;Object.defineProperty(e,"installTimerFunctions",{enumerable:!0,get:function(){return i.installTimerFunctions}})}(cjs$2);var socket={},cjs={},binary$1={},isBinary$1={};Object.defineProperty(isBinary$1,"__esModule",{value:!0}),isBinary$1.hasBinary=isBinary$1.isBinary=void 0;const withNativeArrayBuffer="function"==typeof ArrayBuffer,isView=e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer,toString$1=Object.prototype.toString,withNativeBlob="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===toString$1.call(Blob),withNativeFile="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===toString$1.call(File);function isBinary(e){return withNativeArrayBuffer&&(e instanceof ArrayBuffer||isView(e))||withNativeBlob&&e instanceof Blob||withNativeFile&&e instanceof File}function hasBinary(e,t){if(!e||"object"!=typeof e)return!1;if(Array.isArray(e)){for(let t=0,r=e.length;t<r;t++)if(hasBinary(e[t]))return!0;return!1}if(isBinary(e))return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1===arguments.length)return hasBinary(e.toJSON(),!0);for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)&&hasBinary(e[t]))return!0;return!1}isBinary$1.isBinary=isBinary,isBinary$1.hasBinary=hasBinary,Object.defineProperty(binary$1,"__esModule",{value:!0}),binary$1.reconstructPacket=binary$1.deconstructPacket=void 0;const is_binary_js_1=isBinary$1;function deconstructPacket(e){const t=[],r=e.data,n=e;return n.data=_deconstructPacket(r,t),n.attachments=t.length,{packet:n,buffers:t}}function _deconstructPacket(e,t){if(!e)return e;if(is_binary_js_1.isBinary(e)){const r={_placeholder:!0,num:t.length};return t.push(e),r}if(Array.isArray(e)){const r=new Array(e.length);for(let n=0;n<e.length;n++)r[n]=_deconstructPacket(e[n],t);return r}if("object"==typeof e&&!(e instanceof Date)){const r={};for(const n in e)e.hasOwnProperty(n)&&(r[n]=_deconstructPacket(e[n],t));return r}return e}function reconstructPacket(e,t){return e.data=_reconstructPacket(e.data,t),e.attachments=void 0,e}function _reconstructPacket(e,t){if(!e)return e;if(e&&e._placeholder)return t[e.num];if(Array.isArray(e))for(let r=0;r<e.length;r++)e[r]=_reconstructPacket(e[r],t);else if("object"==typeof e)for(const r in e)e.hasOwnProperty(r)&&(e[r]=_reconstructPacket(e[r],t));return e}binary$1.deconstructPacket=deconstructPacket,binary$1.reconstructPacket=reconstructPacket,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Decoder=e.Encoder=e.PacketType=e.protocol=void 0;const t=componentEmitter,r=binary$1,n=isBinary$1,i=require$$0$b.default("socket.io-parser");var s;e.protocol=5,function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"}(s=e.PacketType||(e.PacketType={}));e.Encoder=class{encode(e){return i("encoding packet %j",e),e.type!==s.EVENT&&e.type!==s.ACK||!n.hasBinary(e)?[this.encodeAsString(e)]:(e.type=e.type===s.EVENT?s.BINARY_EVENT:s.BINARY_ACK,this.encodeAsBinary(e))}encodeAsString(e){let t=""+e.type;return e.type!==s.BINARY_EVENT&&e.type!==s.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data)),i("encoded %j as %s",e,t),t}encodeAsBinary(e){const t=r.deconstructPacket(e),n=this.encodeAsString(t.packet),i=t.buffers;return i.unshift(n),i}};class o extends t.Emitter{constructor(){super()}add(e){let t;if("string"==typeof e)t=this.decodeString(e),t.type===s.BINARY_EVENT||t.type===s.BINARY_ACK?(this.reconstructor=new a(t),0===t.attachments&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t);else{if(!n.isBinary(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t))}}decodeString(e){let t=0;const r={type:Number(e.charAt(0))};if(void 0===s[r.type])throw new Error("unknown packet type "+r.type);if(r.type===s.BINARY_EVENT||r.type===s.BINARY_ACK){const n=t+1;for(;"-"!==e.charAt(++t)&&t!=e.length;);const i=e.substring(n,t);if(i!=Number(i)||"-"!==e.charAt(t))throw new Error("Illegal attachments");r.attachments=Number(i)}if("/"===e.charAt(t+1)){const n=t+1;for(;++t;){if(","===e.charAt(t))break;if(t===e.length)break}r.nsp=e.substring(n,t)}else r.nsp="/";const n=e.charAt(t+1);if(""!==n&&Number(n)==n){const n=t+1;for(;++t;){const r=e.charAt(t);if(null==r||Number(r)!=r){--t;break}if(t===e.length)break}r.id=Number(e.substring(n,t+1))}if(e.charAt(++t)){const n=function(e){try{return JSON.parse(e)}catch(e){return!1}}(e.substr(t));if(!o.isPayloadValid(r.type,n))throw new Error("invalid payload");r.data=n}return i("decoded %s as %j",e,r),r}static isPayloadValid(e,t){switch(e){case s.CONNECT:return"object"==typeof t;case s.DISCONNECT:return void 0===t;case s.CONNECT_ERROR:return"string"==typeof t||"object"==typeof t;case s.EVENT:case s.BINARY_EVENT:return Array.isArray(t)&&t.length>0;case s.ACK:case s.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}e.Decoder=o;class a{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const e=r.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}}(cjs);var on$1={};function on(e,t,r){return e.on(t,r),function(){e.off(t,r)}}Object.defineProperty(on$1,"__esModule",{value:!0}),on$1.on=void 0,on$1.on=on;var __importDefault$3=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(socket,"__esModule",{value:!0}),socket.Socket=void 0;const socket_io_parser_1=cjs,on_js_1$1=on$1,component_emitter_1$1=componentEmitter,debug_1$1=__importDefault$3(require$$0$b),debug$7=debug_1$1.default("socket.io-client:socket"),RESERVED_EVENTS=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Socket extends component_emitter_1$1.Emitter{constructor(e,t,r){super(),this.connected=!1,this.disconnected=!0,this.receiveBuffer=[],this.sendBuffer=[],this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,r&&r.auth&&(this.auth=r.auth),this.io._autoConnect&&this.open()}subEvents(){if(this.subs)return;const e=this.io;this.subs=[on_js_1$1.on(e,"open",this.onopen.bind(this)),on_js_1$1.on(e,"packet",this.onpacket.bind(this)),on_js_1$1.on(e,"error",this.onerror.bind(this)),on_js_1$1.on(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(RESERVED_EVENTS.hasOwnProperty(e))throw new Error('"'+e+'" is a reserved event name');t.unshift(e);const r={type:socket_io_parser_1.PacketType.EVENT,data:t,options:{}};r.options.compress=!1!==this.flags.compress,"function"==typeof t[t.length-1]&&(debug$7("emitting packet with ack id %d",this.ids),this.acks[this.ids]=t.pop(),r.id=this.ids++);const n=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!n||!this.connected)?debug$7("discard packet as the transport is not currently writable"):this.connected?this.packet(r):this.sendBuffer.push(r),this.flags={},this}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){debug$7("transport is open - connecting"),"function"==typeof this.auth?this.auth((e=>{this.packet({type:socket_io_parser_1.PacketType.CONNECT,data:e})})):this.packet({type:socket_io_parser_1.PacketType.CONNECT,data:this.auth})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e){debug$7("close (%s)",e),this.connected=!1,this.disconnected=!0,delete this.id,this.emitReserved("disconnect",e)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case socket_io_parser_1.PacketType.CONNECT:if(e.data&&e.data.sid){const t=e.data.sid;this.onconnect(t)}else this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case socket_io_parser_1.PacketType.EVENT:case socket_io_parser_1.PacketType.BINARY_EVENT:this.onevent(e);break;case socket_io_parser_1.PacketType.ACK:case socket_io_parser_1.PacketType.BINARY_ACK:this.onack(e);break;case socket_io_parser_1.PacketType.DISCONNECT:this.ondisconnect();break;case socket_io_parser_1.PacketType.CONNECT_ERROR:const t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t)}}onevent(e){const t=e.data||[];debug$7("emitting event %j",t),null!=e.id&&(debug$7("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const r of t)r.apply(this,e)}super.emit.apply(this,e)}ack(e){const t=this;let r=!1;return function(...n){r||(r=!0,debug$7("sending ack %j",n),t.packet({type:socket_io_parser_1.PacketType.ACK,id:e,data:n}))}}onack(e){const t=this.acks[e.id];"function"==typeof t?(debug$7("calling ack %s with %j",e.id,e.data),t.apply(this,e.data),delete this.acks[e.id]):debug$7("bad ack %s",e.id)}onconnect(e){debug$7("socket connected with id %s",e),this.id=e,this.connected=!0,this.disconnected=!1,this.emitBuffered(),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach((e=>this.emitEvent(e))),this.receiveBuffer=[],this.sendBuffer.forEach((e=>this.packet(e))),this.sendBuffer=[]}ondisconnect(){debug$7("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach((e=>e())),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&(debug$7("performing disconnect (%s)",this.nsp),this.packet({type:socket_io_parser_1.PacketType.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}}socket.Socket=Socket;var backo2=Backoff;function Backoff(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Backoff.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),r=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-r:e+r}return 0|Math.min(e,this.max)},Backoff.prototype.reset=function(){this.attempts=0},Backoff.prototype.setMin=function(e){this.ms=e},Backoff.prototype.setMax=function(e){this.max=e},Backoff.prototype.setJitter=function(e){this.jitter=e};var __createBinding$2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),__setModuleDefault$2=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar$2=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding$2(t,e,r);return __setModuleDefault$2(t,e),t},__importDefault$2=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(manager,"__esModule",{value:!0}),manager.Manager=void 0;const engine_io_client_1=cjs$2,socket_js_1=socket,parser=__importStar$2(cjs),on_js_1=on$1,backo2_1=__importDefault$2(backo2),component_emitter_1=componentEmitter,debug_1=__importDefault$2(require$$0$b),debug$6=debug_1.default("socket.io-client:manager");class Manager extends component_emitter_1.Emitter{constructor(e,t){var r;super(),this.nsps={},this.subs=[],e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.opts=t,engine_io_client_1.installTimerFunctions(this,t),this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(r=t.randomizationFactor)&&void 0!==r?r:.5),this.backoff=new backo2_1.default({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this._readyState="closed",this.uri=e;const n=t.parser||parser;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this._autoConnect=!1!==t.autoConnect,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}randomizationFactor(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(e){if(debug$6("readyState %s",this._readyState),~this._readyState.indexOf("open"))return this;debug$6("opening %s",this.uri),this.engine=new engine_io_client_1.Socket(this.uri,this.opts);const t=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const n=on_js_1.on(t,"open",(function(){r.onopen(),e&&e()})),i=on_js_1.on(t,"error",(t=>{debug$6("error"),r.cleanup(),r._readyState="closed",this.emitReserved("error",t),e?e(t):r.maybeReconnectOnOpen()}));if(!1!==this._timeout){const e=this._timeout;debug$6("connect attempt will timeout after %d",e),0===e&&n();const r=this.setTimeoutFn((()=>{debug$6("connect attempt timed out after %d",e),n(),t.close(),t.emit("error",new Error("timeout"))}),e);this.opts.autoUnref&&r.unref(),this.subs.push((function(){clearTimeout(r)}))}return this.subs.push(n),this.subs.push(i),this}connect(e){return this.open(e)}onopen(){debug$6("open"),this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(on_js_1.on(e,"ping",this.onping.bind(this)),on_js_1.on(e,"data",this.ondata.bind(this)),on_js_1.on(e,"error",this.onerror.bind(this)),on_js_1.on(e,"close",this.onclose.bind(this)),on_js_1.on(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){this.decoder.add(e)}ondecoded(e){this.emitReserved("packet",e)}onerror(e){debug$6("error",e),this.emitReserved("error",e)}socket(e,t){let r=this.nsps[e];return r||(r=new socket_js_1.Socket(this,e,t),this.nsps[e]=r),r}_destroy(e){const t=Object.keys(this.nsps);for(const e of t){if(this.nsps[e].active)return void debug$6("socket %s is still active, skipping close",e)}this._close()}_packet(e){debug$6("writing packet %j",e);const t=this.encoder.encode(e);for(let r=0;r<t.length;r++)this.engine.write(t[r],e.options)}cleanup(){debug$6("cleanup"),this.subs.forEach((e=>e())),this.subs.length=0,this.decoder.destroy()}_close(){debug$6("disconnect"),this.skipReconnect=!0,this._reconnecting=!1,"opening"===this._readyState&&this.cleanup(),this.backoff.reset(),this._readyState="closed",this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e){debug$6("onclose"),this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)debug$6("reconnect failed"),this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();debug$6("will wait %dms before reconnect attempt",t),this._reconnecting=!0;const r=this.setTimeoutFn((()=>{e.skipReconnect||(debug$6("attempting reconnect"),this.emitReserved("reconnect_attempt",e.backoff.attempts),e.skipReconnect||e.open((t=>{t?(debug$6("reconnect attempt error"),e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",t)):(debug$6("reconnect success"),e.onreconnect())})))}),t);this.opts.autoUnref&&r.unref(),this.subs.push((function(){clearTimeout(r)}))}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}manager.Manager=Manager,function(e,t){var r=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.connect=t.io=t.Socket=t.Manager=t.protocol=void 0;const n=url$1,i=manager;Object.defineProperty(t,"Manager",{enumerable:!0,get:function(){return i.Manager}});const s=socket;Object.defineProperty(t,"Socket",{enumerable:!0,get:function(){return s.Socket}});const o=r(require$$0$b).default("socket.io-client"),a={};function u(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};const r=n.url(e,t.path||"/socket.io"),s=r.source,u=r.id,c=r.path,l=a[u]&&c in a[u].nsps;let h;return t.forceNew||t["force new connection"]||!1===t.multiplex||l?(o("ignoring socket cache for %s",s),h=new i.Manager(s,t)):(a[u]||(o("new io instance for %s",s),a[u]=new i.Manager(s,t)),h=a[u]),r.query&&!t.query&&(t.query=r.queryKey),h.socket(r.path,t)}t.io=u,t.connect=u,t.default=u,Object.assign(u,{Manager:i.Manager,Socket:s.Socket,io:u,connect:u});var c=cjs;Object.defineProperty(t,"protocol",{enumerable:!0,get:function(){return c.protocol}}),e.exports=u}(cjs$3,cjs$3.exports);var streamToIt={exports:{}},source=e=>{if(e[Symbol.asyncIterator])return e;if(e.getReader)return async function*(){const t=e.getReader();try{for(;;){const{done:e,value:r}=await t.read();if(e)return;yield r}}finally{t.releaseLock()}}();throw new Error("unknown stream")};const getIterator$1=getIterator$3;var sink=e=>async t=>{t=getIterator$1(t);const r=e=>{"function"==typeof e.return&&e.return()};let n=null,i=null;const s=e=>{n=e,i&&i(e),r(t)};let o=null,a=!1;const u=()=>{a=!0,o&&o()};let c=null,l=!1;const h=()=>{l=!0,c&&c()};let d=null;const f=()=>{d&&d()};e.once("error",s),e.once("close",u),e.once("finish",h);try{for await(const r of t){if(!e.writable||e.destroyed||n)break;!1===e.write(r)&&await new Promise(((t,r)=>{o=d=t,i=r,e.once("drain",f)}))}}catch(t){n||e.destroy(),n=t}try{if(e.writable&&e.end(),await(r(t),new Promise(((e,t)=>{if(a||l||n)return e();c=o=e,i=t}))),n)throw n}finally{e.removeListener("error",s),e.removeListener("close",u),e.removeListener("finish",h),e.removeListener("drain",f)}};const toSink=sink,toSource=source;var duplex$1=e=>({sink:toSink(e),source:toSource(e)});const toDuplex=duplex$1;var transform=e=>async function*(t){const r=toDuplex(e);let n;if(r.sink(t).catch((e=>{n=e})),yield*r.source,n)throw n};streamToIt.exports=source,streamToIt.exports.source=source,streamToIt.exports.sink=sink,streamToIt.exports.transform=transform,streamToIt.exports.duplex=duplex$1;const abortable$3=abortableIterator.exports,toIterable=streamToIt.exports,{CLOSE_TIMEOUT:CLOSE_TIMEOUT}=constants$1,toMultiaddr=ipPortToMultiaddr$1.exports,debug$5=require$$0$b,log$6=debug$5("libp2p:webrtc-star:socket");log$6.error=debug$5("libp2p:webrtc-star:socket:error");const toWebrtcMultiaddr=(e,t)=>{if(e&&t)try{return toMultiaddr(e,t)}catch(e){return log$6.error(e),toMultiaddr("0.0.0.0",t)}};var socketToConn=(e,t={})=>{const{sink:r,source:n}=toIterable.duplex(e),i=t.remoteAddr||toWebrtcMultiaddr(e.remoteAddress,e.remotePort),s=toWebrtcMultiaddr(e.localAddress,e.localPort),o={async sink(e){t.signal&&(e=abortable$3(e,t.signal));try{await r(async function*(){for await(const t of e)yield t instanceof Uint8Array?t:t.slice()}())}catch(e){"aborted"!==e.type&&log$6.error(e)}},source:t.signal?abortable$3(n,t.signal):n,conn:e,localAddr:s,remoteAddr:i,timeline:{open:Date.now()},close(){if(!e.destroyed)return new Promise(((t,r)=>{const n=Date.now(),i=setTimeout((()=>{if(o.remoteAddr){const{host:e,port:t}=o.remoteAddr.toOptions();log$6("timeout closing socket to %s:%s after %dms, destroying it manually",e,t,Date.now()-n)}e.destroyed||e.destroy()}),CLOSE_TIMEOUT);e.once("close",(()=>{t()})),e.end((e=>{if(clearTimeout(i),o.timeline.close=Date.now(),e)return r(e)}))}))}};return e.once("close",(()=>{o.timeline.close||(o.timeline.close=Date.now())})),o};const{Multiaddr:Multiaddr$1}=src$o;function cleanUrlSIO$2(e){const t=e.toString().split("/"),r=e.protos()[1].name,n=e.protos()[2].name,i=e.stringTuples()[1][1];if("tcp"!==r||"ws"!==n&&"wss"!==n)throw new Error("invalid multiaddr: "+e.toString());return Multiaddr$1.isName(e)?"ws"===n?"http://"+t[2]+("80"===i?"":":"+i):"wss"===n?"https://"+t[2]+("443"===i?"":":"+i):void 0:"http://"+t[2]+":"+t[4]}function cleanMultiaddr$1(e){const t="/libp2p-webrtc-star";if(-1!==e.indexOf(t)){e=e.substring(t.length,e.length);let r=new Multiaddr$1(e);const n=r.stringTuples().filter((e=>421===e[0]))[0];r=r.decapsulate("p2p"),r=r.encapsulate("/p2p-webrtc-star"),r=r.encapsulate(`/p2p/${n[1]}`),e=r.toString()}return e}var utils$r={cleanUrlSIO:cleanUrlSIO$2,cleanMultiaddr:cleanMultiaddr$1};const EventEmitter$4=require$$1$9,debug$4=require$$0$b,log$5=debug$4("libp2p:webrtc-star:listener");log$5.error=debug$4("libp2p:webrtc-star:listener:error");const errCode$1=errCode$m,io=cjs$3.exports,SimplePeer$1=libp2pWebrtcPeer,pDefer=pDefer_1,toConnection$1=socketToConn,{cleanUrlSIO:cleanUrlSIO$1}=utils$r,{CODE_P2P:CODE_P2P}=constants$1,sioOptions={transports:["websocket"],"force new connection":!0,path:"/socket.io-next/"};var listener=({handler:e,upgrader:t},r,n={})=>{const i=new EventEmitter$4;let s,o;return i.__connections=[],i.__spChannels=new Map,i.__pendingIntents=new Map,i.listen=a=>{if(s)throw errCode$1(new Error("listener already in use"),"ERR_ALREADY_LISTENING");const u=pDefer();let c;s=a,c=!a.protoCodes().includes(CODE_P2P)&&t.localPeer?a.encapsulate(`/p2p/${t.localPeer.toB58String()}`):a,i.on("error",(()=>u.reject())),o=cleanUrlSIO$1(a),log$5("Dialing to Signalling Server on: "+o),i.io=io.connect(o,sioOptions);return i.io.once("connect_error",(e=>u.reject(e))),i.io.once("error",(e=>{i.emit("error",e),i.emit("close")})),i.io.on("ws-handshake",(s=>{if(s.answer||s.err||!s.intentId)return;const o=s.intentId;let u=i.__pendingIntents.get(o);u||(u=[],i.__pendingIntents.set(o,u));let c=i.__spChannels.get(o);if(c)return void c.signal(s.signal);if("offer"!==s.signal.type)return void u.push(s);const l={trickle:!1,...n};r.wrtc&&(l.wrtc=r.wrtc),c=new SimplePeer$1(l);const h=e=>{log$5.error("incoming connection errored",e)};c.on("error",h),c.once("close",((...e)=>{c.removeListener("error",h)})),c.on("signal",(e=>{s.signal=e,s.answer=!0,i.io.emit("ss-handshake",s)})),c.signal(s.signal);for(const e of u)c.signal(e.signal);i.__pendingIntents.set(o,[]),c.once("connect",(async()=>{const r=toConnection$1(c);let n;log$5("new inbound connection %s",r.remoteAddr);try{n=await t.upgradeInbound(r)}catch(e){return log$5.error("inbound connection failed to upgrade",e),r.close()}if(!n.remoteAddr)try{n.remoteAddr=a.decapsulateCode(CODE_P2P).encapsulate(`/p2p/${n.remotePeer.toB58String()}`)}catch(e){log$5.error("could not determine remote address",e)}log$5("inbound connection %s upgraded",r.remoteAddr),trackConn(i,r,o),i.emit("connection",n),e(n)})),i.__spChannels.set(o,c)})),i.io.on("ws-peer",r._peerDiscovered),i.io.on("connect",(()=>{i.io.emit("ss-join",c.toString())})),i.io.once("connect",(()=>{i.emit("listening"),u.resolve()})),r.sigReferences.set(o,{listener:i,signallingAddr:c}),u.promise},i.close=async()=>{const e=r.sigReferences.get(o);e&&e.listener.io&&(e.listener.io.emit("ss-leave"),e.listener.io.close()),await Promise.all(i.__connections.map((e=>e.close()))),i.emit("close"),i.removeAllListeners(),s=void 0,r.sigReferences.delete(o)},i.getAddrs=()=>[s],i};function trackConn(e,t,r){e.__connections.push(t);t.conn.once("close",(()=>{e.__connections=e.__connections.filter((e=>e!==t)),e.__spChannels.delete(r),e.__pendingIntents.delete(r)}))}const debug$3=require$$0$b,log$4=debug$3("libp2p:webrtc-star");log$4.error=debug$3("libp2p:webrtc-star:error");const{EventEmitter:EventEmitter$3}=require$$1$9,errcode$t=errCode$m,withIs=classIs.exports,{AbortError:AbortError}=abortableIterator.exports,SimplePeer=libp2pWebrtcPeer,{supportsWebRTCDataChannels:webrtcSupport}=supports,{Multiaddr:Multiaddr}=src$o,mafmt=src$j,PeerId$2=src$a.exports,{CODE_CIRCUIT:CODE_CIRCUIT}=constants$1,createListener=listener,toConnection=socketToConn,{cleanMultiaddr:cleanMultiaddr,cleanUrlSIO:cleanUrlSIO}=utils$r;function noop(){}class WebRTCStar{constructor(e={}){if(!e.upgrader)throw new Error("An upgrader must be provided. See https://github.com/libp2p/interface-transport#upgrader.");this._upgrader=e.upgrader,this.sioOptions={transports:["websocket"],"force new connection":!0},e.wrtc&&(this.wrtc=e.wrtc),this.sigReferences=new Map,this.discovery=new EventEmitter$3,this.discovery.tag="webRTCStar",this.discovery._isStarted=!1,this.discovery.start=()=>{this.discovery._isStarted=!0},this.discovery.stop=()=>{this.discovery._isStarted=!1},this._peerDiscovered=this._peerDiscovered.bind(this)}async dial(e,t={}){const r=await this._connect(e,t),n=toConnection(r,{remoteAddr:e,signal:t.signal});log$4("new outbound connection %s",n.remoteAddr);const i=await this._upgrader.upgradeOutbound(n);return log$4("outbound connection %s upgraded",n.remoteAddr),i}_connect(e,t={}){if(t.signal&&t.signal.aborted)throw new AbortError;const r={initiator:!0,trickle:!1,...t.spOptions||{}};this.wrtc&&(r.wrtc=this.wrtc);const n=e.toOptions(),i=(~~(1e9*Math.random())).toString(36)+Date.now();return new Promise(((s,o)=>{const a=this.sigReferences.get(cleanUrlSIO(e));if(!a||!a.listener)return o(errcode$t(new Error("unknown signal server to use"),"ERR_UNKNOWN_SIGNAL_SERVER"));const u=a.listener.io,c=Date.now();let l;log$4("dialing %s:%s",n.host,n.port);const h=new SimplePeer(r),d=e=>{if(!l){const t=`connection error ${n.host}:${n.port}: ${e.message}`;log$4.error(t),g(e)}},f=()=>{log$4("connnection timeout %s:%s",n.host,n.port);const e=errcode$t(new Error(`connection timeout after ${Date.now()-c}ms`),"ERR_CONNECT_TIMEOUT");h.emit("error",e)},p=()=>{l=!0,log$4("connection opened %s:%s",n.host,n.port),g(null)},y=()=>{log$4.error("connection aborted %s:%s",n.host,n.port),h.destroy(),g(new AbortError)},g=e=>{h.removeListener("timeout",f),h.removeListener("connect",p),t.signal&&t.signal.removeEventListener("abort",y),e?o(e):s(h)};h.on("error",d),h.once("timeout",f),h.once("connect",p),h.on("close",(()=>{h.removeListener("error",d)})),t.signal&&t.signal.addEventListener("abort",y),h.on("signal",(t=>{u.emit("ss-handshake",{intentId:i,srcMultiaddr:a.signallingAddr.toString(),dstMultiaddr:e.toString(),signal:t})})),u.on("ws-handshake",(e=>{e.intentId===i&&e.err&&(h.destroy(),o(errcode$t(e.err instanceof Error?e.err:new Error(e.err),"ERR_SIGNALLING_FAILED"))),e.intentId===i&&e.answer&&!h.destroyed&&h.signal(e.signal)}))}))}createListener(e={},t){if(!webrtcSupport&&!this.wrtc)throw errcode$t(new Error("no WebRTC support"),"ERR_NO_WEBRTC_SUPPORT");return"function"==typeof e&&(t=e,e={}),createListener({handler:t=t||noop,upgrader:this._upgrader},this,e)}filter(e){return(e=Array.isArray(e)?e:[e]).filter((e=>!e.protoCodes().includes(CODE_CIRCUIT)&&mafmt.WebRTCStar.matches(e)))}_peerDiscovered(e){if(!this.discovery._isStarted)return;log$4("Peer Discovered:",e),e=cleanMultiaddr(e);const t=new Multiaddr(e),r=PeerId$2.createFromB58String(t.getPeerId());this.discovery.emit("peer",{id:r,multiaddrs:[t]})}}var src$9=withIs(WebRTCStar,{className:"WebRTCStar",symbolName:"@libp2p/js-libp2p-webrtc-star/webrtcstar"}),src$8={},noise={},x25519$2={},random={},system={},browser={};Object.defineProperty(browser,"__esModule",{value:!0});var QUOTA=65536,BrowserRandomSource=function(){function e(){this.isAvailable=!1,this.isInstantiated=!1;var e="undefined"!=typeof self?self.crypto||self.msCrypto:null;e&&e.getRandomValues&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}return e.prototype.randomBytes=function(e){if(!this.isAvailable||!this._crypto)throw new Error("Browser random byte generator is not available.");for(var t=new Uint8Array(e),r=0;r<t.length;r+=QUOTA)this._crypto.getRandomValues(t.subarray(r,r+Math.min(t.length-r,QUOTA)));return t},e}();browser.BrowserRandomSource=BrowserRandomSource;var node={},wipe$1={};function wipe(e){for(var t=0;t<e.length;t++)e[t]=0;return e}Object.defineProperty(wipe$1,"__esModule",{value:!0}),wipe$1.wipe=wipe,Object.defineProperty(node,"__esModule",{value:!0});var wipe_1$3=wipe$1,NodeRandomSource=function(){function e(){if(this.isAvailable=!1,this.isInstantiated=!1,void 0!==commonjsRequire){var e=require$$0$9;e&&e.randomBytes&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}}return e.prototype.randomBytes=function(e){if(!this.isAvailable||!this._crypto)throw new Error("Node.js random byte generator is not available.");var t=this._crypto.randomBytes(e);if(t.length!==e)throw new Error("NodeRandomSource: got fewer bytes than requested");for(var r=new Uint8Array(e),n=0;n<r.length;n++)r[n]=t[n];return wipe_1$3.wipe(t),r},e}();node.NodeRandomSource=NodeRandomSource,Object.defineProperty(system,"__esModule",{value:!0});var browser_1=browser,node_1=node,SystemRandomSource=function(){function e(){return this.isAvailable=!1,this.name="",this._source=new browser_1.BrowserRandomSource,this._source.isAvailable?(this.isAvailable=!0,void(this.name="Browser")):(this._source=new node_1.NodeRandomSource,this._source.isAvailable?(this.isAvailable=!0,void(this.name="Node")):void 0)}return e.prototype.randomBytes=function(e){if(!this.isAvailable)throw new Error("System random byte generator is not available.");return this._source.randomBytes(e)},e}();system.SystemRandomSource=SystemRandomSource;var binary={},int={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.mul=Math.imul||function(e,t){var r=65535&e,n=65535&t;return r*n+((e>>>16&65535)*n+r*(t>>>16&65535)<<16>>>0)|0},e.add=function(e,t){return e+t|0},e.sub=function(e,t){return e-t|0},e.rotl=function(e,t){return e<<t|e>>>32-t},e.rotr=function(e,t){return e<<32-t|e>>>t},e.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},e.MAX_SAFE_INTEGER=9007199254740991,e.isSafeInteger=function(t){return e.isInteger(t)&&t>=-e.MAX_SAFE_INTEGER&&t<=e.MAX_SAFE_INTEGER}}(int),Object.defineProperty(binary,"__esModule",{value:!0});var int_1=int;function readInt16BE(e,t){return void 0===t&&(t=0),(e[t+0]<<8|e[t+1])<<16>>16}function readUint16BE(e,t){return void 0===t&&(t=0),(e[t+0]<<8|e[t+1])>>>0}function readInt16LE(e,t){return void 0===t&&(t=0),(e[t+1]<<8|e[t])<<16>>16}function readUint16LE(e,t){return void 0===t&&(t=0),(e[t+1]<<8|e[t])>>>0}function writeUint16BE(e,t,r){return void 0===t&&(t=new Uint8Array(2)),void 0===r&&(r=0),t[r+0]=e>>>8,t[r+1]=e>>>0,t}function writeUint16LE(e,t,r){return void 0===t&&(t=new Uint8Array(2)),void 0===r&&(r=0),t[r+0]=e>>>0,t[r+1]=e>>>8,t}function readInt32BE(e,t){return void 0===t&&(t=0),e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function readUint32BE(e,t){return void 0===t&&(t=0),(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}function readInt32LE(e,t){return void 0===t&&(t=0),e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t]}function readUint32LE(e,t){return void 0===t&&(t=0),(e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t])>>>0}function writeUint32BE(e,t,r){return void 0===t&&(t=new Uint8Array(4)),void 0===r&&(r=0),t[r+0]=e>>>24,t[r+1]=e>>>16,t[r+2]=e>>>8,t[r+3]=e>>>0,t}function writeUint32LE(e,t,r){return void 0===t&&(t=new Uint8Array(4)),void 0===r&&(r=0),t[r+0]=e>>>0,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24,t}function readInt64BE(e,t){void 0===t&&(t=0);var r=readInt32BE(e,t),n=readInt32BE(e,t+4);return 4294967296*r+n-4294967296*(n>>31)}function readUint64BE(e,t){return void 0===t&&(t=0),4294967296*readUint32BE(e,t)+readUint32BE(e,t+4)}function readInt64LE(e,t){void 0===t&&(t=0);var r=readInt32LE(e,t);return 4294967296*readInt32LE(e,t+4)+r-4294967296*(r>>31)}function readUint64LE(e,t){void 0===t&&(t=0);var r=readUint32LE(e,t);return 4294967296*readUint32LE(e,t+4)+r}function writeUint64BE(e,t,r){return void 0===t&&(t=new Uint8Array(8)),void 0===r&&(r=0),writeUint32BE(e/4294967296>>>0,t,r),writeUint32BE(e>>>0,t,r+4),t}function writeUint64LE(e,t,r){return void 0===t&&(t=new Uint8Array(8)),void 0===r&&(r=0),writeUint32LE(e>>>0,t,r),writeUint32LE(e/4294967296>>>0,t,r+4),t}function readUintBE(e,t,r){if(void 0===r&&(r=0),e%8!=0)throw new Error("readUintBE supports only bitLengths divisible by 8");if(e/8>t.length-r)throw new Error("readUintBE: array is too short for the given bitLength");for(var n=0,i=1,s=e/8+r-1;s>=r;s--)n+=t[s]*i,i*=256;return n}function readUintLE(e,t,r){if(void 0===r&&(r=0),e%8!=0)throw new Error("readUintLE supports only bitLengths divisible by 8");if(e/8>t.length-r)throw new Error("readUintLE: array is too short for the given bitLength");for(var n=0,i=1,s=r;s<r+e/8;s++)n+=t[s]*i,i*=256;return n}function writeUintBE(e,t,r,n){if(void 0===r&&(r=new Uint8Array(e/8)),void 0===n&&(n=0),e%8!=0)throw new Error("writeUintBE supports only bitLengths divisible by 8");if(!int_1.isSafeInteger(t))throw new Error("writeUintBE value must be an integer");for(var i=1,s=e/8+n-1;s>=n;s--)r[s]=t/i&255,i*=256;return r}function writeUintLE(e,t,r,n){if(void 0===r&&(r=new Uint8Array(e/8)),void 0===n&&(n=0),e%8!=0)throw new Error("writeUintLE supports only bitLengths divisible by 8");if(!int_1.isSafeInteger(t))throw new Error("writeUintLE value must be an integer");for(var i=1,s=n;s<n+e/8;s++)r[s]=t/i&255,i*=256;return r}function readFloat32BE(e,t){return void 0===t&&(t=0),new DataView(e.buffer,e.byteOffset,e.byteLength).getFloat32(t)}function readFloat32LE(e,t){return void 0===t&&(t=0),new DataView(e.buffer,e.byteOffset,e.byteLength).getFloat32(t,!0)}function readFloat64BE(e,t){return void 0===t&&(t=0),new DataView(e.buffer,e.byteOffset,e.byteLength).getFloat64(t)}function readFloat64LE(e,t){return void 0===t&&(t=0),new DataView(e.buffer,e.byteOffset,e.byteLength).getFloat64(t,!0)}function writeFloat32BE(e,t,r){return void 0===t&&(t=new Uint8Array(4)),void 0===r&&(r=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat32(r,e),t}function writeFloat32LE(e,t,r){return void 0===t&&(t=new Uint8Array(4)),void 0===r&&(r=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat32(r,e,!0),t}function writeFloat64BE(e,t,r){return void 0===t&&(t=new Uint8Array(8)),void 0===r&&(r=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat64(r,e),t}function writeFloat64LE(e,t,r){return void 0===t&&(t=new Uint8Array(8)),void 0===r&&(r=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat64(r,e,!0),t}binary.readInt16BE=readInt16BE,binary.readUint16BE=readUint16BE,binary.readInt16LE=readInt16LE,binary.readUint16LE=readUint16LE,binary.writeUint16BE=writeUint16BE,binary.writeInt16BE=writeUint16BE,binary.writeUint16LE=writeUint16LE,binary.writeInt16LE=writeUint16LE,binary.readInt32BE=readInt32BE,binary.readUint32BE=readUint32BE,binary.readInt32LE=readInt32LE,binary.readUint32LE=readUint32LE,binary.writeUint32BE=writeUint32BE,binary.writeInt32BE=writeUint32BE,binary.writeUint32LE=writeUint32LE,binary.writeInt32LE=writeUint32LE,binary.readInt64BE=readInt64BE,binary.readUint64BE=readUint64BE,binary.readInt64LE=readInt64LE,binary.readUint64LE=readUint64LE,binary.writeUint64BE=writeUint64BE,binary.writeInt64BE=writeUint64BE,binary.writeUint64LE=writeUint64LE,binary.writeInt64LE=writeUint64LE,binary.readUintBE=readUintBE,binary.readUintLE=readUintLE,binary.writeUintBE=writeUintBE,binary.writeUintLE=writeUintLE,binary.readFloat32BE=readFloat32BE,binary.readFloat32LE=readFloat32LE,binary.readFloat64BE=readFloat64BE,binary.readFloat64LE=readFloat64LE,binary.writeFloat32BE=writeFloat32BE,binary.writeFloat32LE=writeFloat32LE,binary.writeFloat64BE=writeFloat64BE,binary.writeFloat64LE=writeFloat64LE,function(e){Object.defineProperty(e,"__esModule",{value:!0});var t=system,r=binary,n=wipe$1;function i(t,r){return void 0===r&&(r=e.defaultRandomSource),r.randomBytes(t)}e.defaultRandomSource=new t.SystemRandomSource,e.randomBytes=i,e.randomUint32=function(t){void 0===t&&(t=e.defaultRandomSource);var s=i(4,t),o=r.readUint32LE(s);return n.wipe(s),o};var s="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function o(t,r,o){if(void 0===r&&(r=s),void 0===o&&(o=e.defaultRandomSource),r.length<2)throw new Error("randomString charset is too short");if(r.length>256)throw new Error("randomString charset is too long");for(var a="",u=r.length,c=256-256%u;t>0;){for(var l=i(Math.ceil(256*t/c),o),h=0;h<l.length&&t>0;h++){var d=l[h];d<c&&(a+=r.charAt(d%u),t--)}n.wipe(l)}return a}e.randomString=o,e.randomStringForEntropy=function(t,r,n){return void 0===r&&(r=s),void 0===n&&(n=e.defaultRandomSource),o(Math.ceil(t/(Math.log(r.length)/Math.LN2)),r,n)}}(random),function(e){Object.defineProperty(e,"__esModule",{value:!0});var t=random,r=wipe$1;function n(e){var t=new Float64Array(16);if(e)for(var r=0;r<e.length;r++)t[r]=e[r];return t}e.PUBLIC_KEY_LENGTH=32,e.SECRET_KEY_LENGTH=32,e.SHARED_KEY_LENGTH=32;var i=new Uint8Array(32);i[0]=9;var s=n([56129,1]);function o(e){for(var t=1,r=0;r<16;r++){var n=e[r]+t+65535;t=Math.floor(n/65536),e[r]=n-65536*t}e[0]+=t-1+37*(t-1)}function a(e,t,r){for(var n=~(r-1),i=0;i<16;i++){var s=n&(e[i]^t[i]);e[i]^=s,t[i]^=s}}function u(e,t,r){for(var n=0;n<16;n++)e[n]=t[n]+r[n]}function c(e,t,r){for(var n=0;n<16;n++)e[n]=t[n]-r[n]}function l(e,t,r){var n,i,s=0,o=0,a=0,u=0,c=0,l=0,h=0,d=0,f=0,p=0,y=0,g=0,$=0,m=0,b=0,v=0,_=0,w=0,E=0,S=0,A=0,T=0,I=0,P=0,R=0,C=0,B=0,k=0,K=0,O=0,N=0,D=r[0],M=r[1],L=r[2],x=r[3],U=r[4],j=r[5],q=r[6],F=r[7],V=r[8],H=r[9],z=r[10],G=r[11],W=r[12],Y=r[13],X=r[14],Q=r[15];s+=(n=t[0])*D,o+=n*M,a+=n*L,u+=n*x,c+=n*U,l+=n*j,h+=n*q,d+=n*F,f+=n*V,p+=n*H,y+=n*z,g+=n*G,$+=n*W,m+=n*Y,b+=n*X,v+=n*Q,o+=(n=t[1])*D,a+=n*M,u+=n*L,c+=n*x,l+=n*U,h+=n*j,d+=n*q,f+=n*F,p+=n*V,y+=n*H,g+=n*z,$+=n*G,m+=n*W,b+=n*Y,v+=n*X,_+=n*Q,a+=(n=t[2])*D,u+=n*M,c+=n*L,l+=n*x,h+=n*U,d+=n*j,f+=n*q,p+=n*F,y+=n*V,g+=n*H,$+=n*z,m+=n*G,b+=n*W,v+=n*Y,_+=n*X,w+=n*Q,u+=(n=t[3])*D,c+=n*M,l+=n*L,h+=n*x,d+=n*U,f+=n*j,p+=n*q,y+=n*F,g+=n*V,$+=n*H,m+=n*z,b+=n*G,v+=n*W,_+=n*Y,w+=n*X,E+=n*Q,c+=(n=t[4])*D,l+=n*M,h+=n*L,d+=n*x,f+=n*U,p+=n*j,y+=n*q,g+=n*F,$+=n*V,m+=n*H,b+=n*z,v+=n*G,_+=n*W,w+=n*Y,E+=n*X,S+=n*Q,l+=(n=t[5])*D,h+=n*M,d+=n*L,f+=n*x,p+=n*U,y+=n*j,g+=n*q,$+=n*F,m+=n*V,b+=n*H,v+=n*z,_+=n*G,w+=n*W,E+=n*Y,S+=n*X,A+=n*Q,h+=(n=t[6])*D,d+=n*M,f+=n*L,p+=n*x,y+=n*U,g+=n*j,$+=n*q,m+=n*F,b+=n*V,v+=n*H,_+=n*z,w+=n*G,E+=n*W,S+=n*Y,A+=n*X,T+=n*Q,d+=(n=t[7])*D,f+=n*M,p+=n*L,y+=n*x,g+=n*U,$+=n*j,m+=n*q,b+=n*F,v+=n*V,_+=n*H,w+=n*z,E+=n*G,S+=n*W,A+=n*Y,T+=n*X,I+=n*Q,f+=(n=t[8])*D,p+=n*M,y+=n*L,g+=n*x,$+=n*U,m+=n*j,b+=n*q,v+=n*F,_+=n*V,w+=n*H,E+=n*z,S+=n*G,A+=n*W,T+=n*Y,I+=n*X,P+=n*Q,p+=(n=t[9])*D,y+=n*M,g+=n*L,$+=n*x,m+=n*U,b+=n*j,v+=n*q,_+=n*F,w+=n*V,E+=n*H,S+=n*z,A+=n*G,T+=n*W,I+=n*Y,P+=n*X,R+=n*Q,y+=(n=t[10])*D,g+=n*M,$+=n*L,m+=n*x,b+=n*U,v+=n*j,_+=n*q,w+=n*F,E+=n*V,S+=n*H,A+=n*z,T+=n*G,I+=n*W,P+=n*Y,R+=n*X,C+=n*Q,g+=(n=t[11])*D,$+=n*M,m+=n*L,b+=n*x,v+=n*U,_+=n*j,w+=n*q,E+=n*F,S+=n*V,A+=n*H,T+=n*z,I+=n*G,P+=n*W,R+=n*Y,C+=n*X,B+=n*Q,$+=(n=t[12])*D,m+=n*M,b+=n*L,v+=n*x,_+=n*U,w+=n*j,E+=n*q,S+=n*F,A+=n*V,T+=n*H,I+=n*z,P+=n*G,R+=n*W,C+=n*Y,B+=n*X,k+=n*Q,m+=(n=t[13])*D,b+=n*M,v+=n*L,_+=n*x,w+=n*U,E+=n*j,S+=n*q,A+=n*F,T+=n*V,I+=n*H,P+=n*z,R+=n*G,C+=n*W,B+=n*Y,k+=n*X,K+=n*Q,b+=(n=t[14])*D,v+=n*M,_+=n*L,w+=n*x,E+=n*U,S+=n*j,A+=n*q,T+=n*F,I+=n*V,P+=n*H,R+=n*z,C+=n*G,B+=n*W,k+=n*Y,K+=n*X,O+=n*Q,v+=(n=t[15])*D,o+=38*(w+=n*L),a+=38*(E+=n*x),u+=38*(S+=n*U),c+=38*(A+=n*j),l+=38*(T+=n*q),h+=38*(I+=n*F),d+=38*(P+=n*V),f+=38*(R+=n*H),p+=38*(C+=n*z),y+=38*(B+=n*G),g+=38*(k+=n*W),$+=38*(K+=n*Y),m+=38*(O+=n*X),b+=38*(N+=n*Q),s=(n=(s+=38*(_+=n*M))+(i=1)+65535)-65536*(i=Math.floor(n/65536)),o=(n=o+i+65535)-65536*(i=Math.floor(n/65536)),a=(n=a+i+65535)-65536*(i=Math.floor(n/65536)),u=(n=u+i+65535)-65536*(i=Math.floor(n/65536)),c=(n=c+i+65535)-65536*(i=Math.floor(n/65536)),l=(n=l+i+65535)-65536*(i=Math.floor(n/65536)),h=(n=h+i+65535)-65536*(i=Math.floor(n/65536)),d=(n=d+i+65535)-65536*(i=Math.floor(n/65536)),f=(n=f+i+65535)-65536*(i=Math.floor(n/65536)),p=(n=p+i+65535)-65536*(i=Math.floor(n/65536)),y=(n=y+i+65535)-65536*(i=Math.floor(n/65536)),g=(n=g+i+65535)-65536*(i=Math.floor(n/65536)),$=(n=$+i+65535)-65536*(i=Math.floor(n/65536)),m=(n=m+i+65535)-65536*(i=Math.floor(n/65536)),b=(n=b+i+65535)-65536*(i=Math.floor(n/65536)),v=(n=v+i+65535)-65536*(i=Math.floor(n/65536)),s=(n=(s+=i-1+37*(i-1))+(i=1)+65535)-65536*(i=Math.floor(n/65536)),o=(n=o+i+65535)-65536*(i=Math.floor(n/65536)),a=(n=a+i+65535)-65536*(i=Math.floor(n/65536)),u=(n=u+i+65535)-65536*(i=Math.floor(n/65536)),c=(n=c+i+65535)-65536*(i=Math.floor(n/65536)),l=(n=l+i+65535)-65536*(i=Math.floor(n/65536)),h=(n=h+i+65535)-65536*(i=Math.floor(n/65536)),d=(n=d+i+65535)-65536*(i=Math.floor(n/65536)),f=(n=f+i+65535)-65536*(i=Math.floor(n/65536)),p=(n=p+i+65535)-65536*(i=Math.floor(n/65536)),y=(n=y+i+65535)-65536*(i=Math.floor(n/65536)),g=(n=g+i+65535)-65536*(i=Math.floor(n/65536)),$=(n=$+i+65535)-65536*(i=Math.floor(n/65536)),m=(n=m+i+65535)-65536*(i=Math.floor(n/65536)),b=(n=b+i+65535)-65536*(i=Math.floor(n/65536)),v=(n=v+i+65535)-65536*(i=Math.floor(n/65536)),s+=i-1+37*(i-1),e[0]=s,e[1]=o,e[2]=a,e[3]=u,e[4]=c,e[5]=l,e[6]=h,e[7]=d,e[8]=f,e[9]=p,e[10]=y,e[11]=g,e[12]=$,e[13]=m,e[14]=b,e[15]=v}function h(e,t){l(e,t,t)}function d(e,t){for(var r=new Uint8Array(32),i=new Float64Array(80),d=n(),f=n(),p=n(),y=n(),g=n(),$=n(),m=0;m<31;m++)r[m]=e[m];r[31]=127&e[31]|64,r[0]&=248,function(e,t){for(var r=0;r<16;r++)e[r]=t[2*r]+(t[2*r+1]<<8);e[15]&=32767}(i,t);for(m=0;m<16;m++)f[m]=i[m];d[0]=y[0]=1;for(m=254;m>=0;--m){var b=r[m>>>3]>>>(7&m)&1;a(d,f,b),a(p,y,b),u(g,d,p),c(d,d,p),u(p,f,y),c(f,f,y),h(y,g),h($,d),l(d,p,d),l(p,f,g),u(g,d,p),c(d,d,p),h(f,d),c(p,y,$),l(d,p,s),u(d,d,y),l(p,p,d),l(d,y,$),l(y,f,i),h(f,g),a(d,f,b),a(p,y,b)}for(m=0;m<16;m++)i[m+16]=d[m],i[m+32]=p[m],i[m+48]=f[m],i[m+64]=y[m];var v=i.subarray(32),_=i.subarray(16);!function(e,t){for(var r=n(),i=0;i<16;i++)r[i]=t[i];for(i=253;i>=0;i--)h(r,r),2!==i&&4!==i&&l(r,r,t);for(i=0;i<16;i++)e[i]=r[i]}(v,v),l(_,_,v);var w=new Uint8Array(32);return function(e,t){for(var r=n(),i=n(),s=0;s<16;s++)i[s]=t[s];o(i),o(i),o(i);for(var u=0;u<2;u++){for(r[0]=i[0]-65517,s=1;s<15;s++)r[s]=i[s]-65535-(r[s-1]>>16&1),r[s-1]&=65535;r[15]=i[15]-32767-(r[14]>>16&1);var c=r[15]>>16&1;r[14]&=65535,a(i,r,1-c)}for(s=0;s<16;s++)e[2*s]=255&i[s],e[2*s+1]=i[s]>>8}(w,_),w}function f(e){return d(e,i)}function p(t){if(t.length!==e.SECRET_KEY_LENGTH)throw new Error("x25519: seed must be "+e.SECRET_KEY_LENGTH+" bytes");var r=new Uint8Array(t);return{publicKey:f(r),secretKey:r}}e.scalarMult=d,e.scalarMultBase=f,e.generateKeyPairFromSeed=p,e.generateKeyPair=function(e){var n=t.randomBytes(32,e),i=p(n);return r.wipe(n),i},e.sharedKey=function(t,r,n){if(void 0===n&&(n=!1),t.length!==e.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect secret key length");if(r.length!==e.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect public key length");var i=d(t,r);if(n){for(var s=0,o=0;o<i.length;o++)s|=i[o];if(0===s)throw new Error("X25519: invalid shared key")}return i}}(x25519$2);
/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
var isBuffer$1=function(e){return null!=e&&null!=e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)};const isBuffer=isBuffer$1,Shake=src$h,lp$1=src$i;var src$7=(e,t={})=>{const r=Shake(e),n=lp$1.decode.fromReader(r.reader,t),i={read:async e=>{const{value:t,done:n}=await r.reader.next(e);if(n&&t.length<e)throw new Error("Couldn't read enough bytes");if(!t)throw new Error("Value is null");return t},readLP:async()=>{const{value:e,done:t}=await n.next();if(!e)throw new Error("Value is null");return e},readPB:async e=>{const t=await i.readLP();if(!t)throw new Error("Value is null");const r=isBuffer(t)?t:t.slice();return e.decode(r)},write:e=>{r.writer.push(e)},writeLP:e=>{i.write(lp$1.encode.single(e,t))},writePB:(e,t)=>{i.writeLP(t.encode(e))},pb:e=>({read:()=>i.readPB(e),write:t=>i.writePB(t,e)}),unwrap:()=>(r.rest(),r.stream)};return i};const getIterator=getIterator$3;var itPair=function(){let e,t;return{sink:async r=>{if(e)throw new Error("already piped");e=getIterator(r),t&&t(e)},source:{[Symbol.asyncIterator](){return this},next:()=>e?e.next():new Promise((e=>{t=r=>{t=null,e(r.next())}}))}}},Pair=itPair,duplex=function(){var e=Pair(),t=Pair();return[{source:e.source,sink:t.sink},{source:t.source,sink:e.sink}]},handshakeXx={},xx={},utils$q={},hkdf={},hmac$6={},hash$3={};function isSerializableHash(e){return void 0!==e.saveState&&void 0!==e.restoreState&&void 0!==e.cleanSavedState}Object.defineProperty(hash$3,"__esModule",{value:!0}),hash$3.isSerializableHash=isSerializableHash;var constantTime={};function select(e,t,r){return~(e-1)&t|e-1&r}function lessOrEqual(e,t){return(0|e)-(0|t)-1>>>31&1}function compare(e,t){if(e.length!==t.length)return 0;for(var r=0,n=0;n<e.length;n++)r|=e[n]^t[n];return 1&r-1>>>8}function equal(e,t){return 0!==e.length&&0!==t.length&&0!==compare(e,t)}Object.defineProperty(constantTime,"__esModule",{value:!0}),constantTime.select=select,constantTime.lessOrEqual=lessOrEqual,constantTime.compare=compare,constantTime.equal=equal,Object.defineProperty(hmac$6,"__esModule",{value:!0});var hash_1=hash$3,constant_time_1=constantTime,wipe_1$2=wipe$1,HMAC=function(){function e(e,t){this._finished=!1,this._inner=new e,this._outer=new e,this.blockSize=this._outer.blockSize,this.digestLength=this._outer.digestLength;var r=new Uint8Array(this.blockSize);t.length>this.blockSize?this._inner.update(t).finish(r).clean():r.set(t);for(var n=0;n<r.length;n++)r[n]^=54;this._inner.update(r);for(n=0;n<r.length;n++)r[n]^=106;this._outer.update(r),hash_1.isSerializableHash(this._inner)&&hash_1.isSerializableHash(this._outer)&&(this._innerKeyedState=this._inner.saveState(),this._outerKeyedState=this._outer.saveState()),wipe_1$2.wipe(r)}return e.prototype.reset=function(){if(!hash_1.isSerializableHash(this._inner)||!hash_1.isSerializableHash(this._outer))throw new Error("hmac: can't reset() because hash doesn't implement restoreState()");return this._inner.restoreState(this._innerKeyedState),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},e.prototype.clean=function(){hash_1.isSerializableHash(this._inner)&&this._inner.cleanSavedState(this._innerKeyedState),hash_1.isSerializableHash(this._outer)&&this._outer.cleanSavedState(this._outerKeyedState),this._inner.clean(),this._outer.clean()},e.prototype.update=function(e){return this._inner.update(e),this},e.prototype.finish=function(e){return this._finished?(this._outer.finish(e),this):(this._inner.finish(e),this._outer.update(e.subarray(0,this.digestLength)).finish(e),this._finished=!0,this)},e.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},e.prototype.saveState=function(){if(!hash_1.isSerializableHash(this._inner))throw new Error("hmac: can't saveState() because hash doesn't implement it");return this._inner.saveState()},e.prototype.restoreState=function(e){if(!hash_1.isSerializableHash(this._inner)||!hash_1.isSerializableHash(this._outer))throw new Error("hmac: can't restoreState() because hash doesn't implement it");return this._inner.restoreState(e),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},e.prototype.cleanSavedState=function(e){if(!hash_1.isSerializableHash(this._inner))throw new Error("hmac: can't cleanSavedState() because hash doesn't implement it");this._inner.cleanSavedState(e)},e}();function hmac$5(e,t,r){var n=new HMAC(e,t);n.update(r);var i=n.digest();return n.clean(),i}hmac$6.HMAC=HMAC,hmac$6.hmac=hmac$5,hmac$6.equal=constant_time_1.equal,Object.defineProperty(hkdf,"__esModule",{value:!0});var hmac_1=hmac$6,wipe_1$1=wipe$1,HKDF=function(){function e(e,t,r,n){void 0===r&&(r=new Uint8Array(0)),this._counter=new Uint8Array(1),this._hash=e,this._info=n;var i=hmac_1.hmac(this._hash,r,t);this._hmac=new hmac_1.HMAC(e,i),this._buffer=new Uint8Array(this._hmac.digestLength),this._bufpos=this._buffer.length}return e.prototype._fillBuffer=function(){this._counter[0]++;var e=this._counter[0];if(0===e)throw new Error("hkdf: cannot expand more");this._hmac.reset(),e>1&&this._hmac.update(this._buffer),this._info&&this._hmac.update(this._info),this._hmac.update(this._counter),this._hmac.finish(this._buffer),this._bufpos=0},e.prototype.expand=function(e){for(var t=new Uint8Array(e),r=0;r<t.length;r++)this._bufpos===this._buffer.length&&this._fillBuffer(),t[r]=this._buffer[this._bufpos++];return t},e.prototype.clean=function(){this._hmac.clean(),wipe_1$1.wipe(this._buffer),wipe_1$1.wipe(this._counter),this._bufpos=0},e}();hkdf.HKDF=HKDF;var sha256$d={};!function(e){Object.defineProperty(e,"__esModule",{value:!0});var t=binary,r=wipe$1;e.DIGEST_LENGTH=32,e.BLOCK_SIZE=64;var n=function(){function n(){this.digestLength=e.DIGEST_LENGTH,this.blockSize=e.BLOCK_SIZE,this._state=new Int32Array(8),this._temp=new Int32Array(64),this._buffer=new Uint8Array(128),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return n.prototype._initState=function(){this._state[0]=1779033703,this._state[1]=3144134277,this._state[2]=1013904242,this._state[3]=2773480762,this._state[4]=1359893119,this._state[5]=2600822924,this._state[6]=528734635,this._state[7]=1541459225},n.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},n.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._temp),this.reset()},n.prototype.update=function(e,t){if(void 0===t&&(t=e.length),this._finished)throw new Error("SHA256: can't update because hash was finished.");var r=0;if(this._bytesHashed+=t,this._bufferLength>0){for(;this._bufferLength<this.blockSize&&t>0;)this._buffer[this._bufferLength++]=e[r++],t--;this._bufferLength===this.blockSize&&(s(this._temp,this._state,this._buffer,0,this.blockSize),this._bufferLength=0)}for(t>=this.blockSize&&(r=s(this._temp,this._state,e,r,t),t%=this.blockSize);t>0;)this._buffer[this._bufferLength++]=e[r++],t--;return this},n.prototype.finish=function(e){if(!this._finished){var r=this._bytesHashed,n=this._bufferLength,i=r/536870912|0,o=r<<3,a=r%64<56?64:128;this._buffer[n]=128;for(var u=n+1;u<a-8;u++)this._buffer[u]=0;t.writeUint32BE(i,this._buffer,a-8),t.writeUint32BE(o,this._buffer,a-4),s(this._temp,this._state,this._buffer,0,a),this._finished=!0}for(u=0;u<this.digestLength/4;u++)t.writeUint32BE(this._state[u],e,4*u);return this},n.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},n.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{state:new Int32Array(this._state),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},n.prototype.restoreState=function(e){return this._state.set(e.state),this._bufferLength=e.bufferLength,e.buffer&&this._buffer.set(e.buffer),this._bytesHashed=e.bytesHashed,this._finished=!1,this},n.prototype.cleanSavedState=function(e){r.wipe(e.state),e.buffer&&r.wipe(e.buffer),e.bufferLength=0,e.bytesHashed=0},n}();e.SHA256=n;var i=new Int32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function s(e,r,n,s,o){for(;o>=64;){for(var a=r[0],u=r[1],c=r[2],l=r[3],h=r[4],d=r[5],f=r[6],p=r[7],y=0;y<16;y++){var g=s+4*y;e[y]=t.readUint32BE(n,g)}for(y=16;y<64;y++){var $=e[y-2],m=($>>>17|$<<15)^($>>>19|$<<13)^$>>>10,b=(($=e[y-15])>>>7|$<<25)^($>>>18|$<<14)^$>>>3;e[y]=(m+e[y-7]|0)+(b+e[y-16]|0)}for(y=0;y<64;y++){m=(((h>>>6|h<<26)^(h>>>11|h<<21)^(h>>>25|h<<7))+(h&d^~h&f)|0)+(p+(i[y]+e[y]|0)|0)|0,b=((a>>>2|a<<30)^(a>>>13|a<<19)^(a>>>22|a<<10))+(a&u^a&c^u&c)|0;p=f,f=d,d=h,h=l+m|0,l=c,c=u,u=a,a=m+b|0}r[0]+=a,r[1]+=u,r[2]+=c,r[3]+=l,r[4]+=h,r[5]+=d,r[6]+=f,r[7]+=p,s+=64,o-=64}return s}e.hash=function(e){var t=new n;t.update(e);var r=t.digest();return t.clean(),r}}(sha256$d);var src$6={exports:{}},$protobuf$5=minimal,$Reader$5=$protobuf$5.Reader,$Writer$5=$protobuf$5.Writer,$util$5=$protobuf$5.util,$root$5=$protobuf$5.roots["libp2p-crypto-keys"]||($protobuf$5.roots["libp2p-crypto-keys"]={});$root$5.KeyType=function(){var e={},t=Object.create(e);return t[e[0]="RSA"]=0,t[e[1]="Ed25519"]=1,t[e[2]="Secp256k1"]=2,t}(),$root$5.PublicKey=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.Type=0,e.prototype.Data=$util$5.newBuffer([]),e.encode=function(e,t){return t||(t=$Writer$5.create()),t.uint32(8).int32(e.Type),t.uint32(18).bytes(e.Data),t},e.decode=function(e,t){e instanceof $Reader$5||(e=$Reader$5.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root$5.PublicKey;e.pos<r;){var i=e.uint32();switch(i>>>3){case 1:n.Type=e.int32();break;case 2:n.Data=e.bytes();break;default:e.skipType(7&i)}}if(!n.hasOwnProperty("Type"))throw $util$5.ProtocolError("missing required 'Type'",{instance:n});if(!n.hasOwnProperty("Data"))throw $util$5.ProtocolError("missing required 'Data'",{instance:n});return n},e.fromObject=function(e){if(e instanceof $root$5.PublicKey)return e;var t=new $root$5.PublicKey;switch(e.Type){case"RSA":case 0:t.Type=0;break;case"Ed25519":case 1:t.Type=1;break;case"Secp256k1":case 2:t.Type=2}return null!=e.Data&&("string"==typeof e.Data?$util$5.base64.decode(e.Data,t.Data=$util$5.newBuffer($util$5.base64.length(e.Data)),0):e.Data.length&&(t.Data=e.Data)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.Type=t.enums===String?"RSA":0,t.bytes===String?r.Data="":(r.Data=[],t.bytes!==Array&&(r.Data=$util$5.newBuffer(r.Data)))),null!=e.Type&&e.hasOwnProperty("Type")&&(r.Type=t.enums===String?$root$5.KeyType[e.Type]:e.Type),null!=e.Data&&e.hasOwnProperty("Data")&&(r.Data=t.bytes===String?$util$5.base64.encode(e.Data,0,e.Data.length):t.bytes===Array?Array.prototype.slice.call(e.Data):e.Data),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf$5.util.toJSONOptions)},e}(),$root$5.PrivateKey=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.Type=0,e.prototype.Data=$util$5.newBuffer([]),e.encode=function(e,t){return t||(t=$Writer$5.create()),t.uint32(8).int32(e.Type),t.uint32(18).bytes(e.Data),t},e.decode=function(e,t){e instanceof $Reader$5||(e=$Reader$5.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root$5.PrivateKey;e.pos<r;){var i=e.uint32();switch(i>>>3){case 1:n.Type=e.int32();break;case 2:n.Data=e.bytes();break;default:e.skipType(7&i)}}if(!n.hasOwnProperty("Type"))throw $util$5.ProtocolError("missing required 'Type'",{instance:n});if(!n.hasOwnProperty("Data"))throw $util$5.ProtocolError("missing required 'Data'",{instance:n});return n},e.fromObject=function(e){if(e instanceof $root$5.PrivateKey)return e;var t=new $root$5.PrivateKey;switch(e.Type){case"RSA":case 0:t.Type=0;break;case"Ed25519":case 1:t.Type=1;break;case"Secp256k1":case 2:t.Type=2}return null!=e.Data&&("string"==typeof e.Data?$util$5.base64.decode(e.Data,t.Data=$util$5.newBuffer($util$5.base64.length(e.Data)),0):e.Data.length&&(t.Data=e.Data)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.Type=t.enums===String?"RSA":0,t.bytes===String?r.Data="":(r.Data=[],t.bytes!==Array&&(r.Data=$util$5.newBuffer(r.Data)))),null!=e.Type&&e.hasOwnProperty("Type")&&(r.Type=t.enums===String?$root$5.KeyType[e.Type]:e.Type),null!=e.Data&&e.hasOwnProperty("Data")&&(r.Data=t.bytes===String?$util$5.base64.encode(e.Data,0,e.Data.length):t.bytes===Array?Array.prototype.slice.call(e.Data):e.Data),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf$5.util.toJSONOptions)},e}();var keys$6=$root$5,webcrypto$e={get:(e=globalThis)=>{const t=e.crypto;if(!t||!t.subtle)throw Object.assign(new Error("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p-crypto/blob/master/README.md#web-crypto-api"),{code:"ERR_MISSING_WEB_CRYPTO"});return t}};const{concat:concat$2}=require$$2$2,{fromString:fromString$2}=require$$3$1,webcrypto$d=webcrypto$e;function create$2({algorithm:e="AES-GCM",nonceLength:t=12,keyLength:r=16,digest:n="SHA-256",saltLength:i=16,iterations:s=32767}={}){const o=webcrypto$d.get();return r*=8,{encrypt:async function(a,u){const c=o.getRandomValues(new Uint8Array(i)),l=o.getRandomValues(new Uint8Array(t)),h={name:e,iv:l},d={name:"PBKDF2",salt:c,iterations:s,hash:{name:n}},f=await o.subtle.importKey("raw",fromString$2(u),{name:"PBKDF2"},!1,["deriveKey","deriveBits"]),p=await o.subtle.deriveKey(d,f,{name:e,length:r},!0,["encrypt"]),y=await o.subtle.encrypt(h,p,a);return concat$2([c,h.iv,new Uint8Array(y)])},decrypt:async function(a,u){const c=a.slice(0,i),l=a.slice(i,i+t),h=a.slice(i+t),d={name:e,iv:l},f={name:"PBKDF2",salt:c,iterations:s,hash:{name:n}},p=await o.subtle.importKey("raw",fromString$2(u),{name:"PBKDF2"},!1,["deriveKey","deriveBits"]),y=await o.subtle.deriveKey(f,p,{name:e,length:r},!0,["decrypt"]),g=await o.subtle.decrypt(d,y,h);return new Uint8Array(g)}}}var aesGcm_browser$2={create:create$2};const{base64:base64$5}=require$$4$5,ciphers$6=aesGcm_browser$2;var importer$5={import:async function(e,t){const r=base64$5.decode(e),n=ciphers$6.create();return await n.decrypt(r,t)}},rsaBrowser$2={};const randomBytes$6=random_browser,errcode$s=errCode$m;var randomBytes_1$2=function(e){if(isNaN(e)||e<=0)throw errcode$s(new Error("random bytes length must be a Number bigger than 0"),"ERR_INVALID_LENGTH");return randomBytes$6(e)},rsaUtils$2={},util$2={};!function(e){const t=forge$X,{fromString:r}=require$$3$1,{toString:n}=require$$1$5,{concat:i}=require$$2$2;e.bigIntegerToUintBase64url=(e,t)=>{let r=Uint8Array.from(e.abs().toByteArray());if(r=0===r[0]?r.slice(1):r,null!=t){if(r.length>t)throw new Error("byte array longer than desired length");r=i([new Uint8Array(t-r.length),r])}return n(r,"base64url")},e.base64urlToBigInteger=r=>{const i=e.base64urlToBuffer(r);return new t.jsbn.BigInteger(n(i,"base16"),16)},e.base64urlToBuffer=(e,t)=>{let n=r(e,"base64urlpad");if(null!=t){if(n.length>t)throw new Error("byte array longer than desired length");n=i([new Uint8Array(t-n.length),n])}return n}}(util$2);const forge$f=forge$X,{bigIntegerToUintBase64url:bigIntegerToUintBase64url$2,base64urlToBigInteger:base64urlToBigInteger$5}=util$2,{fromString:uint8ArrayFromString$e}=require$$3$1,{toString:uint8ArrayToString$g}=require$$1$5;rsaUtils$2.pkcs1ToJwk=function(e){const t=forge$f.asn1.fromDer(uint8ArrayToString$g(e,"ascii")),r=forge$f.pki.privateKeyFromAsn1(t);return{kty:"RSA",n:bigIntegerToUintBase64url$2(r.n),e:bigIntegerToUintBase64url$2(r.e),d:bigIntegerToUintBase64url$2(r.d),p:bigIntegerToUintBase64url$2(r.p),q:bigIntegerToUintBase64url$2(r.q),dp:bigIntegerToUintBase64url$2(r.dP),dq:bigIntegerToUintBase64url$2(r.dQ),qi:bigIntegerToUintBase64url$2(r.qInv),alg:"RS256",kid:"2011-04-29"}},rsaUtils$2.jwkToPkcs1=function(e){const t=forge$f.pki.privateKeyToAsn1({n:base64urlToBigInteger$5(e.n),e:base64urlToBigInteger$5(e.e),d:base64urlToBigInteger$5(e.d),p:base64urlToBigInteger$5(e.p),q:base64urlToBigInteger$5(e.q),dP:base64urlToBigInteger$5(e.dp),dQ:base64urlToBigInteger$5(e.dq),qInv:base64urlToBigInteger$5(e.qi)});return uint8ArrayFromString$e(forge$f.asn1.toDer(t).getBytes(),"ascii")},rsaUtils$2.pkixToJwk=function(e){const t=forge$f.asn1.fromDer(uint8ArrayToString$g(e,"ascii")),r=forge$f.pki.publicKeyFromAsn1(t);return{kty:"RSA",n:bigIntegerToUintBase64url$2(r.n),e:bigIntegerToUintBase64url$2(r.e),alg:"RS256",kid:"2011-04-29"}},rsaUtils$2.jwkToPkix=function(e){const t=forge$f.pki.publicKeyToAsn1({n:base64urlToBigInteger$5(e.n),e:base64urlToBigInteger$5(e.e)});return uint8ArrayFromString$e(forge$f.asn1.toDer(t).getBytes(),"ascii")};const forge$e=forge$X,{base64urlToBigInteger:base64urlToBigInteger$4}=util$2;function convert$2(e,t){return t.map((t=>base64urlToBigInteger$4(e[t])))}function jwk2priv$5(e){return forge$e.pki.setRsaPrivateKey(...convert$2(e,["n","e","d","p","q","dp","dq","qi"]))}function jwk2pub$5(e){return forge$e.pki.setRsaPublicKey(...convert$2(e,["n","e"]))}var jwk2pem$2={jwk2pub:jwk2pub$5,jwk2priv:jwk2priv$5};const webcrypto$c=webcrypto$e,randomBytes$5=randomBytes_1$2,{toString:uint8ArrayToString$f}=require$$1$5,{fromString:uint8ArrayFromString$d}=require$$3$1;function exportKey$2(e){return Promise.all([webcrypto$c.get().subtle.exportKey("jwk",e.privateKey),webcrypto$c.get().subtle.exportKey("jwk",e.publicKey)])}function derivePublicFromPrivate$2(e){return webcrypto$c.get().subtle.importKey("jwk",{kty:e.kty,n:e.n,e:e.e},{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])}rsaBrowser$2.utils=rsaUtils$2,rsaBrowser$2.generateKey=async function(e){const t=await webcrypto$c.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),r=await exportKey$2(t);return{privateKey:r[0],publicKey:r[1]}},rsaBrowser$2.unmarshalPrivateKey=async function(e){const t=[await webcrypto$c.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),await derivePublicFromPrivate$2(e)],r=await exportKey$2({privateKey:t[0],publicKey:t[1]});return{privateKey:r[0],publicKey:r[1]}},rsaBrowser$2.getRandomValues=randomBytes$5,rsaBrowser$2.hashAndSign=async function(e,t){const r=await webcrypto$c.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),n=await webcrypto$c.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},r,Uint8Array.from(t));return new Uint8Array(n,n.byteOffset,n.byteLength)},rsaBrowser$2.hashAndVerify=async function(e,t,r){const n=await webcrypto$c.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return webcrypto$c.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},n,t,r)};const{jwk2pub:jwk2pub$4,jwk2priv:jwk2priv$4}=jwk2pem$2;function convertKey$2(e,t,r,n){const i=t?jwk2pub$4(e):jwk2priv$4(e),s=n(uint8ArrayToString$f(Uint8Array.from(r),"ascii"),i);return uint8ArrayFromString$d(s,"ascii")}rsaBrowser$2.encrypt=function(e,t){return convertKey$2(e,!0,t,((e,t)=>t.encrypt(e)))},rsaBrowser$2.decrypt=function(e,t){return convertKey$2(e,!1,t,((e,t)=>t.decrypt(e)))};const{base64:base64$4}=require$$4$5,ciphers$5=aesGcm_browser$2;var exporter$b={export:async function(e,t){const r=ciphers$5.create(),n=await r.encrypt(e,t);return base64$4.encode(n)}};const{sha256:sha256$c}=require$$4$3,errcode$r=errCode$m,{equals:uint8ArrayEquals$b}=require$$10$1,{toString:uint8ArrayToString$e}=require$$1$5,forge$d=forge$X,crypto$8=rsaBrowser$2,pbm$5=keys$6,exporter$a=exporter$b;class RsaPublicKey$2{constructor(e){this._key=e}async verify(e,t){return crypto$8.hashAndVerify(this._key,t,e)}marshal(){return crypto$8.utils.jwkToPkix(this._key)}get bytes(){return pbm$5.PublicKey.encode({Type:pbm$5.KeyType.RSA,Data:this.marshal()}).finish()}encrypt(e){return crypto$8.encrypt(this._key,e)}equals(e){return uint8ArrayEquals$b(this.bytes,e.bytes)}async hash(){const{bytes:e}=await sha256$c.digest(this.bytes);return e}}class RsaPrivateKey$2{constructor(e,t){this._key=e,this._publicKey=t}genSecret(){return crypto$8.getRandomValues(16)}async sign(e){return crypto$8.hashAndSign(this._key,e)}get public(){if(!this._publicKey)throw errcode$r(new Error("public key not provided"),"ERR_PUBKEY_NOT_PROVIDED");return new RsaPublicKey$2(this._publicKey)}decrypt(e){return crypto$8.decrypt(this._key,e)}marshal(){return crypto$8.utils.jwkToPkcs1(this._key)}get bytes(){return pbm$5.PrivateKey.encode({Type:pbm$5.KeyType.RSA,Data:this.marshal()}).finish()}equals(e){return uint8ArrayEquals$b(this.bytes,e.bytes)}async hash(){const{bytes:e}=await sha256$c.digest(this.bytes);return e}async id(){const e=await this.public.hash();return uint8ArrayToString$e(e,"base58btc")}async export(e,t="pkcs-8"){if("pkcs-8"===t){const t=new forge$d.util.ByteBuffer(this.marshal()),r=forge$d.asn1.fromDer(t),n=forge$d.pki.privateKeyFromAsn1(r),i={algorithm:"aes256",count:1e4,saltSize:16,prfAlgorithm:"sha512"};return forge$d.pki.encryptRsaPrivateKey(n,e,i)}if("libp2p-key"===t)return exporter$a.export(this.bytes,e);throw errcode$r(new Error(`export format '${t}' is not supported`),"ERR_INVALID_EXPORT_FORMAT")}}async function unmarshalRsaPrivateKey$2(e){const t=crypto$8.utils.pkcs1ToJwk(e),r=await crypto$8.unmarshalPrivateKey(t);return new RsaPrivateKey$2(r.privateKey,r.publicKey)}function unmarshalRsaPublicKey$2(e){const t=crypto$8.utils.pkixToJwk(e);return new RsaPublicKey$2(t)}async function fromJwk$2(e){const t=await crypto$8.unmarshalPrivateKey(e);return new RsaPrivateKey$2(t.privateKey,t.publicKey)}async function generateKeyPair$8(e){const t=await crypto$8.generateKey(e);return new RsaPrivateKey$2(t.privateKey,t.publicKey)}var rsaClass$2={RsaPublicKey:RsaPublicKey$2,RsaPrivateKey:RsaPrivateKey$2,unmarshalRsaPublicKey:unmarshalRsaPublicKey$2,unmarshalRsaPrivateKey:unmarshalRsaPrivateKey$2,generateKeyPair:generateKeyPair$8,fromJwk:fromJwk$2},ed25519$3={},nobleEd25519={exports:{}};!function(e,t){
/*! noble-ed25519 - MIT License (c) Paul Miller (paulmillr.com) */
Object.defineProperty(t,"__esModule",{value:!0}),t.utils=t.verify=t.sign=t.getPublicKey=t.SignResult=t.Signature=t.Point=t.ExtendedPoint=t.CURVE=void 0;const r={a:-1n,d:37095705934669439343138083508754565189542113879843219016388785533085940283555n,P:2n**255n-19n,n:2n**252n+27742317777372353535851937790883648493n,h:8n,Gx:15112221349535400772501151409588531511454012693041857206046113283949847762202n,Gy:46316835694926478169428394003475163141307993866256225615783033603165251855960n};t.CURVE=r;const n=32,i=19681161376707505956807079304988542015446066515923890162744021073123829784752n,s=25063068953384623474111414158702152701244531502492656460079210482610430750235n,o=54469307008909316920995813868745141605393597292927456921205312896311721017578n,a=1159843021668779879193775521855586647937357759715417654439879720876111806838n,u=40440834346308536858101042469323190826248399146238708352240133220865137265952n;class c{constructor(e,t,r,n){this.x=e,this.y=t,this.z=r,this.t=n}static fromAffine(e){if(!(e instanceof h))throw new TypeError("ExtendedPoint#fromAffine: expected Point");return e.equals(h.ZERO)?c.ZERO:new c(e.x,e.y,1n,_(e.x*e.y))}static toAffineBatch(e){const t=function(e,t=r.P){const n=e.length,i=new Array(n);let s=1n;for(let r=0;r<n;r++)0n!==e[r]&&(i[r]=s,s=_(s*e[r],t));s=w(s,t);for(let r=n-1;r>=0;r--){if(0n===e[r])continue;let n=_(s*e[r],t);e[r]=_(s*i[r],t),s=n}return e}(e.map((e=>e.z)));return e.map(((e,r)=>e.toAffine(t[r])))}static normalizeZ(e){return this.toAffineBatch(e).map(this.fromAffine)}static fromRistrettoHash(e){const t=v(e.slice(0,n)),r=this.calcElligatorRistrettoMap(t),i=v(e.slice(n,64)),s=this.calcElligatorRistrettoMap(i);return r.add(s)}static calcElligatorRistrettoMap(e){const{d:t}=r,n=_(i*e*e),o=_((n+1n)*a);let l=-1n;const h=_((l-t*n)*_(n+t));let{isValid:d,value:f}=S(o,h),p=_(f*e);$(p)||(p=_(-p)),d||(f=p),d||(l=n);const y=_(l*(n-1n)*u-h),g=f*f,m=_((f+f)*h),b=_(y*s),v=_(1n-g),w=_(1n+g);return new c(_(m*w),_(v*b),_(b*w),_(m*v))}static fromRistrettoBytes(e){const{a:t,d:i}=r,s="ExtendedPoint.fromRistrettoBytes: Cannot convert bytes to Ristretto Point",o=v(e);if(!function(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}(g(o,n),e)||$(o))throw new Error(s);const a=_(o*o),u=_(1n+t*a),l=_(1n-t*a),h=_(u*u),d=_(l*l),f=_(t*i*h-d),{isValid:p,value:y}=A(_(f*d)),m=_(y*l),b=_(y*m*f);let w=_((o+o)*m);$(w)&&(w=_(-w));const E=_(u*b),S=_(w*E);if(!p||$(S)||0n===E)throw new Error(s);return new c(w,E,1n,S)}toRistrettoBytes(){let{x:e,y:t,z:r,t:s}=this;const a=_((r+t)*(r-t)),u=_(e*t),{value:c}=A(_(a*u**2n)),l=_(c*a),h=_(c*u),d=_(l*h*s);let f;$(s*d)?([e,t]=[_(t*i),_(e*i)],f=_(l*o)):f=h,$(e*d)&&(t=_(-t));let p=_((r-t)*f);return $(p)&&(p=_(-p)),g(p,n)}equals(e){const t=e,[r,n,i,s]=[this.t,t.t,this.z,t.z];return _(r*s)===_(n*i)}negate(){return new c(_(-this.x),this.y,this.z,_(-this.t))}double(){const e=this.x,t=this.y,n=this.z,{a:i}=r,s=_(e**2n),o=_(t**2n),a=_(2n*n**2n),u=_(i*s),l=_((e+t)**2n-s-o),h=_(u+o),d=_(h-a),f=_(u-o),p=_(l*d),y=_(h*f),g=_(l*f),$=_(d*h);return new c(p,y,$,g)}add(e){const t=this.x,r=this.y,n=this.z,i=this.t,s=e.x,o=e.y,a=e.z,u=e.t,l=_((r-t)*(o+s)),h=_((r+t)*(o-s)),d=_(h-l);if(0n===d)return this.double();const f=_(2n*n*u),p=_(2n*i*a),y=_(p+f),g=_(h+l),$=_(p-f),m=_(y*d),b=_(g*$),v=_(y*$),w=_(d*g);return new c(m,b,w,v)}subtract(e){return this.add(e.negate())}multiplyUnsafe(e){if(!m(e))throw new TypeError("Point#multiply: expected number or bigint");let t=_(BigInt(e),r.n);if(1n===t)return this;let n=c.ZERO,i=this;for(;t>0n;)1n&t&&(n=n.add(i)),i=i.double(),t>>=1n;return n}precomputeWindow(e){const t=256/e+1;let r=[],n=this,i=n;for(let s=0;s<t;s++){i=n,r.push(i);for(let t=1;t<2**(e-1);t++)i=i.add(n),r.push(i);n=i.double()}return r}wNAF(e,t){!t&&this.equals(c.BASE)&&(t=h.BASE);const r=t&&t._WINDOW_SIZE||1;if(256%r)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let n=t&&l.get(t);n||(n=this.precomputeWindow(r),t&&1!==r&&(n=c.normalizeZ(n),l.set(t,n)));let i=c.ZERO,s=c.ZERO;const o=256/r+1,a=2**(r-1),u=BigInt(2**r-1),d=2**r,f=BigInt(r);for(let t=0;t<o;t++){const r=t*a;let o=Number(e&u);if(e>>=f,o>a&&(o-=d,e+=1n),0===o)s=s.add(t%2?n[r].negate():n[r]);else{const e=n[r+Math.abs(o)-1];i=i.add(o<0?e.negate():e)}}return[i,s]}multiply(e,t){if(!m(e))throw new TypeError("Point#multiply: expected number or bigint");const n=_(BigInt(e),r.n);return c.normalizeZ(this.wNAF(n,t))[0]}toAffine(e=w(this.z)){const t=_(this.x*e),r=_(this.y*e);return new h(t,r)}}t.ExtendedPoint=c,c.BASE=new c(r.Gx,r.Gy,1n,_(r.Gx*r.Gy)),c.ZERO=new c(0n,1n,1n,0n);const l=new WeakMap;class h{constructor(e,t){this.x=e,this.y=t}_setWindowSize(e){this._WINDOW_SIZE=e,l.delete(this)}static fromHex(e){const{d:t,P:n}=r,i=e instanceof Uint8Array?e:p(e);if(32!==i.length)throw new Error("Point.fromHex: expected 32 bytes");const s=i[31],o=-129&s,a=0!=(128&s),u=b(Uint8Array.from(Array.from(i.slice(0,31)).concat(o)));if(u>=n)throw new Error("Point.fromHex expects hex <= Fp");const c=_(u*u),l=_(c-1n),d=_(t*c+1n);let{isValid:f,value:y}=S(l,d);if(!f)throw new Error("Point.fromHex: invalid y coordinate");return a!==(1n===(1n&y))&&(y=_(-y)),new h(y,u)}static async fromPrivateKey(e){const r=await t.utils.sha512(R(e));return h.BASE.multiply(I(r))}toRawBytes(){const e=y(this.y),t=new Uint8Array(n);for(let r=e.length-2,i=0;i<n&&r>=0;r-=2,i++)t[i]=Number.parseInt(e[r]+e[r+1],16);const r=1n&this.x?128:0;return t[31]|=r,t}toHex(){return f(this.toRawBytes())}toX25519(){return _((1n+this.y)*w(1n-this.y))}equals(e){return this.x===e.x&&this.y===e.y}negate(){return new h(_(-this.x),this.y)}add(e){return c.fromAffine(this).add(c.fromAffine(e)).toAffine()}subtract(e){return this.add(e.negate())}multiply(e){return c.fromAffine(this).multiply(e,this).toAffine()}}t.Point=h,h.BASE=new h(r.Gx,r.Gy),h.ZERO=new h(0n,1n);class d{constructor(e,t){this.r=e,this.s=t}static fromHex(e){e=P(e);const t=h.fromHex(e.slice(0,32)),n=b(e.slice(32));if(!(0<(i=n)&&i<r.n))throw new Error("Signature.fromHex expects s <= CURVE.n");var i;return new d(t,n)}toRawBytes(){const e=p(y(this.s)).reverse(),t=new Uint8Array(n);t.set(e);const r=new Uint8Array(64);return r.set(this.r.toRawBytes()),r.set(t,32),r}toHex(){return f(this.toRawBytes())}}function f(e){let t="";for(let r=0;r<e.length;r++)t+=e[r].toString(16).padStart(2,"0");return t}function p(e){if("string"!=typeof e)throw new TypeError("hexToBytes: expected string, got "+typeof e);if(e.length%2)throw new Error("hexToBytes: received invalid unpadded hex");const t=new Uint8Array(e.length/2);for(let r=0;r<t.length;r++){const n=2*r;t[r]=Number.parseInt(e.slice(n,n+2),16)}return t}function y(e){const t=e.toString(16);return 1&t.length?`0${t}`:t}function g(e,t=32){return p(y(e).padStart(2*t,"0")).reverse()}function $(e){return 1n===(1n&_(e))}function m(e){return"bigint"==typeof e&&e>0n||!!("number"==typeof e&&e>0&&Number.isSafeInteger(e))}function b(e){let t=0n;for(let r=0;r<e.length;r++)t+=BigInt(e[r])<<8n*BigInt(r);return t}function v(e){return _(b(e)&2n**255n-1n)}function _(e,t=r.P){const n=e%t;return n>=0n?n:t+n}function w(e,t=r.P){if(0n===e||t<=0n)throw new Error(`invert: expected positive integers, got n=${e} mod=${t}`);let n=_(e,t),i=t,[s,o,a,u]=[0n,1n,1n,0n];for(;0n!==n;){const e=i/n,t=i%n,r=s-a*e,c=o-u*e;[i,n]=[n,t],[s,o]=[a,u],[a,u]=[r,c]}if(1n!==i)throw new Error("invert: does not exist");return _(s,t)}function E(e,t){const{P:n}=r;let i=e;for(;t-- >0n;)i*=i,i%=n;return i}function S(e,t){const n=_(t*t*t),s=_(n*n*t);let o=_(e*n*function(e){const{P:t}=r,n=e*e%t*e%t,i=E(n,2n)*n%t,s=E(i,1n)*e%t,o=E(s,5n)*s%t,a=E(o,10n)*o%t,u=E(a,20n)*a%t,c=E(u,40n)*u%t,l=E(c,80n)*c%t,h=E(l,80n)*c%t,d=E(h,10n)*o%t;return E(d,2n)*e%t}(e*s));const a=_(t*o*o),u=o,c=_(o*i),l=a===e,h=a===_(-e),d=a===_(-e*i);return l&&(o=u),(h||d)&&(o=c),$(o)&&(o=_(-o)),{isValid:l||h,value:o}}function A(e){return S(1n,e)}async function T(...e){const n=function(...e){if(1===e.length)return e[0];const t=e.reduce(((e,t)=>e+t.length),0),r=new Uint8Array(t);for(let t=0,n=0;t<e.length;t++){const i=e[t];r.set(i,n),n+=i.length}return r}(...e);return _(b(await t.utils.sha512(n)),r.n)}function I(e){const t=e.slice(0,n);return t[0]&=248,t[31]&=127,t[31]|=64,_(b(t),r.n)}function P(e){return e instanceof Uint8Array?e:p(e)}function R(e){let t;if("bigint"==typeof e||"number"==typeof e&&Number.isSafeInteger(e)){if(t=BigInt(e),t<0n||t>2n**256n)throw new Error("Expected 32 bytes of private key");e=t.toString(16).padStart(64,"0")}if("string"==typeof e){if(64!==e.length)throw new Error("Expected 32 bytes of private key");return p(e)}if(e instanceof Uint8Array){if(32!==e.length)throw new Error("Expected 32 bytes of private key");return e}throw new TypeError("Expected valid private key")}t.Signature=d,t.SignResult=d,t.getPublicKey=async function(e){const t=await h.fromPrivateKey(e);return"string"==typeof e?t.toHex():t.toRawBytes()},t.sign=async function(e,i){const s=await t.utils.sha512(R(i)),o=I(s),a=h.BASE.multiply(o),u=P(e),c=await T((l=s,l.slice(n)),u);var l;const f=h.BASE.multiply(c),p=_(c+await T(f.toRawBytes(),a.toRawBytes(),u)*o,r.n),y=new d(f,p);return"string"==typeof e?y.toHex():y.toRawBytes()},t.verify=async function(e,t,r){t=P(t),r instanceof h||(r=h.fromHex(r)),e instanceof d||(e=d.fromHex(e));const n=await T(e.r.toRawBytes(),r.toRawBytes(),t),i=c.fromAffine(r).multiplyUnsafe(n),s=c.BASE.multiply(e.s);return c.fromAffine(e.r).add(i).subtract(s).multiplyUnsafe(8n).equals(c.ZERO)},h.BASE._setWindowSize(8);const C=(()=>{const t="object"==typeof self&&"crypto"in self?self.crypto:void 0,r="function"==typeof commonjsRequire&&commonjsRequire.bind(e);return{node:r&&!t?r("crypto"):void 0,web:t}})();t.utils={TORSION_SUBGROUP:["0100000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac037a","0000000000000000000000000000000000000000000000000000000000000080","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc05","ecffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7f","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc85","0000000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac03fa"],randomBytes:(e=32)=>{if(C.web)return C.web.getRandomValues(new Uint8Array(e));if(C.node){const{randomBytes:t}=C.node;return new Uint8Array(t(e).buffer)}throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>{let e=1024;for(;e--;){const e=t.utils.randomBytes(32),n=b(e);if(n>1n&&n<r.n)return e}throw new Error("Valid private key was not found in 1024 iterations. PRNG is broken")},sha512:async e=>{if(C.web){const t=await C.web.subtle.digest("SHA-512",e.buffer);return new Uint8Array(t)}if(C.node)return Uint8Array.from(C.node.createHash("sha512").update(e).digest());throw new Error("The environment doesn't have sha512 function")},precompute(e=8,t=h.BASE){const r=t.equals(h.BASE)?t:new h(t.x,t.y);return r._setWindowSize(e),r.multiply(1n),r}}}(nobleEd25519,nobleEd25519.exports),function(e){const t=nobleEd25519.exports;function r(t,r){const n=new Uint8Array(e.privateKeyLength);for(let e=0;e<32;e++)n[e]=t[e],n[32+e]=r[e];return n}e.publicKeyLength=32,e.privateKeyLength=64,e.generateKey=async function(){const e=t.utils.randomPrivateKey(),n=await t.getPublicKey(e);return{privateKey:r(e,n),publicKey:n}},e.generateKeyFromSeed=async function(e){if(32!==e.length)throw new TypeError('"seed" must be 32 bytes in length.');if(!(e instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, or Uint8Array.');const n=e,i=await t.getPublicKey(n);return{privateKey:r(n,i),publicKey:i}},e.hashAndSign=function(e,r){const n=e.slice(0,32);return t.sign(r,n)},e.hashAndVerify=function(e,r,n){return t.verify(r,n,e)}}(ed25519$3);const errcode$q=errCode$m,{equals:uint8ArrayEquals$a}=require$$10$1,{sha256:sha256$b}=require$$4$3,{base58btc:base58btc$2}=require$$3$2,{identity:identity$2}=require$$13,crypto$7=ed25519$3,pbm$4=keys$6,exporter$9=exporter$b;class Ed25519PublicKey$2{constructor(e){this._key=ensureKey$2(e,crypto$7.publicKeyLength)}async verify(e,t){return crypto$7.hashAndVerify(this._key,t,e)}marshal(){return this._key}get bytes(){return pbm$4.PublicKey.encode({Type:pbm$4.KeyType.Ed25519,Data:this.marshal()}).finish()}equals(e){return uint8ArrayEquals$a(this.bytes,e.bytes)}async hash(){const{bytes:e}=await sha256$b.digest(this.bytes);return e}}class Ed25519PrivateKey$2{constructor(e,t){this._key=ensureKey$2(e,crypto$7.privateKeyLength),this._publicKey=ensureKey$2(t,crypto$7.publicKeyLength)}async sign(e){return crypto$7.hashAndSign(this._key,e)}get public(){return new Ed25519PublicKey$2(this._publicKey)}marshal(){return this._key}get bytes(){return pbm$4.PrivateKey.encode({Type:pbm$4.KeyType.Ed25519,Data:this.marshal()}).finish()}equals(e){return uint8ArrayEquals$a(this.bytes,e.bytes)}async hash(){const{bytes:e}=await sha256$b.digest(this.bytes);return e}async id(){const e=await identity$2.digest(this.public.bytes);return base58btc$2.encode(e.bytes).substring(1)}async export(e,t="libp2p-key"){if("libp2p-key"===t)return exporter$9.export(this.bytes,e);throw errcode$q(new Error(`export format '${t}' is not supported`),"ERR_INVALID_EXPORT_FORMAT")}}function unmarshalEd25519PrivateKey$2(e){if(e.length>crypto$7.privateKeyLength){const t=(e=ensureKey$2(e,crypto$7.privateKeyLength+crypto$7.publicKeyLength)).slice(0,crypto$7.privateKeyLength),r=e.slice(crypto$7.privateKeyLength,e.length);return new Ed25519PrivateKey$2(t,r)}const t=(e=ensureKey$2(e,crypto$7.privateKeyLength)).slice(0,crypto$7.privateKeyLength),r=e.slice(crypto$7.publicKeyLength);return new Ed25519PrivateKey$2(t,r)}function unmarshalEd25519PublicKey$2(e){return e=ensureKey$2(e,crypto$7.publicKeyLength),new Ed25519PublicKey$2(e)}async function generateKeyPair$7(){const{privateKey:e,publicKey:t}=await crypto$7.generateKey();return new Ed25519PrivateKey$2(e,t)}async function generateKeyPairFromSeed$5(e){const{privateKey:t,publicKey:r}=await crypto$7.generateKeyFromSeed(e);return new Ed25519PrivateKey$2(t,r)}function ensureKey$2(e,t){if((e=Uint8Array.from(e||[])).length!==t)throw errcode$q(new Error(`Key must be a Uint8Array of length ${t}, got ${e.length}`),"ERR_INVALID_KEY_TYPE");return e}var ed25519Class$2={Ed25519PublicKey:Ed25519PublicKey$2,Ed25519PrivateKey:Ed25519PrivateKey$2,unmarshalEd25519PrivateKey:unmarshalEd25519PrivateKey$2,unmarshalEd25519PublicKey:unmarshalEd25519PublicKey$2,generateKeyPair:generateKeyPair$7,generateKeyPairFromSeed:generateKeyPairFromSeed$5},nobleSecp256k1={exports:{}};!function(e,t){
/*! noble-secp256k1 - MIT License (c) Paul Miller (paulmillr.com) */
Object.defineProperty(t,"__esModule",{value:!0}),t.utils=t.schnorr=t.verify=t.signSync=t.sign=t.getSharedSecret=t.recoverPublicKey=t.getPublicKey=t.SignResult=t.Signature=t.Point=t.CURVE=void 0;const r={a:0n,b:7n,P:2n**256n-2n**32n-977n,n:2n**256n-432420386565659656852420866394968145599n,h:1n,Gx:55066263022277343669578718895168534326250603453777594175500187360389116729240n,Gy:32670510020758816978083085130507043184471273380659243275938904335757337482424n,beta:0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501een};function n(e){const{a:t,b:n}=r;return _(e**3n+t*e+n)}t.CURVE=r;const i=0n===r.a;class s{constructor(e,t,r){this.x=e,this.y=t,this.z=r}static fromAffine(e){if(!(e instanceof a))throw new TypeError("JacobianPoint#fromAffine: expected Point");return new s(e.x,e.y,1n)}static toAffineBatch(e){const t=function(e,t=r.P){const n=e.length,i=new Array(n);let s=1n;for(let r=0;r<n;r++)0n!==e[r]&&(i[r]=s,s=_(s*e[r],t));s=E(s,t);for(let r=n-1;r>=0;r--){if(0n===e[r])continue;const n=_(s*e[r],t);e[r]=_(s*i[r],t),s=n}return e}(e.map((e=>e.z)));return e.map(((e,r)=>e.toAffine(t[r])))}static normalizeZ(e){return s.toAffineBatch(e).map(s.fromAffine)}equals(e){const t=this,r=e,n=_(t.z*t.z),i=_(t.z*n),s=_(r.z*r.z),o=_(r.z*s);return _(t.x*s)===_(n*r.x)&&_(t.y*o)===_(i*r.y)}negate(){return new s(this.x,_(-this.y),this.z)}double(){const e=this.x,t=this.y,r=this.z,n=_(e**2n),i=_(t**2n),o=_(i**2n),a=_(2n*(_(_((e+i)**2n))-n-o)),u=_(3n*n),c=_(u**2n),l=_(c-2n*a),h=_(u*(a-l)-8n*o),d=_(2n*t*r);return new s(l,h,d)}add(e){if(!(e instanceof s))throw new TypeError("JacobianPoint#add: expected JacobianPoint");const t=this.x,r=this.y,n=this.z,i=e.x,o=e.y,a=e.z;if(0n===i||0n===o)return this;if(0n===t||0n===r)return e;const u=_(n**2n),c=_(a**2n),l=_(t*c),h=_(i*u),d=_(r*a*c),f=_(_(o*n)*u),p=_(h-l),y=_(f-d);if(0n===p)return 0n===y?this.double():s.ZERO;const g=_(p**2n),$=_(p*g),m=_(l*g),b=_(y**2n-$-2n*m),v=_(y*(m-b)-d*$),w=_(n*a*p);return new s(b,v,w)}subtract(e){return this.add(e.negate())}multiplyUnsafe(e){if(!v(e))throw new TypeError("Point#multiply: expected valid scalar");let t=_(BigInt(e),r.n);if(!i){let e=s.ZERO,r=this;for(;t>0n;)1n&t&&(e=e.add(r)),r=r.double(),t>>=1n;return e}let[n,o,a,u]=T(t),c=s.ZERO,l=s.ZERO,h=this;for(;o>0n||u>0n;)1n&o&&(c=c.add(h)),1n&u&&(l=l.add(h)),h=h.double(),o>>=1n,u>>=1n;return n&&(c=c.negate()),a&&(l=l.negate()),l=new s(_(l.x*r.beta),l.y,l.z),c.add(l)}precomputeWindow(e){const t=i?128/e+1:256/e+1;let r=[],n=this,s=n;for(let i=0;i<t;i++){s=n,r.push(s);for(let t=1;t<2**(e-1);t++)s=s.add(n),r.push(s);n=s.double()}return r}wNAF(e,t){!t&&this.equals(s.BASE)&&(t=a.BASE);const r=t&&t._WINDOW_SIZE||1;if(256%r)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let n=t&&o.get(t);n||(n=this.precomputeWindow(r),t&&1!==r&&(n=s.normalizeZ(n),o.set(t,n)));let u=s.ZERO,c=s.ZERO;const l=i?128/r+1:256/r+1,h=2**(r-1),d=BigInt(2**r-1),f=2**r,p=BigInt(r);for(let t=0;t<l;t++){const r=t*h;let i=Number(e&d);if(e>>=p,i>h&&(i-=f,e+=1n),0===i)c=c.add(t%2?n[r].negate():n[r]);else{const e=n[r+Math.abs(i)-1];u=u.add(i<0?e.negate():e)}}return[u,c]}multiply(e,t){if(!v(e))throw new TypeError("Point#multiply: expected valid scalar");let n,o,a=_(BigInt(e),r.n);if(i){const[e,i,u,c]=T(a);let l,h,d,f;[l,d]=this.wNAF(i,t),[h,f]=this.wNAF(c,t),e&&(l=l.negate()),u&&(h=h.negate()),h=new s(_(h.x*r.beta),h.y,h.z),[n,o]=[l.add(h),d.add(f)]}else[n,o]=this.wNAF(a,t);return s.normalizeZ([n,o])[0]}toAffine(e=E(this.z)){const t=e**2n,r=_(this.x*t),n=_(this.y*t*e);return new a(r,n)}}s.BASE=new s(r.Gx,r.Gy,1n),s.ZERO=new s(0n,1n,0n);const o=new WeakMap;class a{constructor(e,t){this.x=e,this.y=t}_setWindowSize(e){this._WINDOW_SIZE=e,o.delete(this)}static fromCompressedHex(e){const t=32===e.length,i=m(t?e:e.slice(1));let s=function(e){const{P:t}=r,n=e*e*e%t,i=n*n*e%t,s=w(i,3n)*i%t,o=w(s,3n)*i%t,a=w(o,2n)*n%t,u=w(a,11n)*a%t,c=w(u,22n)*u%t,l=w(c,44n)*c%t,h=w(l,88n)*l%t,d=w(h,44n)*c%t,f=w(d,3n)*i%t,p=w(f,23n)*u%t,y=w(p,6n)*n%t;return w(y,2n)}(n(i));const o=1n===(1n&s);if(t)o&&(s=_(-s));else{1==(1&e[0])!==o&&(s=_(-s))}const u=new a(i,s);return u.assertValidity(),u}static fromUncompressedHex(e){const t=m(e.slice(1,33)),r=m(e.slice(33)),n=new a(t,r);return n.assertValidity(),n}static fromHex(e){const t=$(e),r=t[0];if(32===t.length||33===t.length&&(2===r||3===r))return this.fromCompressedHex(t);if(65===t.length&&4===r)return this.fromUncompressedHex(t);throw new Error(`Point.fromHex: received invalid point. Expected 32-33 compressed bytes or 65 uncompressed bytes, not ${t.length}`)}static fromPrivateKey(e){return a.BASE.multiply(C(e))}static fromSignature(e,t,n){let i=e instanceof Uint8Array?m(e):y(e);const o=k(t),{r:u,s:c}=o;if(0!==n&&1!==n)throw new Error("Cannot recover signature: invalid yParity bit");const l=2+(1&n),h=a.fromHex(`0${l}${d(u)}`),f=s.fromAffine(h).multiplyUnsafe(c),p=s.BASE.multiply(i),g=E(u,r.n),$=f.subtract(p).multiplyUnsafe(g).toAffine();return $.assertValidity(),$}toRawBytes(e=!1){return g(this.toHex(e))}toHex(e=!1){const t=d(this.x);return e?`${1n&this.y?"03":"02"}${t}`:`04${t}${d(this.y)}`}toHexX(){return this.toHex(!0).slice(2)}toRawX(){return this.toRawBytes(!0).slice(1)}assertValidity(){const e="Point is not on elliptic curve",{P:t}=r,{x:i,y:s}=this;if(0n===i||0n===s||i>=t||s>=t)throw new Error(e);if((_(s*s)-n(i))%t!==0n)throw new Error(e)}equals(e){return this.x===e.x&&this.y===e.y}negate(){return new a(this.x,_(-this.y))}double(){return s.fromAffine(this).double().toAffine()}add(e){return s.fromAffine(this).add(s.fromAffine(e)).toAffine()}subtract(e){return this.add(e.negate())}multiply(e){return s.fromAffine(this).multiply(e,this).toAffine()}}function u(e){return Number.parseInt(e[0],16)>=8?"00"+e:e}t.Point=a,a.BASE=new a(r.Gx,r.Gy),a.ZERO=new a(0n,0n);class c{constructor(e,t){this.r=e,this.s=t}static fromCompact(e){if("string"!=typeof e&&!(e instanceof Uint8Array))throw new TypeError("Signature.fromCompact: Expected string or Uint8Array");const t=e instanceof Uint8Array?h(e):e;if(128!==t.length)throw new Error("Signature.fromCompact: Expected 64-byte hex");const r=new c(y(t.slice(0,64)),y(t.slice(64,128)));return r.assertValidity(),r}static fromDER(e){const t="Signature.fromDER";if("string"!=typeof e&&!(e instanceof Uint8Array))throw new TypeError(`${t}: Expected string or Uint8Array`);const r=e instanceof Uint8Array?h(e):e,n=b(r.slice(2,4));if("30"!==r.slice(0,2)||n!==r.length-4||"02"!==r.slice(4,6))throw new Error(`${t}: Invalid signature ${r}`);const i=b(r.slice(6,8)),s=8+i,o=r.slice(8,s);if(o.startsWith("00")&&b(o.slice(2,4))<=127)throw new Error(`${t}: Invalid r with trailing length`);const a=y(o);if("02"!==r.slice(s,s+2))throw new Error(`${t}: Invalid r-s separator`);const u=b(r.slice(s+2,s+4)),l=n-u-i-10;if(l>0||-4===l)throw new Error(`${t}: Invalid total length`);if(u>n-i-4)throw new Error(`${t}: Invalid s`);const d=s+4,f=r.slice(d,d+u);if(f.startsWith("00")&&b(f.slice(2,4))<=127)throw new Error(`${t}: Invalid s with trailing length`);const p=y(f),g=new c(a,p);return g.assertValidity(),g}static fromHex(e){return this.fromDER(e)}assertValidity(){const{r:e,s:t}=this;if(!P(e))throw new Error("Invalid Signature: r must be 0 < r < n");if(!P(t))throw new Error("Invalid Signature: s must be 0 < s < n")}toDERRawBytes(e=!1){return g(this.toDERHex(e))}toDERHex(e=!1){const t=u(p(this.s));if(e)return t;const r=u(p(this.r)),n=p(r.length/2),i=p(t.length/2);return`30${p(r.length/2+t.length/2+4)}02${n}${r}02${i}${t}`}toRawBytes(){return this.toDERRawBytes()}toHex(){return this.toDERHex()}toCompactRawBytes(){return g(this.toCompactHex())}toCompactHex(){return d(this.r)+d(this.s)}}function l(...e){if(1===e.length)return e[0];const t=e.reduce(((e,t)=>e+t.length),0),r=new Uint8Array(t);for(let t=0,n=0;t<e.length;t++){const i=e[t];r.set(i,n),n+=i.length}return r}function h(e){let t="";for(let r=0;r<e.length;r++)t+=e[r].toString(16).padStart(2,"0");return t}function d(e){return e.toString(16).padStart(64,"0")}function f(e){return g(d(e))}function p(e){const t=e.toString(16);return 1&t.length?`0${t}`:t}function y(e){if("string"!=typeof e)throw new TypeError("hexToNumber: expected string, got "+typeof e);return BigInt(`0x${e}`)}function g(e){if("string"!=typeof e)throw new TypeError("hexToBytes: expected string, got "+typeof e);if(e.length%2)throw new Error("hexToBytes: received invalid unpadded hex");const t=new Uint8Array(e.length/2);for(let r=0;r<t.length;r++){const n=2*r;t[r]=Number.parseInt(e.slice(n,n+2),16)}return t}function $(e){return e instanceof Uint8Array?e:g(e)}function m(e){return y(h(e))}function b(e){return 2*Number.parseInt(e,16)}function v(e){return"bigint"==typeof e&&e>0n||!!("number"==typeof e&&e>0&&Number.isSafeInteger(e))}function _(e,t=r.P){const n=e%t;return n>=0?n:t+n}function w(e,t){const{P:n}=r;let i=e;for(;t-- >0n;)i*=i,i%=n;return i}function E(e,t=r.P){if(0n===e||t<=0n)throw new Error(`invert: expected positive integers, got n=${e} mod=${t}`);let n=_(e,t),i=t,[s,o,a,u]=[0n,1n,1n,0n];for(;0n!==n;){const e=i/n,t=i%n,r=s-a*e,c=o-u*e;[i,n]=[n,t],[s,o]=[a,u],[a,u]=[r,c]}if(1n!==i)throw new Error("invert: does not exist");return _(s,t)}t.Signature=c,t.SignResult=c;const S=(e,t)=>(e+t/2n)/t,A=2n**128n;function T(e){const{n:t}=r,n=0x3086d221a7d46bcde86c90e49284eb15n,i=-0xe4437ed6010e88286f547fa90abfe4c3n,s=n,o=S(s*e,t),a=S(-i*e,t);let u=_(e-o*n-0x114ca50f7a8e2f3f657c1108d9d44cfd8n*a,t),c=_(-o*i-a*s,t);const l=u>A,h=c>A;if(l&&(u=t-u),h&&(c=t-c),u>A||c>A)throw new Error("splitScalarEndo: Endomorphism failed");return[l,u,h,c]}function I(e,t){if(null==e)throw new Error(`sign: expected valid msgHash, not "${e}"`);const r=f("string"==typeof e?y(e):m(e));return[r,m(r),f(t),new Uint8Array(32).fill(1),new Uint8Array(32).fill(0),Uint8Array.from([0]),Uint8Array.from([1])]}function P(e){return 0<e&&e<r.n}function R(e,t,n){const i=m(e);if(!P(i))return;const s=r.n,o=a.BASE.multiply(i),u=_(o.x,s),c=_(E(i,s)*(t+u*n),s);return 0n!==u&&0n!==c?[o,u,c]:void 0}function C(e){let t;if("bigint"==typeof e)t=e;else if("number"==typeof e&&Number.isSafeInteger(e)&&e>0)t=BigInt(e);else if("string"==typeof e){if(64!==e.length)throw new Error("Expected 32 bytes of private key");t=y(e)}else{if(!(e instanceof Uint8Array))throw new TypeError("Expected valid private key");if(32!==e.length)throw new Error("Expected 32 bytes of private key");t=m(e)}if(!P(t))throw new Error("Expected private key: 0 < key < n");return t}function B(e){return e instanceof a?(e.assertValidity(),e):a.fromHex(e)}function k(e){return e instanceof c?(e.assertValidity(),e):c.fromDER(e)}function K(e){const t=e instanceof Uint8Array,r="string"==typeof e,n=(t||r)&&e.length;return t?33===n||65===n:r?66===n||130===n:e instanceof a}function O(e,t,n=!1){const[i,s,o]=e;let{canonical:a,der:u,recovered:l}=t,h=(i.x===s?0:2)|Number(1n&i.y),d=o;o>r.n>>1n&&a&&(d=r.n-o,h^=1);const f=new c(s,d);f.assertValidity();const p=!1===u?f.toCompactHex():f.toDERHex(),y=n?p:g(p);return l?[y,h]:y}async function N(e,...r){const n=new Uint8Array(e.split("").map((e=>e.charCodeAt(0)))),i=await t.utils.sha256(n);return m(await t.utils.sha256(l(i,i,...r)))}async function D(e,t,n){const i=f(e);return _(await N("BIP0340/challenge",i,t.toRawX(),n),r.n)}function M(e){return 0n===_(e.y,2n)}t.getPublicKey=function(e,t=!1){const r=a.fromPrivateKey(e);return"string"==typeof e?r.toHex(t):r.toRawBytes(t)},t.recoverPublicKey=function(e,t,r){const n=a.fromSignature(e,t,r);return"string"==typeof e?n.toHex():n.toRawBytes()},t.getSharedSecret=function(e,t,r=!1){if(K(e))throw new TypeError("getSharedSecret: first arg must be private key");if(!K(t))throw new TypeError("getSharedSecret: second arg must be public key");const n=B(t);n.assertValidity();const i=n.multiply(C(e));return"string"==typeof e?i.toHex(r):i.toRawBytes(r)},t.sign=async function(e,r,n={}){return O(await async function(e,r){const n=C(r);let[i,s,o,a,u,c,l]=I(e,n);const h=t.utils.hmacSha256;u=await h(u,a,c,o,i),a=await h(u,a),u=await h(u,a,l,o,i),a=await h(u,a);for(let e=0;e<1e3;e++){a=await h(u,a);let e=R(a,s,n);if(e)return e;u=await h(u,a,c),a=await h(u,a)}throw new TypeError("secp256k1: Tried 1,000 k values for sign(), all were invalid")}(e,r),n,"string"==typeof e)},t.signSync=function(e,r,n={}){return O(function(e,r){const n=C(r);let[i,s,o,a,u,c,l]=I(e,n);const h=t.utils.hmacSha256Sync;if(!h)throw new Error("utils.hmacSha256Sync is undefined, you need to set it");if(u=h(u,a,c,o,i),u instanceof Promise)throw new Error("To use sync sign(), ensure utils.hmacSha256 is sync");a=h(u,a),u=h(u,a,l,o,i),a=h(u,a);for(let e=0;e<1e3;e++){a=h(u,a);let e=R(a,s,n);if(e)return e;u=h(u,a,c),a=h(u,a)}throw new TypeError("secp256k1: Tried 1,000 k values for sign(), all were invalid")}(e,r),n,"string"==typeof e)},t.verify=function(e,t,n){const{n:i}=r;let o;try{o=k(e)}catch(e){return!1}const{r:a,s:u}=o,c=function(e){"string"!=typeof e&&(e=h(e));let t=y(e||"0");const n=e.length/2*8-256;return n>0&&(t>>=BigInt(n)),t>=r.n&&(t-=r.n),t}(t);if(0n===c)return!1;const l=s.fromAffine(B(n)),d=E(u,i),f=_(c*d,i),p=_(a*d,i),g=s.BASE.multiply(f),$=l.multiplyUnsafe(p);return _(g.add($).toAffine().x,i)===a};class L{constructor(e,t){if(this.r=e,this.s=t,e<=0n||t<=0n||e>=r.P||t>=r.n)throw new Error("Invalid signature")}static fromHex(e){const t=$(e);if(64!==t.length)throw new TypeError(`SchnorrSignature.fromHex: expected 64 bytes, not ${t.length}`);const r=m(t.slice(0,32)),n=m(t.slice(32));return new L(r,n)}toHex(){return d(this.r)+d(this.s)}toRawBytes(){return g(this.toHex())}}async function x(e,t,r){const n=e instanceof L?e:L.fromHex(e),i="string"==typeof t?g(t):t,s=B(r),o=await D(n.r,s,i),u=a.fromPrivateKey(n.s),c=s.multiply(o),l=u.subtract(c);return!(l.equals(a.BASE)||!M(l)||l.x!==n.r)}t.schnorr={Signature:L,getPublicKey:function(e){const t=a.fromPrivateKey(e);return"string"==typeof e?t.toHexX():t.toRawX()},sign:async function(e,n,i=t.utils.randomBytes()){if(null==e)throw new TypeError(`sign: Expected valid message, not "${e}"`);n||(n=0n);const{n:s}=r,o=$(e),u=C(n),c=$(i);if(32!==c.length)throw new TypeError("sign: Expected 32 bytes of aux randomness");const l=a.fromPrivateKey(u),h=M(l)?u:s-u,d=h^await N("BIP0340/aux",c),p=_(await N("BIP0340/nonce",f(d),l.toRawX(),o),s);if(0n===p)throw new Error("sign: Creation of signature failed. k is zero");const y=a.fromPrivateKey(p),g=M(y)?p:s-p,m=await D(y.x,l,o),b=new L(y.x,_(g+m*h,s));if(!await x(b.toRawBytes(),o,l.toRawX()))throw new Error("sign: Invalid signature produced");return"string"==typeof e?b.toHex():b.toRawBytes()},verify:x},a.BASE._setWindowSize(8);const U=(()=>{const e="object"==typeof self&&"crypto"in self?self.crypto:void 0;return{node:"function"==typeof commonjsRequire&&!e?require$$0$9:void 0,web:e}})();t.utils={isValidPrivateKey(e){try{return C(e),!0}catch(e){return!1}},randomBytes:(e=32)=>{if(U.web)return U.web.getRandomValues(new Uint8Array(e));if(U.node){const{randomBytes:t}=U.node;return new Uint8Array(t(e).buffer)}throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>{let e=8;for(;e--;){const e=t.utils.randomBytes(32),r=m(e);if(P(r)&&1n!==r)return e}throw new Error("Valid private key was not found in 8 iterations. PRNG is broken")},sha256:async e=>{if(U.web){const t=await U.web.subtle.digest("SHA-256",e.buffer);return new Uint8Array(t)}if(U.node){const{createHash:t}=U.node;return Uint8Array.from(t("sha256").update(e).digest())}throw new Error("The environment doesn't have sha256 function")},hmacSha256:async(e,...t)=>{if(U.web){const r=await U.web.subtle.importKey("raw",e,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),n=l(...t),i=await U.web.subtle.sign("HMAC",r,n);return new Uint8Array(i)}if(U.node){const{createHmac:r}=U.node,n=r("sha256",e);for(let e of t)n.update(e);return Uint8Array.from(n.digest())}throw new Error("The environment doesn't have hmac-sha256 function")},sha256Sync:void 0,hmacSha256Sync:void 0,precompute(e=8,t=a.BASE){const r=t===a.BASE?t:new a(t.x,t.y);return r._setWindowSize(e),r.multiply(3n),r}}}(0,nobleSecp256k1.exports);const errcode$p=errCode$m,secp$1=nobleSecp256k1.exports,{sha256:sha256$a}=require$$4$3;var secp256k1$2=()=>({generateKey:function(){return secp$1.utils.randomPrivateKey()},privateKeyLength:32,hashAndSign:async function(e,t){const{digest:r}=await sha256$a.digest(t);try{return await secp$1.sign(r,e)}catch(e){throw errcode$p(e,"ERR_INVALID_INPUT")}},hashAndVerify:async function(e,t,r){try{const{digest:n}=await sha256$a.digest(r);return secp$1.verify(t,n,e)}catch(e){throw errcode$p(e,"ERR_INVALID_INPUT")}},compressPublicKey:function(e){return secp$1.Point.fromHex(e).toRawBytes(!0)},decompressPublicKey:function(e){return secp$1.Point.fromHex(e).toRawBytes(!1)},validatePrivateKey:function(e){try{secp$1.getPublicKey(e,!0)}catch(e){throw errcode$p(e,"ERR_INVALID_PRIVATE_KEY")}},validatePublicKey:function(e){try{secp$1.Point.fromHex(e)}catch(e){throw errcode$p(e,"ERR_INVALID_PUBLIC_KEY")}},computePublicKey:function(e){try{return secp$1.getPublicKey(e,!0)}catch(e){throw errcode$p(e,"ERR_INVALID_PRIVATE_KEY")}}});const{sha256:sha256$9}=require$$4$3,errcode$o=errCode$m,{equals:uint8ArrayEquals$9}=require$$10$1,{toString:uint8ArrayToString$d}=require$$1$5,exporter$8=exporter$b;var secp256k1Class$2=(e,t,r)=>{r=r||secp256k1$2();class n{constructor(e){r.validatePublicKey(e),this._key=e}verify(e,t){return r.hashAndVerify(this._key,t,e)}marshal(){return r.compressPublicKey(this._key)}get bytes(){return e.PublicKey.encode({Type:e.KeyType.Secp256k1,Data:this.marshal()}).finish()}equals(e){return uint8ArrayEquals$9(this.bytes,e.bytes)}async hash(){const{bytes:e}=await sha256$9.digest(this.bytes);return e}}class i{constructor(e,t){this._key=e,this._publicKey=t||r.computePublicKey(e),r.validatePrivateKey(this._key),r.validatePublicKey(this._publicKey)}sign(e){return r.hashAndSign(this._key,e)}get public(){return new n(this._publicKey)}marshal(){return this._key}get bytes(){return e.PrivateKey.encode({Type:e.KeyType.Secp256k1,Data:this.marshal()}).finish()}equals(e){return uint8ArrayEquals$9(this.bytes,e.bytes)}async hash(){const{bytes:e}=await sha256$9.digest(this.bytes);return e}async id(){const e=await this.public.hash();return uint8ArrayToString$d(e,"base58btc")}async export(e,t="libp2p-key"){if("libp2p-key"===t)return exporter$8.export(this.bytes,e);throw errcode$o(new Error(`export format '${t}' is not supported`),"ERR_INVALID_EXPORT_FORMAT")}}return{Secp256k1PublicKey:n,Secp256k1PrivateKey:i,unmarshalSecp256k1PrivateKey:function(e){return new i(e)},unmarshalSecp256k1PublicKey:function(e){return new n(e)},generateKeyPair:async function(){const e=await r.generateKey();return new i(e)}}},indexBrowser$2={},lengths$5={SHA1:20,SHA256:32,SHA512:64};const webcrypto$b=webcrypto$e,lengths$4=lengths$5,hashTypes$2={SHA1:"SHA-1",SHA256:"SHA-256",SHA512:"SHA-512"},sign$3=async(e,t)=>{const r=await webcrypto$b.get().subtle.sign({name:"HMAC"},e,t);return new Uint8Array(r,r.byteOffset,r.byteLength)};indexBrowser$2.create=async function(e,t){const r=hashTypes$2[e],n=await webcrypto$b.get().subtle.importKey("raw",t,{name:"HMAC",hash:{name:r}},!1,["sign"]);return{digest:async e=>sign$3(n,e),length:lengths$4[e]}};const errcode$n=errCode$m,{concat:uint8ArrayConcat$6}=require$$2$2,{fromString:uint8ArrayFromString$c}=require$$3$1,hmac$4=indexBrowser$2,cipherMap$2={"AES-128":{ivSize:16,keySize:16},"AES-256":{ivSize:16,keySize:32},Blowfish:{ivSize:8,cipherKeySize:32}};var keyStretcher$2=async(e,t,r)=>{const n=cipherMap$2[e];if(!n){const t=Object.keys(cipherMap$2).join(" / ");throw errcode$n(new Error(`unknown cipher type '${e}'. Must be ${t}`),"ERR_INVALID_CIPHER_TYPE")}if(!t)throw errcode$n(new Error("missing hash type"),"ERR_MISSING_HASH_TYPE");const i=n.keySize,s=n.ivSize,o=uint8ArrayFromString$c("key expansion"),a=2*(s+i+20),u=await hmac$4.create(t,r);let c=await u.digest(o);const l=[];let h=0;for(;h<a;){const e=await u.digest(uint8ArrayConcat$6([c,o]));let t=e.length;h+t>a&&(t=a-h),l.push(e),h+=t,c=await u.digest(c)}const d=a/2,f=uint8ArrayConcat$6(l),p=f.slice(0,d),y=f.slice(d,a),g=e=>({iv:e.slice(0,s),cipherKey:e.slice(s,s+i),macKey:e.slice(s+i)});return{k1:g(p),k2:g(y)}},ecdhBrowser$2={};const errcode$m=errCode$m;var validateCurveType$5=function(e,t){if(!e.includes(t)){const r=e.join(" / ");throw errcode$m(new Error(`Unknown curve: ${t}. Must be ${r}`),"ERR_INVALID_CURVE")}};const errcode$l=errCode$m,webcrypto$a=webcrypto$e,{base64urlToBuffer:base64urlToBuffer$2}=util$2,validateCurveType$4=validateCurveType$5,{toString:uint8ArrayToString$c}=require$$1$5,{concat:uint8ArrayConcat$5}=require$$2$2,{equals:uint8ArrayEquals$8}=require$$10$1,bits$2={"P-256":256,"P-384":384,"P-521":521};ecdhBrowser$2.generateEphmeralKeyPair=async function(e){validateCurveType$4(Object.keys(bits$2),e);const t=await webcrypto$a.get().subtle.generateKey({name:"ECDH",namedCurve:e},!0,["deriveBits"]);return{key:marshalPublicKey$5(await webcrypto$a.get().subtle.exportKey("jwk",t.publicKey)),genSharedKey:async(r,n)=>{let i;i=n?await webcrypto$a.get().subtle.importKey("jwk",unmarshalPrivateKey$5(e,n),{name:"ECDH",namedCurve:e},!1,["deriveBits"]):t.privateKey;const s=[await webcrypto$a.get().subtle.importKey("jwk",unmarshalPublicKey$5(e,r),{name:"ECDH",namedCurve:e},!1,[]),i],o=await webcrypto$a.get().subtle.deriveBits({name:"ECDH",namedCurve:e,public:s[0]},s[1],bits$2[e]);return new Uint8Array(o,o.byteOffset,o.byteLength)}}};const curveLengths$2={"P-256":32,"P-384":48,"P-521":66};function marshalPublicKey$5(e){const t=curveLengths$2[e.crv];return uint8ArrayConcat$5([Uint8Array.from([4]),base64urlToBuffer$2(e.x,t),base64urlToBuffer$2(e.y,t)],1+2*t)}function unmarshalPublicKey$5(e,t){const r=curveLengths$2[e];if(uint8ArrayEquals$8(!t.slice(0,1),Uint8Array.from([4])))throw errcode$l(new Error("Cannot unmarshal public key - invalid key format"),"ERR_INVALID_KEY_FORMAT");return{kty:"EC",crv:e,x:uint8ArrayToString$c(t.slice(1,r+1),"base64url"),y:uint8ArrayToString$c(t.slice(1+r),"base64url"),ext:!0}}const unmarshalPrivateKey$5=(e,t)=>({...unmarshalPublicKey$5(e,t.public),d:uint8ArrayToString$c(t.private,"base64url")}),ecdh$2=ecdhBrowser$2;var ephemeralKeys$2=async e=>ecdh$2.generateEphmeralKeyPair(e);const keysPBM$2=keys$6,forge$c=forge$X,errcode$k=errCode$m,{fromString:uint8ArrayFromString$b}=require$$3$1,importer$4=importer$5,supportedKeys$2={rsa:rsaClass$2,ed25519:ed25519Class$2,secp256k1:secp256k1Class$2(keysPBM$2)},ErrMissingSecp256K1$2={message:"secp256k1 support requires libp2p-crypto-secp256k1 package",code:"ERR_MISSING_PACKAGE"};function typeToKey$2(e){const t=supportedKeys$2[e.toLowerCase()];if(!t){const t=Object.keys(supportedKeys$2).join(" / ");throw errcode$k(new Error(`invalid or unsupported key type ${e}. Must be ${t}`),"ERR_UNSUPPORTED_KEY_TYPE")}return t}const generateKeyPair$6=async(e,t)=>typeToKey$2(e).generateKeyPair(t),generateKeyPairFromSeed$4=async(e,t,r)=>{const n=typeToKey$2(e);if("ed25519"!==e.toLowerCase())throw errcode$k(new Error("Seed key derivation is unimplemented for RSA or secp256k1"),"ERR_UNSUPPORTED_KEY_DERIVATION_TYPE");return n.generateKeyPairFromSeed(t,r)},unmarshalPublicKey$4=e=>{const t=keysPBM$2.PublicKey.decode(e),r=t.Data;switch(t.Type){case keysPBM$2.KeyType.RSA:return supportedKeys$2.rsa.unmarshalRsaPublicKey(r);case keysPBM$2.KeyType.Ed25519:return supportedKeys$2.ed25519.unmarshalEd25519PublicKey(r);case keysPBM$2.KeyType.Secp256k1:if(supportedKeys$2.secp256k1)return supportedKeys$2.secp256k1.unmarshalSecp256k1PublicKey(r);throw errcode$k(new Error(ErrMissingSecp256K1$2.message),ErrMissingSecp256K1$2.code);default:typeToKey$2(t.Type)}},marshalPublicKey$4=(e,t)=>(typeToKey$2(t=(t||"rsa").toLowerCase()),e.bytes),unmarshalPrivateKey$4=async e=>{const t=keysPBM$2.PrivateKey.decode(e),r=t.Data;switch(t.Type){case keysPBM$2.KeyType.RSA:return supportedKeys$2.rsa.unmarshalRsaPrivateKey(r);case keysPBM$2.KeyType.Ed25519:return supportedKeys$2.ed25519.unmarshalEd25519PrivateKey(r);case keysPBM$2.KeyType.Secp256k1:if(supportedKeys$2.secp256k1)return supportedKeys$2.secp256k1.unmarshalSecp256k1PrivateKey(r);throw errcode$k(new Error(ErrMissingSecp256K1$2.message),ErrMissingSecp256K1$2.code);default:typeToKey$2(t.Type)}},marshalPrivateKey$2=(e,t)=>(typeToKey$2(t=(t||"rsa").toLowerCase()),e.bytes),importKey$2=async(e,t)=>{try{const r=await importer$4.import(e,t);return unmarshalPrivateKey$4(r)}catch(e){}const r=forge$c.pki.decryptRsaPrivateKey(e,t);if(null===r)throw errcode$k(new Error("Cannot read the key, most likely the password is wrong or not a RSA key"),"ERR_CANNOT_DECRYPT_PEM");let n=forge$c.asn1.toDer(forge$c.pki.privateKeyToAsn1(r));return n=uint8ArrayFromString$b(n.getBytes(),"ascii"),supportedKeys$2.rsa.unmarshalRsaPrivateKey(n)};var keys$5={supportedKeys:supportedKeys$2,keysPBM:keysPBM$2,keyStretcher:keyStretcher$2,generateEphemeralKeyPair:ephemeralKeys$2,generateKeyPair:generateKeyPair$6,generateKeyPairFromSeed:generateKeyPairFromSeed$4,unmarshalPublicKey:unmarshalPublicKey$4,marshalPublicKey:marshalPublicKey$4,unmarshalPrivateKey:unmarshalPrivateKey$4,marshalPrivateKey:marshalPrivateKey$2,import:importKey$2},$protobuf$4=minimal,$Reader$4=$protobuf$4.Reader,$Writer$4=$protobuf$4.Writer,$util$4=$protobuf$4.util,$root$4=$protobuf$4.roots["libp2p-peer-id"]||($protobuf$4.roots["libp2p-peer-id"]={});$root$4.PeerIdProto=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.id=$util$4.newBuffer([]),e.prototype.pubKey=$util$4.newBuffer([]),e.prototype.privKey=$util$4.newBuffer([]),e.encode=function(e,t){return t||(t=$Writer$4.create()),t.uint32(10).bytes(e.id),null!=e.pubKey&&Object.hasOwnProperty.call(e,"pubKey")&&t.uint32(18).bytes(e.pubKey),null!=e.privKey&&Object.hasOwnProperty.call(e,"privKey")&&t.uint32(26).bytes(e.privKey),t},e.decode=function(e,t){e instanceof $Reader$4||(e=$Reader$4.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root$4.PeerIdProto;e.pos<r;){var i=e.uint32();switch(i>>>3){case 1:n.id=e.bytes();break;case 2:n.pubKey=e.bytes();break;case 3:n.privKey=e.bytes();break;default:e.skipType(7&i)}}if(!n.hasOwnProperty("id"))throw $util$4.ProtocolError("missing required 'id'",{instance:n});return n},e.fromObject=function(e){if(e instanceof $root$4.PeerIdProto)return e;var t=new $root$4.PeerIdProto;return null!=e.id&&("string"==typeof e.id?$util$4.base64.decode(e.id,t.id=$util$4.newBuffer($util$4.base64.length(e.id)),0):e.id.length&&(t.id=e.id)),null!=e.pubKey&&("string"==typeof e.pubKey?$util$4.base64.decode(e.pubKey,t.pubKey=$util$4.newBuffer($util$4.base64.length(e.pubKey)),0):e.pubKey.length&&(t.pubKey=e.pubKey)),null!=e.privKey&&("string"==typeof e.privKey?$util$4.base64.decode(e.privKey,t.privKey=$util$4.newBuffer($util$4.base64.length(e.privKey)),0):e.privKey.length&&(t.privKey=e.privKey)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(t.bytes===String?r.id="":(r.id=[],t.bytes!==Array&&(r.id=$util$4.newBuffer(r.id))),t.bytes===String?r.pubKey="":(r.pubKey=[],t.bytes!==Array&&(r.pubKey=$util$4.newBuffer(r.pubKey))),t.bytes===String?r.privKey="":(r.privKey=[],t.bytes!==Array&&(r.privKey=$util$4.newBuffer(r.privKey)))),null!=e.id&&e.hasOwnProperty("id")&&(r.id=t.bytes===String?$util$4.base64.encode(e.id,0,e.id.length):t.bytes===Array?Array.prototype.slice.call(e.id):e.id),null!=e.pubKey&&e.hasOwnProperty("pubKey")&&(r.pubKey=t.bytes===String?$util$4.base64.encode(e.pubKey,0,e.pubKey.length):t.bytes===Array?Array.prototype.slice.call(e.pubKey):e.pubKey),null!=e.privKey&&e.hasOwnProperty("privKey")&&(r.privKey=t.bytes===String?$util$4.base64.encode(e.privKey,0,e.privKey.length):t.bytes===Array?Array.prototype.slice.call(e.privKey):e.privKey),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf$4.util.toJSONOptions)},e}();var proto$1=$root$4;!function(e,t){const{CID:r}=require$$0$a,n=require$$1$8,i=require$$2$3,s=require$$3$2,o=require$$4$5,{base58btc:a}=require$$3$2,{base32:u}=require$$1$8,{base16:c}=require$$5$1,l=require$$6$1,h=keys$5,d=classIs.exports,{PeerIdProto:f}=proto$1,{equals:p}=require$$10$1,{fromString:y}=require$$3$1,{toString:g}=require$$1$5,{identity:$}=require$$13,m={...n,...i,...s,...o},b=Object.keys(m).reduce(((e,t)=>e.or(m[t])),u.decoder);const v=d(class{constructor(e,t,r){if(!(e instanceof Uint8Array))throw new Error("invalid id provided");if(t&&r&&!p(t.public.bytes,r.bytes))throw new Error("inconsistent arguments");this._id=e,this._idB58String=a.encode(this.id).substring(1),this._privKey=t,this._pubKey=r}get id(){return this._id}set id(e){throw new Error("Id is immutable")}get privKey(){return this._privKey}set privKey(e){this._privKey=e}get pubKey(){if(this._pubKey)return this._pubKey;if(this._privKey)return this._privKey.public;try{const e=l.decode(this.id);e.code===$.code&&(this._pubKey=h.unmarshalPublicKey(e.digest))}catch(e){}return this._pubKey}set pubKey(e){this._pubKey=e}marshalPubKey(){if(this.pubKey)return h.marshalPublicKey(this.pubKey)}marshalPrivKey(){if(this.privKey)return h.marshalPrivateKey(this.privKey)}marshal(e){return f.encode({id:this.toBytes(),pubKey:this.marshalPubKey(),privKey:e?null:this.marshalPrivKey()}).finish()}toPrint(){let e=this.toB58String();e.startsWith("Qm")&&(e=e.slice(2));let t=6;return e.length<t&&(t=e.length),"<peer.ID "+e.substr(0,t)+">"}toJSON(){return{id:this.toB58String(),privKey:S(this.marshalPrivKey()),pubKey:S(this.marshalPubKey())}}toHexString(){return c.encode(this.id).substring(1)}toBytes(){return this.id}toB58String(){return this._idB58String}toString(){if(!this._idCIDString){const e=r.createV1(114,l.decode(this.id));Object.defineProperty(this,"_idCIDString",{value:e.toString(),enumerable:!1})}return this._idCIDString}equals(e){if(e instanceof Uint8Array)return p(this.id,e);if(e.id)return p(this.id,e.id);throw new Error("not valid Id")}isEqual(e){return this.equals(e)}isValid(){return Boolean(this.privKey&&this.privKey.public&&this.privKey.public.bytes&&this.pubKey.bytes instanceof Uint8Array&&p(this.privKey.public.bytes,this.pubKey.bytes))}hasInlinePublicKey(){try{if(l.decode(this.id).code===$.code)return!0}catch(e){}return!1}},{className:"PeerId",symbolName:"@libp2p/js-peer-id/PeerId"});t=e.exports=v;const _=e=>e.bytes.length<=42?l.create($.code,e.bytes).bytes:e.hash(),w=async(e,t)=>{const r=await _(t);return new v(r,e,t)};t.create=async e=>{(e=e||{}).bits=e.bits||2048,e.keyType=e.keyType||"RSA";const t=await h.generateKeyPair(e.keyType,e.bits);return w(t,t.public)},t.createFromHexString=e=>new v(c.decode("f"+e)),t.createFromBytes=e=>{try{const n=r.decode(e);if(!E(n))throw new Error("Supplied PeerID CID is invalid");return t.createFromCID(n)}catch{if(l.decode(e).code!==$.code)throw new Error("Supplied PeerID CID is invalid");return new v(e)}},t.createFromB58String=e=>t.createFromBytes(a.decode("z"+e));const E=e=>114===e.code||112===e.code;function S(e){if(e)return g(e,"base64pad")}t.createFromCID=e=>{if(!(e=r.asCID(e))||!E(e))throw new Error("Supplied PeerID CID is invalid");return new v(e.multihash.bytes)},t.createFromPubKey=async e=>{let t=e;if("string"==typeof t&&(t=y(e,"base64pad")),!(t instanceof Uint8Array))throw new Error("Supplied key is neither a base64 string nor a Uint8Array");const r=await h.unmarshalPublicKey(t);return w(void 0,r)},t.createFromPrivKey=async e=>{if("string"==typeof e&&(e=y(e,"base64pad")),!(e instanceof Uint8Array))throw new Error("Supplied key is neither a base64 string nor a Uint8Array");const t=await h.unmarshalPrivateKey(e);return w(t,t.public)},t.createFromJSON=async e=>{const t=a.decode("z"+e.id),r=e.privKey&&y(e.privKey,"base64pad"),n=e.pubKey&&y(e.pubKey,"base64pad"),i=n&&await h.unmarshalPublicKey(n);if(!r)return new v(t,void 0,i);const s=await h.unmarshalPrivateKey(r),o=await _(s.public);let u;if(i&&(u=await _(i)),i&&!p(o,u))throw new Error("Public and private key do not match");if(t&&!p(o,t))throw new Error("Id and private key do not match");return new v(t,s,i)},t.createFromProtobuf=async e=>{"string"==typeof e&&(e=y(e,"base16"));let t,r,{id:n,privKey:i,pubKey:s}=f.decode(e);if(i=!!i&&await h.unmarshalPrivateKey(i),s=!!s&&await h.unmarshalPublicKey(s),i&&(r=await _(i.public)),s&&(t=await _(s)),i){if(s&&!p(r,t))throw new Error("Public and private key do not match");return new v(r,i,i.public)}if(s)return new v(t,void 0,s);if(n)return new v(n);throw new Error("Protobuf did not contain any usable key material")},t.parse=e=>("1"!==e.charAt(0)&&"Q"!==e.charAt(0)||(e=`z${e}`),t.createFromBytes(b.decode(e))),t.isPeerId=e=>Boolean("object"==typeof e&&e._id&&e._idB58String)}(src$6,src$6.exports);var src$5={},indexBrowser$1={},webcrypto$9={get:(e=self)=>{const t=e.crypto||e.msCrypto;if(!t||!t.subtle)throw Object.assign(new Error("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p-crypto/blob/master/README.md#web-crypto-api"),{code:"ERR_MISSING_WEB_CRYPTO"});return t}},lengths$3={SHA1:20,SHA256:32,SHA512:64};const webcrypto$8=webcrypto$9,lengths$2=lengths$3,hashTypes$1={SHA1:"SHA-1",SHA256:"SHA-256",SHA512:"SHA-512"},sign$2=async(e,t)=>{const r=await webcrypto$8.get().subtle.sign({name:"HMAC"},e,t);return new Uint8Array(r,r.byteOffset,r.byteLength)};indexBrowser$1.create=async function(e,t){const r=hashTypes$1[e],n=await webcrypto$8.get().subtle.importKey("raw",t,{name:"HMAC",hash:{name:r}},!1,["sign"]);return{digest:async e=>sign$2(n,e),length:lengths$2[e]}};var aes$1={};const forge$b=forge$X,{toString:uint8ArrayToString$b}=require$$1$5,{fromString:uint8ArrayFromString$a}=require$$3$1;var ciphersBrowser={createCipheriv:(e,t,r)=>{const n=forge$b.cipher.createCipher("AES-CTR",uint8ArrayToString$b(t,"ascii"));return n.start({iv:uint8ArrayToString$b(r,"ascii")}),{update:e=>(n.update(forge$b.util.createBuffer(uint8ArrayToString$b(e,"ascii"))),uint8ArrayFromString$a(n.output.getBytes(),"ascii"))}},createDecipheriv:(e,t,r)=>{const n=forge$b.cipher.createDecipher("AES-CTR",uint8ArrayToString$b(t,"ascii"));return n.start({iv:uint8ArrayToString$b(r,"ascii")}),{update:e=>(n.update(forge$b.util.createBuffer(uint8ArrayToString$b(e,"ascii"))),uint8ArrayFromString$a(n.output.getBytes(),"ascii"))}}};const errcode$j=errCode$m,CIPHER_MODES={16:"aes-128-ctr",32:"aes-256-ctr"};var cipherMode$1=function(e){const t=CIPHER_MODES[e.length];if(!t){const t=Object.entries(CIPHER_MODES).map((([e,t])=>`${e} (${t})`)).join(" / ");throw errcode$j(new Error(`Invalid key length ${e.length} bytes. Must be ${t}`),"ERR_INVALID_KEY_LENGTH")}return t};const ciphers$4=ciphersBrowser,cipherMode=cipherMode$1;aes$1.create=async function(e,t){const r=cipherMode(e),n=ciphers$4.createCipheriv(r,e,t),i=ciphers$4.createDecipheriv(r,e,t);return{encrypt:async e=>n.update(e),decrypt:async e=>i.update(e)}};var $protobuf$3=minimal,$Reader$3=$protobuf$3.Reader,$Writer$3=$protobuf$3.Writer,$util$3=$protobuf$3.util,$root$3=$protobuf$3.roots["libp2p-crypto-keys"]||($protobuf$3.roots["libp2p-crypto-keys"]={});$root$3.KeyType=function(){var e={},t=Object.create(e);return t[e[0]="RSA"]=0,t[e[1]="Ed25519"]=1,t[e[2]="Secp256k1"]=2,t}(),$root$3.PublicKey=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.Type=0,e.prototype.Data=$util$3.newBuffer([]),e.encode=function(e,t){return t||(t=$Writer$3.create()),t.uint32(8).int32(e.Type),t.uint32(18).bytes(e.Data),t},e.decode=function(e,t){e instanceof $Reader$3||(e=$Reader$3.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root$3.PublicKey;e.pos<r;){var i=e.uint32();switch(i>>>3){case 1:n.Type=e.int32();break;case 2:n.Data=e.bytes();break;default:e.skipType(7&i)}}if(!n.hasOwnProperty("Type"))throw $util$3.ProtocolError("missing required 'Type'",{instance:n});if(!n.hasOwnProperty("Data"))throw $util$3.ProtocolError("missing required 'Data'",{instance:n});return n},e.fromObject=function(e){if(e instanceof $root$3.PublicKey)return e;var t=new $root$3.PublicKey;switch(e.Type){case"RSA":case 0:t.Type=0;break;case"Ed25519":case 1:t.Type=1;break;case"Secp256k1":case 2:t.Type=2}return null!=e.Data&&("string"==typeof e.Data?$util$3.base64.decode(e.Data,t.Data=$util$3.newBuffer($util$3.base64.length(e.Data)),0):e.Data.length&&(t.Data=e.Data)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.Type=t.enums===String?"RSA":0,t.bytes===String?r.Data="":(r.Data=[],t.bytes!==Array&&(r.Data=$util$3.newBuffer(r.Data)))),null!=e.Type&&e.hasOwnProperty("Type")&&(r.Type=t.enums===String?$root$3.KeyType[e.Type]:e.Type),null!=e.Data&&e.hasOwnProperty("Data")&&(r.Data=t.bytes===String?$util$3.base64.encode(e.Data,0,e.Data.length):t.bytes===Array?Array.prototype.slice.call(e.Data):e.Data),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf$3.util.toJSONOptions)},e}(),$root$3.PrivateKey=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.Type=0,e.prototype.Data=$util$3.newBuffer([]),e.encode=function(e,t){return t||(t=$Writer$3.create()),t.uint32(8).int32(e.Type),t.uint32(18).bytes(e.Data),t},e.decode=function(e,t){e instanceof $Reader$3||(e=$Reader$3.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root$3.PrivateKey;e.pos<r;){var i=e.uint32();switch(i>>>3){case 1:n.Type=e.int32();break;case 2:n.Data=e.bytes();break;default:e.skipType(7&i)}}if(!n.hasOwnProperty("Type"))throw $util$3.ProtocolError("missing required 'Type'",{instance:n});if(!n.hasOwnProperty("Data"))throw $util$3.ProtocolError("missing required 'Data'",{instance:n});return n},e.fromObject=function(e){if(e instanceof $root$3.PrivateKey)return e;var t=new $root$3.PrivateKey;switch(e.Type){case"RSA":case 0:t.Type=0;break;case"Ed25519":case 1:t.Type=1;break;case"Secp256k1":case 2:t.Type=2}return null!=e.Data&&("string"==typeof e.Data?$util$3.base64.decode(e.Data,t.Data=$util$3.newBuffer($util$3.base64.length(e.Data)),0):e.Data.length&&(t.Data=e.Data)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.Type=t.enums===String?"RSA":0,t.bytes===String?r.Data="":(r.Data=[],t.bytes!==Array&&(r.Data=$util$3.newBuffer(r.Data)))),null!=e.Type&&e.hasOwnProperty("Type")&&(r.Type=t.enums===String?$root$3.KeyType[e.Type]:e.Type),null!=e.Data&&e.hasOwnProperty("Data")&&(r.Data=t.bytes===String?$util$3.base64.encode(e.Data,0,e.Data.length):t.bytes===Array?Array.prototype.slice.call(e.Data):e.Data),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf$3.util.toJSONOptions)},e}();var keys$4=$root$3;const{concat:concat$1}=require$$2$2,{fromString:fromString$1}=require$$3$1,webcrypto$7=webcrypto$9;function create$1({algorithm:e="AES-GCM",nonceLength:t=12,keyLength:r=16,digest:n="SHA-256",saltLength:i=16,iterations:s=32767}={}){const o=webcrypto$7.get();return r*=8,{encrypt:async function(a,u){const c=o.getRandomValues(new Uint8Array(i)),l=o.getRandomValues(new Uint8Array(t)),h={name:e,iv:l},d={name:"PBKDF2",salt:c,iterations:s,hash:{name:n}},f=await o.subtle.importKey("raw",fromString$1(u),{name:"PBKDF2"},!1,["deriveKey","deriveBits"]),p=await o.subtle.deriveKey(d,f,{name:e,length:r},!0,["encrypt"]),y=await o.subtle.encrypt(h,p,a);return concat$1([c,h.iv,new Uint8Array(y)])},decrypt:async function(a,u){const c=a.slice(0,i),l=a.slice(i,i+t),h=a.slice(i+t),d={name:e,iv:l},f={name:"PBKDF2",salt:c,iterations:s,hash:{name:n}},p=await o.subtle.importKey("raw",fromString$1(u),{name:"PBKDF2"},!1,["deriveKey","deriveBits"]),y=await o.subtle.deriveKey(f,p,{name:e,length:r},!0,["decrypt"]),g=await o.subtle.decrypt(d,y,h);return new Uint8Array(g)}}}var aesGcm_browser$1={create:create$1};const{base64:base64$3}=require$$4$5,ciphers$3=aesGcm_browser$1;var importer$3={import:async function(e,t){const r=base64$3.decode(e),n=ciphers$3.create();return await n.decrypt(r,t)}},asn1Validator$1={},forge$a=forge$X,asn1=forge$a.asn1;asn1Validator$1.privateKeyValidator={name:"PrivateKeyInfo",tagClass:asn1.Class.UNIVERSAL,type:asn1.Type.SEQUENCE,constructed:!0,value:[{name:"PrivateKeyInfo.version",tagClass:asn1.Class.UNIVERSAL,type:asn1.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"PrivateKeyInfo.privateKeyAlgorithm",tagClass:asn1.Class.UNIVERSAL,type:asn1.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:asn1.Class.UNIVERSAL,type:asn1.Type.OID,constructed:!1,capture:"privateKeyOid"}]},{name:"PrivateKeyInfo",tagClass:asn1.Class.UNIVERSAL,type:asn1.Type.OCTETSTRING,constructed:!1,capture:"privateKey"}]},asn1Validator$1.publicKeyValidator={name:"SubjectPublicKeyInfo",tagClass:asn1.Class.UNIVERSAL,type:asn1.Type.SEQUENCE,constructed:!0,captureAsn1:"subjectPublicKeyInfo",value:[{name:"SubjectPublicKeyInfo.AlgorithmIdentifier",tagClass:asn1.Class.UNIVERSAL,type:asn1.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:asn1.Class.UNIVERSAL,type:asn1.Type.OID,constructed:!1,capture:"publicKeyOid"}]},{tagClass:asn1.Class.UNIVERSAL,type:asn1.Type.BITSTRING,constructed:!1,composed:!0,captureBitStringValue:"ed25519PublicKey"}]};var forge$9=forge$X,asn1Validator=asn1Validator$1,publicKeyValidator=asn1Validator.publicKeyValidator,privateKeyValidator=asn1Validator.privateKeyValidator;if(void 0===BigInteger)var BigInteger=forge$9.jsbn.BigInteger;var ByteBuffer=forge$9.util.ByteBuffer,NativeBuffer=void 0===Buffer$f?Uint8Array:Buffer$f;forge$9.pki=forge$9.pki||{},module.exports=forge$9.pki.ed25519=forge$9.ed25519=forge$9.ed25519||{};var ed25519$2=forge$9.ed25519;function messageToNativeBuffer(e){var t=e.message;if(t instanceof Uint8Array||t instanceof NativeBuffer)return t;var r=e.encoding;if(void 0===t){if(!e.md)throw new TypeError('"options.message" or "options.md" not specified.');t=e.md.digest().getBytes(),r="binary"}if("string"==typeof t&&!r)throw new TypeError('"options.encoding" must be "binary" or "utf8".');if("string"==typeof t){if(void 0!==Buffer$f)return Buffer$f.from(t,r);t=new ByteBuffer(t,r)}else if(!(t instanceof ByteBuffer))throw new TypeError('"options.message" must be a node.js Buffer, a Uint8Array, a forge ByteBuffer, or a string with "options.encoding" specifying its encoding.');for(var n=new NativeBuffer(t.length()),i=0;i<n.length;++i)n[i]=t.at(i);return n}ed25519$2.constants={},ed25519$2.constants.PUBLIC_KEY_BYTE_LENGTH=32,ed25519$2.constants.PRIVATE_KEY_BYTE_LENGTH=64,ed25519$2.constants.SEED_BYTE_LENGTH=32,ed25519$2.constants.SIGN_BYTE_LENGTH=64,ed25519$2.constants.HASH_BYTE_LENGTH=64,ed25519$2.generateKeyPair=function(e){var t=(e=e||{}).seed;if(void 0===t)t=forge$9.random.getBytesSync(ed25519$2.constants.SEED_BYTE_LENGTH);else if("string"==typeof t){if(t.length!==ed25519$2.constants.SEED_BYTE_LENGTH)throw new TypeError('"seed" must be '+ed25519$2.constants.SEED_BYTE_LENGTH+" bytes in length.")}else if(!(t instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, Uint8Array, or a binary string.');t=messageToNativeBuffer({message:t,encoding:"binary"});for(var r=new NativeBuffer(ed25519$2.constants.PUBLIC_KEY_BYTE_LENGTH),n=new NativeBuffer(ed25519$2.constants.PRIVATE_KEY_BYTE_LENGTH),i=0;i<32;++i)n[i]=t[i];return crypto_sign_keypair(r,n),{publicKey:r,privateKey:n}},ed25519$2.privateKeyFromAsn1=function(e){var t={},r=[];if(!forge$9.asn1.validate(e,privateKeyValidator,t,r)){var n=new Error("Invalid Key.");throw n.errors=r,n}var i=forge$9.asn1.derToOid(t.privateKeyOid),s=forge$9.oids.EdDSA25519;if(i!==s)throw new Error('Invalid OID "'+i+'"; OID must be "'+s+'".');var o=t.privateKey;return{privateKeyBytes:messageToNativeBuffer({message:forge$9.asn1.fromDer(o).value,encoding:"binary"})}},ed25519$2.publicKeyFromAsn1=function(e){var t={},r=[];if(!forge$9.asn1.validate(e,publicKeyValidator,t,r)){var n=new Error("Invalid Key.");throw n.errors=r,n}var i=forge$9.asn1.derToOid(t.publicKeyOid),s=forge$9.oids.EdDSA25519;if(i!==s)throw new Error('Invalid OID "'+i+'"; OID must be "'+s+'".');var o=t.ed25519PublicKey;if(o.length!==ed25519$2.constants.PUBLIC_KEY_BYTE_LENGTH)throw new Error("Key length is invalid.");return messageToNativeBuffer({message:o,encoding:"binary"})},ed25519$2.publicKeyFromPrivateKey=function(e){var t=messageToNativeBuffer({message:(e=e||{}).privateKey,encoding:"binary"});if(t.length!==ed25519$2.constants.PRIVATE_KEY_BYTE_LENGTH)throw new TypeError('"options.privateKey" must have a byte length of '+ed25519$2.constants.PRIVATE_KEY_BYTE_LENGTH);for(var r=new NativeBuffer(ed25519$2.constants.PUBLIC_KEY_BYTE_LENGTH),n=0;n<r.length;++n)r[n]=t[32+n];return r},ed25519$2.sign=function(e){var t=messageToNativeBuffer(e=e||{}),r=messageToNativeBuffer({message:e.privateKey,encoding:"binary"});if(r.length===ed25519$2.constants.SEED_BYTE_LENGTH)r=ed25519$2.generateKeyPair({seed:r}).privateKey;else if(r.length!==ed25519$2.constants.PRIVATE_KEY_BYTE_LENGTH)throw new TypeError('"options.privateKey" must have a byte length of '+ed25519$2.constants.SEED_BYTE_LENGTH+" or "+ed25519$2.constants.PRIVATE_KEY_BYTE_LENGTH);var n=new NativeBuffer(ed25519$2.constants.SIGN_BYTE_LENGTH+t.length);crypto_sign(n,t,t.length,r);for(var i=new NativeBuffer(ed25519$2.constants.SIGN_BYTE_LENGTH),s=0;s<i.length;++s)i[s]=n[s];return i},ed25519$2.verify=function(e){var t=messageToNativeBuffer(e=e||{});if(void 0===e.signature)throw new TypeError('"options.signature" must be a node.js Buffer, a Uint8Array, a forge ByteBuffer, or a binary string.');var r=messageToNativeBuffer({message:e.signature,encoding:"binary"});if(r.length!==ed25519$2.constants.SIGN_BYTE_LENGTH)throw new TypeError('"options.signature" must have a byte length of '+ed25519$2.constants.SIGN_BYTE_LENGTH);var n=messageToNativeBuffer({message:e.publicKey,encoding:"binary"});if(n.length!==ed25519$2.constants.PUBLIC_KEY_BYTE_LENGTH)throw new TypeError('"options.publicKey" must have a byte length of '+ed25519$2.constants.PUBLIC_KEY_BYTE_LENGTH);var i,s=new NativeBuffer(ed25519$2.constants.SIGN_BYTE_LENGTH+t.length),o=new NativeBuffer(ed25519$2.constants.SIGN_BYTE_LENGTH+t.length);for(i=0;i<ed25519$2.constants.SIGN_BYTE_LENGTH;++i)s[i]=r[i];for(i=0;i<t.length;++i)s[i+ed25519$2.constants.SIGN_BYTE_LENGTH]=t[i];return crypto_sign_open(o,s,s.length,n)>=0};var gf0=gf(),gf1=gf([1]),D=gf([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),D2=gf([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),X=gf([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),Y=gf([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),L=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]),I=gf([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function sha512(e,t){var r=forge$9.md.sha512.create(),n=new ByteBuffer(e);r.update(n.getBytes(t),"binary");var i=r.digest().getBytes();if(void 0!==Buffer$f)return Buffer$f.from(i,"binary");for(var s=new NativeBuffer(ed25519$2.constants.HASH_BYTE_LENGTH),o=0;o<64;++o)s[o]=i.charCodeAt(o);return s}function crypto_sign_keypair(e,t){var r,n=[gf(),gf(),gf(),gf()],i=sha512(t,32);for(i[0]&=248,i[31]&=127,i[31]|=64,scalarbase(n,i),pack(e,n),r=0;r<32;++r)t[r+32]=e[r];return 0}function crypto_sign(e,t,r,n){var i,s,o=new Float64Array(64),a=[gf(),gf(),gf(),gf()],u=sha512(n,32);u[0]&=248,u[31]&=127,u[31]|=64;var c=r+64;for(i=0;i<r;++i)e[64+i]=t[i];for(i=0;i<32;++i)e[32+i]=u[32+i];var l=sha512(e.subarray(32),r+32);for(reduce(l),scalarbase(a,l),pack(e,a),i=32;i<64;++i)e[i]=n[i];var h=sha512(e,r+64);for(reduce(h),i=32;i<64;++i)o[i]=0;for(i=0;i<32;++i)o[i]=l[i];for(i=0;i<32;++i)for(s=0;s<32;s++)o[i+s]+=h[i]*u[s];return modL(e.subarray(32),o),c}function crypto_sign_open(e,t,r,n){var i,s=new NativeBuffer(32),o=[gf(),gf(),gf(),gf()],a=[gf(),gf(),gf(),gf()];if(-1,r<64)return-1;if(unpackneg(a,n))return-1;for(i=0;i<r;++i)e[i]=t[i];for(i=0;i<32;++i)e[i+32]=n[i];var u=sha512(e,r);if(reduce(u),scalarmult(o,a,u),scalarbase(a,t.subarray(32)),add(o,a),pack(s,o),r-=64,crypto_verify_32(t,0,s,0)){for(i=0;i<r;++i)e[i]=0;return-1}for(i=0;i<r;++i)e[i]=t[i+64];return r}function modL(e,t){var r,n,i,s;for(n=63;n>=32;--n){for(r=0,i=n-32,s=n-12;i<s;++i)t[i]+=r-16*t[n]*L[i-(n-32)],r=t[i]+128>>8,t[i]-=256*r;t[i]+=r,t[n]=0}for(r=0,i=0;i<32;++i)t[i]+=r-(t[31]>>4)*L[i],r=t[i]>>8,t[i]&=255;for(i=0;i<32;++i)t[i]-=r*L[i];for(n=0;n<32;++n)t[n+1]+=t[n]>>8,e[n]=255&t[n]}function reduce(e){for(var t=new Float64Array(64),r=0;r<64;++r)t[r]=e[r],e[r]=0;modL(e,t)}function add(e,t){var r=gf(),n=gf(),i=gf(),s=gf(),o=gf(),a=gf(),u=gf(),c=gf(),l=gf();Z(r,e[1],e[0]),Z(l,t[1],t[0]),M(r,r,l),A(n,e[0],e[1]),A(l,t[0],t[1]),M(n,n,l),M(i,e[3],t[3]),M(i,i,D2),M(s,e[2],t[2]),A(s,s,s),Z(o,n,r),Z(a,s,i),A(u,s,i),A(c,n,r),M(e[0],o,a),M(e[1],c,u),M(e[2],u,a),M(e[3],o,c)}function cswap(e,t,r){for(var n=0;n<4;++n)sel25519(e[n],t[n],r)}function pack(e,t){var r=gf(),n=gf(),i=gf();inv25519(i,t[2]),M(r,t[0],i),M(n,t[1],i),pack25519(e,n),e[31]^=par25519(r)<<7}function pack25519(e,t){var r,n,i,s=gf(),o=gf();for(r=0;r<16;++r)o[r]=t[r];for(car25519(o),car25519(o),car25519(o),n=0;n<2;++n){for(s[0]=o[0]-65517,r=1;r<15;++r)s[r]=o[r]-65535-(s[r-1]>>16&1),s[r-1]&=65535;s[15]=o[15]-32767-(s[14]>>16&1),i=s[15]>>16&1,s[14]&=65535,sel25519(o,s,1-i)}for(r=0;r<16;r++)e[2*r]=255&o[r],e[2*r+1]=o[r]>>8}function unpackneg(e,t){var r=gf(),n=gf(),i=gf(),s=gf(),o=gf(),a=gf(),u=gf();return set25519(e[2],gf1),unpack25519(e[1],t),S(i,e[1]),M(s,i,D),Z(i,i,e[2]),A(s,e[2],s),S(o,s),S(a,o),M(u,a,o),M(r,u,i),M(r,r,s),pow2523(r,r),M(r,r,i),M(r,r,s),M(r,r,s),M(e[0],r,s),S(n,e[0]),M(n,n,s),neq25519(n,i)&&M(e[0],e[0],I),S(n,e[0]),M(n,n,s),neq25519(n,i)?-1:(par25519(e[0])===t[31]>>7&&Z(e[0],gf0,e[0]),M(e[3],e[0],e[1]),0)}function unpack25519(e,t){var r;for(r=0;r<16;++r)e[r]=t[2*r]+(t[2*r+1]<<8);e[15]&=32767}function pow2523(e,t){var r,n=gf();for(r=0;r<16;++r)n[r]=t[r];for(r=250;r>=0;--r)S(n,n),1!==r&&M(n,n,t);for(r=0;r<16;++r)e[r]=n[r]}function neq25519(e,t){var r=new NativeBuffer(32),n=new NativeBuffer(32);return pack25519(r,e),pack25519(n,t),crypto_verify_32(r,0,n,0)}function crypto_verify_32(e,t,r,n){return vn(e,t,r,n,32)}function vn(e,t,r,n,i){var s,o=0;for(s=0;s<i;++s)o|=e[t+s]^r[n+s];return(1&o-1>>>8)-1}function par25519(e){var t=new NativeBuffer(32);return pack25519(t,e),1&t[0]}function scalarmult(e,t,r){var n,i;for(set25519(e[0],gf0),set25519(e[1],gf1),set25519(e[2],gf1),set25519(e[3],gf0),i=255;i>=0;--i)cswap(e,t,n=r[i/8|0]>>(7&i)&1),add(t,e),add(e,e),cswap(e,t,n)}function scalarbase(e,t){var r=[gf(),gf(),gf(),gf()];set25519(r[0],X),set25519(r[1],Y),set25519(r[2],gf1),M(r[3],X,Y),scalarmult(e,r,t)}function set25519(e,t){var r;for(r=0;r<16;r++)e[r]=0|t[r]}function inv25519(e,t){var r,n=gf();for(r=0;r<16;++r)n[r]=t[r];for(r=253;r>=0;--r)S(n,n),2!==r&&4!==r&&M(n,n,t);for(r=0;r<16;++r)e[r]=n[r]}function car25519(e){var t,r,n=1;for(t=0;t<16;++t)r=e[t]+n+65535,n=Math.floor(r/65536),e[t]=r-65536*n;e[0]+=n-1+37*(n-1)}function sel25519(e,t,r){for(var n,i=~(r-1),s=0;s<16;++s)n=i&(e[s]^t[s]),e[s]^=n,t[s]^=n}function gf(e){var t,r=new Float64Array(16);if(e)for(t=0;t<e.length;++t)r[t]=e[t];return r}function A(e,t,r){for(var n=0;n<16;++n)e[n]=t[n]+r[n]}function Z(e,t,r){for(var n=0;n<16;++n)e[n]=t[n]-r[n]}function S(e,t){M(e,t,t)}function M(e,t,r){var n,i,s=0,o=0,a=0,u=0,c=0,l=0,h=0,d=0,f=0,p=0,y=0,g=0,$=0,m=0,b=0,v=0,_=0,w=0,E=0,S=0,A=0,T=0,I=0,P=0,R=0,C=0,B=0,k=0,K=0,O=0,N=0,D=r[0],M=r[1],L=r[2],x=r[3],U=r[4],j=r[5],q=r[6],F=r[7],V=r[8],H=r[9],z=r[10],G=r[11],W=r[12],Y=r[13],X=r[14],Q=r[15];s+=(n=t[0])*D,o+=n*M,a+=n*L,u+=n*x,c+=n*U,l+=n*j,h+=n*q,d+=n*F,f+=n*V,p+=n*H,y+=n*z,g+=n*G,$+=n*W,m+=n*Y,b+=n*X,v+=n*Q,o+=(n=t[1])*D,a+=n*M,u+=n*L,c+=n*x,l+=n*U,h+=n*j,d+=n*q,f+=n*F,p+=n*V,y+=n*H,g+=n*z,$+=n*G,m+=n*W,b+=n*Y,v+=n*X,_+=n*Q,a+=(n=t[2])*D,u+=n*M,c+=n*L,l+=n*x,h+=n*U,d+=n*j,f+=n*q,p+=n*F,y+=n*V,g+=n*H,$+=n*z,m+=n*G,b+=n*W,v+=n*Y,_+=n*X,w+=n*Q,u+=(n=t[3])*D,c+=n*M,l+=n*L,h+=n*x,d+=n*U,f+=n*j,p+=n*q,y+=n*F,g+=n*V,$+=n*H,m+=n*z,b+=n*G,v+=n*W,_+=n*Y,w+=n*X,E+=n*Q,c+=(n=t[4])*D,l+=n*M,h+=n*L,d+=n*x,f+=n*U,p+=n*j,y+=n*q,g+=n*F,$+=n*V,m+=n*H,b+=n*z,v+=n*G,_+=n*W,w+=n*Y,E+=n*X,S+=n*Q,l+=(n=t[5])*D,h+=n*M,d+=n*L,f+=n*x,p+=n*U,y+=n*j,g+=n*q,$+=n*F,m+=n*V,b+=n*H,v+=n*z,_+=n*G,w+=n*W,E+=n*Y,S+=n*X,A+=n*Q,h+=(n=t[6])*D,d+=n*M,f+=n*L,p+=n*x,y+=n*U,g+=n*j,$+=n*q,m+=n*F,b+=n*V,v+=n*H,_+=n*z,w+=n*G,E+=n*W,S+=n*Y,A+=n*X,T+=n*Q,d+=(n=t[7])*D,f+=n*M,p+=n*L,y+=n*x,g+=n*U,$+=n*j,m+=n*q,b+=n*F,v+=n*V,_+=n*H,w+=n*z,E+=n*G,S+=n*W,A+=n*Y,T+=n*X,I+=n*Q,f+=(n=t[8])*D,p+=n*M,y+=n*L,g+=n*x,$+=n*U,m+=n*j,b+=n*q,v+=n*F,_+=n*V,w+=n*H,E+=n*z,S+=n*G,A+=n*W,T+=n*Y,I+=n*X,P+=n*Q,p+=(n=t[9])*D,y+=n*M,g+=n*L,$+=n*x,m+=n*U,b+=n*j,v+=n*q,_+=n*F,w+=n*V,E+=n*H,S+=n*z,A+=n*G,T+=n*W,I+=n*Y,P+=n*X,R+=n*Q,y+=(n=t[10])*D,g+=n*M,$+=n*L,m+=n*x,b+=n*U,v+=n*j,_+=n*q,w+=n*F,E+=n*V,S+=n*H,A+=n*z,T+=n*G,I+=n*W,P+=n*Y,R+=n*X,C+=n*Q,g+=(n=t[11])*D,$+=n*M,m+=n*L,b+=n*x,v+=n*U,_+=n*j,w+=n*q,E+=n*F,S+=n*V,A+=n*H,T+=n*z,I+=n*G,P+=n*W,R+=n*Y,C+=n*X,B+=n*Q,$+=(n=t[12])*D,m+=n*M,b+=n*L,v+=n*x,_+=n*U,w+=n*j,E+=n*q,S+=n*F,A+=n*V,T+=n*H,I+=n*z,P+=n*G,R+=n*W,C+=n*Y,B+=n*X,k+=n*Q,m+=(n=t[13])*D,b+=n*M,v+=n*L,_+=n*x,w+=n*U,E+=n*j,S+=n*q,A+=n*F,T+=n*V,I+=n*H,P+=n*z,R+=n*G,C+=n*W,B+=n*Y,k+=n*X,K+=n*Q,b+=(n=t[14])*D,v+=n*M,_+=n*L,w+=n*x,E+=n*U,S+=n*j,A+=n*q,T+=n*F,I+=n*V,P+=n*H,R+=n*z,C+=n*G,B+=n*W,k+=n*Y,K+=n*X,O+=n*Q,v+=(n=t[15])*D,o+=38*(w+=n*L),a+=38*(E+=n*x),u+=38*(S+=n*U),c+=38*(A+=n*j),l+=38*(T+=n*q),h+=38*(I+=n*F),d+=38*(P+=n*V),f+=38*(R+=n*H),p+=38*(C+=n*z),y+=38*(B+=n*G),g+=38*(k+=n*W),$+=38*(K+=n*Y),m+=38*(O+=n*X),b+=38*(N+=n*Q),s=(n=(s+=38*(_+=n*M))+(i=1)+65535)-65536*(i=Math.floor(n/65536)),o=(n=o+i+65535)-65536*(i=Math.floor(n/65536)),a=(n=a+i+65535)-65536*(i=Math.floor(n/65536)),u=(n=u+i+65535)-65536*(i=Math.floor(n/65536)),c=(n=c+i+65535)-65536*(i=Math.floor(n/65536)),l=(n=l+i+65535)-65536*(i=Math.floor(n/65536)),h=(n=h+i+65535)-65536*(i=Math.floor(n/65536)),d=(n=d+i+65535)-65536*(i=Math.floor(n/65536)),f=(n=f+i+65535)-65536*(i=Math.floor(n/65536)),p=(n=p+i+65535)-65536*(i=Math.floor(n/65536)),y=(n=y+i+65535)-65536*(i=Math.floor(n/65536)),g=(n=g+i+65535)-65536*(i=Math.floor(n/65536)),$=(n=$+i+65535)-65536*(i=Math.floor(n/65536)),m=(n=m+i+65535)-65536*(i=Math.floor(n/65536)),b=(n=b+i+65535)-65536*(i=Math.floor(n/65536)),v=(n=v+i+65535)-65536*(i=Math.floor(n/65536)),s=(n=(s+=i-1+37*(i-1))+(i=1)+65535)-65536*(i=Math.floor(n/65536)),o=(n=o+i+65535)-65536*(i=Math.floor(n/65536)),a=(n=a+i+65535)-65536*(i=Math.floor(n/65536)),u=(n=u+i+65535)-65536*(i=Math.floor(n/65536)),c=(n=c+i+65535)-65536*(i=Math.floor(n/65536)),l=(n=l+i+65535)-65536*(i=Math.floor(n/65536)),h=(n=h+i+65535)-65536*(i=Math.floor(n/65536)),d=(n=d+i+65535)-65536*(i=Math.floor(n/65536)),f=(n=f+i+65535)-65536*(i=Math.floor(n/65536)),p=(n=p+i+65535)-65536*(i=Math.floor(n/65536)),y=(n=y+i+65535)-65536*(i=Math.floor(n/65536)),g=(n=g+i+65535)-65536*(i=Math.floor(n/65536)),$=(n=$+i+65535)-65536*(i=Math.floor(n/65536)),m=(n=m+i+65535)-65536*(i=Math.floor(n/65536)),b=(n=b+i+65535)-65536*(i=Math.floor(n/65536)),v=(n=v+i+65535)-65536*(i=Math.floor(n/65536)),s+=i-1+37*(i-1),e[0]=s,e[1]=o,e[2]=a,e[3]=u,e[4]=c,e[5]=l,e[6]=h,e[7]=d,e[8]=f,e[9]=p,e[10]=y,e[11]=g,e[12]=$,e[13]=m,e[14]=b,e[15]=v}var rsaBrowser$1={};const randomBytes$4=random_browser,errcode$i=errCode$m;var randomBytes_1$1=function(e){if(isNaN(e)||e<=0)throw errcode$i(new Error("random bytes length must be a Number bigger than 0"),"ERR_INVALID_LENGTH");return randomBytes$4(e)},rsaUtils$1={},util$1={};!function(e){const t=forge$X,{fromString:r}=require$$3$1,{toString:n}=require$$1$5,{concat:i}=require$$2$2;e.bigIntegerToUintBase64url=(e,t)=>{let r=Uint8Array.from(e.abs().toByteArray());if(r=0===r[0]?r.slice(1):r,null!=t){if(r.length>t)throw new Error("byte array longer than desired length");r=i([new Uint8Array(t-r.length),r])}return n(r,"base64url")},e.base64urlToBigInteger=r=>{const i=e.base64urlToBuffer(r);return new t.jsbn.BigInteger(n(i,"base16"),16)},e.base64urlToBuffer=(e,t)=>{let n=r(e,"base64urlpad");if(null!=t){if(n.length>t)throw new Error("byte array longer than desired length");n=i([new Uint8Array(t-n.length),n])}return n}}(util$1);const forge$8=forge$X,{bigIntegerToUintBase64url:bigIntegerToUintBase64url$1,base64urlToBigInteger:base64urlToBigInteger$3}=util$1,{fromString:uint8ArrayFromString$9}=require$$3$1,{toString:uint8ArrayToString$a}=require$$1$5;rsaUtils$1.pkcs1ToJwk=function(e){const t=forge$8.asn1.fromDer(uint8ArrayToString$a(e,"ascii")),r=forge$8.pki.privateKeyFromAsn1(t);return{kty:"RSA",n:bigIntegerToUintBase64url$1(r.n),e:bigIntegerToUintBase64url$1(r.e),d:bigIntegerToUintBase64url$1(r.d),p:bigIntegerToUintBase64url$1(r.p),q:bigIntegerToUintBase64url$1(r.q),dp:bigIntegerToUintBase64url$1(r.dP),dq:bigIntegerToUintBase64url$1(r.dQ),qi:bigIntegerToUintBase64url$1(r.qInv),alg:"RS256",kid:"2011-04-29"}},rsaUtils$1.jwkToPkcs1=function(e){const t=forge$8.pki.privateKeyToAsn1({n:base64urlToBigInteger$3(e.n),e:base64urlToBigInteger$3(e.e),d:base64urlToBigInteger$3(e.d),p:base64urlToBigInteger$3(e.p),q:base64urlToBigInteger$3(e.q),dP:base64urlToBigInteger$3(e.dp),dQ:base64urlToBigInteger$3(e.dq),qInv:base64urlToBigInteger$3(e.qi)});return uint8ArrayFromString$9(forge$8.asn1.toDer(t).getBytes(),"ascii")},rsaUtils$1.pkixToJwk=function(e){const t=forge$8.asn1.fromDer(uint8ArrayToString$a(e,"ascii")),r=forge$8.pki.publicKeyFromAsn1(t);return{kty:"RSA",n:bigIntegerToUintBase64url$1(r.n),e:bigIntegerToUintBase64url$1(r.e),alg:"RS256",kid:"2011-04-29"}},rsaUtils$1.jwkToPkix=function(e){const t=forge$8.pki.publicKeyToAsn1({n:base64urlToBigInteger$3(e.n),e:base64urlToBigInteger$3(e.e)});return uint8ArrayFromString$9(forge$8.asn1.toDer(t).getBytes(),"ascii")};const forge$7=forge$X,{base64urlToBigInteger:base64urlToBigInteger$2}=util$1;function convert$1(e,t){return t.map((t=>base64urlToBigInteger$2(e[t])))}function jwk2priv$3(e){return forge$7.pki.setRsaPrivateKey(...convert$1(e,["n","e","d","p","q","dp","dq","qi"]))}function jwk2pub$3(e){return forge$7.pki.setRsaPublicKey(...convert$1(e,["n","e"]))}var jwk2pem$1={jwk2pub:jwk2pub$3,jwk2priv:jwk2priv$3};const webcrypto$6=webcrypto$9,randomBytes$3=randomBytes_1$1,{toString:uint8ArrayToString$9}=require$$1$5,{fromString:uint8ArrayFromString$8}=require$$3$1;function exportKey$1(e){return Promise.all([webcrypto$6.get().subtle.exportKey("jwk",e.privateKey),webcrypto$6.get().subtle.exportKey("jwk",e.publicKey)])}function derivePublicFromPrivate$1(e){return webcrypto$6.get().subtle.importKey("jwk",{kty:e.kty,n:e.n,e:e.e},{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])}rsaBrowser$1.utils=rsaUtils$1,rsaBrowser$1.generateKey=async function(e){const t=await webcrypto$6.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),r=await exportKey$1(t);return{privateKey:r[0],publicKey:r[1]}},rsaBrowser$1.unmarshalPrivateKey=async function(e){const t=[await webcrypto$6.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),await derivePublicFromPrivate$1(e)],r=await exportKey$1({privateKey:t[0],publicKey:t[1]});return{privateKey:r[0],publicKey:r[1]}},rsaBrowser$1.getRandomValues=randomBytes$3,rsaBrowser$1.hashAndSign=async function(e,t){const r=await webcrypto$6.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),n=await webcrypto$6.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},r,Uint8Array.from(t));return new Uint8Array(n,n.byteOffset,n.byteLength)},rsaBrowser$1.hashAndVerify=async function(e,t,r){const n=await webcrypto$6.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return webcrypto$6.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},n,t,r)};const{jwk2pub:jwk2pub$2,jwk2priv:jwk2priv$2}=jwk2pem$1;function convertKey$1(e,t,r,n){const i=t?jwk2pub$2(e):jwk2priv$2(e),s=n(uint8ArrayToString$9(Uint8Array.from(r),"ascii"),i);return uint8ArrayFromString$8(s,"ascii")}rsaBrowser$1.encrypt=function(e,t){return convertKey$1(e,!0,t,((e,t)=>t.encrypt(e)))},rsaBrowser$1.decrypt=function(e,t){return convertKey$1(e,!1,t,((e,t)=>t.decrypt(e)))};const{base64:base64$2}=require$$4$5,ciphers$2=aesGcm_browser$1;var exporter$7={export:async function(e,t){const r=ciphers$2.create(),n=await r.encrypt(e,t);return base64$2.encode(n)}};const{sha256:sha256$8}=require$$4$3,errcode$h=errCode$m,{equals:uint8ArrayEquals$7}=require$$10$1,{toString:uint8ArrayToString$8}=require$$1$5,forge$6=forge$X,crypto$6=rsaBrowser$1,pbm$3=keys$4,exporter$6=exporter$7;class RsaPublicKey$1{constructor(e){this._key=e}async verify(e,t){return crypto$6.hashAndVerify(this._key,t,e)}marshal(){return crypto$6.utils.jwkToPkix(this._key)}get bytes(){return pbm$3.PublicKey.encode({Type:pbm$3.KeyType.RSA,Data:this.marshal()}).finish()}encrypt(e){return crypto$6.encrypt(this._key,e)}equals(e){return uint8ArrayEquals$7(this.bytes,e.bytes)}async hash(){const{bytes:e}=await sha256$8.digest(this.bytes);return e}}class RsaPrivateKey$1{constructor(e,t){this._key=e,this._publicKey=t}genSecret(){return crypto$6.getRandomValues(16)}async sign(e){return crypto$6.hashAndSign(this._key,e)}get public(){if(!this._publicKey)throw errcode$h(new Error("public key not provided"),"ERR_PUBKEY_NOT_PROVIDED");return new RsaPublicKey$1(this._publicKey)}decrypt(e){return crypto$6.decrypt(this._key,e)}marshal(){return crypto$6.utils.jwkToPkcs1(this._key)}get bytes(){return pbm$3.PrivateKey.encode({Type:pbm$3.KeyType.RSA,Data:this.marshal()}).finish()}equals(e){return uint8ArrayEquals$7(this.bytes,e.bytes)}async hash(){const{bytes:e}=await sha256$8.digest(this.bytes);return e}async id(){const e=await this.public.hash();return uint8ArrayToString$8(e,"base58btc")}async export(e,t="pkcs-8"){if("pkcs-8"===t){const t=new forge$6.util.ByteBuffer(this.marshal()),r=forge$6.asn1.fromDer(t),n=forge$6.pki.privateKeyFromAsn1(r),i={algorithm:"aes256",count:1e4,saltSize:16,prfAlgorithm:"sha512"};return forge$6.pki.encryptRsaPrivateKey(n,e,i)}if("libp2p-key"===t)return exporter$6.export(this.bytes,e);throw errcode$h(new Error(`export format '${t}' is not supported`),"ERR_INVALID_EXPORT_FORMAT")}}async function unmarshalRsaPrivateKey$1(e){const t=crypto$6.utils.pkcs1ToJwk(e),r=await crypto$6.unmarshalPrivateKey(t);return new RsaPrivateKey$1(r.privateKey,r.publicKey)}function unmarshalRsaPublicKey$1(e){const t=crypto$6.utils.pkixToJwk(e);return new RsaPublicKey$1(t)}async function fromJwk$1(e){const t=await crypto$6.unmarshalPrivateKey(e);return new RsaPrivateKey$1(t.privateKey,t.publicKey)}async function generateKeyPair$5(e){const t=await crypto$6.generateKey(e);return new RsaPrivateKey$1(t.privateKey,t.publicKey)}var rsaClass$1={RsaPublicKey:RsaPublicKey$1,RsaPrivateKey:RsaPrivateKey$1,unmarshalRsaPublicKey:unmarshalRsaPublicKey$1,unmarshalRsaPrivateKey:unmarshalRsaPrivateKey$1,generateKeyPair:generateKeyPair$5,fromJwk:fromJwk$1},ed25519$1={};const forge$5=forge$X;ed25519$1.publicKeyLength=forge$5.pki.ed25519.constants.PUBLIC_KEY_BYTE_LENGTH,ed25519$1.privateKeyLength=forge$5.pki.ed25519.constants.PRIVATE_KEY_BYTE_LENGTH,ed25519$1.generateKey=async function(){return forge$5.pki.ed25519.generateKeyPair()},ed25519$1.generateKeyFromSeed=async function(e){return forge$5.pki.ed25519.generateKeyPair({seed:e})},ed25519$1.hashAndSign=async function(e,t){return forge$5.pki.ed25519.sign({message:t,privateKey:e})},ed25519$1.hashAndVerify=async function(e,t,r){return forge$5.pki.ed25519.verify({signature:t,message:r,publicKey:e})};const errcode$g=errCode$m,{equals:uint8ArrayEquals$6}=require$$10$1,{sha256:sha256$7}=require$$4$3,{base58btc:base58btc$1}=require$$3$2,{identity:identity$1}=require$$13,crypto$5=ed25519$1,pbm$2=keys$4,exporter$5=exporter$7;class Ed25519PublicKey$1{constructor(e){this._key=ensureKey$1(e,crypto$5.publicKeyLength)}async verify(e,t){return crypto$5.hashAndVerify(this._key,t,e)}marshal(){return this._key}get bytes(){return pbm$2.PublicKey.encode({Type:pbm$2.KeyType.Ed25519,Data:this.marshal()}).finish()}equals(e){return uint8ArrayEquals$6(this.bytes,e.bytes)}async hash(){const{bytes:e}=await sha256$7.digest(this.bytes);return e}}class Ed25519PrivateKey$1{constructor(e,t){this._key=ensureKey$1(e,crypto$5.privateKeyLength),this._publicKey=ensureKey$1(t,crypto$5.publicKeyLength)}async sign(e){return crypto$5.hashAndSign(this._key,e)}get public(){return new Ed25519PublicKey$1(this._publicKey)}marshal(){return this._key}get bytes(){return pbm$2.PrivateKey.encode({Type:pbm$2.KeyType.Ed25519,Data:this.marshal()}).finish()}equals(e){return uint8ArrayEquals$6(this.bytes,e.bytes)}async hash(){const{bytes:e}=await sha256$7.digest(this.bytes);return e}async id(){const e=await identity$1.digest(this.public.bytes);return base58btc$1.encode(e.bytes).substring(1)}async export(e,t="libp2p-key"){if("libp2p-key"===t)return exporter$5.export(this.bytes,e);throw errcode$g(new Error(`export format '${t}' is not supported`),"ERR_INVALID_EXPORT_FORMAT")}}function unmarshalEd25519PrivateKey$1(e){if(e.length>crypto$5.privateKeyLength){const t=(e=ensureKey$1(e,crypto$5.privateKeyLength+crypto$5.publicKeyLength)).slice(0,crypto$5.privateKeyLength),r=e.slice(crypto$5.privateKeyLength,e.length);return new Ed25519PrivateKey$1(t,r)}const t=(e=ensureKey$1(e,crypto$5.privateKeyLength)).slice(0,crypto$5.privateKeyLength),r=e.slice(crypto$5.publicKeyLength);return new Ed25519PrivateKey$1(t,r)}function unmarshalEd25519PublicKey$1(e){return e=ensureKey$1(e,crypto$5.publicKeyLength),new Ed25519PublicKey$1(e)}async function generateKeyPair$4(){const{privateKey:e,publicKey:t}=await crypto$5.generateKey();return new Ed25519PrivateKey$1(e,t)}async function generateKeyPairFromSeed$3(e){const{privateKey:t,publicKey:r}=await crypto$5.generateKeyFromSeed(e);return new Ed25519PrivateKey$1(t,r)}function ensureKey$1(e,t){if((e=Uint8Array.from(e||[])).length!==t)throw errcode$g(new Error(`Key must be a Uint8Array of length ${t}, got ${e.length}`),"ERR_INVALID_KEY_TYPE");return e}var ed25519Class$1={Ed25519PublicKey:Ed25519PublicKey$1,Ed25519PrivateKey:Ed25519PrivateKey$1,unmarshalEd25519PrivateKey:unmarshalEd25519PrivateKey$1,unmarshalEd25519PublicKey:unmarshalEd25519PublicKey$1,generateKeyPair:generateKeyPair$4,generateKeyPairFromSeed:generateKeyPairFromSeed$3};const errors$2={IMPOSSIBLE_CASE:"Impossible case. Please create issue.",TWEAK_ADD:"The tweak was out of range or the resulted private key is invalid",TWEAK_MUL:"The tweak was out of range or equal to zero",CONTEXT_RANDOMIZE_UNKNOW:"Unknow error on context randomization",SECKEY_INVALID:"Private Key is invalid",PUBKEY_PARSE:"Public Key could not be parsed",PUBKEY_SERIALIZE:"Public Key serialization error",PUBKEY_COMBINE:"The sum of the public keys is not valid",SIG_PARSE:"Signature could not be parsed",SIGN:"The nonce generation function failed, or the private key was invalid",RECOVER:"Public key could not be recover",ECDH:"Scalar was invalid (zero or overflow)"};function assert$g(e,t){if(!e)throw new Error(t)}function isUint8Array(e,t,r){if(assert$g(t instanceof Uint8Array,`Expected ${e} to be an Uint8Array`),void 0!==r)if(Array.isArray(r)){const n=`Expected ${e} to be an Uint8Array with length [${r.join(", ")}]`;assert$g(r.includes(t.length),n)}else{const n=`Expected ${e} to be an Uint8Array with length ${r}`;assert$g(t.length===r,n)}}function isCompressed(e){assert$g("Boolean"===toTypeString(e),"Expected compressed to be a Boolean")}function getAssertedOutput(e=(e=>new Uint8Array(e)),t){return"function"==typeof e&&(e=e(t)),isUint8Array("output",e,t),e}function toTypeString(e){return Object.prototype.toString.call(e).slice(8,-1)}var lib=e=>({contextRandomize(t){if(assert$g(null===t||t instanceof Uint8Array,"Expected seed to be an Uint8Array or null"),null!==t&&isUint8Array("seed",t,32),1===e.contextRandomize(t))throw new Error(errors$2.CONTEXT_RANDOMIZE_UNKNOW)},privateKeyVerify:t=>(isUint8Array("private key",t,32),0===e.privateKeyVerify(t)),privateKeyNegate(t){switch(isUint8Array("private key",t,32),e.privateKeyNegate(t)){case 0:return t;case 1:throw new Error(errors$2.IMPOSSIBLE_CASE)}},privateKeyTweakAdd(t,r){switch(isUint8Array("private key",t,32),isUint8Array("tweak",r,32),e.privateKeyTweakAdd(t,r)){case 0:return t;case 1:throw new Error(errors$2.TWEAK_ADD)}},privateKeyTweakMul(t,r){switch(isUint8Array("private key",t,32),isUint8Array("tweak",r,32),e.privateKeyTweakMul(t,r)){case 0:return t;case 1:throw new Error(errors$2.TWEAK_MUL)}},publicKeyVerify:t=>(isUint8Array("public key",t,[33,65]),0===e.publicKeyVerify(t)),publicKeyCreate(t,r=!0,n){switch(isUint8Array("private key",t,32),isCompressed(r),n=getAssertedOutput(n,r?33:65),e.publicKeyCreate(n,t)){case 0:return n;case 1:throw new Error(errors$2.SECKEY_INVALID);case 2:throw new Error(errors$2.PUBKEY_SERIALIZE)}},publicKeyConvert(t,r=!0,n){switch(isUint8Array("public key",t,[33,65]),isCompressed(r),n=getAssertedOutput(n,r?33:65),e.publicKeyConvert(n,t)){case 0:return n;case 1:throw new Error(errors$2.PUBKEY_PARSE);case 2:throw new Error(errors$2.PUBKEY_SERIALIZE)}},publicKeyNegate(t,r=!0,n){switch(isUint8Array("public key",t,[33,65]),isCompressed(r),n=getAssertedOutput(n,r?33:65),e.publicKeyNegate(n,t)){case 0:return n;case 1:throw new Error(errors$2.PUBKEY_PARSE);case 2:throw new Error(errors$2.IMPOSSIBLE_CASE);case 3:throw new Error(errors$2.PUBKEY_SERIALIZE)}},publicKeyCombine(t,r=!0,n){assert$g(Array.isArray(t),"Expected public keys to be an Array"),assert$g(t.length>0,"Expected public keys array will have more than zero items");for(const e of t)isUint8Array("public key",e,[33,65]);switch(isCompressed(r),n=getAssertedOutput(n,r?33:65),e.publicKeyCombine(n,t)){case 0:return n;case 1:throw new Error(errors$2.PUBKEY_PARSE);case 2:throw new Error(errors$2.PUBKEY_COMBINE);case 3:throw new Error(errors$2.PUBKEY_SERIALIZE)}},publicKeyTweakAdd(t,r,n=!0,i){switch(isUint8Array("public key",t,[33,65]),isUint8Array("tweak",r,32),isCompressed(n),i=getAssertedOutput(i,n?33:65),e.publicKeyTweakAdd(i,t,r)){case 0:return i;case 1:throw new Error(errors$2.PUBKEY_PARSE);case 2:throw new Error(errors$2.TWEAK_ADD)}},publicKeyTweakMul(t,r,n=!0,i){switch(isUint8Array("public key",t,[33,65]),isUint8Array("tweak",r,32),isCompressed(n),i=getAssertedOutput(i,n?33:65),e.publicKeyTweakMul(i,t,r)){case 0:return i;case 1:throw new Error(errors$2.PUBKEY_PARSE);case 2:throw new Error(errors$2.TWEAK_MUL)}},signatureNormalize(t){switch(isUint8Array("signature",t,64),e.signatureNormalize(t)){case 0:return t;case 1:throw new Error(errors$2.SIG_PARSE)}},signatureExport(t,r){isUint8Array("signature",t,64);const n={output:r=getAssertedOutput(r,72),outputlen:72};switch(e.signatureExport(n,t)){case 0:return r.slice(0,n.outputlen);case 1:throw new Error(errors$2.SIG_PARSE);case 2:throw new Error(errors$2.IMPOSSIBLE_CASE)}},signatureImport(t,r){switch(isUint8Array("signature",t),r=getAssertedOutput(r,64),e.signatureImport(r,t)){case 0:return r;case 1:throw new Error(errors$2.SIG_PARSE);case 2:throw new Error(errors$2.IMPOSSIBLE_CASE)}},ecdsaSign(t,r,n={},i){isUint8Array("message",t,32),isUint8Array("private key",r,32),assert$g("Object"===toTypeString(n),"Expected options to be an Object"),void 0!==n.data&&isUint8Array("options.data",n.data),void 0!==n.noncefn&&assert$g("Function"===toTypeString(n.noncefn),"Expected options.noncefn to be a Function");const s={signature:i=getAssertedOutput(i,64),recid:null};switch(e.ecdsaSign(s,t,r,n.data,n.noncefn)){case 0:return s;case 1:throw new Error(errors$2.SIGN);case 2:throw new Error(errors$2.IMPOSSIBLE_CASE)}},ecdsaVerify(t,r,n){switch(isUint8Array("signature",t,64),isUint8Array("message",r,32),isUint8Array("public key",n,[33,65]),e.ecdsaVerify(t,r,n)){case 0:return!0;case 3:return!1;case 1:throw new Error(errors$2.SIG_PARSE);case 2:throw new Error(errors$2.PUBKEY_PARSE)}},ecdsaRecover(t,r,n,i=!0,s){switch(isUint8Array("signature",t,64),assert$g("Number"===toTypeString(r)&&r>=0&&r<=3,"Expected recovery id to be a Number within interval [0, 3]"),isUint8Array("message",n,32),isCompressed(i),s=getAssertedOutput(s,i?33:65),e.ecdsaRecover(s,t,r,n)){case 0:return s;case 1:throw new Error(errors$2.SIG_PARSE);case 2:throw new Error(errors$2.RECOVER);case 3:throw new Error(errors$2.IMPOSSIBLE_CASE)}},ecdh(t,r,n={},i){switch(isUint8Array("public key",t,[33,65]),isUint8Array("private key",r,32),assert$g("Object"===toTypeString(n),"Expected options to be an Object"),void 0!==n.data&&isUint8Array("options.data",n.data),void 0!==n.hashfn?(assert$g("Function"===toTypeString(n.hashfn),"Expected options.hashfn to be a Function"),void 0!==n.xbuf&&isUint8Array("options.xbuf",n.xbuf,32),void 0!==n.ybuf&&isUint8Array("options.ybuf",n.ybuf,32),isUint8Array("output",i)):i=getAssertedOutput(i,32),e.ecdh(i,t,r,n.data,n.hashfn,n.xbuf,n.ybuf)){case 0:return i;case 1:throw new Error(errors$2.PUBKEY_PARSE);case 2:throw new Error(errors$2.ECDH)}}}),elliptic$2={},name="elliptic",version="6.5.4",description="EC cryptography",main="lib/elliptic.js",files=["lib"],scripts={lint:"eslint lib test","lint:fix":"npm run lint -- --fix",unit:"istanbul test _mocha --reporter=spec test/index.js",test:"npm run lint && npm run unit",version:"grunt dist && git add dist/"},repository={type:"git",url:"git@github.com:indutny/elliptic"},keywords=["EC","Elliptic","curve","Cryptography"],author="Fedor Indutny <fedor@indutny.com>",license="MIT",bugs={url:"https://github.com/indutny/elliptic/issues"},homepage="https://github.com/indutny/elliptic",devDependencies={brfs:"^2.0.2",coveralls:"^3.1.0",eslint:"^7.6.0",grunt:"^1.2.1","grunt-browserify":"^5.3.0","grunt-cli":"^1.3.2","grunt-contrib-connect":"^3.0.0","grunt-contrib-copy":"^1.0.0","grunt-contrib-uglify":"^5.0.0","grunt-mocha-istanbul":"^5.0.2","grunt-saucelabs":"^9.0.1",istanbul:"^0.4.5",mocha:"^8.0.1"},dependencies={"bn.js":"^4.11.9",brorand:"^1.1.0","hash.js":"^1.0.0","hmac-drbg":"^1.0.1",inherits:"^2.0.4","minimalistic-assert":"^1.0.1","minimalistic-crypto-utils":"^1.0.1"},require$$0$1={name:name,version:version,description:description,main:main,files:files,scripts:scripts,repository:repository,keywords:keywords,author:author,license:license,bugs:bugs,homepage:homepage,devDependencies:devDependencies,dependencies:dependencies},utils$p={},bn={exports:{}};!function(e,t){function r(e,t){if(!e)throw new Error(t||"Assertion failed")}function n(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}function i(e,t,r){if(i.isBN(e))return e;this.negative=0,this.words=null,this.length=0,this.red=null,null!==e&&("le"!==t&&"be"!==t||(r=t,t=10),this._init(e||0,t||10,r||"be"))}var s;"object"==typeof e?e.exports=i:t.BN=i,i.BN=i,i.wordSize=26;try{s="undefined"!=typeof window&&void 0!==window.Buffer?window.Buffer:require("buffer").Buffer}catch(e){}function o(e,t){var r=e.charCodeAt(t);return r>=65&&r<=70?r-55:r>=97&&r<=102?r-87:r-48&15}function a(e,t,r){var n=o(e,r);return r-1>=t&&(n|=o(e,r-1)<<4),n}function u(e,t,r,n){for(var i=0,s=Math.min(e.length,r),o=t;o<s;o++){var a=e.charCodeAt(o)-48;i*=n,i+=a>=49?a-49+10:a>=17?a-17+10:a}return i}i.isBN=function(e){return e instanceof i||null!==e&&"object"==typeof e&&e.constructor.wordSize===i.wordSize&&Array.isArray(e.words)},i.max=function(e,t){return e.cmp(t)>0?e:t},i.min=function(e,t){return e.cmp(t)<0?e:t},i.prototype._init=function(e,t,n){if("number"==typeof e)return this._initNumber(e,t,n);if("object"==typeof e)return this._initArray(e,t,n);"hex"===t&&(t=16),r(t===(0|t)&&t>=2&&t<=36);var i=0;"-"===(e=e.toString().replace(/\s+/g,""))[0]&&(i++,this.negative=1),i<e.length&&(16===t?this._parseHex(e,i,n):(this._parseBase(e,t,i),"le"===n&&this._initArray(this.toArray(),t,n)))},i.prototype._initNumber=function(e,t,n){e<0&&(this.negative=1,e=-e),e<67108864?(this.words=[67108863&e],this.length=1):e<4503599627370496?(this.words=[67108863&e,e/67108864&67108863],this.length=2):(r(e<9007199254740992),this.words=[67108863&e,e/67108864&67108863,1],this.length=3),"le"===n&&this._initArray(this.toArray(),t,n)},i.prototype._initArray=function(e,t,n){if(r("number"==typeof e.length),e.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(e.length/3),this.words=new Array(this.length);for(var i=0;i<this.length;i++)this.words[i]=0;var s,o,a=0;if("be"===n)for(i=e.length-1,s=0;i>=0;i-=3)o=e[i]|e[i-1]<<8|e[i-2]<<16,this.words[s]|=o<<a&67108863,this.words[s+1]=o>>>26-a&67108863,(a+=24)>=26&&(a-=26,s++);else if("le"===n)for(i=0,s=0;i<e.length;i+=3)o=e[i]|e[i+1]<<8|e[i+2]<<16,this.words[s]|=o<<a&67108863,this.words[s+1]=o>>>26-a&67108863,(a+=24)>=26&&(a-=26,s++);return this.strip()},i.prototype._parseHex=function(e,t,r){this.length=Math.ceil((e.length-t)/6),this.words=new Array(this.length);for(var n=0;n<this.length;n++)this.words[n]=0;var i,s=0,o=0;if("be"===r)for(n=e.length-1;n>=t;n-=2)i=a(e,t,n)<<s,this.words[o]|=67108863&i,s>=18?(s-=18,o+=1,this.words[o]|=i>>>26):s+=8;else for(n=(e.length-t)%2==0?t+1:t;n<e.length;n+=2)i=a(e,t,n)<<s,this.words[o]|=67108863&i,s>=18?(s-=18,o+=1,this.words[o]|=i>>>26):s+=8;this.strip()},i.prototype._parseBase=function(e,t,r){this.words=[0],this.length=1;for(var n=0,i=1;i<=67108863;i*=t)n++;n--,i=i/t|0;for(var s=e.length-r,o=s%n,a=Math.min(s,s-o)+r,c=0,l=r;l<a;l+=n)c=u(e,l,l+n,t),this.imuln(i),this.words[0]+c<67108864?this.words[0]+=c:this._iaddn(c);if(0!==o){var h=1;for(c=u(e,l,e.length,t),l=0;l<o;l++)h*=t;this.imuln(h),this.words[0]+c<67108864?this.words[0]+=c:this._iaddn(c)}this.strip()},i.prototype.copy=function(e){e.words=new Array(this.length);for(var t=0;t<this.length;t++)e.words[t]=this.words[t];e.length=this.length,e.negative=this.negative,e.red=this.red},i.prototype.clone=function(){var e=new i(null);return this.copy(e),e},i.prototype._expand=function(e){for(;this.length<e;)this.words[this.length++]=0;return this},i.prototype.strip=function(){for(;this.length>1&&0===this.words[this.length-1];)this.length--;return this._normSign()},i.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},i.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var c=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],l=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],h=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];function d(e,t,r){r.negative=t.negative^e.negative;var n=e.length+t.length|0;r.length=n,n=n-1|0;var i=0|e.words[0],s=0|t.words[0],o=i*s,a=67108863&o,u=o/67108864|0;r.words[0]=a;for(var c=1;c<n;c++){for(var l=u>>>26,h=67108863&u,d=Math.min(c,t.length-1),f=Math.max(0,c-e.length+1);f<=d;f++){var p=c-f|0;l+=(o=(i=0|e.words[p])*(s=0|t.words[f])+h)/67108864|0,h=67108863&o}r.words[c]=0|h,u=0|l}return 0!==u?r.words[c]=0|u:r.length--,r.strip()}i.prototype.toString=function(e,t){var n;if(t=0|t||1,16===(e=e||10)||"hex"===e){n="";for(var i=0,s=0,o=0;o<this.length;o++){var a=this.words[o],u=(16777215&(a<<i|s)).toString(16);n=0!=(s=a>>>24-i&16777215)||o!==this.length-1?c[6-u.length]+u+n:u+n,(i+=2)>=26&&(i-=26,o--)}for(0!==s&&(n=s.toString(16)+n);n.length%t!=0;)n="0"+n;return 0!==this.negative&&(n="-"+n),n}if(e===(0|e)&&e>=2&&e<=36){var d=l[e],f=h[e];n="";var p=this.clone();for(p.negative=0;!p.isZero();){var y=p.modn(f).toString(e);n=(p=p.idivn(f)).isZero()?y+n:c[d-y.length]+y+n}for(this.isZero()&&(n="0"+n);n.length%t!=0;)n="0"+n;return 0!==this.negative&&(n="-"+n),n}r(!1,"Base should be between 2 and 36")},i.prototype.toNumber=function(){var e=this.words[0];return 2===this.length?e+=67108864*this.words[1]:3===this.length&&1===this.words[2]?e+=4503599627370496+67108864*this.words[1]:this.length>2&&r(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-e:e},i.prototype.toJSON=function(){return this.toString(16)},i.prototype.toBuffer=function(e,t){return r(void 0!==s),this.toArrayLike(s,e,t)},i.prototype.toArray=function(e,t){return this.toArrayLike(Array,e,t)},i.prototype.toArrayLike=function(e,t,n){var i=this.byteLength(),s=n||Math.max(1,i);r(i<=s,"byte array longer than desired length"),r(s>0,"Requested array length <= 0"),this.strip();var o,a,u="le"===t,c=new e(s),l=this.clone();if(u){for(a=0;!l.isZero();a++)o=l.andln(255),l.iushrn(8),c[a]=o;for(;a<s;a++)c[a]=0}else{for(a=0;a<s-i;a++)c[a]=0;for(a=0;!l.isZero();a++)o=l.andln(255),l.iushrn(8),c[s-a-1]=o}return c},Math.clz32?i.prototype._countBits=function(e){return 32-Math.clz32(e)}:i.prototype._countBits=function(e){var t=e,r=0;return t>=4096&&(r+=13,t>>>=13),t>=64&&(r+=7,t>>>=7),t>=8&&(r+=4,t>>>=4),t>=2&&(r+=2,t>>>=2),r+t},i.prototype._zeroBits=function(e){if(0===e)return 26;var t=e,r=0;return 0==(8191&t)&&(r+=13,t>>>=13),0==(127&t)&&(r+=7,t>>>=7),0==(15&t)&&(r+=4,t>>>=4),0==(3&t)&&(r+=2,t>>>=2),0==(1&t)&&r++,r},i.prototype.bitLength=function(){var e=this.words[this.length-1],t=this._countBits(e);return 26*(this.length-1)+t},i.prototype.zeroBits=function(){if(this.isZero())return 0;for(var e=0,t=0;t<this.length;t++){var r=this._zeroBits(this.words[t]);if(e+=r,26!==r)break}return e},i.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},i.prototype.toTwos=function(e){return 0!==this.negative?this.abs().inotn(e).iaddn(1):this.clone()},i.prototype.fromTwos=function(e){return this.testn(e-1)?this.notn(e).iaddn(1).ineg():this.clone()},i.prototype.isNeg=function(){return 0!==this.negative},i.prototype.neg=function(){return this.clone().ineg()},i.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},i.prototype.iuor=function(e){for(;this.length<e.length;)this.words[this.length++]=0;for(var t=0;t<e.length;t++)this.words[t]=this.words[t]|e.words[t];return this.strip()},i.prototype.ior=function(e){return r(0==(this.negative|e.negative)),this.iuor(e)},i.prototype.or=function(e){return this.length>e.length?this.clone().ior(e):e.clone().ior(this)},i.prototype.uor=function(e){return this.length>e.length?this.clone().iuor(e):e.clone().iuor(this)},i.prototype.iuand=function(e){var t;t=this.length>e.length?e:this;for(var r=0;r<t.length;r++)this.words[r]=this.words[r]&e.words[r];return this.length=t.length,this.strip()},i.prototype.iand=function(e){return r(0==(this.negative|e.negative)),this.iuand(e)},i.prototype.and=function(e){return this.length>e.length?this.clone().iand(e):e.clone().iand(this)},i.prototype.uand=function(e){return this.length>e.length?this.clone().iuand(e):e.clone().iuand(this)},i.prototype.iuxor=function(e){var t,r;this.length>e.length?(t=this,r=e):(t=e,r=this);for(var n=0;n<r.length;n++)this.words[n]=t.words[n]^r.words[n];if(this!==t)for(;n<t.length;n++)this.words[n]=t.words[n];return this.length=t.length,this.strip()},i.prototype.ixor=function(e){return r(0==(this.negative|e.negative)),this.iuxor(e)},i.prototype.xor=function(e){return this.length>e.length?this.clone().ixor(e):e.clone().ixor(this)},i.prototype.uxor=function(e){return this.length>e.length?this.clone().iuxor(e):e.clone().iuxor(this)},i.prototype.inotn=function(e){r("number"==typeof e&&e>=0);var t=0|Math.ceil(e/26),n=e%26;this._expand(t),n>0&&t--;for(var i=0;i<t;i++)this.words[i]=67108863&~this.words[i];return n>0&&(this.words[i]=~this.words[i]&67108863>>26-n),this.strip()},i.prototype.notn=function(e){return this.clone().inotn(e)},i.prototype.setn=function(e,t){r("number"==typeof e&&e>=0);var n=e/26|0,i=e%26;return this._expand(n+1),this.words[n]=t?this.words[n]|1<<i:this.words[n]&~(1<<i),this.strip()},i.prototype.iadd=function(e){var t,r,n;if(0!==this.negative&&0===e.negative)return this.negative=0,t=this.isub(e),this.negative^=1,this._normSign();if(0===this.negative&&0!==e.negative)return e.negative=0,t=this.isub(e),e.negative=1,t._normSign();this.length>e.length?(r=this,n=e):(r=e,n=this);for(var i=0,s=0;s<n.length;s++)t=(0|r.words[s])+(0|n.words[s])+i,this.words[s]=67108863&t,i=t>>>26;for(;0!==i&&s<r.length;s++)t=(0|r.words[s])+i,this.words[s]=67108863&t,i=t>>>26;if(this.length=r.length,0!==i)this.words[this.length]=i,this.length++;else if(r!==this)for(;s<r.length;s++)this.words[s]=r.words[s];return this},i.prototype.add=function(e){var t;return 0!==e.negative&&0===this.negative?(e.negative=0,t=this.sub(e),e.negative^=1,t):0===e.negative&&0!==this.negative?(this.negative=0,t=e.sub(this),this.negative=1,t):this.length>e.length?this.clone().iadd(e):e.clone().iadd(this)},i.prototype.isub=function(e){if(0!==e.negative){e.negative=0;var t=this.iadd(e);return e.negative=1,t._normSign()}if(0!==this.negative)return this.negative=0,this.iadd(e),this.negative=1,this._normSign();var r,n,i=this.cmp(e);if(0===i)return this.negative=0,this.length=1,this.words[0]=0,this;i>0?(r=this,n=e):(r=e,n=this);for(var s=0,o=0;o<n.length;o++)s=(t=(0|r.words[o])-(0|n.words[o])+s)>>26,this.words[o]=67108863&t;for(;0!==s&&o<r.length;o++)s=(t=(0|r.words[o])+s)>>26,this.words[o]=67108863&t;if(0===s&&o<r.length&&r!==this)for(;o<r.length;o++)this.words[o]=r.words[o];return this.length=Math.max(this.length,o),r!==this&&(this.negative=1),this.strip()},i.prototype.sub=function(e){return this.clone().isub(e)};var f=function(e,t,r){var n,i,s,o=e.words,a=t.words,u=r.words,c=0,l=0|o[0],h=8191&l,d=l>>>13,f=0|o[1],p=8191&f,y=f>>>13,g=0|o[2],$=8191&g,m=g>>>13,b=0|o[3],v=8191&b,_=b>>>13,w=0|o[4],E=8191&w,S=w>>>13,A=0|o[5],T=8191&A,I=A>>>13,P=0|o[6],R=8191&P,C=P>>>13,B=0|o[7],k=8191&B,K=B>>>13,O=0|o[8],N=8191&O,D=O>>>13,M=0|o[9],L=8191&M,x=M>>>13,U=0|a[0],j=8191&U,q=U>>>13,F=0|a[1],V=8191&F,H=F>>>13,z=0|a[2],G=8191&z,W=z>>>13,Y=0|a[3],X=8191&Y,Q=Y>>>13,J=0|a[4],Z=8191&J,ee=J>>>13,te=0|a[5],re=8191&te,ne=te>>>13,ie=0|a[6],se=8191&ie,oe=ie>>>13,ae=0|a[7],ue=8191&ae,ce=ae>>>13,le=0|a[8],he=8191&le,de=le>>>13,fe=0|a[9],pe=8191&fe,ye=fe>>>13;r.negative=e.negative^t.negative,r.length=19;var ge=(c+(n=Math.imul(h,j))|0)+((8191&(i=(i=Math.imul(h,q))+Math.imul(d,j)|0))<<13)|0;c=((s=Math.imul(d,q))+(i>>>13)|0)+(ge>>>26)|0,ge&=67108863,n=Math.imul(p,j),i=(i=Math.imul(p,q))+Math.imul(y,j)|0,s=Math.imul(y,q);var $e=(c+(n=n+Math.imul(h,V)|0)|0)+((8191&(i=(i=i+Math.imul(h,H)|0)+Math.imul(d,V)|0))<<13)|0;c=((s=s+Math.imul(d,H)|0)+(i>>>13)|0)+($e>>>26)|0,$e&=67108863,n=Math.imul($,j),i=(i=Math.imul($,q))+Math.imul(m,j)|0,s=Math.imul(m,q),n=n+Math.imul(p,V)|0,i=(i=i+Math.imul(p,H)|0)+Math.imul(y,V)|0,s=s+Math.imul(y,H)|0;var me=(c+(n=n+Math.imul(h,G)|0)|0)+((8191&(i=(i=i+Math.imul(h,W)|0)+Math.imul(d,G)|0))<<13)|0;c=((s=s+Math.imul(d,W)|0)+(i>>>13)|0)+(me>>>26)|0,me&=67108863,n=Math.imul(v,j),i=(i=Math.imul(v,q))+Math.imul(_,j)|0,s=Math.imul(_,q),n=n+Math.imul($,V)|0,i=(i=i+Math.imul($,H)|0)+Math.imul(m,V)|0,s=s+Math.imul(m,H)|0,n=n+Math.imul(p,G)|0,i=(i=i+Math.imul(p,W)|0)+Math.imul(y,G)|0,s=s+Math.imul(y,W)|0;var be=(c+(n=n+Math.imul(h,X)|0)|0)+((8191&(i=(i=i+Math.imul(h,Q)|0)+Math.imul(d,X)|0))<<13)|0;c=((s=s+Math.imul(d,Q)|0)+(i>>>13)|0)+(be>>>26)|0,be&=67108863,n=Math.imul(E,j),i=(i=Math.imul(E,q))+Math.imul(S,j)|0,s=Math.imul(S,q),n=n+Math.imul(v,V)|0,i=(i=i+Math.imul(v,H)|0)+Math.imul(_,V)|0,s=s+Math.imul(_,H)|0,n=n+Math.imul($,G)|0,i=(i=i+Math.imul($,W)|0)+Math.imul(m,G)|0,s=s+Math.imul(m,W)|0,n=n+Math.imul(p,X)|0,i=(i=i+Math.imul(p,Q)|0)+Math.imul(y,X)|0,s=s+Math.imul(y,Q)|0;var ve=(c+(n=n+Math.imul(h,Z)|0)|0)+((8191&(i=(i=i+Math.imul(h,ee)|0)+Math.imul(d,Z)|0))<<13)|0;c=((s=s+Math.imul(d,ee)|0)+(i>>>13)|0)+(ve>>>26)|0,ve&=67108863,n=Math.imul(T,j),i=(i=Math.imul(T,q))+Math.imul(I,j)|0,s=Math.imul(I,q),n=n+Math.imul(E,V)|0,i=(i=i+Math.imul(E,H)|0)+Math.imul(S,V)|0,s=s+Math.imul(S,H)|0,n=n+Math.imul(v,G)|0,i=(i=i+Math.imul(v,W)|0)+Math.imul(_,G)|0,s=s+Math.imul(_,W)|0,n=n+Math.imul($,X)|0,i=(i=i+Math.imul($,Q)|0)+Math.imul(m,X)|0,s=s+Math.imul(m,Q)|0,n=n+Math.imul(p,Z)|0,i=(i=i+Math.imul(p,ee)|0)+Math.imul(y,Z)|0,s=s+Math.imul(y,ee)|0;var _e=(c+(n=n+Math.imul(h,re)|0)|0)+((8191&(i=(i=i+Math.imul(h,ne)|0)+Math.imul(d,re)|0))<<13)|0;c=((s=s+Math.imul(d,ne)|0)+(i>>>13)|0)+(_e>>>26)|0,_e&=67108863,n=Math.imul(R,j),i=(i=Math.imul(R,q))+Math.imul(C,j)|0,s=Math.imul(C,q),n=n+Math.imul(T,V)|0,i=(i=i+Math.imul(T,H)|0)+Math.imul(I,V)|0,s=s+Math.imul(I,H)|0,n=n+Math.imul(E,G)|0,i=(i=i+Math.imul(E,W)|0)+Math.imul(S,G)|0,s=s+Math.imul(S,W)|0,n=n+Math.imul(v,X)|0,i=(i=i+Math.imul(v,Q)|0)+Math.imul(_,X)|0,s=s+Math.imul(_,Q)|0,n=n+Math.imul($,Z)|0,i=(i=i+Math.imul($,ee)|0)+Math.imul(m,Z)|0,s=s+Math.imul(m,ee)|0,n=n+Math.imul(p,re)|0,i=(i=i+Math.imul(p,ne)|0)+Math.imul(y,re)|0,s=s+Math.imul(y,ne)|0;var we=(c+(n=n+Math.imul(h,se)|0)|0)+((8191&(i=(i=i+Math.imul(h,oe)|0)+Math.imul(d,se)|0))<<13)|0;c=((s=s+Math.imul(d,oe)|0)+(i>>>13)|0)+(we>>>26)|0,we&=67108863,n=Math.imul(k,j),i=(i=Math.imul(k,q))+Math.imul(K,j)|0,s=Math.imul(K,q),n=n+Math.imul(R,V)|0,i=(i=i+Math.imul(R,H)|0)+Math.imul(C,V)|0,s=s+Math.imul(C,H)|0,n=n+Math.imul(T,G)|0,i=(i=i+Math.imul(T,W)|0)+Math.imul(I,G)|0,s=s+Math.imul(I,W)|0,n=n+Math.imul(E,X)|0,i=(i=i+Math.imul(E,Q)|0)+Math.imul(S,X)|0,s=s+Math.imul(S,Q)|0,n=n+Math.imul(v,Z)|0,i=(i=i+Math.imul(v,ee)|0)+Math.imul(_,Z)|0,s=s+Math.imul(_,ee)|0,n=n+Math.imul($,re)|0,i=(i=i+Math.imul($,ne)|0)+Math.imul(m,re)|0,s=s+Math.imul(m,ne)|0,n=n+Math.imul(p,se)|0,i=(i=i+Math.imul(p,oe)|0)+Math.imul(y,se)|0,s=s+Math.imul(y,oe)|0;var Ee=(c+(n=n+Math.imul(h,ue)|0)|0)+((8191&(i=(i=i+Math.imul(h,ce)|0)+Math.imul(d,ue)|0))<<13)|0;c=((s=s+Math.imul(d,ce)|0)+(i>>>13)|0)+(Ee>>>26)|0,Ee&=67108863,n=Math.imul(N,j),i=(i=Math.imul(N,q))+Math.imul(D,j)|0,s=Math.imul(D,q),n=n+Math.imul(k,V)|0,i=(i=i+Math.imul(k,H)|0)+Math.imul(K,V)|0,s=s+Math.imul(K,H)|0,n=n+Math.imul(R,G)|0,i=(i=i+Math.imul(R,W)|0)+Math.imul(C,G)|0,s=s+Math.imul(C,W)|0,n=n+Math.imul(T,X)|0,i=(i=i+Math.imul(T,Q)|0)+Math.imul(I,X)|0,s=s+Math.imul(I,Q)|0,n=n+Math.imul(E,Z)|0,i=(i=i+Math.imul(E,ee)|0)+Math.imul(S,Z)|0,s=s+Math.imul(S,ee)|0,n=n+Math.imul(v,re)|0,i=(i=i+Math.imul(v,ne)|0)+Math.imul(_,re)|0,s=s+Math.imul(_,ne)|0,n=n+Math.imul($,se)|0,i=(i=i+Math.imul($,oe)|0)+Math.imul(m,se)|0,s=s+Math.imul(m,oe)|0,n=n+Math.imul(p,ue)|0,i=(i=i+Math.imul(p,ce)|0)+Math.imul(y,ue)|0,s=s+Math.imul(y,ce)|0;var Se=(c+(n=n+Math.imul(h,he)|0)|0)+((8191&(i=(i=i+Math.imul(h,de)|0)+Math.imul(d,he)|0))<<13)|0;c=((s=s+Math.imul(d,de)|0)+(i>>>13)|0)+(Se>>>26)|0,Se&=67108863,n=Math.imul(L,j),i=(i=Math.imul(L,q))+Math.imul(x,j)|0,s=Math.imul(x,q),n=n+Math.imul(N,V)|0,i=(i=i+Math.imul(N,H)|0)+Math.imul(D,V)|0,s=s+Math.imul(D,H)|0,n=n+Math.imul(k,G)|0,i=(i=i+Math.imul(k,W)|0)+Math.imul(K,G)|0,s=s+Math.imul(K,W)|0,n=n+Math.imul(R,X)|0,i=(i=i+Math.imul(R,Q)|0)+Math.imul(C,X)|0,s=s+Math.imul(C,Q)|0,n=n+Math.imul(T,Z)|0,i=(i=i+Math.imul(T,ee)|0)+Math.imul(I,Z)|0,s=s+Math.imul(I,ee)|0,n=n+Math.imul(E,re)|0,i=(i=i+Math.imul(E,ne)|0)+Math.imul(S,re)|0,s=s+Math.imul(S,ne)|0,n=n+Math.imul(v,se)|0,i=(i=i+Math.imul(v,oe)|0)+Math.imul(_,se)|0,s=s+Math.imul(_,oe)|0,n=n+Math.imul($,ue)|0,i=(i=i+Math.imul($,ce)|0)+Math.imul(m,ue)|0,s=s+Math.imul(m,ce)|0,n=n+Math.imul(p,he)|0,i=(i=i+Math.imul(p,de)|0)+Math.imul(y,he)|0,s=s+Math.imul(y,de)|0;var Ae=(c+(n=n+Math.imul(h,pe)|0)|0)+((8191&(i=(i=i+Math.imul(h,ye)|0)+Math.imul(d,pe)|0))<<13)|0;c=((s=s+Math.imul(d,ye)|0)+(i>>>13)|0)+(Ae>>>26)|0,Ae&=67108863,n=Math.imul(L,V),i=(i=Math.imul(L,H))+Math.imul(x,V)|0,s=Math.imul(x,H),n=n+Math.imul(N,G)|0,i=(i=i+Math.imul(N,W)|0)+Math.imul(D,G)|0,s=s+Math.imul(D,W)|0,n=n+Math.imul(k,X)|0,i=(i=i+Math.imul(k,Q)|0)+Math.imul(K,X)|0,s=s+Math.imul(K,Q)|0,n=n+Math.imul(R,Z)|0,i=(i=i+Math.imul(R,ee)|0)+Math.imul(C,Z)|0,s=s+Math.imul(C,ee)|0,n=n+Math.imul(T,re)|0,i=(i=i+Math.imul(T,ne)|0)+Math.imul(I,re)|0,s=s+Math.imul(I,ne)|0,n=n+Math.imul(E,se)|0,i=(i=i+Math.imul(E,oe)|0)+Math.imul(S,se)|0,s=s+Math.imul(S,oe)|0,n=n+Math.imul(v,ue)|0,i=(i=i+Math.imul(v,ce)|0)+Math.imul(_,ue)|0,s=s+Math.imul(_,ce)|0,n=n+Math.imul($,he)|0,i=(i=i+Math.imul($,de)|0)+Math.imul(m,he)|0,s=s+Math.imul(m,de)|0;var Te=(c+(n=n+Math.imul(p,pe)|0)|0)+((8191&(i=(i=i+Math.imul(p,ye)|0)+Math.imul(y,pe)|0))<<13)|0;c=((s=s+Math.imul(y,ye)|0)+(i>>>13)|0)+(Te>>>26)|0,Te&=67108863,n=Math.imul(L,G),i=(i=Math.imul(L,W))+Math.imul(x,G)|0,s=Math.imul(x,W),n=n+Math.imul(N,X)|0,i=(i=i+Math.imul(N,Q)|0)+Math.imul(D,X)|0,s=s+Math.imul(D,Q)|0,n=n+Math.imul(k,Z)|0,i=(i=i+Math.imul(k,ee)|0)+Math.imul(K,Z)|0,s=s+Math.imul(K,ee)|0,n=n+Math.imul(R,re)|0,i=(i=i+Math.imul(R,ne)|0)+Math.imul(C,re)|0,s=s+Math.imul(C,ne)|0,n=n+Math.imul(T,se)|0,i=(i=i+Math.imul(T,oe)|0)+Math.imul(I,se)|0,s=s+Math.imul(I,oe)|0,n=n+Math.imul(E,ue)|0,i=(i=i+Math.imul(E,ce)|0)+Math.imul(S,ue)|0,s=s+Math.imul(S,ce)|0,n=n+Math.imul(v,he)|0,i=(i=i+Math.imul(v,de)|0)+Math.imul(_,he)|0,s=s+Math.imul(_,de)|0;var Ie=(c+(n=n+Math.imul($,pe)|0)|0)+((8191&(i=(i=i+Math.imul($,ye)|0)+Math.imul(m,pe)|0))<<13)|0;c=((s=s+Math.imul(m,ye)|0)+(i>>>13)|0)+(Ie>>>26)|0,Ie&=67108863,n=Math.imul(L,X),i=(i=Math.imul(L,Q))+Math.imul(x,X)|0,s=Math.imul(x,Q),n=n+Math.imul(N,Z)|0,i=(i=i+Math.imul(N,ee)|0)+Math.imul(D,Z)|0,s=s+Math.imul(D,ee)|0,n=n+Math.imul(k,re)|0,i=(i=i+Math.imul(k,ne)|0)+Math.imul(K,re)|0,s=s+Math.imul(K,ne)|0,n=n+Math.imul(R,se)|0,i=(i=i+Math.imul(R,oe)|0)+Math.imul(C,se)|0,s=s+Math.imul(C,oe)|0,n=n+Math.imul(T,ue)|0,i=(i=i+Math.imul(T,ce)|0)+Math.imul(I,ue)|0,s=s+Math.imul(I,ce)|0,n=n+Math.imul(E,he)|0,i=(i=i+Math.imul(E,de)|0)+Math.imul(S,he)|0,s=s+Math.imul(S,de)|0;var Pe=(c+(n=n+Math.imul(v,pe)|0)|0)+((8191&(i=(i=i+Math.imul(v,ye)|0)+Math.imul(_,pe)|0))<<13)|0;c=((s=s+Math.imul(_,ye)|0)+(i>>>13)|0)+(Pe>>>26)|0,Pe&=67108863,n=Math.imul(L,Z),i=(i=Math.imul(L,ee))+Math.imul(x,Z)|0,s=Math.imul(x,ee),n=n+Math.imul(N,re)|0,i=(i=i+Math.imul(N,ne)|0)+Math.imul(D,re)|0,s=s+Math.imul(D,ne)|0,n=n+Math.imul(k,se)|0,i=(i=i+Math.imul(k,oe)|0)+Math.imul(K,se)|0,s=s+Math.imul(K,oe)|0,n=n+Math.imul(R,ue)|0,i=(i=i+Math.imul(R,ce)|0)+Math.imul(C,ue)|0,s=s+Math.imul(C,ce)|0,n=n+Math.imul(T,he)|0,i=(i=i+Math.imul(T,de)|0)+Math.imul(I,he)|0,s=s+Math.imul(I,de)|0;var Re=(c+(n=n+Math.imul(E,pe)|0)|0)+((8191&(i=(i=i+Math.imul(E,ye)|0)+Math.imul(S,pe)|0))<<13)|0;c=((s=s+Math.imul(S,ye)|0)+(i>>>13)|0)+(Re>>>26)|0,Re&=67108863,n=Math.imul(L,re),i=(i=Math.imul(L,ne))+Math.imul(x,re)|0,s=Math.imul(x,ne),n=n+Math.imul(N,se)|0,i=(i=i+Math.imul(N,oe)|0)+Math.imul(D,se)|0,s=s+Math.imul(D,oe)|0,n=n+Math.imul(k,ue)|0,i=(i=i+Math.imul(k,ce)|0)+Math.imul(K,ue)|0,s=s+Math.imul(K,ce)|0,n=n+Math.imul(R,he)|0,i=(i=i+Math.imul(R,de)|0)+Math.imul(C,he)|0,s=s+Math.imul(C,de)|0;var Ce=(c+(n=n+Math.imul(T,pe)|0)|0)+((8191&(i=(i=i+Math.imul(T,ye)|0)+Math.imul(I,pe)|0))<<13)|0;c=((s=s+Math.imul(I,ye)|0)+(i>>>13)|0)+(Ce>>>26)|0,Ce&=67108863,n=Math.imul(L,se),i=(i=Math.imul(L,oe))+Math.imul(x,se)|0,s=Math.imul(x,oe),n=n+Math.imul(N,ue)|0,i=(i=i+Math.imul(N,ce)|0)+Math.imul(D,ue)|0,s=s+Math.imul(D,ce)|0,n=n+Math.imul(k,he)|0,i=(i=i+Math.imul(k,de)|0)+Math.imul(K,he)|0,s=s+Math.imul(K,de)|0;var Be=(c+(n=n+Math.imul(R,pe)|0)|0)+((8191&(i=(i=i+Math.imul(R,ye)|0)+Math.imul(C,pe)|0))<<13)|0;c=((s=s+Math.imul(C,ye)|0)+(i>>>13)|0)+(Be>>>26)|0,Be&=67108863,n=Math.imul(L,ue),i=(i=Math.imul(L,ce))+Math.imul(x,ue)|0,s=Math.imul(x,ce),n=n+Math.imul(N,he)|0,i=(i=i+Math.imul(N,de)|0)+Math.imul(D,he)|0,s=s+Math.imul(D,de)|0;var ke=(c+(n=n+Math.imul(k,pe)|0)|0)+((8191&(i=(i=i+Math.imul(k,ye)|0)+Math.imul(K,pe)|0))<<13)|0;c=((s=s+Math.imul(K,ye)|0)+(i>>>13)|0)+(ke>>>26)|0,ke&=67108863,n=Math.imul(L,he),i=(i=Math.imul(L,de))+Math.imul(x,he)|0,s=Math.imul(x,de);var Ke=(c+(n=n+Math.imul(N,pe)|0)|0)+((8191&(i=(i=i+Math.imul(N,ye)|0)+Math.imul(D,pe)|0))<<13)|0;c=((s=s+Math.imul(D,ye)|0)+(i>>>13)|0)+(Ke>>>26)|0,Ke&=67108863;var Oe=(c+(n=Math.imul(L,pe))|0)+((8191&(i=(i=Math.imul(L,ye))+Math.imul(x,pe)|0))<<13)|0;return c=((s=Math.imul(x,ye))+(i>>>13)|0)+(Oe>>>26)|0,Oe&=67108863,u[0]=ge,u[1]=$e,u[2]=me,u[3]=be,u[4]=ve,u[5]=_e,u[6]=we,u[7]=Ee,u[8]=Se,u[9]=Ae,u[10]=Te,u[11]=Ie,u[12]=Pe,u[13]=Re,u[14]=Ce,u[15]=Be,u[16]=ke,u[17]=Ke,u[18]=Oe,0!==c&&(u[19]=c,r.length++),r};function p(e,t,r){return(new y).mulp(e,t,r)}function y(e,t){this.x=e,this.y=t}Math.imul||(f=d),i.prototype.mulTo=function(e,t){var r,n=this.length+e.length;return r=10===this.length&&10===e.length?f(this,e,t):n<63?d(this,e,t):n<1024?function(e,t,r){r.negative=t.negative^e.negative,r.length=e.length+t.length;for(var n=0,i=0,s=0;s<r.length-1;s++){var o=i;i=0;for(var a=67108863&n,u=Math.min(s,t.length-1),c=Math.max(0,s-e.length+1);c<=u;c++){var l=s-c,h=(0|e.words[l])*(0|t.words[c]),d=67108863&h;a=67108863&(d=d+a|0),i+=(o=(o=o+(h/67108864|0)|0)+(d>>>26)|0)>>>26,o&=67108863}r.words[s]=a,n=o,o=i}return 0!==n?r.words[s]=n:r.length--,r.strip()}(this,e,t):p(this,e,t),r},y.prototype.makeRBT=function(e){for(var t=new Array(e),r=i.prototype._countBits(e)-1,n=0;n<e;n++)t[n]=this.revBin(n,r,e);return t},y.prototype.revBin=function(e,t,r){if(0===e||e===r-1)return e;for(var n=0,i=0;i<t;i++)n|=(1&e)<<t-i-1,e>>=1;return n},y.prototype.permute=function(e,t,r,n,i,s){for(var o=0;o<s;o++)n[o]=t[e[o]],i[o]=r[e[o]]},y.prototype.transform=function(e,t,r,n,i,s){this.permute(s,e,t,r,n,i);for(var o=1;o<i;o<<=1)for(var a=o<<1,u=Math.cos(2*Math.PI/a),c=Math.sin(2*Math.PI/a),l=0;l<i;l+=a)for(var h=u,d=c,f=0;f<o;f++){var p=r[l+f],y=n[l+f],g=r[l+f+o],$=n[l+f+o],m=h*g-d*$;$=h*$+d*g,g=m,r[l+f]=p+g,n[l+f]=y+$,r[l+f+o]=p-g,n[l+f+o]=y-$,f!==a&&(m=u*h-c*d,d=u*d+c*h,h=m)}},y.prototype.guessLen13b=function(e,t){var r=1|Math.max(t,e),n=1&r,i=0;for(r=r/2|0;r;r>>>=1)i++;return 1<<i+1+n},y.prototype.conjugate=function(e,t,r){if(!(r<=1))for(var n=0;n<r/2;n++){var i=e[n];e[n]=e[r-n-1],e[r-n-1]=i,i=t[n],t[n]=-t[r-n-1],t[r-n-1]=-i}},y.prototype.normalize13b=function(e,t){for(var r=0,n=0;n<t/2;n++){var i=8192*Math.round(e[2*n+1]/t)+Math.round(e[2*n]/t)+r;e[n]=67108863&i,r=i<67108864?0:i/67108864|0}return e},y.prototype.convert13b=function(e,t,n,i){for(var s=0,o=0;o<t;o++)s+=0|e[o],n[2*o]=8191&s,s>>>=13,n[2*o+1]=8191&s,s>>>=13;for(o=2*t;o<i;++o)n[o]=0;r(0===s),r(0==(-8192&s))},y.prototype.stub=function(e){for(var t=new Array(e),r=0;r<e;r++)t[r]=0;return t},y.prototype.mulp=function(e,t,r){var n=2*this.guessLen13b(e.length,t.length),i=this.makeRBT(n),s=this.stub(n),o=new Array(n),a=new Array(n),u=new Array(n),c=new Array(n),l=new Array(n),h=new Array(n),d=r.words;d.length=n,this.convert13b(e.words,e.length,o,n),this.convert13b(t.words,t.length,c,n),this.transform(o,s,a,u,n,i),this.transform(c,s,l,h,n,i);for(var f=0;f<n;f++){var p=a[f]*l[f]-u[f]*h[f];u[f]=a[f]*h[f]+u[f]*l[f],a[f]=p}return this.conjugate(a,u,n),this.transform(a,u,d,s,n,i),this.conjugate(d,s,n),this.normalize13b(d,n),r.negative=e.negative^t.negative,r.length=e.length+t.length,r.strip()},i.prototype.mul=function(e){var t=new i(null);return t.words=new Array(this.length+e.length),this.mulTo(e,t)},i.prototype.mulf=function(e){var t=new i(null);return t.words=new Array(this.length+e.length),p(this,e,t)},i.prototype.imul=function(e){return this.clone().mulTo(e,this)},i.prototype.imuln=function(e){r("number"==typeof e),r(e<67108864);for(var t=0,n=0;n<this.length;n++){var i=(0|this.words[n])*e,s=(67108863&i)+(67108863&t);t>>=26,t+=i/67108864|0,t+=s>>>26,this.words[n]=67108863&s}return 0!==t&&(this.words[n]=t,this.length++),this},i.prototype.muln=function(e){return this.clone().imuln(e)},i.prototype.sqr=function(){return this.mul(this)},i.prototype.isqr=function(){return this.imul(this.clone())},i.prototype.pow=function(e){var t=function(e){for(var t=new Array(e.bitLength()),r=0;r<t.length;r++){var n=r/26|0,i=r%26;t[r]=(e.words[n]&1<<i)>>>i}return t}(e);if(0===t.length)return new i(1);for(var r=this,n=0;n<t.length&&0===t[n];n++,r=r.sqr());if(++n<t.length)for(var s=r.sqr();n<t.length;n++,s=s.sqr())0!==t[n]&&(r=r.mul(s));return r},i.prototype.iushln=function(e){r("number"==typeof e&&e>=0);var t,n=e%26,i=(e-n)/26,s=67108863>>>26-n<<26-n;if(0!==n){var o=0;for(t=0;t<this.length;t++){var a=this.words[t]&s,u=(0|this.words[t])-a<<n;this.words[t]=u|o,o=a>>>26-n}o&&(this.words[t]=o,this.length++)}if(0!==i){for(t=this.length-1;t>=0;t--)this.words[t+i]=this.words[t];for(t=0;t<i;t++)this.words[t]=0;this.length+=i}return this.strip()},i.prototype.ishln=function(e){return r(0===this.negative),this.iushln(e)},i.prototype.iushrn=function(e,t,n){var i;r("number"==typeof e&&e>=0),i=t?(t-t%26)/26:0;var s=e%26,o=Math.min((e-s)/26,this.length),a=67108863^67108863>>>s<<s,u=n;if(i-=o,i=Math.max(0,i),u){for(var c=0;c<o;c++)u.words[c]=this.words[c];u.length=o}if(0===o);else if(this.length>o)for(this.length-=o,c=0;c<this.length;c++)this.words[c]=this.words[c+o];else this.words[0]=0,this.length=1;var l=0;for(c=this.length-1;c>=0&&(0!==l||c>=i);c--){var h=0|this.words[c];this.words[c]=l<<26-s|h>>>s,l=h&a}return u&&0!==l&&(u.words[u.length++]=l),0===this.length&&(this.words[0]=0,this.length=1),this.strip()},i.prototype.ishrn=function(e,t,n){return r(0===this.negative),this.iushrn(e,t,n)},i.prototype.shln=function(e){return this.clone().ishln(e)},i.prototype.ushln=function(e){return this.clone().iushln(e)},i.prototype.shrn=function(e){return this.clone().ishrn(e)},i.prototype.ushrn=function(e){return this.clone().iushrn(e)},i.prototype.testn=function(e){r("number"==typeof e&&e>=0);var t=e%26,n=(e-t)/26,i=1<<t;return!(this.length<=n||!(this.words[n]&i))},i.prototype.imaskn=function(e){r("number"==typeof e&&e>=0);var t=e%26,n=(e-t)/26;if(r(0===this.negative,"imaskn works only with positive numbers"),this.length<=n)return this;if(0!==t&&n++,this.length=Math.min(n,this.length),0!==t){var i=67108863^67108863>>>t<<t;this.words[this.length-1]&=i}return this.strip()},i.prototype.maskn=function(e){return this.clone().imaskn(e)},i.prototype.iaddn=function(e){return r("number"==typeof e),r(e<67108864),e<0?this.isubn(-e):0!==this.negative?1===this.length&&(0|this.words[0])<e?(this.words[0]=e-(0|this.words[0]),this.negative=0,this):(this.negative=0,this.isubn(e),this.negative=1,this):this._iaddn(e)},i.prototype._iaddn=function(e){this.words[0]+=e;for(var t=0;t<this.length&&this.words[t]>=67108864;t++)this.words[t]-=67108864,t===this.length-1?this.words[t+1]=1:this.words[t+1]++;return this.length=Math.max(this.length,t+1),this},i.prototype.isubn=function(e){if(r("number"==typeof e),r(e<67108864),e<0)return this.iaddn(-e);if(0!==this.negative)return this.negative=0,this.iaddn(e),this.negative=1,this;if(this.words[0]-=e,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var t=0;t<this.length&&this.words[t]<0;t++)this.words[t]+=67108864,this.words[t+1]-=1;return this.strip()},i.prototype.addn=function(e){return this.clone().iaddn(e)},i.prototype.subn=function(e){return this.clone().isubn(e)},i.prototype.iabs=function(){return this.negative=0,this},i.prototype.abs=function(){return this.clone().iabs()},i.prototype._ishlnsubmul=function(e,t,n){var i,s,o=e.length+n;this._expand(o);var a=0;for(i=0;i<e.length;i++){s=(0|this.words[i+n])+a;var u=(0|e.words[i])*t;a=((s-=67108863&u)>>26)-(u/67108864|0),this.words[i+n]=67108863&s}for(;i<this.length-n;i++)a=(s=(0|this.words[i+n])+a)>>26,this.words[i+n]=67108863&s;if(0===a)return this.strip();for(r(-1===a),a=0,i=0;i<this.length;i++)a=(s=-(0|this.words[i])+a)>>26,this.words[i]=67108863&s;return this.negative=1,this.strip()},i.prototype._wordDiv=function(e,t){var r=(this.length,e.length),n=this.clone(),s=e,o=0|s.words[s.length-1];0!=(r=26-this._countBits(o))&&(s=s.ushln(r),n.iushln(r),o=0|s.words[s.length-1]);var a,u=n.length-s.length;if("mod"!==t){(a=new i(null)).length=u+1,a.words=new Array(a.length);for(var c=0;c<a.length;c++)a.words[c]=0}var l=n.clone()._ishlnsubmul(s,1,u);0===l.negative&&(n=l,a&&(a.words[u]=1));for(var h=u-1;h>=0;h--){var d=67108864*(0|n.words[s.length+h])+(0|n.words[s.length+h-1]);for(d=Math.min(d/o|0,67108863),n._ishlnsubmul(s,d,h);0!==n.negative;)d--,n.negative=0,n._ishlnsubmul(s,1,h),n.isZero()||(n.negative^=1);a&&(a.words[h]=d)}return a&&a.strip(),n.strip(),"div"!==t&&0!==r&&n.iushrn(r),{div:a||null,mod:n}},i.prototype.divmod=function(e,t,n){return r(!e.isZero()),this.isZero()?{div:new i(0),mod:new i(0)}:0!==this.negative&&0===e.negative?(a=this.neg().divmod(e,t),"mod"!==t&&(s=a.div.neg()),"div"!==t&&(o=a.mod.neg(),n&&0!==o.negative&&o.iadd(e)),{div:s,mod:o}):0===this.negative&&0!==e.negative?(a=this.divmod(e.neg(),t),"mod"!==t&&(s=a.div.neg()),{div:s,mod:a.mod}):0!=(this.negative&e.negative)?(a=this.neg().divmod(e.neg(),t),"div"!==t&&(o=a.mod.neg(),n&&0!==o.negative&&o.isub(e)),{div:a.div,mod:o}):e.length>this.length||this.cmp(e)<0?{div:new i(0),mod:this}:1===e.length?"div"===t?{div:this.divn(e.words[0]),mod:null}:"mod"===t?{div:null,mod:new i(this.modn(e.words[0]))}:{div:this.divn(e.words[0]),mod:new i(this.modn(e.words[0]))}:this._wordDiv(e,t);var s,o,a},i.prototype.div=function(e){return this.divmod(e,"div",!1).div},i.prototype.mod=function(e){return this.divmod(e,"mod",!1).mod},i.prototype.umod=function(e){return this.divmod(e,"mod",!0).mod},i.prototype.divRound=function(e){var t=this.divmod(e);if(t.mod.isZero())return t.div;var r=0!==t.div.negative?t.mod.isub(e):t.mod,n=e.ushrn(1),i=e.andln(1),s=r.cmp(n);return s<0||1===i&&0===s?t.div:0!==t.div.negative?t.div.isubn(1):t.div.iaddn(1)},i.prototype.modn=function(e){r(e<=67108863);for(var t=(1<<26)%e,n=0,i=this.length-1;i>=0;i--)n=(t*n+(0|this.words[i]))%e;return n},i.prototype.idivn=function(e){r(e<=67108863);for(var t=0,n=this.length-1;n>=0;n--){var i=(0|this.words[n])+67108864*t;this.words[n]=i/e|0,t=i%e}return this.strip()},i.prototype.divn=function(e){return this.clone().idivn(e)},i.prototype.egcd=function(e){r(0===e.negative),r(!e.isZero());var t=this,n=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var s=new i(1),o=new i(0),a=new i(0),u=new i(1),c=0;t.isEven()&&n.isEven();)t.iushrn(1),n.iushrn(1),++c;for(var l=n.clone(),h=t.clone();!t.isZero();){for(var d=0,f=1;0==(t.words[0]&f)&&d<26;++d,f<<=1);if(d>0)for(t.iushrn(d);d-- >0;)(s.isOdd()||o.isOdd())&&(s.iadd(l),o.isub(h)),s.iushrn(1),o.iushrn(1);for(var p=0,y=1;0==(n.words[0]&y)&&p<26;++p,y<<=1);if(p>0)for(n.iushrn(p);p-- >0;)(a.isOdd()||u.isOdd())&&(a.iadd(l),u.isub(h)),a.iushrn(1),u.iushrn(1);t.cmp(n)>=0?(t.isub(n),s.isub(a),o.isub(u)):(n.isub(t),a.isub(s),u.isub(o))}return{a:a,b:u,gcd:n.iushln(c)}},i.prototype._invmp=function(e){r(0===e.negative),r(!e.isZero());var t=this,n=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var s,o=new i(1),a=new i(0),u=n.clone();t.cmpn(1)>0&&n.cmpn(1)>0;){for(var c=0,l=1;0==(t.words[0]&l)&&c<26;++c,l<<=1);if(c>0)for(t.iushrn(c);c-- >0;)o.isOdd()&&o.iadd(u),o.iushrn(1);for(var h=0,d=1;0==(n.words[0]&d)&&h<26;++h,d<<=1);if(h>0)for(n.iushrn(h);h-- >0;)a.isOdd()&&a.iadd(u),a.iushrn(1);t.cmp(n)>=0?(t.isub(n),o.isub(a)):(n.isub(t),a.isub(o))}return(s=0===t.cmpn(1)?o:a).cmpn(0)<0&&s.iadd(e),s},i.prototype.gcd=function(e){if(this.isZero())return e.abs();if(e.isZero())return this.abs();var t=this.clone(),r=e.clone();t.negative=0,r.negative=0;for(var n=0;t.isEven()&&r.isEven();n++)t.iushrn(1),r.iushrn(1);for(;;){for(;t.isEven();)t.iushrn(1);for(;r.isEven();)r.iushrn(1);var i=t.cmp(r);if(i<0){var s=t;t=r,r=s}else if(0===i||0===r.cmpn(1))break;t.isub(r)}return r.iushln(n)},i.prototype.invm=function(e){return this.egcd(e).a.umod(e)},i.prototype.isEven=function(){return 0==(1&this.words[0])},i.prototype.isOdd=function(){return 1==(1&this.words[0])},i.prototype.andln=function(e){return this.words[0]&e},i.prototype.bincn=function(e){r("number"==typeof e);var t=e%26,n=(e-t)/26,i=1<<t;if(this.length<=n)return this._expand(n+1),this.words[n]|=i,this;for(var s=i,o=n;0!==s&&o<this.length;o++){var a=0|this.words[o];s=(a+=s)>>>26,a&=67108863,this.words[o]=a}return 0!==s&&(this.words[o]=s,this.length++),this},i.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},i.prototype.cmpn=function(e){var t,n=e<0;if(0!==this.negative&&!n)return-1;if(0===this.negative&&n)return 1;if(this.strip(),this.length>1)t=1;else{n&&(e=-e),r(e<=67108863,"Number is too big");var i=0|this.words[0];t=i===e?0:i<e?-1:1}return 0!==this.negative?0|-t:t},i.prototype.cmp=function(e){if(0!==this.negative&&0===e.negative)return-1;if(0===this.negative&&0!==e.negative)return 1;var t=this.ucmp(e);return 0!==this.negative?0|-t:t},i.prototype.ucmp=function(e){if(this.length>e.length)return 1;if(this.length<e.length)return-1;for(var t=0,r=this.length-1;r>=0;r--){var n=0|this.words[r],i=0|e.words[r];if(n!==i){n<i?t=-1:n>i&&(t=1);break}}return t},i.prototype.gtn=function(e){return 1===this.cmpn(e)},i.prototype.gt=function(e){return 1===this.cmp(e)},i.prototype.gten=function(e){return this.cmpn(e)>=0},i.prototype.gte=function(e){return this.cmp(e)>=0},i.prototype.ltn=function(e){return-1===this.cmpn(e)},i.prototype.lt=function(e){return-1===this.cmp(e)},i.prototype.lten=function(e){return this.cmpn(e)<=0},i.prototype.lte=function(e){return this.cmp(e)<=0},i.prototype.eqn=function(e){return 0===this.cmpn(e)},i.prototype.eq=function(e){return 0===this.cmp(e)},i.red=function(e){return new w(e)},i.prototype.toRed=function(e){return r(!this.red,"Already a number in reduction context"),r(0===this.negative,"red works only with positives"),e.convertTo(this)._forceRed(e)},i.prototype.fromRed=function(){return r(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},i.prototype._forceRed=function(e){return this.red=e,this},i.prototype.forceRed=function(e){return r(!this.red,"Already a number in reduction context"),this._forceRed(e)},i.prototype.redAdd=function(e){return r(this.red,"redAdd works only with red numbers"),this.red.add(this,e)},i.prototype.redIAdd=function(e){return r(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,e)},i.prototype.redSub=function(e){return r(this.red,"redSub works only with red numbers"),this.red.sub(this,e)},i.prototype.redISub=function(e){return r(this.red,"redISub works only with red numbers"),this.red.isub(this,e)},i.prototype.redShl=function(e){return r(this.red,"redShl works only with red numbers"),this.red.shl(this,e)},i.prototype.redMul=function(e){return r(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.mul(this,e)},i.prototype.redIMul=function(e){return r(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.imul(this,e)},i.prototype.redSqr=function(){return r(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},i.prototype.redISqr=function(){return r(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},i.prototype.redSqrt=function(){return r(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},i.prototype.redInvm=function(){return r(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},i.prototype.redNeg=function(){return r(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},i.prototype.redPow=function(e){return r(this.red&&!e.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,e)};var g={k256:null,p224:null,p192:null,p25519:null};function $(e,t){this.name=e,this.p=new i(t,16),this.n=this.p.bitLength(),this.k=new i(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}function m(){$.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function b(){$.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function v(){$.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function _(){$.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function w(e){if("string"==typeof e){var t=i._prime(e);this.m=t.p,this.prime=t}else r(e.gtn(1),"modulus must be greater than 1"),this.m=e,this.prime=null}function E(e){w.call(this,e),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new i(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}$.prototype._tmp=function(){var e=new i(null);return e.words=new Array(Math.ceil(this.n/13)),e},$.prototype.ireduce=function(e){var t,r=e;do{this.split(r,this.tmp),t=(r=(r=this.imulK(r)).iadd(this.tmp)).bitLength()}while(t>this.n);var n=t<this.n?-1:r.ucmp(this.p);return 0===n?(r.words[0]=0,r.length=1):n>0?r.isub(this.p):void 0!==r.strip?r.strip():r._strip(),r},$.prototype.split=function(e,t){e.iushrn(this.n,0,t)},$.prototype.imulK=function(e){return e.imul(this.k)},n(m,$),m.prototype.split=function(e,t){for(var r=4194303,n=Math.min(e.length,9),i=0;i<n;i++)t.words[i]=e.words[i];if(t.length=n,e.length<=9)return e.words[0]=0,void(e.length=1);var s=e.words[9];for(t.words[t.length++]=s&r,i=10;i<e.length;i++){var o=0|e.words[i];e.words[i-10]=(o&r)<<4|s>>>22,s=o}s>>>=22,e.words[i-10]=s,0===s&&e.length>10?e.length-=10:e.length-=9},m.prototype.imulK=function(e){e.words[e.length]=0,e.words[e.length+1]=0,e.length+=2;for(var t=0,r=0;r<e.length;r++){var n=0|e.words[r];t+=977*n,e.words[r]=67108863&t,t=64*n+(t/67108864|0)}return 0===e.words[e.length-1]&&(e.length--,0===e.words[e.length-1]&&e.length--),e},n(b,$),n(v,$),n(_,$),_.prototype.imulK=function(e){for(var t=0,r=0;r<e.length;r++){var n=19*(0|e.words[r])+t,i=67108863&n;n>>>=26,e.words[r]=i,t=n}return 0!==t&&(e.words[e.length++]=t),e},i._prime=function(e){if(g[e])return g[e];var t;if("k256"===e)t=new m;else if("p224"===e)t=new b;else if("p192"===e)t=new v;else{if("p25519"!==e)throw new Error("Unknown prime "+e);t=new _}return g[e]=t,t},w.prototype._verify1=function(e){r(0===e.negative,"red works only with positives"),r(e.red,"red works only with red numbers")},w.prototype._verify2=function(e,t){r(0==(e.negative|t.negative),"red works only with positives"),r(e.red&&e.red===t.red,"red works only with red numbers")},w.prototype.imod=function(e){return this.prime?this.prime.ireduce(e)._forceRed(this):e.umod(this.m)._forceRed(this)},w.prototype.neg=function(e){return e.isZero()?e.clone():this.m.sub(e)._forceRed(this)},w.prototype.add=function(e,t){this._verify2(e,t);var r=e.add(t);return r.cmp(this.m)>=0&&r.isub(this.m),r._forceRed(this)},w.prototype.iadd=function(e,t){this._verify2(e,t);var r=e.iadd(t);return r.cmp(this.m)>=0&&r.isub(this.m),r},w.prototype.sub=function(e,t){this._verify2(e,t);var r=e.sub(t);return r.cmpn(0)<0&&r.iadd(this.m),r._forceRed(this)},w.prototype.isub=function(e,t){this._verify2(e,t);var r=e.isub(t);return r.cmpn(0)<0&&r.iadd(this.m),r},w.prototype.shl=function(e,t){return this._verify1(e),this.imod(e.ushln(t))},w.prototype.imul=function(e,t){return this._verify2(e,t),this.imod(e.imul(t))},w.prototype.mul=function(e,t){return this._verify2(e,t),this.imod(e.mul(t))},w.prototype.isqr=function(e){return this.imul(e,e.clone())},w.prototype.sqr=function(e){return this.mul(e,e)},w.prototype.sqrt=function(e){if(e.isZero())return e.clone();var t=this.m.andln(3);if(r(t%2==1),3===t){var n=this.m.add(new i(1)).iushrn(2);return this.pow(e,n)}for(var s=this.m.subn(1),o=0;!s.isZero()&&0===s.andln(1);)o++,s.iushrn(1);r(!s.isZero());var a=new i(1).toRed(this),u=a.redNeg(),c=this.m.subn(1).iushrn(1),l=this.m.bitLength();for(l=new i(2*l*l).toRed(this);0!==this.pow(l,c).cmp(u);)l.redIAdd(u);for(var h=this.pow(l,s),d=this.pow(e,s.addn(1).iushrn(1)),f=this.pow(e,s),p=o;0!==f.cmp(a);){for(var y=f,g=0;0!==y.cmp(a);g++)y=y.redSqr();r(g<p);var $=this.pow(h,new i(1).iushln(p-g-1));d=d.redMul($),h=$.redSqr(),f=f.redMul(h),p=g}return d},w.prototype.invm=function(e){var t=e._invmp(this.m);return 0!==t.negative?(t.negative=0,this.imod(t).redNeg()):this.imod(t)},w.prototype.pow=function(e,t){if(t.isZero())return new i(1).toRed(this);if(0===t.cmpn(1))return e.clone();var r=new Array(16);r[0]=new i(1).toRed(this),r[1]=e;for(var n=2;n<r.length;n++)r[n]=this.mul(r[n-1],e);var s=r[0],o=0,a=0,u=t.bitLength()%26;for(0===u&&(u=26),n=t.length-1;n>=0;n--){for(var c=t.words[n],l=u-1;l>=0;l--){var h=c>>l&1;s!==r[0]&&(s=this.sqr(s)),0!==h||0!==o?(o<<=1,o|=h,(4==++a||0===n&&0===l)&&(s=this.mul(s,r[o]),a=0,o=0)):a=0}u=26}return s},w.prototype.convertTo=function(e){var t=e.umod(this.m);return t===e?t.clone():t},w.prototype.convertFrom=function(e){var t=e.clone();return t.red=null,t},i.mont=function(e){return new E(e)},n(E,w),E.prototype.convertTo=function(e){return this.imod(e.ushln(this.shift))},E.prototype.convertFrom=function(e){var t=this.imod(e.mul(this.rinv));return t.red=null,t},E.prototype.imul=function(e,t){if(e.isZero()||t.isZero())return e.words[0]=0,e.length=1,e;var r=e.imul(t),n=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),i=r.isub(n).iushrn(this.shift),s=i;return i.cmp(this.m)>=0?s=i.isub(this.m):i.cmpn(0)<0&&(s=i.iadd(this.m)),s._forceRed(this)},E.prototype.mul=function(e,t){if(e.isZero()||t.isZero())return new i(0)._forceRed(this);var r=e.mul(t),n=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),s=r.isub(n).iushrn(this.shift),o=s;return s.cmp(this.m)>=0?o=s.isub(this.m):s.cmpn(0)<0&&(o=s.iadd(this.m)),o._forceRed(this)},E.prototype.invm=function(e){return this.imod(e._invmp(this.m).mul(this.r2))._forceRed(this)}}(bn,commonjsGlobal);var minimalisticAssert=assert$f;function assert$f(e,t){if(!e)throw new Error(t||"Assertion failed")}assert$f.equal=function(e,t,r){if(e!=t)throw new Error(r||"Assertion failed: "+e+" != "+t)};var utils$o={};!function(e){var t=utils$o;function r(e){return 1===e.length?"0"+e:e}function n(e){for(var t="",n=0;n<e.length;n++)t+=r(e[n].toString(16));return t}t.toArray=function(e,t){if(Array.isArray(e))return e.slice();if(!e)return[];var r=[];if("string"!=typeof e){for(var n=0;n<e.length;n++)r[n]=0|e[n];return r}if("hex"===t){(e=e.replace(/[^a-z0-9]+/gi,"")).length%2!=0&&(e="0"+e);for(n=0;n<e.length;n+=2)r.push(parseInt(e[n]+e[n+1],16))}else for(n=0;n<e.length;n++){var i=e.charCodeAt(n),s=i>>8,o=255&i;s?r.push(s,o):r.push(o)}return r},t.zero2=r,t.toHex=n,t.encode=function(e,t){return"hex"===t?n(e):e}}(),function(e){var t=utils$p,r=bn.exports,n=minimalisticAssert,i=utils$o;t.assert=n,t.toArray=i.toArray,t.zero2=i.zero2,t.toHex=i.toHex,t.encode=i.encode,t.getNAF=function(e,t,r){var n=new Array(Math.max(e.bitLength(),r)+1);n.fill(0);for(var i=1<<t+1,s=e.clone(),o=0;o<n.length;o++){var a,u=s.andln(i-1);s.isOdd()?(a=u>(i>>1)-1?(i>>1)-u:u,s.isubn(a)):a=0,n[o]=a,s.iushrn(1)}return n},t.getJSF=function(e,t){var r=[[],[]];e=e.clone(),t=t.clone();for(var n,i=0,s=0;e.cmpn(-i)>0||t.cmpn(-s)>0;){var o,a,u=e.andln(3)+i&3,c=t.andln(3)+s&3;3===u&&(u=-1),3===c&&(c=-1),o=0==(1&u)?0:3!==(n=e.andln(7)+i&7)&&5!==n||2!==c?u:-u,r[0].push(o),a=0==(1&c)?0:3!==(n=t.andln(7)+s&7)&&5!==n||2!==u?c:-c,r[1].push(a),2*i===o+1&&(i=1-i),2*s===a+1&&(s=1-s),e.iushrn(1),t.iushrn(1)}return r},t.cachedProperty=function(e,t,r){var n="_"+t;e.prototype[t]=function(){return void 0!==this[n]?this[n]:this[n]=r.call(this)}},t.parseBytes=function(e){return"string"==typeof e?t.toArray(e,"hex"):e},t.intFromLE=function(e){return new r(e,"hex","le")}}();var brorand={exports:{}},r$1;function Rand(e){this.rand=e}if(brorand.exports=function(e){return r$1||(r$1=new Rand(null)),r$1.generate(e)},brorand.exports.Rand=Rand,Rand.prototype.generate=function(e){return this._rand(e)},Rand.prototype._rand=function(e){if(this.rand.getBytes)return this.rand.getBytes(e);for(var t=new Uint8Array(e),r=0;r<t.length;r++)t[r]=this.rand.getByte();return t},"object"==typeof self)self.crypto&&self.crypto.getRandomValues?Rand.prototype._rand=function(e){var t=new Uint8Array(e);return self.crypto.getRandomValues(t),t}:self.msCrypto&&self.msCrypto.getRandomValues?Rand.prototype._rand=function(e){var t=new Uint8Array(e);return self.msCrypto.getRandomValues(t),t}:"object"==typeof window&&(Rand.prototype._rand=function(){throw new Error("Not implemented yet")});else try{var crypto$4=require("crypto");if("function"!=typeof crypto$4.randomBytes)throw new Error("Not supported");Rand.prototype._rand=function(e){return crypto$4.randomBytes(e)}}catch(e){}var curve={},BN$8=bn.exports,utils$n=utils$p,getNAF=utils$n.getNAF,getJSF=utils$n.getJSF,assert$e=utils$n.assert;function BaseCurve(e,t){this.type=e,this.p=new BN$8(t.p,16),this.red=t.prime?BN$8.red(t.prime):BN$8.mont(this.p),this.zero=new BN$8(0).toRed(this.red),this.one=new BN$8(1).toRed(this.red),this.two=new BN$8(2).toRed(this.red),this.n=t.n&&new BN$8(t.n,16),this.g=t.g&&this.pointFromJSON(t.g,t.gRed),this._wnafT1=new Array(4),this._wnafT2=new Array(4),this._wnafT3=new Array(4),this._wnafT4=new Array(4),this._bitLength=this.n?this.n.bitLength():0;var r=this.n&&this.p.div(this.n);!r||r.cmpn(100)>0?this.redN=null:(this._maxwellTrick=!0,this.redN=this.n.toRed(this.red))}var base=BaseCurve;function BasePoint(e,t){this.curve=e,this.type=t,this.precomputed=null}BaseCurve.prototype.point=function(){throw new Error("Not implemented")},BaseCurve.prototype.validate=function(){throw new Error("Not implemented")},BaseCurve.prototype._fixedNafMul=function(e,t){assert$e(e.precomputed);var r=e._getDoubles(),n=getNAF(t,1,this._bitLength),i=(1<<r.step+1)-(r.step%2==0?2:1);i/=3;var s,o,a=[];for(s=0;s<n.length;s+=r.step){o=0;for(var u=s+r.step-1;u>=s;u--)o=(o<<1)+n[u];a.push(o)}for(var c=this.jpoint(null,null,null),l=this.jpoint(null,null,null),h=i;h>0;h--){for(s=0;s<a.length;s++)(o=a[s])===h?l=l.mixedAdd(r.points[s]):o===-h&&(l=l.mixedAdd(r.points[s].neg()));c=c.add(l)}return c.toP()},BaseCurve.prototype._wnafMul=function(e,t){var r=4,n=e._getNAFPoints(r);r=n.wnd;for(var i=n.points,s=getNAF(t,r,this._bitLength),o=this.jpoint(null,null,null),a=s.length-1;a>=0;a--){for(var u=0;a>=0&&0===s[a];a--)u++;if(a>=0&&u++,o=o.dblp(u),a<0)break;var c=s[a];assert$e(0!==c),o="affine"===e.type?c>0?o.mixedAdd(i[c-1>>1]):o.mixedAdd(i[-c-1>>1].neg()):c>0?o.add(i[c-1>>1]):o.add(i[-c-1>>1].neg())}return"affine"===e.type?o.toP():o},BaseCurve.prototype._wnafMulAdd=function(e,t,r,n,i){var s,o,a,u=this._wnafT1,c=this._wnafT2,l=this._wnafT3,h=0;for(s=0;s<n;s++){var d=(a=t[s])._getNAFPoints(e);u[s]=d.wnd,c[s]=d.points}for(s=n-1;s>=1;s-=2){var f=s-1,p=s;if(1===u[f]&&1===u[p]){var y=[t[f],null,null,t[p]];0===t[f].y.cmp(t[p].y)?(y[1]=t[f].add(t[p]),y[2]=t[f].toJ().mixedAdd(t[p].neg())):0===t[f].y.cmp(t[p].y.redNeg())?(y[1]=t[f].toJ().mixedAdd(t[p]),y[2]=t[f].add(t[p].neg())):(y[1]=t[f].toJ().mixedAdd(t[p]),y[2]=t[f].toJ().mixedAdd(t[p].neg()));var g=[-3,-1,-5,-7,0,7,5,1,3],$=getJSF(r[f],r[p]);for(h=Math.max($[0].length,h),l[f]=new Array(h),l[p]=new Array(h),o=0;o<h;o++){var m=0|$[0][o],b=0|$[1][o];l[f][o]=g[3*(m+1)+(b+1)],l[p][o]=0,c[f]=y}}else l[f]=getNAF(r[f],u[f],this._bitLength),l[p]=getNAF(r[p],u[p],this._bitLength),h=Math.max(l[f].length,h),h=Math.max(l[p].length,h)}var v=this.jpoint(null,null,null),_=this._wnafT4;for(s=h;s>=0;s--){for(var w=0;s>=0;){var E=!0;for(o=0;o<n;o++)_[o]=0|l[o][s],0!==_[o]&&(E=!1);if(!E)break;w++,s--}if(s>=0&&w++,v=v.dblp(w),s<0)break;for(o=0;o<n;o++){var S=_[o];0!==S&&(S>0?a=c[o][S-1>>1]:S<0&&(a=c[o][-S-1>>1].neg()),v="affine"===a.type?v.mixedAdd(a):v.add(a))}}for(s=0;s<n;s++)c[s]=null;return i?v:v.toP()},BaseCurve.BasePoint=BasePoint,BasePoint.prototype.eq=function(){throw new Error("Not implemented")},BasePoint.prototype.validate=function(){return this.curve.validate(this)},BaseCurve.prototype.decodePoint=function(e,t){e=utils$n.toArray(e,t);var r=this.p.byteLength();if((4===e[0]||6===e[0]||7===e[0])&&e.length-1==2*r)return 6===e[0]?assert$e(e[e.length-1]%2==0):7===e[0]&&assert$e(e[e.length-1]%2==1),this.point(e.slice(1,1+r),e.slice(1+r,1+2*r));if((2===e[0]||3===e[0])&&e.length-1===r)return this.pointFromX(e.slice(1,1+r),3===e[0]);throw new Error("Unknown point format")},BasePoint.prototype.encodeCompressed=function(e){return this.encode(e,!0)},BasePoint.prototype._encode=function(e){var t=this.curve.p.byteLength(),r=this.getX().toArray("be",t);return e?[this.getY().isEven()?2:3].concat(r):[4].concat(r,this.getY().toArray("be",t))},BasePoint.prototype.encode=function(e,t){return utils$n.encode(this._encode(t),e)},BasePoint.prototype.precompute=function(e){if(this.precomputed)return this;var t={doubles:null,naf:null,beta:null};return t.naf=this._getNAFPoints(8),t.doubles=this._getDoubles(4,e),t.beta=this._getBeta(),this.precomputed=t,this},BasePoint.prototype._hasDoubles=function(e){if(!this.precomputed)return!1;var t=this.precomputed.doubles;return!!t&&t.points.length>=Math.ceil((e.bitLength()+1)/t.step)},BasePoint.prototype._getDoubles=function(e,t){if(this.precomputed&&this.precomputed.doubles)return this.precomputed.doubles;for(var r=[this],n=this,i=0;i<t;i+=e){for(var s=0;s<e;s++)n=n.dbl();r.push(n)}return{step:e,points:r}},BasePoint.prototype._getNAFPoints=function(e){if(this.precomputed&&this.precomputed.naf)return this.precomputed.naf;for(var t=[this],r=(1<<e)-1,n=1===r?null:this.dbl(),i=1;i<r;i++)t[i]=t[i-1].add(n);return{wnd:e,points:t}},BasePoint.prototype._getBeta=function(){return null},BasePoint.prototype.dblp=function(e){for(var t=this,r=0;r<e;r++)t=t.dbl();return t};var utils$m=utils$p,BN$7=bn.exports,inherits$3=require$$1$3,Base$2=base,assert$d=utils$m.assert;function ShortCurve(e){Base$2.call(this,"short",e),this.a=new BN$7(e.a,16).toRed(this.red),this.b=new BN$7(e.b,16).toRed(this.red),this.tinv=this.two.redInvm(),this.zeroA=0===this.a.fromRed().cmpn(0),this.threeA=0===this.a.fromRed().sub(this.p).cmpn(-3),this.endo=this._getEndomorphism(e),this._endoWnafT1=new Array(4),this._endoWnafT2=new Array(4)}inherits$3(ShortCurve,Base$2);var short=ShortCurve;function Point$2(e,t,r,n){Base$2.BasePoint.call(this,e,"affine"),null===t&&null===r?(this.x=null,this.y=null,this.inf=!0):(this.x=new BN$7(t,16),this.y=new BN$7(r,16),n&&(this.x.forceRed(this.curve.red),this.y.forceRed(this.curve.red)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.inf=!1)}function JPoint(e,t,r,n){Base$2.BasePoint.call(this,e,"jacobian"),null===t&&null===r&&null===n?(this.x=this.curve.one,this.y=this.curve.one,this.z=new BN$7(0)):(this.x=new BN$7(t,16),this.y=new BN$7(r,16),this.z=new BN$7(n,16)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.zOne=this.z===this.curve.one}ShortCurve.prototype._getEndomorphism=function(e){if(this.zeroA&&this.g&&this.n&&1===this.p.modn(3)){var t,r;if(e.beta)t=new BN$7(e.beta,16).toRed(this.red);else{var n=this._getEndoRoots(this.p);t=(t=n[0].cmp(n[1])<0?n[0]:n[1]).toRed(this.red)}if(e.lambda)r=new BN$7(e.lambda,16);else{var i=this._getEndoRoots(this.n);0===this.g.mul(i[0]).x.cmp(this.g.x.redMul(t))?r=i[0]:(r=i[1],assert$d(0===this.g.mul(r).x.cmp(this.g.x.redMul(t))))}return{beta:t,lambda:r,basis:e.basis?e.basis.map((function(e){return{a:new BN$7(e.a,16),b:new BN$7(e.b,16)}})):this._getEndoBasis(r)}}},ShortCurve.prototype._getEndoRoots=function(e){var t=e===this.p?this.red:BN$7.mont(e),r=new BN$7(2).toRed(t).redInvm(),n=r.redNeg(),i=new BN$7(3).toRed(t).redNeg().redSqrt().redMul(r);return[n.redAdd(i).fromRed(),n.redSub(i).fromRed()]},ShortCurve.prototype._getEndoBasis=function(e){for(var t,r,n,i,s,o,a,u,c,l=this.n.ushrn(Math.floor(this.n.bitLength()/2)),h=e,d=this.n.clone(),f=new BN$7(1),p=new BN$7(0),y=new BN$7(0),g=new BN$7(1),$=0;0!==h.cmpn(0);){var m=d.div(h);u=d.sub(m.mul(h)),c=y.sub(m.mul(f));var b=g.sub(m.mul(p));if(!n&&u.cmp(l)<0)t=a.neg(),r=f,n=u.neg(),i=c;else if(n&&2==++$)break;a=u,d=h,h=u,y=f,f=c,g=p,p=b}s=u.neg(),o=c;var v=n.sqr().add(i.sqr());return s.sqr().add(o.sqr()).cmp(v)>=0&&(s=t,o=r),n.negative&&(n=n.neg(),i=i.neg()),s.negative&&(s=s.neg(),o=o.neg()),[{a:n,b:i},{a:s,b:o}]},ShortCurve.prototype._endoSplit=function(e){var t=this.endo.basis,r=t[0],n=t[1],i=n.b.mul(e).divRound(this.n),s=r.b.neg().mul(e).divRound(this.n),o=i.mul(r.a),a=s.mul(n.a),u=i.mul(r.b),c=s.mul(n.b);return{k1:e.sub(o).sub(a),k2:u.add(c).neg()}},ShortCurve.prototype.pointFromX=function(e,t){(e=new BN$7(e,16)).red||(e=e.toRed(this.red));var r=e.redSqr().redMul(e).redIAdd(e.redMul(this.a)).redIAdd(this.b),n=r.redSqrt();if(0!==n.redSqr().redSub(r).cmp(this.zero))throw new Error("invalid point");var i=n.fromRed().isOdd();return(t&&!i||!t&&i)&&(n=n.redNeg()),this.point(e,n)},ShortCurve.prototype.validate=function(e){if(e.inf)return!0;var t=e.x,r=e.y,n=this.a.redMul(t),i=t.redSqr().redMul(t).redIAdd(n).redIAdd(this.b);return 0===r.redSqr().redISub(i).cmpn(0)},ShortCurve.prototype._endoWnafMulAdd=function(e,t,r){for(var n=this._endoWnafT1,i=this._endoWnafT2,s=0;s<e.length;s++){var o=this._endoSplit(t[s]),a=e[s],u=a._getBeta();o.k1.negative&&(o.k1.ineg(),a=a.neg(!0)),o.k2.negative&&(o.k2.ineg(),u=u.neg(!0)),n[2*s]=a,n[2*s+1]=u,i[2*s]=o.k1,i[2*s+1]=o.k2}for(var c=this._wnafMulAdd(1,n,i,2*s,r),l=0;l<2*s;l++)n[l]=null,i[l]=null;return c},inherits$3(Point$2,Base$2.BasePoint),ShortCurve.prototype.point=function(e,t,r){return new Point$2(this,e,t,r)},ShortCurve.prototype.pointFromJSON=function(e,t){return Point$2.fromJSON(this,e,t)},Point$2.prototype._getBeta=function(){if(this.curve.endo){var e=this.precomputed;if(e&&e.beta)return e.beta;var t=this.curve.point(this.x.redMul(this.curve.endo.beta),this.y);if(e){var r=this.curve,n=function(e){return r.point(e.x.redMul(r.endo.beta),e.y)};e.beta=t,t.precomputed={beta:null,naf:e.naf&&{wnd:e.naf.wnd,points:e.naf.points.map(n)},doubles:e.doubles&&{step:e.doubles.step,points:e.doubles.points.map(n)}}}return t}},Point$2.prototype.toJSON=function(){return this.precomputed?[this.x,this.y,this.precomputed&&{doubles:this.precomputed.doubles&&{step:this.precomputed.doubles.step,points:this.precomputed.doubles.points.slice(1)},naf:this.precomputed.naf&&{wnd:this.precomputed.naf.wnd,points:this.precomputed.naf.points.slice(1)}}]:[this.x,this.y]},Point$2.fromJSON=function(e,t,r){"string"==typeof t&&(t=JSON.parse(t));var n=e.point(t[0],t[1],r);if(!t[2])return n;function i(t){return e.point(t[0],t[1],r)}var s=t[2];return n.precomputed={beta:null,doubles:s.doubles&&{step:s.doubles.step,points:[n].concat(s.doubles.points.map(i))},naf:s.naf&&{wnd:s.naf.wnd,points:[n].concat(s.naf.points.map(i))}},n},Point$2.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+">"},Point$2.prototype.isInfinity=function(){return this.inf},Point$2.prototype.add=function(e){if(this.inf)return e;if(e.inf)return this;if(this.eq(e))return this.dbl();if(this.neg().eq(e))return this.curve.point(null,null);if(0===this.x.cmp(e.x))return this.curve.point(null,null);var t=this.y.redSub(e.y);0!==t.cmpn(0)&&(t=t.redMul(this.x.redSub(e.x).redInvm()));var r=t.redSqr().redISub(this.x).redISub(e.x),n=t.redMul(this.x.redSub(r)).redISub(this.y);return this.curve.point(r,n)},Point$2.prototype.dbl=function(){if(this.inf)return this;var e=this.y.redAdd(this.y);if(0===e.cmpn(0))return this.curve.point(null,null);var t=this.curve.a,r=this.x.redSqr(),n=e.redInvm(),i=r.redAdd(r).redIAdd(r).redIAdd(t).redMul(n),s=i.redSqr().redISub(this.x.redAdd(this.x)),o=i.redMul(this.x.redSub(s)).redISub(this.y);return this.curve.point(s,o)},Point$2.prototype.getX=function(){return this.x.fromRed()},Point$2.prototype.getY=function(){return this.y.fromRed()},Point$2.prototype.mul=function(e){return e=new BN$7(e,16),this.isInfinity()?this:this._hasDoubles(e)?this.curve._fixedNafMul(this,e):this.curve.endo?this.curve._endoWnafMulAdd([this],[e]):this.curve._wnafMul(this,e)},Point$2.prototype.mulAdd=function(e,t,r){var n=[this,t],i=[e,r];return this.curve.endo?this.curve._endoWnafMulAdd(n,i):this.curve._wnafMulAdd(1,n,i,2)},Point$2.prototype.jmulAdd=function(e,t,r){var n=[this,t],i=[e,r];return this.curve.endo?this.curve._endoWnafMulAdd(n,i,!0):this.curve._wnafMulAdd(1,n,i,2,!0)},Point$2.prototype.eq=function(e){return this===e||this.inf===e.inf&&(this.inf||0===this.x.cmp(e.x)&&0===this.y.cmp(e.y))},Point$2.prototype.neg=function(e){if(this.inf)return this;var t=this.curve.point(this.x,this.y.redNeg());if(e&&this.precomputed){var r=this.precomputed,n=function(e){return e.neg()};t.precomputed={naf:r.naf&&{wnd:r.naf.wnd,points:r.naf.points.map(n)},doubles:r.doubles&&{step:r.doubles.step,points:r.doubles.points.map(n)}}}return t},Point$2.prototype.toJ=function(){return this.inf?this.curve.jpoint(null,null,null):this.curve.jpoint(this.x,this.y,this.curve.one)},inherits$3(JPoint,Base$2.BasePoint),ShortCurve.prototype.jpoint=function(e,t,r){return new JPoint(this,e,t,r)},JPoint.prototype.toP=function(){if(this.isInfinity())return this.curve.point(null,null);var e=this.z.redInvm(),t=e.redSqr(),r=this.x.redMul(t),n=this.y.redMul(t).redMul(e);return this.curve.point(r,n)},JPoint.prototype.neg=function(){return this.curve.jpoint(this.x,this.y.redNeg(),this.z)},JPoint.prototype.add=function(e){if(this.isInfinity())return e;if(e.isInfinity())return this;var t=e.z.redSqr(),r=this.z.redSqr(),n=this.x.redMul(t),i=e.x.redMul(r),s=this.y.redMul(t.redMul(e.z)),o=e.y.redMul(r.redMul(this.z)),a=n.redSub(i),u=s.redSub(o);if(0===a.cmpn(0))return 0!==u.cmpn(0)?this.curve.jpoint(null,null,null):this.dbl();var c=a.redSqr(),l=c.redMul(a),h=n.redMul(c),d=u.redSqr().redIAdd(l).redISub(h).redISub(h),f=u.redMul(h.redISub(d)).redISub(s.redMul(l)),p=this.z.redMul(e.z).redMul(a);return this.curve.jpoint(d,f,p)},JPoint.prototype.mixedAdd=function(e){if(this.isInfinity())return e.toJ();if(e.isInfinity())return this;var t=this.z.redSqr(),r=this.x,n=e.x.redMul(t),i=this.y,s=e.y.redMul(t).redMul(this.z),o=r.redSub(n),a=i.redSub(s);if(0===o.cmpn(0))return 0!==a.cmpn(0)?this.curve.jpoint(null,null,null):this.dbl();var u=o.redSqr(),c=u.redMul(o),l=r.redMul(u),h=a.redSqr().redIAdd(c).redISub(l).redISub(l),d=a.redMul(l.redISub(h)).redISub(i.redMul(c)),f=this.z.redMul(o);return this.curve.jpoint(h,d,f)},JPoint.prototype.dblp=function(e){if(0===e)return this;if(this.isInfinity())return this;if(!e)return this.dbl();var t;if(this.curve.zeroA||this.curve.threeA){var r=this;for(t=0;t<e;t++)r=r.dbl();return r}var n=this.curve.a,i=this.curve.tinv,s=this.x,o=this.y,a=this.z,u=a.redSqr().redSqr(),c=o.redAdd(o);for(t=0;t<e;t++){var l=s.redSqr(),h=c.redSqr(),d=h.redSqr(),f=l.redAdd(l).redIAdd(l).redIAdd(n.redMul(u)),p=s.redMul(h),y=f.redSqr().redISub(p.redAdd(p)),g=p.redISub(y),$=f.redMul(g);$=$.redIAdd($).redISub(d);var m=c.redMul(a);t+1<e&&(u=u.redMul(d)),s=y,a=m,c=$}return this.curve.jpoint(s,c.redMul(i),a)},JPoint.prototype.dbl=function(){return this.isInfinity()?this:this.curve.zeroA?this._zeroDbl():this.curve.threeA?this._threeDbl():this._dbl()},JPoint.prototype._zeroDbl=function(){var e,t,r;if(this.zOne){var n=this.x.redSqr(),i=this.y.redSqr(),s=i.redSqr(),o=this.x.redAdd(i).redSqr().redISub(n).redISub(s);o=o.redIAdd(o);var a=n.redAdd(n).redIAdd(n),u=a.redSqr().redISub(o).redISub(o),c=s.redIAdd(s);c=(c=c.redIAdd(c)).redIAdd(c),e=u,t=a.redMul(o.redISub(u)).redISub(c),r=this.y.redAdd(this.y)}else{var l=this.x.redSqr(),h=this.y.redSqr(),d=h.redSqr(),f=this.x.redAdd(h).redSqr().redISub(l).redISub(d);f=f.redIAdd(f);var p=l.redAdd(l).redIAdd(l),y=p.redSqr(),g=d.redIAdd(d);g=(g=g.redIAdd(g)).redIAdd(g),e=y.redISub(f).redISub(f),t=p.redMul(f.redISub(e)).redISub(g),r=(r=this.y.redMul(this.z)).redIAdd(r)}return this.curve.jpoint(e,t,r)},JPoint.prototype._threeDbl=function(){var e,t,r;if(this.zOne){var n=this.x.redSqr(),i=this.y.redSqr(),s=i.redSqr(),o=this.x.redAdd(i).redSqr().redISub(n).redISub(s);o=o.redIAdd(o);var a=n.redAdd(n).redIAdd(n).redIAdd(this.curve.a),u=a.redSqr().redISub(o).redISub(o);e=u;var c=s.redIAdd(s);c=(c=c.redIAdd(c)).redIAdd(c),t=a.redMul(o.redISub(u)).redISub(c),r=this.y.redAdd(this.y)}else{var l=this.z.redSqr(),h=this.y.redSqr(),d=this.x.redMul(h),f=this.x.redSub(l).redMul(this.x.redAdd(l));f=f.redAdd(f).redIAdd(f);var p=d.redIAdd(d),y=(p=p.redIAdd(p)).redAdd(p);e=f.redSqr().redISub(y),r=this.y.redAdd(this.z).redSqr().redISub(h).redISub(l);var g=h.redSqr();g=(g=(g=g.redIAdd(g)).redIAdd(g)).redIAdd(g),t=f.redMul(p.redISub(e)).redISub(g)}return this.curve.jpoint(e,t,r)},JPoint.prototype._dbl=function(){var e=this.curve.a,t=this.x,r=this.y,n=this.z,i=n.redSqr().redSqr(),s=t.redSqr(),o=r.redSqr(),a=s.redAdd(s).redIAdd(s).redIAdd(e.redMul(i)),u=t.redAdd(t),c=(u=u.redIAdd(u)).redMul(o),l=a.redSqr().redISub(c.redAdd(c)),h=c.redISub(l),d=o.redSqr();d=(d=(d=d.redIAdd(d)).redIAdd(d)).redIAdd(d);var f=a.redMul(h).redISub(d),p=r.redAdd(r).redMul(n);return this.curve.jpoint(l,f,p)},JPoint.prototype.trpl=function(){if(!this.curve.zeroA)return this.dbl().add(this);var e=this.x.redSqr(),t=this.y.redSqr(),r=this.z.redSqr(),n=t.redSqr(),i=e.redAdd(e).redIAdd(e),s=i.redSqr(),o=this.x.redAdd(t).redSqr().redISub(e).redISub(n),a=(o=(o=(o=o.redIAdd(o)).redAdd(o).redIAdd(o)).redISub(s)).redSqr(),u=n.redIAdd(n);u=(u=(u=u.redIAdd(u)).redIAdd(u)).redIAdd(u);var c=i.redIAdd(o).redSqr().redISub(s).redISub(a).redISub(u),l=t.redMul(c);l=(l=l.redIAdd(l)).redIAdd(l);var h=this.x.redMul(a).redISub(l);h=(h=h.redIAdd(h)).redIAdd(h);var d=this.y.redMul(c.redMul(u.redISub(c)).redISub(o.redMul(a)));d=(d=(d=d.redIAdd(d)).redIAdd(d)).redIAdd(d);var f=this.z.redAdd(o).redSqr().redISub(r).redISub(a);return this.curve.jpoint(h,d,f)},JPoint.prototype.mul=function(e,t){return e=new BN$7(e,t),this.curve._wnafMul(this,e)},JPoint.prototype.eq=function(e){if("affine"===e.type)return this.eq(e.toJ());if(this===e)return!0;var t=this.z.redSqr(),r=e.z.redSqr();if(0!==this.x.redMul(r).redISub(e.x.redMul(t)).cmpn(0))return!1;var n=t.redMul(this.z),i=r.redMul(e.z);return 0===this.y.redMul(i).redISub(e.y.redMul(n)).cmpn(0)},JPoint.prototype.eqXToP=function(e){var t=this.z.redSqr(),r=e.toRed(this.curve.red).redMul(t);if(0===this.x.cmp(r))return!0;for(var n=e.clone(),i=this.curve.redN.redMul(t);;){if(n.iadd(this.curve.n),n.cmp(this.curve.p)>=0)return!1;if(r.redIAdd(i),0===this.x.cmp(r))return!0}},JPoint.prototype.inspect=function(){return this.isInfinity()?"<EC JPoint Infinity>":"<EC JPoint x: "+this.x.toString(16,2)+" y: "+this.y.toString(16,2)+" z: "+this.z.toString(16,2)+">"},JPoint.prototype.isInfinity=function(){return 0===this.z.cmpn(0)};var BN$6=bn.exports,inherits$2=require$$1$3,Base$1=base,utils$l=utils$p;function MontCurve(e){Base$1.call(this,"mont",e),this.a=new BN$6(e.a,16).toRed(this.red),this.b=new BN$6(e.b,16).toRed(this.red),this.i4=new BN$6(4).toRed(this.red).redInvm(),this.two=new BN$6(2).toRed(this.red),this.a24=this.i4.redMul(this.a.redAdd(this.two))}inherits$2(MontCurve,Base$1);var mont=MontCurve;function Point$1(e,t,r){Base$1.BasePoint.call(this,e,"projective"),null===t&&null===r?(this.x=this.curve.one,this.z=this.curve.zero):(this.x=new BN$6(t,16),this.z=new BN$6(r,16),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)))}MontCurve.prototype.validate=function(e){var t=e.normalize().x,r=t.redSqr(),n=r.redMul(t).redAdd(r.redMul(this.a)).redAdd(t);return 0===n.redSqrt().redSqr().cmp(n)},inherits$2(Point$1,Base$1.BasePoint),MontCurve.prototype.decodePoint=function(e,t){return this.point(utils$l.toArray(e,t),1)},MontCurve.prototype.point=function(e,t){return new Point$1(this,e,t)},MontCurve.prototype.pointFromJSON=function(e){return Point$1.fromJSON(this,e)},Point$1.prototype.precompute=function(){},Point$1.prototype._encode=function(){return this.getX().toArray("be",this.curve.p.byteLength())},Point$1.fromJSON=function(e,t){return new Point$1(e,t[0],t[1]||e.one)},Point$1.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"},Point$1.prototype.isInfinity=function(){return 0===this.z.cmpn(0)},Point$1.prototype.dbl=function(){var e=this.x.redAdd(this.z).redSqr(),t=this.x.redSub(this.z).redSqr(),r=e.redSub(t),n=e.redMul(t),i=r.redMul(t.redAdd(this.curve.a24.redMul(r)));return this.curve.point(n,i)},Point$1.prototype.add=function(){throw new Error("Not supported on Montgomery curve")},Point$1.prototype.diffAdd=function(e,t){var r=this.x.redAdd(this.z),n=this.x.redSub(this.z),i=e.x.redAdd(e.z),s=e.x.redSub(e.z).redMul(r),o=i.redMul(n),a=t.z.redMul(s.redAdd(o).redSqr()),u=t.x.redMul(s.redISub(o).redSqr());return this.curve.point(a,u)},Point$1.prototype.mul=function(e){for(var t=e.clone(),r=this,n=this.curve.point(null,null),i=[];0!==t.cmpn(0);t.iushrn(1))i.push(t.andln(1));for(var s=i.length-1;s>=0;s--)0===i[s]?(r=r.diffAdd(n,this),n=n.dbl()):(n=r.diffAdd(n,this),r=r.dbl());return n},Point$1.prototype.mulAdd=function(){throw new Error("Not supported on Montgomery curve")},Point$1.prototype.jumlAdd=function(){throw new Error("Not supported on Montgomery curve")},Point$1.prototype.eq=function(e){return 0===this.getX().cmp(e.getX())},Point$1.prototype.normalize=function(){return this.x=this.x.redMul(this.z.redInvm()),this.z=this.curve.one,this},Point$1.prototype.getX=function(){return this.normalize(),this.x.fromRed()};var utils$k=utils$p,BN$5=bn.exports,inherits$1=require$$1$3,Base=base,assert$c=utils$k.assert;function EdwardsCurve(e){this.twisted=1!=(0|e.a),this.mOneA=this.twisted&&-1==(0|e.a),this.extended=this.mOneA,Base.call(this,"edwards",e),this.a=new BN$5(e.a,16).umod(this.red.m),this.a=this.a.toRed(this.red),this.c=new BN$5(e.c,16).toRed(this.red),this.c2=this.c.redSqr(),this.d=new BN$5(e.d,16).toRed(this.red),this.dd=this.d.redAdd(this.d),assert$c(!this.twisted||0===this.c.fromRed().cmpn(1)),this.oneC=1==(0|e.c)}inherits$1(EdwardsCurve,Base);var edwards=EdwardsCurve;function Point(e,t,r,n,i){Base.BasePoint.call(this,e,"projective"),null===t&&null===r&&null===n?(this.x=this.curve.zero,this.y=this.curve.one,this.z=this.curve.one,this.t=this.curve.zero,this.zOne=!0):(this.x=new BN$5(t,16),this.y=new BN$5(r,16),this.z=n?new BN$5(n,16):this.curve.one,this.t=i&&new BN$5(i,16),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.t&&!this.t.red&&(this.t=this.t.toRed(this.curve.red)),this.zOne=this.z===this.curve.one,this.curve.extended&&!this.t&&(this.t=this.x.redMul(this.y),this.zOne||(this.t=this.t.redMul(this.z.redInvm()))))}EdwardsCurve.prototype._mulA=function(e){return this.mOneA?e.redNeg():this.a.redMul(e)},EdwardsCurve.prototype._mulC=function(e){return this.oneC?e:this.c.redMul(e)},EdwardsCurve.prototype.jpoint=function(e,t,r,n){return this.point(e,t,r,n)},EdwardsCurve.prototype.pointFromX=function(e,t){(e=new BN$5(e,16)).red||(e=e.toRed(this.red));var r=e.redSqr(),n=this.c2.redSub(this.a.redMul(r)),i=this.one.redSub(this.c2.redMul(this.d).redMul(r)),s=n.redMul(i.redInvm()),o=s.redSqrt();if(0!==o.redSqr().redSub(s).cmp(this.zero))throw new Error("invalid point");var a=o.fromRed().isOdd();return(t&&!a||!t&&a)&&(o=o.redNeg()),this.point(e,o)},EdwardsCurve.prototype.pointFromY=function(e,t){(e=new BN$5(e,16)).red||(e=e.toRed(this.red));var r=e.redSqr(),n=r.redSub(this.c2),i=r.redMul(this.d).redMul(this.c2).redSub(this.a),s=n.redMul(i.redInvm());if(0===s.cmp(this.zero)){if(t)throw new Error("invalid point");return this.point(this.zero,e)}var o=s.redSqrt();if(0!==o.redSqr().redSub(s).cmp(this.zero))throw new Error("invalid point");return o.fromRed().isOdd()!==t&&(o=o.redNeg()),this.point(o,e)},EdwardsCurve.prototype.validate=function(e){if(e.isInfinity())return!0;e.normalize();var t=e.x.redSqr(),r=e.y.redSqr(),n=t.redMul(this.a).redAdd(r),i=this.c2.redMul(this.one.redAdd(this.d.redMul(t).redMul(r)));return 0===n.cmp(i)},inherits$1(Point,Base.BasePoint),EdwardsCurve.prototype.pointFromJSON=function(e){return Point.fromJSON(this,e)},EdwardsCurve.prototype.point=function(e,t,r,n){return new Point(this,e,t,r,n)},Point.fromJSON=function(e,t){return new Point(e,t[0],t[1],t[2])},Point.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"},Point.prototype.isInfinity=function(){return 0===this.x.cmpn(0)&&(0===this.y.cmp(this.z)||this.zOne&&0===this.y.cmp(this.curve.c))},Point.prototype._extDbl=function(){var e=this.x.redSqr(),t=this.y.redSqr(),r=this.z.redSqr();r=r.redIAdd(r);var n=this.curve._mulA(e),i=this.x.redAdd(this.y).redSqr().redISub(e).redISub(t),s=n.redAdd(t),o=s.redSub(r),a=n.redSub(t),u=i.redMul(o),c=s.redMul(a),l=i.redMul(a),h=o.redMul(s);return this.curve.point(u,c,h,l)},Point.prototype._projDbl=function(){var e,t,r,n,i,s,o=this.x.redAdd(this.y).redSqr(),a=this.x.redSqr(),u=this.y.redSqr();if(this.curve.twisted){var c=(n=this.curve._mulA(a)).redAdd(u);this.zOne?(e=o.redSub(a).redSub(u).redMul(c.redSub(this.curve.two)),t=c.redMul(n.redSub(u)),r=c.redSqr().redSub(c).redSub(c)):(i=this.z.redSqr(),s=c.redSub(i).redISub(i),e=o.redSub(a).redISub(u).redMul(s),t=c.redMul(n.redSub(u)),r=c.redMul(s))}else n=a.redAdd(u),i=this.curve._mulC(this.z).redSqr(),s=n.redSub(i).redSub(i),e=this.curve._mulC(o.redISub(n)).redMul(s),t=this.curve._mulC(n).redMul(a.redISub(u)),r=n.redMul(s);return this.curve.point(e,t,r)},Point.prototype.dbl=function(){return this.isInfinity()?this:this.curve.extended?this._extDbl():this._projDbl()},Point.prototype._extAdd=function(e){var t=this.y.redSub(this.x).redMul(e.y.redSub(e.x)),r=this.y.redAdd(this.x).redMul(e.y.redAdd(e.x)),n=this.t.redMul(this.curve.dd).redMul(e.t),i=this.z.redMul(e.z.redAdd(e.z)),s=r.redSub(t),o=i.redSub(n),a=i.redAdd(n),u=r.redAdd(t),c=s.redMul(o),l=a.redMul(u),h=s.redMul(u),d=o.redMul(a);return this.curve.point(c,l,d,h)},Point.prototype._projAdd=function(e){var t,r,n=this.z.redMul(e.z),i=n.redSqr(),s=this.x.redMul(e.x),o=this.y.redMul(e.y),a=this.curve.d.redMul(s).redMul(o),u=i.redSub(a),c=i.redAdd(a),l=this.x.redAdd(this.y).redMul(e.x.redAdd(e.y)).redISub(s).redISub(o),h=n.redMul(u).redMul(l);return this.curve.twisted?(t=n.redMul(c).redMul(o.redSub(this.curve._mulA(s))),r=u.redMul(c)):(t=n.redMul(c).redMul(o.redSub(s)),r=this.curve._mulC(u).redMul(c)),this.curve.point(h,t,r)},Point.prototype.add=function(e){return this.isInfinity()?e:e.isInfinity()?this:this.curve.extended?this._extAdd(e):this._projAdd(e)},Point.prototype.mul=function(e){return this._hasDoubles(e)?this.curve._fixedNafMul(this,e):this.curve._wnafMul(this,e)},Point.prototype.mulAdd=function(e,t,r){return this.curve._wnafMulAdd(1,[this,t],[e,r],2,!1)},Point.prototype.jmulAdd=function(e,t,r){return this.curve._wnafMulAdd(1,[this,t],[e,r],2,!0)},Point.prototype.normalize=function(){if(this.zOne)return this;var e=this.z.redInvm();return this.x=this.x.redMul(e),this.y=this.y.redMul(e),this.t&&(this.t=this.t.redMul(e)),this.z=this.curve.one,this.zOne=!0,this},Point.prototype.neg=function(){return this.curve.point(this.x.redNeg(),this.y,this.z,this.t&&this.t.redNeg())},Point.prototype.getX=function(){return this.normalize(),this.x.fromRed()},Point.prototype.getY=function(){return this.normalize(),this.y.fromRed()},Point.prototype.eq=function(e){return this===e||0===this.getX().cmp(e.getX())&&0===this.getY().cmp(e.getY())},Point.prototype.eqXToP=function(e){var t=e.toRed(this.curve.red).redMul(this.z);if(0===this.x.cmp(t))return!0;for(var r=e.clone(),n=this.curve.redN.redMul(this.z);;){if(r.iadd(this.curve.n),r.cmp(this.curve.p)>=0)return!1;if(t.redIAdd(n),0===this.x.cmp(t))return!0}},Point.prototype.toP=Point.prototype.normalize,Point.prototype.mixedAdd=Point.prototype.add,function(e){var t=e;t.base=base,t.short=short,t.mont=mont,t.edwards=edwards}(curve);var curves$2={},hash$2={},utils$j={},assert$b=minimalisticAssert,inherits=require$$1$3;function isSurrogatePair(e,t){return 55296==(64512&e.charCodeAt(t))&&(!(t<0||t+1>=e.length)&&56320==(64512&e.charCodeAt(t+1)))}function toArray(e,t){if(Array.isArray(e))return e.slice();if(!e)return[];var r=[];if("string"==typeof e)if(t){if("hex"===t)for((e=e.replace(/[^a-z0-9]+/gi,"")).length%2!=0&&(e="0"+e),i=0;i<e.length;i+=2)r.push(parseInt(e[i]+e[i+1],16))}else for(var n=0,i=0;i<e.length;i++){var s=e.charCodeAt(i);s<128?r[n++]=s:s<2048?(r[n++]=s>>6|192,r[n++]=63&s|128):isSurrogatePair(e,i)?(s=65536+((1023&s)<<10)+(1023&e.charCodeAt(++i)),r[n++]=s>>18|240,r[n++]=s>>12&63|128,r[n++]=s>>6&63|128,r[n++]=63&s|128):(r[n++]=s>>12|224,r[n++]=s>>6&63|128,r[n++]=63&s|128)}else for(i=0;i<e.length;i++)r[i]=0|e[i];return r}function toHex(e){for(var t="",r=0;r<e.length;r++)t+=zero2(e[r].toString(16));return t}function htonl(e){return(e>>>24|e>>>8&65280|e<<8&16711680|(255&e)<<24)>>>0}function toHex32(e,t){for(var r="",n=0;n<e.length;n++){var i=e[n];"little"===t&&(i=htonl(i)),r+=zero8(i.toString(16))}return r}function zero2(e){return 1===e.length?"0"+e:e}function zero8(e){return 7===e.length?"0"+e:6===e.length?"00"+e:5===e.length?"000"+e:4===e.length?"0000"+e:3===e.length?"00000"+e:2===e.length?"000000"+e:1===e.length?"0000000"+e:e}function join32(e,t,r,n){var i=r-t;assert$b(i%4==0);for(var s=new Array(i/4),o=0,a=t;o<s.length;o++,a+=4){var u;u="big"===n?e[a]<<24|e[a+1]<<16|e[a+2]<<8|e[a+3]:e[a+3]<<24|e[a+2]<<16|e[a+1]<<8|e[a],s[o]=u>>>0}return s}function split32(e,t){for(var r=new Array(4*e.length),n=0,i=0;n<e.length;n++,i+=4){var s=e[n];"big"===t?(r[i]=s>>>24,r[i+1]=s>>>16&255,r[i+2]=s>>>8&255,r[i+3]=255&s):(r[i+3]=s>>>24,r[i+2]=s>>>16&255,r[i+1]=s>>>8&255,r[i]=255&s)}return r}function rotr32$1(e,t){return e>>>t|e<<32-t}function rotl32$2(e,t){return e<<t|e>>>32-t}function sum32$3(e,t){return e+t>>>0}function sum32_3$1(e,t,r){return e+t+r>>>0}function sum32_4$2(e,t,r,n){return e+t+r+n>>>0}function sum32_5$2(e,t,r,n,i){return e+t+r+n+i>>>0}function sum64$1(e,t,r,n){var i=e[t],s=n+e[t+1]>>>0,o=(s<n?1:0)+r+i;e[t]=o>>>0,e[t+1]=s}function sum64_hi$1(e,t,r,n){return(t+n>>>0<t?1:0)+e+r>>>0}function sum64_lo$1(e,t,r,n){return t+n>>>0}function sum64_4_hi$1(e,t,r,n,i,s,o,a){var u=0,c=t;return u+=(c=c+n>>>0)<t?1:0,u+=(c=c+s>>>0)<s?1:0,e+r+i+o+(u+=(c=c+a>>>0)<a?1:0)>>>0}function sum64_4_lo$1(e,t,r,n,i,s,o,a){return t+n+s+a>>>0}function sum64_5_hi$1(e,t,r,n,i,s,o,a,u,c){var l=0,h=t;return l+=(h=h+n>>>0)<t?1:0,l+=(h=h+s>>>0)<s?1:0,l+=(h=h+a>>>0)<a?1:0,e+r+i+o+u+(l+=(h=h+c>>>0)<c?1:0)>>>0}function sum64_5_lo$1(e,t,r,n,i,s,o,a,u,c){return t+n+s+a+c>>>0}function rotr64_hi$1(e,t,r){return(t<<32-r|e>>>r)>>>0}function rotr64_lo$1(e,t,r){return(e<<32-r|t>>>r)>>>0}function shr64_hi$1(e,t,r){return e>>>r}function shr64_lo$1(e,t,r){return(e<<32-r|t>>>r)>>>0}utils$j.inherits=inherits,utils$j.toArray=toArray,utils$j.toHex=toHex,utils$j.htonl=htonl,utils$j.toHex32=toHex32,utils$j.zero2=zero2,utils$j.zero8=zero8,utils$j.join32=join32,utils$j.split32=split32,utils$j.rotr32=rotr32$1,utils$j.rotl32=rotl32$2,utils$j.sum32=sum32$3,utils$j.sum32_3=sum32_3$1,utils$j.sum32_4=sum32_4$2,utils$j.sum32_5=sum32_5$2,utils$j.sum64=sum64$1,utils$j.sum64_hi=sum64_hi$1,utils$j.sum64_lo=sum64_lo$1,utils$j.sum64_4_hi=sum64_4_hi$1,utils$j.sum64_4_lo=sum64_4_lo$1,utils$j.sum64_5_hi=sum64_5_hi$1,utils$j.sum64_5_lo=sum64_5_lo$1,utils$j.rotr64_hi=rotr64_hi$1,utils$j.rotr64_lo=rotr64_lo$1,utils$j.shr64_hi=shr64_hi$1,utils$j.shr64_lo=shr64_lo$1;var common$5={},utils$i=utils$j,assert$a=minimalisticAssert;function BlockHash$4(){this.pending=null,this.pendingTotal=0,this.blockSize=this.constructor.blockSize,this.outSize=this.constructor.outSize,this.hmacStrength=this.constructor.hmacStrength,this.padLength=this.constructor.padLength/8,this.endian="big",this._delta8=this.blockSize/8,this._delta32=this.blockSize/32}common$5.BlockHash=BlockHash$4,BlockHash$4.prototype.update=function(e,t){if(e=utils$i.toArray(e,t),this.pending?this.pending=this.pending.concat(e):this.pending=e,this.pendingTotal+=e.length,this.pending.length>=this._delta8){var r=(e=this.pending).length%this._delta8;this.pending=e.slice(e.length-r,e.length),0===this.pending.length&&(this.pending=null),e=utils$i.join32(e,0,e.length-r,this.endian);for(var n=0;n<e.length;n+=this._delta32)this._update(e,n,n+this._delta32)}return this},BlockHash$4.prototype.digest=function(e){return this.update(this._pad()),assert$a(null===this.pending),this._digest(e)},BlockHash$4.prototype._pad=function(){var e=this.pendingTotal,t=this._delta8,r=t-(e+this.padLength)%t,n=new Array(r+this.padLength);n[0]=128;for(var i=1;i<r;i++)n[i]=0;if(e<<=3,"big"===this.endian){for(var s=8;s<this.padLength;s++)n[i++]=0;n[i++]=0,n[i++]=0,n[i++]=0,n[i++]=0,n[i++]=e>>>24&255,n[i++]=e>>>16&255,n[i++]=e>>>8&255,n[i++]=255&e}else for(n[i++]=255&e,n[i++]=e>>>8&255,n[i++]=e>>>16&255,n[i++]=e>>>24&255,n[i++]=0,n[i++]=0,n[i++]=0,n[i++]=0,s=8;s<this.padLength;s++)n[i++]=0;return n};var sha={},common$4={},utils$h=utils$j,rotr32=utils$h.rotr32;function ft_1$1(e,t,r,n){return 0===e?ch32$1(t,r,n):1===e||3===e?p32(t,r,n):2===e?maj32$1(t,r,n):void 0}function ch32$1(e,t,r){return e&t^~e&r}function maj32$1(e,t,r){return e&t^e&r^t&r}function p32(e,t,r){return e^t^r}function s0_256$1(e){return rotr32(e,2)^rotr32(e,13)^rotr32(e,22)}function s1_256$1(e){return rotr32(e,6)^rotr32(e,11)^rotr32(e,25)}function g0_256$1(e){return rotr32(e,7)^rotr32(e,18)^e>>>3}function g1_256$1(e){return rotr32(e,17)^rotr32(e,19)^e>>>10}common$4.ft_1=ft_1$1,common$4.ch32=ch32$1,common$4.maj32=maj32$1,common$4.p32=p32,common$4.s0_256=s0_256$1,common$4.s1_256=s1_256$1,common$4.g0_256=g0_256$1,common$4.g1_256=g1_256$1;var utils$g=utils$j,common$3=common$5,shaCommon$1=common$4,rotl32$1=utils$g.rotl32,sum32$2=utils$g.sum32,sum32_5$1=utils$g.sum32_5,ft_1=shaCommon$1.ft_1,BlockHash$3=common$3.BlockHash,sha1_K=[1518500249,1859775393,2400959708,3395469782];function SHA1(){if(!(this instanceof SHA1))return new SHA1;BlockHash$3.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.W=new Array(80)}utils$g.inherits(SHA1,BlockHash$3);var _1=SHA1;SHA1.blockSize=512,SHA1.outSize=160,SHA1.hmacStrength=80,SHA1.padLength=64,SHA1.prototype._update=function(e,t){for(var r=this.W,n=0;n<16;n++)r[n]=e[t+n];for(;n<r.length;n++)r[n]=rotl32$1(r[n-3]^r[n-8]^r[n-14]^r[n-16],1);var i=this.h[0],s=this.h[1],o=this.h[2],a=this.h[3],u=this.h[4];for(n=0;n<r.length;n++){var c=~~(n/20),l=sum32_5$1(rotl32$1(i,5),ft_1(c,s,o,a),u,r[n],sha1_K[c]);u=a,a=o,o=rotl32$1(s,30),s=i,i=l}this.h[0]=sum32$2(this.h[0],i),this.h[1]=sum32$2(this.h[1],s),this.h[2]=sum32$2(this.h[2],o),this.h[3]=sum32$2(this.h[3],a),this.h[4]=sum32$2(this.h[4],u)},SHA1.prototype._digest=function(e){return"hex"===e?utils$g.toHex32(this.h,"big"):utils$g.split32(this.h,"big")};var utils$f=utils$j,common$2=common$5,shaCommon=common$4,assert$9=minimalisticAssert,sum32$1=utils$f.sum32,sum32_4$1=utils$f.sum32_4,sum32_5=utils$f.sum32_5,ch32=shaCommon.ch32,maj32=shaCommon.maj32,s0_256=shaCommon.s0_256,s1_256=shaCommon.s1_256,g0_256=shaCommon.g0_256,g1_256=shaCommon.g1_256,BlockHash$2=common$2.BlockHash,sha256_K=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function SHA256$1(){if(!(this instanceof SHA256$1))return new SHA256$1;BlockHash$2.call(this),this.h=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],this.k=sha256_K,this.W=new Array(64)}utils$f.inherits(SHA256$1,BlockHash$2);var _256=SHA256$1;SHA256$1.blockSize=512,SHA256$1.outSize=256,SHA256$1.hmacStrength=192,SHA256$1.padLength=64,SHA256$1.prototype._update=function(e,t){for(var r=this.W,n=0;n<16;n++)r[n]=e[t+n];for(;n<r.length;n++)r[n]=sum32_4$1(g1_256(r[n-2]),r[n-7],g0_256(r[n-15]),r[n-16]);var i=this.h[0],s=this.h[1],o=this.h[2],a=this.h[3],u=this.h[4],c=this.h[5],l=this.h[6],h=this.h[7];for(assert$9(this.k.length===r.length),n=0;n<r.length;n++){var d=sum32_5(h,s1_256(u),ch32(u,c,l),this.k[n],r[n]),f=sum32$1(s0_256(i),maj32(i,s,o));h=l,l=c,c=u,u=sum32$1(a,d),a=o,o=s,s=i,i=sum32$1(d,f)}this.h[0]=sum32$1(this.h[0],i),this.h[1]=sum32$1(this.h[1],s),this.h[2]=sum32$1(this.h[2],o),this.h[3]=sum32$1(this.h[3],a),this.h[4]=sum32$1(this.h[4],u),this.h[5]=sum32$1(this.h[5],c),this.h[6]=sum32$1(this.h[6],l),this.h[7]=sum32$1(this.h[7],h)},SHA256$1.prototype._digest=function(e){return"hex"===e?utils$f.toHex32(this.h,"big"):utils$f.split32(this.h,"big")};var utils$e=utils$j,SHA256=_256;function SHA224(){if(!(this instanceof SHA224))return new SHA224;SHA256.call(this),this.h=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]}utils$e.inherits(SHA224,SHA256);var _224=SHA224;SHA224.blockSize=512,SHA224.outSize=224,SHA224.hmacStrength=192,SHA224.padLength=64,SHA224.prototype._digest=function(e){return"hex"===e?utils$e.toHex32(this.h.slice(0,7),"big"):utils$e.split32(this.h.slice(0,7),"big")};var utils$d=utils$j,common$1=common$5,assert$8=minimalisticAssert,rotr64_hi=utils$d.rotr64_hi,rotr64_lo=utils$d.rotr64_lo,shr64_hi=utils$d.shr64_hi,shr64_lo=utils$d.shr64_lo,sum64=utils$d.sum64,sum64_hi=utils$d.sum64_hi,sum64_lo=utils$d.sum64_lo,sum64_4_hi=utils$d.sum64_4_hi,sum64_4_lo=utils$d.sum64_4_lo,sum64_5_hi=utils$d.sum64_5_hi,sum64_5_lo=utils$d.sum64_5_lo,BlockHash$1=common$1.BlockHash,sha512_K=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function SHA512$1(){if(!(this instanceof SHA512$1))return new SHA512$1;BlockHash$1.call(this),this.h=[1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209],this.k=sha512_K,this.W=new Array(160)}utils$d.inherits(SHA512$1,BlockHash$1);var _512=SHA512$1;function ch64_hi(e,t,r,n,i){var s=e&r^~e&i;return s<0&&(s+=4294967296),s}function ch64_lo(e,t,r,n,i,s){var o=t&n^~t&s;return o<0&&(o+=4294967296),o}function maj64_hi(e,t,r,n,i){var s=e&r^e&i^r&i;return s<0&&(s+=4294967296),s}function maj64_lo(e,t,r,n,i,s){var o=t&n^t&s^n&s;return o<0&&(o+=4294967296),o}function s0_512_hi(e,t){var r=rotr64_hi(e,t,28)^rotr64_hi(t,e,2)^rotr64_hi(t,e,7);return r<0&&(r+=4294967296),r}function s0_512_lo(e,t){var r=rotr64_lo(e,t,28)^rotr64_lo(t,e,2)^rotr64_lo(t,e,7);return r<0&&(r+=4294967296),r}function s1_512_hi(e,t){var r=rotr64_hi(e,t,14)^rotr64_hi(e,t,18)^rotr64_hi(t,e,9);return r<0&&(r+=4294967296),r}function s1_512_lo(e,t){var r=rotr64_lo(e,t,14)^rotr64_lo(e,t,18)^rotr64_lo(t,e,9);return r<0&&(r+=4294967296),r}function g0_512_hi(e,t){var r=rotr64_hi(e,t,1)^rotr64_hi(e,t,8)^shr64_hi(e,t,7);return r<0&&(r+=4294967296),r}function g0_512_lo(e,t){var r=rotr64_lo(e,t,1)^rotr64_lo(e,t,8)^shr64_lo(e,t,7);return r<0&&(r+=4294967296),r}function g1_512_hi(e,t){var r=rotr64_hi(e,t,19)^rotr64_hi(t,e,29)^shr64_hi(e,t,6);return r<0&&(r+=4294967296),r}function g1_512_lo(e,t){var r=rotr64_lo(e,t,19)^rotr64_lo(t,e,29)^shr64_lo(e,t,6);return r<0&&(r+=4294967296),r}SHA512$1.blockSize=1024,SHA512$1.outSize=512,SHA512$1.hmacStrength=192,SHA512$1.padLength=128,SHA512$1.prototype._prepareBlock=function(e,t){for(var r=this.W,n=0;n<32;n++)r[n]=e[t+n];for(;n<r.length;n+=2){var i=g1_512_hi(r[n-4],r[n-3]),s=g1_512_lo(r[n-4],r[n-3]),o=r[n-14],a=r[n-13],u=g0_512_hi(r[n-30],r[n-29]),c=g0_512_lo(r[n-30],r[n-29]),l=r[n-32],h=r[n-31];r[n]=sum64_4_hi(i,s,o,a,u,c,l,h),r[n+1]=sum64_4_lo(i,s,o,a,u,c,l,h)}},SHA512$1.prototype._update=function(e,t){this._prepareBlock(e,t);var r=this.W,n=this.h[0],i=this.h[1],s=this.h[2],o=this.h[3],a=this.h[4],u=this.h[5],c=this.h[6],l=this.h[7],h=this.h[8],d=this.h[9],f=this.h[10],p=this.h[11],y=this.h[12],g=this.h[13],$=this.h[14],m=this.h[15];assert$8(this.k.length===r.length);for(var b=0;b<r.length;b+=2){var v=$,_=m,w=s1_512_hi(h,d),E=s1_512_lo(h,d),S=ch64_hi(h,d,f,p,y),A=ch64_lo(h,d,f,p,y,g),T=this.k[b],I=this.k[b+1],P=r[b],R=r[b+1],C=sum64_5_hi(v,_,w,E,S,A,T,I,P,R),B=sum64_5_lo(v,_,w,E,S,A,T,I,P,R);v=s0_512_hi(n,i),_=s0_512_lo(n,i),w=maj64_hi(n,i,s,o,a),E=maj64_lo(n,i,s,o,a,u);var k=sum64_hi(v,_,w,E),K=sum64_lo(v,_,w,E);$=y,m=g,y=f,g=p,f=h,p=d,h=sum64_hi(c,l,C,B),d=sum64_lo(l,l,C,B),c=a,l=u,a=s,u=o,s=n,o=i,n=sum64_hi(C,B,k,K),i=sum64_lo(C,B,k,K)}sum64(this.h,0,n,i),sum64(this.h,2,s,o),sum64(this.h,4,a,u),sum64(this.h,6,c,l),sum64(this.h,8,h,d),sum64(this.h,10,f,p),sum64(this.h,12,y,g),sum64(this.h,14,$,m)},SHA512$1.prototype._digest=function(e){return"hex"===e?utils$d.toHex32(this.h,"big"):utils$d.split32(this.h,"big")};var utils$c=utils$j,SHA512=_512;function SHA384(){if(!(this instanceof SHA384))return new SHA384;SHA512.call(this),this.h=[3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]}utils$c.inherits(SHA384,SHA512);var _384=SHA384;SHA384.blockSize=1024,SHA384.outSize=384,SHA384.hmacStrength=192,SHA384.padLength=128,SHA384.prototype._digest=function(e){return"hex"===e?utils$c.toHex32(this.h.slice(0,12),"big"):utils$c.split32(this.h.slice(0,12),"big")},sha.sha1=_1,sha.sha224=_224,sha.sha256=_256,sha.sha384=_384,sha.sha512=_512;var ripemd={},utils$b=utils$j,common=common$5,rotl32=utils$b.rotl32,sum32=utils$b.sum32,sum32_3=utils$b.sum32_3,sum32_4=utils$b.sum32_4,BlockHash=common.BlockHash;function RIPEMD160(){if(!(this instanceof RIPEMD160))return new RIPEMD160;BlockHash.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.endian="little"}function f(e,t,r,n){return e<=15?t^r^n:e<=31?t&r|~t&n:e<=47?(t|~r)^n:e<=63?t&n|r&~n:t^(r|~n)}function K(e){return e<=15?0:e<=31?1518500249:e<=47?1859775393:e<=63?2400959708:2840853838}function Kh(e){return e<=15?1352829926:e<=31?1548603684:e<=47?1836072691:e<=63?2053994217:0}utils$b.inherits(RIPEMD160,BlockHash),ripemd.ripemd160=RIPEMD160,RIPEMD160.blockSize=512,RIPEMD160.outSize=160,RIPEMD160.hmacStrength=192,RIPEMD160.padLength=64,RIPEMD160.prototype._update=function(e,t){for(var n=this.h[0],i=this.h[1],o=this.h[2],a=this.h[3],u=this.h[4],c=n,l=i,h=o,d=a,p=u,y=0;y<80;y++){var g=sum32(rotl32(sum32_4(n,f(y,i,o,a),e[r[y]+t],K(y)),s[y]),u);n=u,u=a,a=rotl32(o,10),o=i,i=g,g=sum32(rotl32(sum32_4(c,f(79-y,l,h,d),e[rh[y]+t],Kh(y)),sh[y]),p),c=p,p=d,d=rotl32(h,10),h=l,l=g}g=sum32_3(this.h[1],o,d),this.h[1]=sum32_3(this.h[2],a,p),this.h[2]=sum32_3(this.h[3],u,c),this.h[3]=sum32_3(this.h[4],n,l),this.h[4]=sum32_3(this.h[0],i,h),this.h[0]=g},RIPEMD160.prototype._digest=function(e){return"hex"===e?utils$b.toHex32(this.h,"little"):utils$b.split32(this.h,"little")};var r=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],rh=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],s=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],sh=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11],utils$a=utils$j,assert$7=minimalisticAssert;function Hmac(e,t,r){if(!(this instanceof Hmac))return new Hmac(e,t,r);this.Hash=e,this.blockSize=e.blockSize/8,this.outSize=e.outSize/8,this.inner=null,this.outer=null,this._init(utils$a.toArray(t,r))}var hmac$3=Hmac;Hmac.prototype._init=function(e){e.length>this.blockSize&&(e=(new this.Hash).update(e).digest()),assert$7(e.length<=this.blockSize);for(var t=e.length;t<this.blockSize;t++)e.push(0);for(t=0;t<e.length;t++)e[t]^=54;for(this.inner=(new this.Hash).update(e),t=0;t<e.length;t++)e[t]^=106;this.outer=(new this.Hash).update(e)},Hmac.prototype.update=function(e,t){return this.inner.update(e,t),this},Hmac.prototype.digest=function(e){return this.outer.update(this.inner.digest()),this.outer.digest(e)},function(e){var t=hash$2;t.utils=utils$j,t.common=common$5,t.sha=sha,t.ripemd=ripemd,t.hmac=hmac$3,t.sha1=t.sha.sha1,t.sha256=t.sha.sha256,t.sha224=t.sha.sha224,t.sha384=t.sha.sha384,t.sha512=t.sha.sha512,t.ripemd160=t.ripemd.ripemd160}(),function(e){var t,r=curves$2,n=hash$2,i=curve,s=utils$p.assert;function o(e){"short"===e.type?this.curve=new i.short(e):"edwards"===e.type?this.curve=new i.edwards(e):this.curve=new i.mont(e),this.g=this.curve.g,this.n=this.curve.n,this.hash=e.hash,s(this.g.validate(),"Invalid curve"),s(this.g.mul(this.n).isInfinity(),"Invalid curve, G*N != O")}function a(e,t){Object.defineProperty(r,e,{configurable:!0,enumerable:!0,get:function(){var n=new o(t);return Object.defineProperty(r,e,{configurable:!0,enumerable:!0,value:n}),n}})}r.PresetCurve=o,a("p192",{type:"short",prime:"p192",p:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff",a:"ffffffff ffffffff ffffffff fffffffe ffffffff fffffffc",b:"64210519 e59c80e7 0fa7e9ab 72243049 feb8deec c146b9b1",n:"ffffffff ffffffff ffffffff 99def836 146bc9b1 b4d22831",hash:n.sha256,gRed:!1,g:["188da80e b03090f6 7cbf20eb 43a18800 f4ff0afd 82ff1012","07192b95 ffc8da78 631011ed 6b24cdd5 73f977a1 1e794811"]}),a("p224",{type:"short",prime:"p224",p:"ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001",a:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff fffffffe",b:"b4050a85 0c04b3ab f5413256 5044b0b7 d7bfd8ba 270b3943 2355ffb4",n:"ffffffff ffffffff ffffffff ffff16a2 e0b8f03e 13dd2945 5c5c2a3d",hash:n.sha256,gRed:!1,g:["b70e0cbd 6bb4bf7f 321390b9 4a03c1d3 56c21122 343280d6 115c1d21","bd376388 b5f723fb 4c22dfe6 cd4375a0 5a074764 44d58199 85007e34"]}),a("p256",{type:"short",prime:null,p:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff ffffffff",a:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff fffffffc",b:"5ac635d8 aa3a93e7 b3ebbd55 769886bc 651d06b0 cc53b0f6 3bce3c3e 27d2604b",n:"ffffffff 00000000 ffffffff ffffffff bce6faad a7179e84 f3b9cac2 fc632551",hash:n.sha256,gRed:!1,g:["6b17d1f2 e12c4247 f8bce6e5 63a440f2 77037d81 2deb33a0 f4a13945 d898c296","4fe342e2 fe1a7f9b 8ee7eb4a 7c0f9e16 2bce3357 6b315ece cbb64068 37bf51f5"]}),a("p384",{type:"short",prime:null,p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 ffffffff",a:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 fffffffc",b:"b3312fa7 e23ee7e4 988e056b e3f82d19 181d9c6e fe814112 0314088f 5013875a c656398d 8a2ed19d 2a85c8ed d3ec2aef",n:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff c7634d81 f4372ddf 581a0db2 48b0a77a ecec196a ccc52973",hash:n.sha384,gRed:!1,g:["aa87ca22 be8b0537 8eb1c71e f320ad74 6e1d3b62 8ba79b98 59f741e0 82542a38 5502f25d bf55296c 3a545e38 72760ab7","3617de4a 96262c6f 5d9e98bf 9292dc29 f8f41dbd 289a147c e9da3113 b5f0b8c0 0a60b1ce 1d7e819d 7a431d7c 90ea0e5f"]}),a("p521",{type:"short",prime:null,p:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff",a:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffc",b:"00000051 953eb961 8e1c9a1f 929a21a0 b68540ee a2da725b 99b315f3 b8b48991 8ef109e1 56193951 ec7e937b 1652c0bd 3bb1bf07 3573df88 3d2c34f1 ef451fd4 6b503f00",n:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffa 51868783 bf2f966b 7fcc0148 f709a5d0 3bb5c9b8 899c47ae bb6fb71e 91386409",hash:n.sha512,gRed:!1,g:["000000c6 858e06b7 0404e9cd 9e3ecb66 2395b442 9c648139 053fb521 f828af60 6b4d3dba a14b5e77 efe75928 fe1dc127 a2ffa8de 3348b3c1 856a429b f97e7e31 c2e5bd66","00000118 39296a78 9a3bc004 5c8a5fb4 2c7d1bd9 98f54449 579b4468 17afbd17 273e662c 97ee7299 5ef42640 c550b901 3fad0761 353c7086 a272c240 88be9476 9fd16650"]}),a("curve25519",{type:"mont",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"76d06",b:"1",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:n.sha256,gRed:!1,g:["9"]}),a("ed25519",{type:"edwards",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"-1",c:"1",d:"52036cee2b6ffe73 8cc740797779e898 00700a4d4141d8ab 75eb4dca135978a3",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:n.sha256,gRed:!1,g:["216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a","6666666666666666666666666666666666666666666666666666666666666658"]});try{t=require("./precomputed/secp256k1")}catch(e){t=void 0}a("secp256k1",{type:"short",prime:"k256",p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f",a:"0",b:"7",n:"ffffffff ffffffff ffffffff fffffffe baaedce6 af48a03b bfd25e8c d0364141",h:"1",hash:n.sha256,beta:"7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee",lambda:"5363ad4cc05c30e0a5261c028812645a122e22ea20816678df02967c1b23bd72",basis:[{a:"3086d221a7d46bcde86c90e49284eb15",b:"-e4437ed6010e88286f547fa90abfe4c3"},{a:"114ca50f7a8e2f3f657c1108d9d44cfd8",b:"3086d221a7d46bcde86c90e49284eb15"}],gRed:!1,g:["79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798","483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8",t]})}();var hash$1=hash$2,utils$9=utils$o,assert$6=minimalisticAssert;function HmacDRBG$1(e){if(!(this instanceof HmacDRBG$1))return new HmacDRBG$1(e);this.hash=e.hash,this.predResist=!!e.predResist,this.outLen=this.hash.outSize,this.minEntropy=e.minEntropy||this.hash.hmacStrength,this._reseed=null,this.reseedInterval=null,this.K=null,this.V=null;var t=utils$9.toArray(e.entropy,e.entropyEnc||"hex"),r=utils$9.toArray(e.nonce,e.nonceEnc||"hex"),n=utils$9.toArray(e.pers,e.persEnc||"hex");assert$6(t.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._init(t,r,n)}var hmacDrbg=HmacDRBG$1;HmacDRBG$1.prototype._init=function(e,t,r){var n=e.concat(t).concat(r);this.K=new Array(this.outLen/8),this.V=new Array(this.outLen/8);for(var i=0;i<this.V.length;i++)this.K[i]=0,this.V[i]=1;this._update(n),this._reseed=1,this.reseedInterval=281474976710656},HmacDRBG$1.prototype._hmac=function(){return new hash$1.hmac(this.hash,this.K)},HmacDRBG$1.prototype._update=function(e){var t=this._hmac().update(this.V).update([0]);e&&(t=t.update(e)),this.K=t.digest(),this.V=this._hmac().update(this.V).digest(),e&&(this.K=this._hmac().update(this.V).update([1]).update(e).digest(),this.V=this._hmac().update(this.V).digest())},HmacDRBG$1.prototype.reseed=function(e,t,r,n){"string"!=typeof t&&(n=r,r=t,t=null),e=utils$9.toArray(e,t),r=utils$9.toArray(r,n),assert$6(e.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._update(e.concat(r||[])),this._reseed=1},HmacDRBG$1.prototype.generate=function(e,t,r,n){if(this._reseed>this.reseedInterval)throw new Error("Reseed is required");"string"!=typeof t&&(n=r,r=t,t=null),r&&(r=utils$9.toArray(r,n||"hex"),this._update(r));for(var i=[];i.length<e;)this.V=this._hmac().update(this.V).digest(),i=i.concat(this.V);var s=i.slice(0,e);return this._update(r),this._reseed++,utils$9.encode(s,t)};var BN$4=bn.exports,utils$8=utils$p,assert$5=utils$8.assert;function KeyPair$3(e,t){this.ec=e,this.priv=null,this.pub=null,t.priv&&this._importPrivate(t.priv,t.privEnc),t.pub&&this._importPublic(t.pub,t.pubEnc)}var key$1=KeyPair$3;KeyPair$3.fromPublic=function(e,t,r){return t instanceof KeyPair$3?t:new KeyPair$3(e,{pub:t,pubEnc:r})},KeyPair$3.fromPrivate=function(e,t,r){return t instanceof KeyPair$3?t:new KeyPair$3(e,{priv:t,privEnc:r})},KeyPair$3.prototype.validate=function(){var e=this.getPublic();return e.isInfinity()?{result:!1,reason:"Invalid public key"}:e.validate()?e.mul(this.ec.curve.n).isInfinity()?{result:!0,reason:null}:{result:!1,reason:"Public key * N != O"}:{result:!1,reason:"Public key is not a point"}},KeyPair$3.prototype.getPublic=function(e,t){return"string"==typeof e&&(t=e,e=null),this.pub||(this.pub=this.ec.g.mul(this.priv)),t?this.pub.encode(t,e):this.pub},KeyPair$3.prototype.getPrivate=function(e){return"hex"===e?this.priv.toString(16,2):this.priv},KeyPair$3.prototype._importPrivate=function(e,t){this.priv=new BN$4(e,t||16),this.priv=this.priv.umod(this.ec.curve.n)},KeyPair$3.prototype._importPublic=function(e,t){if(e.x||e.y)return"mont"===this.ec.curve.type?assert$5(e.x,"Need x coordinate"):"short"!==this.ec.curve.type&&"edwards"!==this.ec.curve.type||assert$5(e.x&&e.y,"Need both x and y coordinate"),void(this.pub=this.ec.curve.point(e.x,e.y));this.pub=this.ec.curve.decodePoint(e,t)},KeyPair$3.prototype.derive=function(e){return e.validate()||assert$5(e.validate(),"public point not validated"),e.mul(this.priv).getX()},KeyPair$3.prototype.sign=function(e,t,r){return this.ec.sign(e,this,t,r)},KeyPair$3.prototype.verify=function(e,t){return this.ec.verify(e,t,this)},KeyPair$3.prototype.inspect=function(){return"<Key priv: "+(this.priv&&this.priv.toString(16,2))+" pub: "+(this.pub&&this.pub.inspect())+" >"};var BN$3=bn.exports,utils$7=utils$p,assert$4=utils$7.assert;function Signature$3(e,t){if(e instanceof Signature$3)return e;this._importDER(e,t)||(assert$4(e.r&&e.s,"Signature without r or s"),this.r=new BN$3(e.r,16),this.s=new BN$3(e.s,16),void 0===e.recoveryParam?this.recoveryParam=null:this.recoveryParam=e.recoveryParam)}var signature$1=Signature$3;function Position(){this.place=0}function getLength(e,t){var r=e[t.place++];if(!(128&r))return r;var n=15&r;if(0===n||n>4)return!1;for(var i=0,s=0,o=t.place;s<n;s++,o++)i<<=8,i|=e[o],i>>>=0;return!(i<=127)&&(t.place=o,i)}function rmPadding(e){for(var t=0,r=e.length-1;!e[t]&&!(128&e[t+1])&&t<r;)t++;return 0===t?e:e.slice(t)}function constructLength(e,t){if(t<128)e.push(t);else{var r=1+(Math.log(t)/Math.LN2>>>3);for(e.push(128|r);--r;)e.push(t>>>(r<<3)&255);e.push(t)}}Signature$3.prototype._importDER=function(e,t){e=utils$7.toArray(e,t);var r=new Position;if(48!==e[r.place++])return!1;var n=getLength(e,r);if(!1===n)return!1;if(n+r.place!==e.length)return!1;if(2!==e[r.place++])return!1;var i=getLength(e,r);if(!1===i)return!1;var s=e.slice(r.place,i+r.place);if(r.place+=i,2!==e[r.place++])return!1;var o=getLength(e,r);if(!1===o)return!1;if(e.length!==o+r.place)return!1;var a=e.slice(r.place,o+r.place);if(0===s[0]){if(!(128&s[1]))return!1;s=s.slice(1)}if(0===a[0]){if(!(128&a[1]))return!1;a=a.slice(1)}return this.r=new BN$3(s),this.s=new BN$3(a),this.recoveryParam=null,!0},Signature$3.prototype.toDER=function(e){var t=this.r.toArray(),r=this.s.toArray();for(128&t[0]&&(t=[0].concat(t)),128&r[0]&&(r=[0].concat(r)),t=rmPadding(t),r=rmPadding(r);!(r[0]||128&r[1]);)r=r.slice(1);var n=[2];constructLength(n,t.length),(n=n.concat(t)).push(2),constructLength(n,r.length);var i=n.concat(r),s=[48];return constructLength(s,i.length),s=s.concat(i),utils$7.encode(s,e)};var BN$2=bn.exports,HmacDRBG=hmacDrbg,utils$6=utils$p,curves$1=curves$2,rand=brorand.exports,assert$3=utils$6.assert,KeyPair$2=key$1,Signature$2=signature$1;function EC$1(e){if(!(this instanceof EC$1))return new EC$1(e);"string"==typeof e&&(assert$3(Object.prototype.hasOwnProperty.call(curves$1,e),"Unknown curve "+e),e=curves$1[e]),e instanceof curves$1.PresetCurve&&(e={curve:e}),this.curve=e.curve.curve,this.n=this.curve.n,this.nh=this.n.ushrn(1),this.g=this.curve.g,this.g=e.curve.g,this.g.precompute(e.curve.n.bitLength()+1),this.hash=e.hash||e.curve.hash}var ec$1=EC$1;EC$1.prototype.keyPair=function(e){return new KeyPair$2(this,e)},EC$1.prototype.keyFromPrivate=function(e,t){return KeyPair$2.fromPrivate(this,e,t)},EC$1.prototype.keyFromPublic=function(e,t){return KeyPair$2.fromPublic(this,e,t)},EC$1.prototype.genKeyPair=function(e){e||(e={});for(var t=new HmacDRBG({hash:this.hash,pers:e.pers,persEnc:e.persEnc||"utf8",entropy:e.entropy||rand(this.hash.hmacStrength),entropyEnc:e.entropy&&e.entropyEnc||"utf8",nonce:this.n.toArray()}),r=this.n.byteLength(),n=this.n.sub(new BN$2(2));;){var i=new BN$2(t.generate(r));if(!(i.cmp(n)>0))return i.iaddn(1),this.keyFromPrivate(i)}},EC$1.prototype._truncateToN=function(e,t){var r=8*e.byteLength()-this.n.bitLength();return r>0&&(e=e.ushrn(r)),!t&&e.cmp(this.n)>=0?e.sub(this.n):e},EC$1.prototype.sign=function(e,t,r,n){"object"==typeof r&&(n=r,r=null),n||(n={}),t=this.keyFromPrivate(t,r),e=this._truncateToN(new BN$2(e,16));for(var i=this.n.byteLength(),s=t.getPrivate().toArray("be",i),o=e.toArray("be",i),a=new HmacDRBG({hash:this.hash,entropy:s,nonce:o,pers:n.pers,persEnc:n.persEnc||"utf8"}),u=this.n.sub(new BN$2(1)),c=0;;c++){var l=n.k?n.k(c):new BN$2(a.generate(this.n.byteLength()));if(!((l=this._truncateToN(l,!0)).cmpn(1)<=0||l.cmp(u)>=0)){var h=this.g.mul(l);if(!h.isInfinity()){var d=h.getX(),f=d.umod(this.n);if(0!==f.cmpn(0)){var p=l.invm(this.n).mul(f.mul(t.getPrivate()).iadd(e));if(0!==(p=p.umod(this.n)).cmpn(0)){var y=(h.getY().isOdd()?1:0)|(0!==d.cmp(f)?2:0);return n.canonical&&p.cmp(this.nh)>0&&(p=this.n.sub(p),y^=1),new Signature$2({r:f,s:p,recoveryParam:y})}}}}}},EC$1.prototype.verify=function(e,t,r,n){e=this._truncateToN(new BN$2(e,16)),r=this.keyFromPublic(r,n);var i=(t=new Signature$2(t,"hex")).r,s=t.s;if(i.cmpn(1)<0||i.cmp(this.n)>=0)return!1;if(s.cmpn(1)<0||s.cmp(this.n)>=0)return!1;var o,a=s.invm(this.n),u=a.mul(e).umod(this.n),c=a.mul(i).umod(this.n);return this.curve._maxwellTrick?!(o=this.g.jmulAdd(u,r.getPublic(),c)).isInfinity()&&o.eqXToP(i):!(o=this.g.mulAdd(u,r.getPublic(),c)).isInfinity()&&0===o.getX().umod(this.n).cmp(i)},EC$1.prototype.recoverPubKey=function(e,t,r,n){assert$3((3&r)===r,"The recovery param is more than two bits"),t=new Signature$2(t,n);var i=this.n,s=new BN$2(e),o=t.r,a=t.s,u=1&r,c=r>>1;if(o.cmp(this.curve.p.umod(this.curve.n))>=0&&c)throw new Error("Unable to find sencond key candinate");o=c?this.curve.pointFromX(o.add(this.curve.n),u):this.curve.pointFromX(o,u);var l=t.r.invm(i),h=i.sub(s).mul(l).umod(i),d=a.mul(l).umod(i);return this.g.mulAdd(h,o,d)},EC$1.prototype.getKeyRecoveryParam=function(e,t,r,n){if(null!==(t=new Signature$2(t,n)).recoveryParam)return t.recoveryParam;for(var i=0;i<4;i++){var s;try{s=this.recoverPubKey(e,t,i)}catch(e){continue}if(s.eq(r))return i}throw new Error("Unable to find valid recovery factor")};var utils$5=utils$p,assert$2=utils$5.assert,parseBytes$2=utils$5.parseBytes,cachedProperty$1=utils$5.cachedProperty;function KeyPair$1(e,t){this.eddsa=e,this._secret=parseBytes$2(t.secret),e.isPoint(t.pub)?this._pub=t.pub:this._pubBytes=parseBytes$2(t.pub)}KeyPair$1.fromPublic=function(e,t){return t instanceof KeyPair$1?t:new KeyPair$1(e,{pub:t})},KeyPair$1.fromSecret=function(e,t){return t instanceof KeyPair$1?t:new KeyPair$1(e,{secret:t})},KeyPair$1.prototype.secret=function(){return this._secret},cachedProperty$1(KeyPair$1,"pubBytes",(function(){return this.eddsa.encodePoint(this.pub())})),cachedProperty$1(KeyPair$1,"pub",(function(){return this._pubBytes?this.eddsa.decodePoint(this._pubBytes):this.eddsa.g.mul(this.priv())})),cachedProperty$1(KeyPair$1,"privBytes",(function(){var e=this.eddsa,t=this.hash(),r=e.encodingLength-1,n=t.slice(0,e.encodingLength);return n[0]&=248,n[r]&=127,n[r]|=64,n})),cachedProperty$1(KeyPair$1,"priv",(function(){return this.eddsa.decodeInt(this.privBytes())})),cachedProperty$1(KeyPair$1,"hash",(function(){return this.eddsa.hash().update(this.secret()).digest()})),cachedProperty$1(KeyPair$1,"messagePrefix",(function(){return this.hash().slice(this.eddsa.encodingLength)})),KeyPair$1.prototype.sign=function(e){return assert$2(this._secret,"KeyPair can only verify"),this.eddsa.sign(e,this)},KeyPair$1.prototype.verify=function(e,t){return this.eddsa.verify(e,t,this)},KeyPair$1.prototype.getSecret=function(e){return assert$2(this._secret,"KeyPair is public only"),utils$5.encode(this.secret(),e)},KeyPair$1.prototype.getPublic=function(e){return utils$5.encode(this.pubBytes(),e)};var key=KeyPair$1,BN$1=bn.exports,utils$4=utils$p,assert$1=utils$4.assert,cachedProperty=utils$4.cachedProperty,parseBytes$1=utils$4.parseBytes;function Signature$1(e,t){this.eddsa=e,"object"!=typeof t&&(t=parseBytes$1(t)),Array.isArray(t)&&(t={R:t.slice(0,e.encodingLength),S:t.slice(e.encodingLength)}),assert$1(t.R&&t.S,"Signature without R or S"),e.isPoint(t.R)&&(this._R=t.R),t.S instanceof BN$1&&(this._S=t.S),this._Rencoded=Array.isArray(t.R)?t.R:t.Rencoded,this._Sencoded=Array.isArray(t.S)?t.S:t.Sencoded}cachedProperty(Signature$1,"S",(function(){return this.eddsa.decodeInt(this.Sencoded())})),cachedProperty(Signature$1,"R",(function(){return this.eddsa.decodePoint(this.Rencoded())})),cachedProperty(Signature$1,"Rencoded",(function(){return this.eddsa.encodePoint(this.R())})),cachedProperty(Signature$1,"Sencoded",(function(){return this.eddsa.encodeInt(this.S())})),Signature$1.prototype.toBytes=function(){return this.Rencoded().concat(this.Sencoded())},Signature$1.prototype.toHex=function(){return utils$4.encode(this.toBytes(),"hex").toUpperCase()};var signature=Signature$1,hash=hash$2,curves=curves$2,utils$3=utils$p,assert=utils$3.assert,parseBytes=utils$3.parseBytes,KeyPair=key,Signature=signature;function EDDSA(e){if(assert("ed25519"===e,"only tested with ed25519 so far"),!(this instanceof EDDSA))return new EDDSA(e);e=curves[e].curve,this.curve=e,this.g=e.g,this.g.precompute(e.n.bitLength()+1),this.pointClass=e.point().constructor,this.encodingLength=Math.ceil(e.n.bitLength()/8),this.hash=hash.sha512}var eddsa=EDDSA;EDDSA.prototype.sign=function(e,t){e=parseBytes(e);var r=this.keyFromSecret(t),n=this.hashInt(r.messagePrefix(),e),i=this.g.mul(n),s=this.encodePoint(i),o=this.hashInt(s,r.pubBytes(),e).mul(r.priv()),a=n.add(o).umod(this.curve.n);return this.makeSignature({R:i,S:a,Rencoded:s})},EDDSA.prototype.verify=function(e,t,r){e=parseBytes(e),t=this.makeSignature(t);var n=this.keyFromPublic(r),i=this.hashInt(t.Rencoded(),n.pubBytes(),e),s=this.g.mul(t.S());return t.R().add(n.pub().mul(i)).eq(s)},EDDSA.prototype.hashInt=function(){for(var e=this.hash(),t=0;t<arguments.length;t++)e.update(arguments[t]);return utils$3.intFromLE(e.digest()).umod(this.curve.n)},EDDSA.prototype.keyFromPublic=function(e){return KeyPair.fromPublic(this,e)},EDDSA.prototype.keyFromSecret=function(e){return KeyPair.fromSecret(this,e)},EDDSA.prototype.makeSignature=function(e){return e instanceof Signature?e:new Signature(this,e)},EDDSA.prototype.encodePoint=function(e){var t=e.getY().toArray("le",this.encodingLength);return t[this.encodingLength-1]|=e.getX().isOdd()?128:0,t},EDDSA.prototype.decodePoint=function(e){var t=(e=utils$3.parseBytes(e)).length-1,r=e.slice(0,t).concat(-129&e[t]),n=0!=(128&e[t]),i=utils$3.intFromLE(r);return this.curve.pointFromY(i,n)},EDDSA.prototype.encodeInt=function(e){return e.toArray("le",this.encodingLength)},EDDSA.prototype.decodeInt=function(e){return utils$3.intFromLE(e)},EDDSA.prototype.isPoint=function(e){return e instanceof this.pointClass},function(e){var t=elliptic$2;t.version=require$$0$1.version,t.utils=utils$p,t.rand=brorand.exports,t.curve=curve,t.curves=curves$2,t.ec=ec$1,t.eddsa=eddsa}();const EC=elliptic$2.ec,ec=new EC("secp256k1"),ecparams=ec.curve,BN=ecparams.n.constructor;function loadCompressedPublicKey(e,t){let r=new BN(t);if(r.cmp(ecparams.p)>=0)return null;r=r.toRed(ecparams.red);let n=r.redSqr().redIMul(r).redIAdd(ecparams.b).redSqrt();return 3===e!==n.isOdd()&&(n=n.redNeg()),ec.keyPair({pub:{x:r,y:n}})}function loadUncompressedPublicKey(e,t,r){let n=new BN(t),i=new BN(r);if(n.cmp(ecparams.p)>=0||i.cmp(ecparams.p)>=0)return null;if(n=n.toRed(ecparams.red),i=i.toRed(ecparams.red),(6===e||7===e)&&i.isOdd()!==(7===e))return null;const s=n.redSqr().redIMul(n);return i.redSqr().redISub(s.redIAdd(ecparams.b)).isZero()?ec.keyPair({pub:{x:n,y:i}}):null}function loadPublicKey(e){const t=e[0];switch(t){case 2:case 3:return 33!==e.length?null:loadCompressedPublicKey(t,e.subarray(1,33));case 4:case 6:case 7:return 65!==e.length?null:loadUncompressedPublicKey(t,e.subarray(1,33),e.subarray(33,65));default:return null}}function savePublicKey(e,t){const r=t.encode(null,33===e.length);for(let t=0;t<e.length;++t)e[t]=r[t]}var elliptic$1={contextRandomize:()=>0,privateKeyVerify(e){const t=new BN(e);return t.cmp(ecparams.n)<0&&!t.isZero()?0:1},privateKeyNegate(e){const t=new BN(e),r=ecparams.n.sub(t).umod(ecparams.n).toArrayLike(Uint8Array,"be",32);return e.set(r),0},privateKeyTweakAdd(e,t){const r=new BN(t);if(r.cmp(ecparams.n)>=0)return 1;if(r.iadd(new BN(e)),r.cmp(ecparams.n)>=0&&r.isub(ecparams.n),r.isZero())return 1;const n=r.toArrayLike(Uint8Array,"be",32);return e.set(n),0},privateKeyTweakMul(e,t){let r=new BN(t);if(r.cmp(ecparams.n)>=0||r.isZero())return 1;r.imul(new BN(e)),r.cmp(ecparams.n)>=0&&(r=r.umod(ecparams.n));const n=r.toArrayLike(Uint8Array,"be",32);return e.set(n),0},publicKeyVerify:e=>null===loadPublicKey(e)?1:0,publicKeyCreate(e,t){const r=new BN(t);if(r.cmp(ecparams.n)>=0||r.isZero())return 1;return savePublicKey(e,ec.keyFromPrivate(t).getPublic()),0},publicKeyConvert(e,t){const r=loadPublicKey(t);if(null===r)return 1;return savePublicKey(e,r.getPublic()),0},publicKeyNegate(e,t){const r=loadPublicKey(t);if(null===r)return 1;const n=r.getPublic();return n.y=n.y.redNeg(),savePublicKey(e,n),0},publicKeyCombine(e,t){const r=new Array(t.length);for(let e=0;e<t.length;++e)if(r[e]=loadPublicKey(t[e]),null===r[e])return 1;let n=r[0].getPublic();for(let e=1;e<r.length;++e)n=n.add(r[e].pub);return n.isInfinity()?2:(savePublicKey(e,n),0)},publicKeyTweakAdd(e,t,r){const n=loadPublicKey(t);if(null===n)return 1;if((r=new BN(r)).cmp(ecparams.n)>=0)return 2;const i=n.getPublic().add(ecparams.g.mul(r));return i.isInfinity()?2:(savePublicKey(e,i),0)},publicKeyTweakMul(e,t,r){const n=loadPublicKey(t);if(null===n)return 1;if((r=new BN(r)).cmp(ecparams.n)>=0||r.isZero())return 2;return savePublicKey(e,n.getPublic().mul(r)),0},signatureNormalize(e){const t=new BN(e.subarray(0,32)),r=new BN(e.subarray(32,64));return t.cmp(ecparams.n)>=0||r.cmp(ecparams.n)>=0?1:(1===r.cmp(ec.nh)&&e.set(ecparams.n.sub(r).toArrayLike(Uint8Array,"be",32),32),0)},signatureExport(e,t){const r=t.subarray(0,32),n=t.subarray(32,64);if(new BN(r).cmp(ecparams.n)>=0)return 1;if(new BN(n).cmp(ecparams.n)>=0)return 1;const{output:i}=e;let s=i.subarray(4,37);s[0]=0,s.set(r,1);let o=33,a=0;for(;o>1&&0===s[a]&&!(128&s[a+1]);--o,++a);if(s=s.subarray(a),128&s[0])return 1;if(o>1&&0===s[0]&&!(128&s[1]))return 1;let u=i.subarray(39,72);u[0]=0,u.set(n,1);let c=33,l=0;for(;c>1&&0===u[l]&&!(128&u[l+1]);--c,++l);return u=u.subarray(l),128&u[0]||c>1&&0===u[0]&&!(128&u[1])?1:(e.outputlen=6+o+c,i[0]=48,i[1]=e.outputlen-2,i[2]=2,i[3]=s.length,i.set(s,4),i[4+o]=2,i[5+o]=u.length,i.set(u,6+o),0)},signatureImport(e,t){if(t.length<8)return 1;if(t.length>72)return 1;if(48!==t[0])return 1;if(t[1]!==t.length-2)return 1;if(2!==t[2])return 1;const r=t[3];if(0===r)return 1;if(5+r>=t.length)return 1;if(2!==t[4+r])return 1;const n=t[5+r];if(0===n)return 1;if(6+r+n!==t.length)return 1;if(128&t[4])return 1;if(r>1&&0===t[4]&&!(128&t[5]))return 1;if(128&t[r+6])return 1;if(n>1&&0===t[r+6]&&!(128&t[r+7]))return 1;let i=t.subarray(4,4+r);if(33===i.length&&0===i[0]&&(i=i.subarray(1)),i.length>32)return 1;let s=t.subarray(6+r);if(33===s.length&&0===s[0]&&(s=s.slice(1)),s.length>32)throw new Error("S length is too long");let o=new BN(i);o.cmp(ecparams.n)>=0&&(o=new BN(0));let a=new BN(t.subarray(6+r));return a.cmp(ecparams.n)>=0&&(a=new BN(0)),e.set(o.toArrayLike(Uint8Array,"be",32),0),e.set(a.toArrayLike(Uint8Array,"be",32),32),0},ecdsaSign(e,t,r,n,i){if(i){const e=i;i=i=>{const s=e(t,r,null,n,i);if(!(s instanceof Uint8Array&&32===s.length))throw new Error("This is the way");return new BN(s)}}const s=new BN(r);if(s.cmp(ecparams.n)>=0||s.isZero())return 1;let o;try{o=ec.sign(t,r,{canonical:!0,k:i,pers:n})}catch(e){return 1}return e.signature.set(o.r.toArrayLike(Uint8Array,"be",32),0),e.signature.set(o.s.toArrayLike(Uint8Array,"be",32),32),e.recid=o.recoveryParam,0},ecdsaVerify(e,t,r){const n={r:e.subarray(0,32),s:e.subarray(32,64)},i=new BN(n.r),s=new BN(n.s);if(i.cmp(ecparams.n)>=0||s.cmp(ecparams.n)>=0)return 1;if(1===s.cmp(ec.nh)||i.isZero()||s.isZero())return 3;const o=loadPublicKey(r);if(null===o)return 2;const a=o.getPublic();return ec.verify(t,n,a)?0:3},ecdsaRecover(e,t,r,n){const i={r:t.slice(0,32),s:t.slice(32,64)},s=new BN(i.r),o=new BN(i.s);if(s.cmp(ecparams.n)>=0||o.cmp(ecparams.n)>=0)return 1;if(s.isZero()||o.isZero())return 2;let a;try{a=ec.recoverPubKey(n,i,r)}catch(e){return 2}return savePublicKey(e,a),0},ecdh(e,t,r,n,i,s,o){const a=loadPublicKey(t);if(null===a)return 1;const u=new BN(r);if(u.cmp(ecparams.n)>=0||u.isZero())return 2;const c=a.getPublic().mul(u);if(void 0===i){const t=c.encode(null,!0),r=ec.hash().update(t).digest();for(let t=0;t<32;++t)e[t]=r[t]}else{s||(s=new Uint8Array(32));const t=c.getX().toArray("be",32);for(let e=0;e<32;++e)s[e]=t[e];o||(o=new Uint8Array(32));const r=c.getY().toArray("be",32);for(let e=0;e<32;++e)o[e]=r[e];const a=i(s,o,n);if(!(a instanceof Uint8Array&&a.length===e.length))return 2;e.set(a)}return 0}},elliptic=lib(elliptic$1);const secp256k1$1=elliptic,{sha256:sha256$6}=require$$4$3;var secp256k1_1=e=>{function t(e){if(!secp256k1$1.privateKeyVerify(e))throw new Error("Invalid private key")}return{generateKey:function(){let t;do{t=e(32)}while(!secp256k1$1.privateKeyVerify(t));return t},privateKeyLength:32,hashAndSign:async function(e,t){const{digest:r}=await sha256$6.digest(t),n=secp256k1$1.ecdsaSign(r,e);return secp256k1$1.signatureExport(n.signature)},hashAndVerify:async function(e,t,r){const{digest:n}=await sha256$6.digest(r);return t=secp256k1$1.signatureImport(t),secp256k1$1.ecdsaVerify(t,n,e)},compressPublicKey:function(e){if(!secp256k1$1.publicKeyVerify(e))throw new Error("Invalid public key");return secp256k1$1.publicKeyConvert(e,!0)},decompressPublicKey:function(e){return secp256k1$1.publicKeyConvert(e,!1)},validatePrivateKey:t,validatePublicKey:function(e){if(!secp256k1$1.publicKeyVerify(e))throw new Error("Invalid public key")},computePublicKey:function(e){return t(e),secp256k1$1.publicKeyCreate(e)}}};const{sha256:sha256$5}=require$$4$3,errcode$f=errCode$m,{equals:uint8ArrayEquals$5}=require$$10$1,{toString:uint8ArrayToString$7}=require$$1$5,exporter$4=exporter$7;var secp256k1Class$1=(e,t,r)=>{r=r||secp256k1_1(t);class n{constructor(e){r.validatePublicKey(e),this._key=e}verify(e,t){return r.hashAndVerify(this._key,t,e)}marshal(){return r.compressPublicKey(this._key)}get bytes(){return e.PublicKey.encode({Type:e.KeyType.Secp256k1,Data:this.marshal()}).finish()}equals(e){return uint8ArrayEquals$5(this.bytes,e.bytes)}async hash(){const{bytes:e}=await sha256$5.digest(this.bytes);return e}}class i{constructor(e,t){this._key=e,this._publicKey=t||r.computePublicKey(e),r.validatePrivateKey(this._key),r.validatePublicKey(this._publicKey)}sign(e){return r.hashAndSign(this._key,e)}get public(){return new n(this._publicKey)}marshal(){return this._key}get bytes(){return e.PrivateKey.encode({Type:e.KeyType.Secp256k1,Data:this.marshal()}).finish()}equals(e){return uint8ArrayEquals$5(this.bytes,e.bytes)}async hash(){const{bytes:e}=await sha256$5.digest(this.bytes);return e}async id(){const e=await this.public.hash();return uint8ArrayToString$7(e,"base58btc")}async export(e,t="libp2p-key"){if("libp2p-key"===t)return exporter$4.export(this.bytes,e);throw errcode$f(new Error(`export format '${t}' is not supported`),"ERR_INVALID_EXPORT_FORMAT")}}return{Secp256k1PublicKey:n,Secp256k1PrivateKey:i,unmarshalSecp256k1PrivateKey:function(e){return new i(e)},unmarshalSecp256k1PublicKey:function(e){return new n(e)},generateKeyPair:async function(){const e=await r.generateKey();return new i(e)}}};const errcode$e=errCode$m,{concat:uint8ArrayConcat$4}=require$$2$2,{fromString:uint8ArrayFromString$7}=require$$3$1,hmac$2=indexBrowser$1,cipherMap$1={"AES-128":{ivSize:16,keySize:16},"AES-256":{ivSize:16,keySize:32},Blowfish:{ivSize:8,cipherKeySize:32}};var keyStretcher$1=async(e,t,r)=>{const n=cipherMap$1[e];if(!n){const t=Object.keys(cipherMap$1).join(" / ");throw errcode$e(new Error(`unknown cipher type '${e}'. Must be ${t}`),"ERR_INVALID_CIPHER_TYPE")}if(!t)throw errcode$e(new Error("missing hash type"),"ERR_MISSING_HASH_TYPE");const i=n.keySize,s=n.ivSize,o=uint8ArrayFromString$7("key expansion"),a=2*(s+i+20),u=await hmac$2.create(t,r);let c=await u.digest(o);const l=[];let h=0;for(;h<a;){const e=await u.digest(uint8ArrayConcat$4([c,o]));let t=e.length;h+t>a&&(t=a-h),l.push(e),h+=t,c=await u.digest(c)}const d=a/2,f=uint8ArrayConcat$4(l),p=f.slice(0,d),y=f.slice(d,a),g=e=>({iv:e.slice(0,s),cipherKey:e.slice(s,s+i),macKey:e.slice(s+i)});return{k1:g(p),k2:g(y)}},ecdhBrowser$1={};const errcode$d=errCode$m;var validateCurveType$3=function(e,t){if(!e.includes(t)){const r=e.join(" / ");throw errcode$d(new Error(`Unknown curve: ${t}. Must be ${r}`),"ERR_INVALID_CURVE")}};const errcode$c=errCode$m,webcrypto$5=webcrypto$9,{base64urlToBuffer:base64urlToBuffer$1}=util$1,validateCurveType$2=validateCurveType$3,{toString:uint8ArrayToString$6}=require$$1$5,{concat:uint8ArrayConcat$3}=require$$2$2,{equals:uint8ArrayEquals$4}=require$$10$1,bits$1={"P-256":256,"P-384":384,"P-521":521};ecdhBrowser$1.generateEphmeralKeyPair=async function(e){validateCurveType$2(Object.keys(bits$1),e);const t=await webcrypto$5.get().subtle.generateKey({name:"ECDH",namedCurve:e},!0,["deriveBits"]);return{key:marshalPublicKey$3(await webcrypto$5.get().subtle.exportKey("jwk",t.publicKey)),genSharedKey:async(r,n)=>{let i;i=n?await webcrypto$5.get().subtle.importKey("jwk",unmarshalPrivateKey$3(e,n),{name:"ECDH",namedCurve:e},!1,["deriveBits"]):t.privateKey;const s=[await webcrypto$5.get().subtle.importKey("jwk",unmarshalPublicKey$3(e,r),{name:"ECDH",namedCurve:e},!1,[]),i],o=await webcrypto$5.get().subtle.deriveBits({name:"ECDH",namedCurve:e,public:s[0]},s[1],bits$1[e]);return new Uint8Array(o,o.byteOffset,o.byteLength)}}};const curveLengths$1={"P-256":32,"P-384":48,"P-521":66};function marshalPublicKey$3(e){const t=curveLengths$1[e.crv];return uint8ArrayConcat$3([Uint8Array.from([4]),base64urlToBuffer$1(e.x,t),base64urlToBuffer$1(e.y,t)],1+2*t)}function unmarshalPublicKey$3(e,t){const r=curveLengths$1[e];if(uint8ArrayEquals$4(!t.slice(0,1),Uint8Array.from([4])))throw errcode$c(new Error("Cannot unmarshal public key - invalid key format"),"ERR_INVALID_KEY_FORMAT");return{kty:"EC",crv:e,x:uint8ArrayToString$6(t.slice(1,r+1),"base64url"),y:uint8ArrayToString$6(t.slice(1+r),"base64url"),ext:!0}}const unmarshalPrivateKey$3=(e,t)=>({...unmarshalPublicKey$3(e,t.public),d:uint8ArrayToString$6(t.private,"base64url")}),ecdh$1=ecdhBrowser$1;var ephemeralKeys$1=async e=>ecdh$1.generateEphmeralKeyPair(e);const keysPBM$1=keys$4,forge$4=forge$X,errcode$b=errCode$m,{fromString:uint8ArrayFromString$6}=require$$3$1,importer$2=importer$3,supportedKeys$1={rsa:rsaClass$1,ed25519:ed25519Class$1,secp256k1:secp256k1Class$1(keysPBM$1,randomBytes_1$1)},ErrMissingSecp256K1$1={message:"secp256k1 support requires libp2p-crypto-secp256k1 package",code:"ERR_MISSING_PACKAGE"};function typeToKey$1(e){const t=supportedKeys$1[e.toLowerCase()];if(!t){const t=Object.keys(supportedKeys$1).join(" / ");throw errcode$b(new Error(`invalid or unsupported key type ${e}. Must be ${t}`),"ERR_UNSUPPORTED_KEY_TYPE")}return t}const generateKeyPair$3=async(e,t)=>typeToKey$1(e).generateKeyPair(t),generateKeyPairFromSeed$2=async(e,t,r)=>{const n=typeToKey$1(e);if("ed25519"!==e.toLowerCase())throw errcode$b(new Error("Seed key derivation is unimplemented for RSA or secp256k1"),"ERR_UNSUPPORTED_KEY_DERIVATION_TYPE");return n.generateKeyPairFromSeed(t,r)},unmarshalPublicKey$2=e=>{const t=keysPBM$1.PublicKey.decode(e),r=t.Data;switch(t.Type){case keysPBM$1.KeyType.RSA:return supportedKeys$1.rsa.unmarshalRsaPublicKey(r);case keysPBM$1.KeyType.Ed25519:return supportedKeys$1.ed25519.unmarshalEd25519PublicKey(r);case keysPBM$1.KeyType.Secp256k1:if(supportedKeys$1.secp256k1)return supportedKeys$1.secp256k1.unmarshalSecp256k1PublicKey(r);throw errcode$b(new Error(ErrMissingSecp256K1$1.message),ErrMissingSecp256K1$1.code);default:typeToKey$1(t.Type)}},marshalPublicKey$2=(e,t)=>(typeToKey$1(t=(t||"rsa").toLowerCase()),e.bytes),unmarshalPrivateKey$2=async e=>{const t=keysPBM$1.PrivateKey.decode(e),r=t.Data;switch(t.Type){case keysPBM$1.KeyType.RSA:return supportedKeys$1.rsa.unmarshalRsaPrivateKey(r);case keysPBM$1.KeyType.Ed25519:return supportedKeys$1.ed25519.unmarshalEd25519PrivateKey(r);case keysPBM$1.KeyType.Secp256k1:if(supportedKeys$1.secp256k1)return supportedKeys$1.secp256k1.unmarshalSecp256k1PrivateKey(r);throw errcode$b(new Error(ErrMissingSecp256K1$1.message),ErrMissingSecp256K1$1.code);default:typeToKey$1(t.Type)}},marshalPrivateKey$1=(e,t)=>(typeToKey$1(t=(t||"rsa").toLowerCase()),e.bytes),importKey$1=async(e,t)=>{try{const r=await importer$2.import(e,t);return unmarshalPrivateKey$2(r)}catch(e){}const r=forge$4.pki.decryptRsaPrivateKey(e,t);if(null===r)throw errcode$b(new Error("Cannot read the key, most likely the password is wrong or not a RSA key"),"ERR_CANNOT_DECRYPT_PEM");let n=forge$4.asn1.toDer(forge$4.pki.privateKeyToAsn1(r));return n=uint8ArrayFromString$6(n.getBytes(),"ascii"),supportedKeys$1.rsa.unmarshalRsaPrivateKey(n)};var keys$3={supportedKeys:supportedKeys$1,keysPBM:keysPBM$1,keyStretcher:keyStretcher$1,generateEphemeralKeyPair:ephemeralKeys$1,generateKeyPair:generateKeyPair$3,generateKeyPairFromSeed:generateKeyPairFromSeed$2,unmarshalPublicKey:unmarshalPublicKey$2,marshalPublicKey:marshalPublicKey$2,unmarshalPrivateKey:unmarshalPrivateKey$2,marshalPrivateKey:marshalPrivateKey$1,import:importKey$1};const forgePbkdf2=require$$0$8,forgeUtil=require$$1$6,errcode$a=errCode$m,hashName={sha1:"sha1","sha2-256":"sha256","sha2-512":"sha512"};function pbkdf2(e,t,r,n,i){const s=hashName[i];if(!s){const e=Object.keys(hashName).join(" / ");throw errcode$a(new Error(`Hash '${i}' is unknown or not supported. Must be ${e}`),"ERR_UNSUPPORTED_HASH_TYPE")}const o=forgePbkdf2(e,t,r,n,s);return forgeUtil.encode64(o)}var pbkdf2_1=pbkdf2;const hmac$1=indexBrowser$1,aes=aes$1,keys$2=keys$3;src$5.aes=aes,src$5.hmac=hmac$1,src$5.keys=keys$2,src$5.randomBytes=randomBytes_1$1,src$5.pbkdf2=pbkdf2_1;var payload={exports:{}};!function(e){"function"==typeof commonjsRequire&&e&&e.exports&&(e.exports=function(e){var t,r=e.Reader,n=e.Writer,i=e.util,s=e.roots["libp2p-noise"]||(e.roots["libp2p-noise"]={});return s.pb=((t={}).NoiseHandshakePayload=function(){function t(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return t.prototype.identityKey=i.newBuffer([]),t.prototype.identitySig=i.newBuffer([]),t.prototype.data=i.newBuffer([]),t.create=function(e){return new t(e)},t.encode=function(e,t){return t||(t=n.create()),null!=e.identityKey&&Object.hasOwnProperty.call(e,"identityKey")&&t.uint32(10).bytes(e.identityKey),null!=e.identitySig&&Object.hasOwnProperty.call(e,"identitySig")&&t.uint32(18).bytes(e.identitySig),null!=e.data&&Object.hasOwnProperty.call(e,"data")&&t.uint32(26).bytes(e.data),t},t.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},t.decode=function(e,t){e instanceof r||(e=r.create(e));for(var n=void 0===t?e.len:e.pos+t,i=new s.pb.NoiseHandshakePayload;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:i.identityKey=e.bytes();break;case 2:i.identitySig=e.bytes();break;case 3:i.data=e.bytes();break;default:e.skipType(7&o)}}return i},t.decodeDelimited=function(e){return e instanceof r||(e=new r(e)),this.decode(e,e.uint32())},t.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.identityKey&&e.hasOwnProperty("identityKey")&&!(e.identityKey&&"number"==typeof e.identityKey.length||i.isString(e.identityKey))?"identityKey: buffer expected":null!=e.identitySig&&e.hasOwnProperty("identitySig")&&!(e.identitySig&&"number"==typeof e.identitySig.length||i.isString(e.identitySig))?"identitySig: buffer expected":null!=e.data&&e.hasOwnProperty("data")&&!(e.data&&"number"==typeof e.data.length||i.isString(e.data))?"data: buffer expected":null},t.fromObject=function(e){if(e instanceof s.pb.NoiseHandshakePayload)return e;var t=new s.pb.NoiseHandshakePayload;return null!=e.identityKey&&("string"==typeof e.identityKey?i.base64.decode(e.identityKey,t.identityKey=i.newBuffer(i.base64.length(e.identityKey)),0):e.identityKey.length&&(t.identityKey=e.identityKey)),null!=e.identitySig&&("string"==typeof e.identitySig?i.base64.decode(e.identitySig,t.identitySig=i.newBuffer(i.base64.length(e.identitySig)),0):e.identitySig.length&&(t.identitySig=e.identitySig)),null!=e.data&&("string"==typeof e.data?i.base64.decode(e.data,t.data=i.newBuffer(i.base64.length(e.data)),0):e.data.length&&(t.data=e.data)),t},t.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(t.bytes===String?r.identityKey="":(r.identityKey=[],t.bytes!==Array&&(r.identityKey=i.newBuffer(r.identityKey))),t.bytes===String?r.identitySig="":(r.identitySig=[],t.bytes!==Array&&(r.identitySig=i.newBuffer(r.identitySig))),t.bytes===String?r.data="":(r.data=[],t.bytes!==Array&&(r.data=i.newBuffer(r.data)))),null!=e.identityKey&&e.hasOwnProperty("identityKey")&&(r.identityKey=t.bytes===String?i.base64.encode(e.identityKey,0,e.identityKey.length):t.bytes===Array?Array.prototype.slice.call(e.identityKey):e.identityKey),null!=e.identitySig&&e.hasOwnProperty("identitySig")&&(r.identitySig=t.bytes===String?i.base64.encode(e.identitySig,0,e.identitySig.length):t.bytes===Array?Array.prototype.slice.call(e.identitySig):e.identitySig),null!=e.data&&e.hasOwnProperty("data")&&(r.data=t.bytes===String?i.base64.encode(e.data,0,e.data.length):t.bytes===Array?Array.prototype.slice.call(e.data):e.data),r},t.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},t}(),t),s}(minimal))}(payload);var __createBinding$1=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),__setModuleDefault$1=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar$1=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding$1(t,e,r);return __setModuleDefault$1(t,e),t},__importDefault$1=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(utils$q,"__esModule",{value:!0}),utils$q.isValidPublicKey=utils$q.getHkdf=utils$q.verifySignedPayload=utils$q.getHandshakePayload=utils$q.decodePayload=utils$q.getPeerIdFromPayload=utils$q.signPayload=utils$q.createHandshakePayload=utils$q.getPayload=utils$q.generateKeypair=void 0;const hkdf_1=hkdf,sha256_1=sha256$d,x25519$1=__importStar$1(x25519$2),buffer_1$7=require$$0$7,peer_id_1=__importDefault$1(src$6.exports),libp2p_crypto_1=src$5,payload_1=payload.exports,equals_1=require$$10$1,NoiseHandshakePayloadProto=payload_1.pb.NoiseHandshakePayload;function generateKeypair(){const e=x25519$1.generateKeyPair();return{publicKey:buffer_1$7.Buffer.from(e.publicKey.buffer,e.publicKey.byteOffset,e.publicKey.length),privateKey:buffer_1$7.Buffer.from(e.secretKey.buffer,e.secretKey.byteOffset,e.secretKey.length)}}async function getPayload(e,t,r){const n=await signPayload(e,getHandshakePayload(t)),i=null!=r?r:buffer_1$7.Buffer.alloc(0);return createHandshakePayload(e.marshalPubKey(),n,i)}function createHandshakePayload(e,t,r){const n=NoiseHandshakePayloadProto.create({identityKey:buffer_1$7.Buffer.from(e),identitySig:t,data:null!=r?r:null});return buffer_1$7.Buffer.from(NoiseHandshakePayloadProto.encode(n).finish())}async function signPayload(e,t){return buffer_1$7.Buffer.from(await e.privKey.sign(t))}async function getPeerIdFromPayload(e){return await peer_id_1.default.createFromPubKey(buffer_1$7.Buffer.from(e.identityKey))}function decodePayload(e){return NoiseHandshakePayloadProto.toObject(NoiseHandshakePayloadProto.decode(buffer_1$7.Buffer.from(e)))}function getHandshakePayload(e){return buffer_1$7.Buffer.concat([buffer_1$7.Buffer.from("noise-libp2p-static-key:"),e])}async function isValidPeerId(e,t){const r=await peer_id_1.default.createFromPubKey(t);return equals_1.equals(r.id,e)}async function verifySignedPayload(e,t,r){const n=buffer_1$7.Buffer.from(t.identityKey);if(!await isValidPeerId(r.id,n))throw new Error("Peer ID doesn't match libp2p public key.");const i=getHandshakePayload(e),s=libp2p_crypto_1.keys.unmarshalPublicKey(n);if(!t.identitySig||!s.verify(i,buffer_1$7.Buffer.from(t.identitySig)))throw new Error("Static key doesn't match to peer that signed payload!");return await peer_id_1.default.createFromPubKey(n)}function getHkdf(e,t){const r=new hkdf_1.HKDF(sha256_1.SHA256,t,e).expand(96),n=buffer_1$7.Buffer.from(r.buffer,r.byteOffset,r.length);return[n.slice(0,32),n.slice(32,64),n.slice(64,96)]}function isValidPublicKey(e){return!!buffer_1$7.Buffer.isBuffer(e)&&32===e.length}utils$q.generateKeypair=generateKeypair,utils$q.getPayload=getPayload,utils$q.createHandshakePayload=createHandshakePayload,utils$q.signPayload=signPayload,utils$q.getPeerIdFromPayload=getPeerIdFromPayload,utils$q.decodePayload=decodePayload,utils$q.getHandshakePayload=getHandshakePayload,utils$q.verifySignedPayload=verifySignedPayload,utils$q.getHkdf=getHkdf,utils$q.isValidPublicKey=isValidPublicKey;var abstractHandshake={},chacha20poly1305={},chacha={};Object.defineProperty(chacha,"__esModule",{value:!0});var binary_1=binary,wipe_1=wipe$1,ROUNDS=20;function core(e,t,r){for(var n=1634760805,i=857760878,s=2036477234,o=1797285236,a=r[3]<<24|r[2]<<16|r[1]<<8|r[0],u=r[7]<<24|r[6]<<16|r[5]<<8|r[4],c=r[11]<<24|r[10]<<16|r[9]<<8|r[8],l=r[15]<<24|r[14]<<16|r[13]<<8|r[12],h=r[19]<<24|r[18]<<16|r[17]<<8|r[16],d=r[23]<<24|r[22]<<16|r[21]<<8|r[20],f=r[27]<<24|r[26]<<16|r[25]<<8|r[24],p=r[31]<<24|r[30]<<16|r[29]<<8|r[28],y=t[3]<<24|t[2]<<16|t[1]<<8|t[0],g=t[7]<<24|t[6]<<16|t[5]<<8|t[4],$=t[11]<<24|t[10]<<16|t[9]<<8|t[8],m=t[15]<<24|t[14]<<16|t[13]<<8|t[12],b=n,v=i,_=s,w=o,E=a,S=u,A=c,T=l,I=h,P=d,R=f,C=p,B=y,k=g,K=$,O=m,N=0;N<ROUNDS;N+=2)E=(E^=I=I+(B=(B^=b=b+E|0)>>>16|B<<16)|0)>>>20|E<<12,S=(S^=P=P+(k=(k^=v=v+S|0)>>>16|k<<16)|0)>>>20|S<<12,A=(A^=R=R+(K=(K^=_=_+A|0)>>>16|K<<16)|0)>>>20|A<<12,T=(T^=C=C+(O=(O^=w=w+T|0)>>>16|O<<16)|0)>>>20|T<<12,A=(A^=R=R+(K=(K^=_=_+A|0)>>>24|K<<8)|0)>>>25|A<<7,T=(T^=C=C+(O=(O^=w=w+T|0)>>>24|O<<8)|0)>>>25|T<<7,S=(S^=P=P+(k=(k^=v=v+S|0)>>>24|k<<8)|0)>>>25|S<<7,E=(E^=I=I+(B=(B^=b=b+E|0)>>>24|B<<8)|0)>>>25|E<<7,S=(S^=R=R+(O=(O^=b=b+S|0)>>>16|O<<16)|0)>>>20|S<<12,A=(A^=C=C+(B=(B^=v=v+A|0)>>>16|B<<16)|0)>>>20|A<<12,T=(T^=I=I+(k=(k^=_=_+T|0)>>>16|k<<16)|0)>>>20|T<<12,E=(E^=P=P+(K=(K^=w=w+E|0)>>>16|K<<16)|0)>>>20|E<<12,T=(T^=I=I+(k=(k^=_=_+T|0)>>>24|k<<8)|0)>>>25|T<<7,E=(E^=P=P+(K=(K^=w=w+E|0)>>>24|K<<8)|0)>>>25|E<<7,A=(A^=C=C+(B=(B^=v=v+A|0)>>>24|B<<8)|0)>>>25|A<<7,S=(S^=R=R+(O=(O^=b=b+S|0)>>>24|O<<8)|0)>>>25|S<<7;binary_1.writeUint32LE(b+n|0,e,0),binary_1.writeUint32LE(v+i|0,e,4),binary_1.writeUint32LE(_+s|0,e,8),binary_1.writeUint32LE(w+o|0,e,12),binary_1.writeUint32LE(E+a|0,e,16),binary_1.writeUint32LE(S+u|0,e,20),binary_1.writeUint32LE(A+c|0,e,24),binary_1.writeUint32LE(T+l|0,e,28),binary_1.writeUint32LE(I+h|0,e,32),binary_1.writeUint32LE(P+d|0,e,36),binary_1.writeUint32LE(R+f|0,e,40),binary_1.writeUint32LE(C+p|0,e,44),binary_1.writeUint32LE(B+y|0,e,48),binary_1.writeUint32LE(k+g|0,e,52),binary_1.writeUint32LE(K+$|0,e,56),binary_1.writeUint32LE(O+m|0,e,60)}function streamXOR(e,t,r,n,i){if(void 0===i&&(i=0),32!==e.length)throw new Error("ChaCha: key size must be 32 bytes");if(n.length<r.length)throw new Error("ChaCha: destination is shorter than source");var s,o;if(0===i){if(8!==t.length&&12!==t.length)throw new Error("ChaCha nonce must be 8 or 12 bytes");o=(s=new Uint8Array(16)).length-t.length,s.set(t,o)}else{if(16!==t.length)throw new Error("ChaCha nonce with counter must be 16 bytes");s=t,o=i}for(var a=new Uint8Array(64),u=0;u<r.length;u+=64){core(a,s,e);for(var c=u;c<u+64&&c<r.length;c++)n[c]=r[c]^a[c-u];incrementCounter(s,0,o)}return wipe_1.wipe(a),0===i&&wipe_1.wipe(s),n}function stream$1(e,t,r,n){return void 0===n&&(n=0),wipe_1.wipe(r),streamXOR(e,t,r,r,n)}function incrementCounter(e,t,r){for(var n=1;r--;)n=n+(255&e[t])|0,e[t]=255&n,n>>>=8,t++;if(n>0)throw new Error("ChaCha: counter overflow")}chacha.streamXOR=streamXOR,chacha.stream=stream$1;var poly1305={};!function(e){Object.defineProperty(e,"__esModule",{value:!0});var t=constantTime,r=wipe$1;e.DIGEST_LENGTH=16;var n=function(){function t(t){this.digestLength=e.DIGEST_LENGTH,this._buffer=new Uint8Array(16),this._r=new Uint16Array(10),this._h=new Uint16Array(10),this._pad=new Uint16Array(8),this._leftover=0,this._fin=0,this._finished=!1;var r=t[0]|t[1]<<8;this._r[0]=8191&r;var n=t[2]|t[3]<<8;this._r[1]=8191&(r>>>13|n<<3);var i=t[4]|t[5]<<8;this._r[2]=7939&(n>>>10|i<<6);var s=t[6]|t[7]<<8;this._r[3]=8191&(i>>>7|s<<9);var o=t[8]|t[9]<<8;this._r[4]=255&(s>>>4|o<<12),this._r[5]=o>>>1&8190;var a=t[10]|t[11]<<8;this._r[6]=8191&(o>>>14|a<<2);var u=t[12]|t[13]<<8;this._r[7]=8065&(a>>>11|u<<5);var c=t[14]|t[15]<<8;this._r[8]=8191&(u>>>8|c<<8),this._r[9]=c>>>5&127,this._pad[0]=t[16]|t[17]<<8,this._pad[1]=t[18]|t[19]<<8,this._pad[2]=t[20]|t[21]<<8,this._pad[3]=t[22]|t[23]<<8,this._pad[4]=t[24]|t[25]<<8,this._pad[5]=t[26]|t[27]<<8,this._pad[6]=t[28]|t[29]<<8,this._pad[7]=t[30]|t[31]<<8}return t.prototype._blocks=function(e,t,r){for(var n=this._fin?0:2048,i=this._h[0],s=this._h[1],o=this._h[2],a=this._h[3],u=this._h[4],c=this._h[5],l=this._h[6],h=this._h[7],d=this._h[8],f=this._h[9],p=this._r[0],y=this._r[1],g=this._r[2],$=this._r[3],m=this._r[4],b=this._r[5],v=this._r[6],_=this._r[7],w=this._r[8],E=this._r[9];r>=16;){var S=e[t+0]|e[t+1]<<8;i+=8191&S;var A=e[t+2]|e[t+3]<<8;s+=8191&(S>>>13|A<<3);var T=e[t+4]|e[t+5]<<8;o+=8191&(A>>>10|T<<6);var I=e[t+6]|e[t+7]<<8;a+=8191&(T>>>7|I<<9);var P=e[t+8]|e[t+9]<<8;u+=8191&(I>>>4|P<<12),c+=P>>>1&8191;var R=e[t+10]|e[t+11]<<8;l+=8191&(P>>>14|R<<2);var C=e[t+12]|e[t+13]<<8;h+=8191&(R>>>11|C<<5);var B=e[t+14]|e[t+15]<<8,k=0,K=k;K+=i*p,K+=s*(5*E),K+=o*(5*w),K+=a*(5*_),k=(K+=u*(5*v))>>>13,K&=8191,K+=c*(5*b),K+=l*(5*m),K+=h*(5*$),K+=(d+=8191&(C>>>8|B<<8))*(5*g);var O=k+=(K+=(f+=B>>>5|n)*(5*y))>>>13;O+=i*y,O+=s*p,O+=o*(5*E),O+=a*(5*w),k=(O+=u*(5*_))>>>13,O&=8191,O+=c*(5*v),O+=l*(5*b),O+=h*(5*m),O+=d*(5*$),k+=(O+=f*(5*g))>>>13,O&=8191;var N=k;N+=i*g,N+=s*y,N+=o*p,N+=a*(5*E),k=(N+=u*(5*w))>>>13,N&=8191,N+=c*(5*_),N+=l*(5*v),N+=h*(5*b),N+=d*(5*m);var D=k+=(N+=f*(5*$))>>>13;D+=i*$,D+=s*g,D+=o*y,D+=a*p,k=(D+=u*(5*E))>>>13,D&=8191,D+=c*(5*w),D+=l*(5*_),D+=h*(5*v),D+=d*(5*b);var M=k+=(D+=f*(5*m))>>>13;M+=i*m,M+=s*$,M+=o*g,M+=a*y,k=(M+=u*p)>>>13,M&=8191,M+=c*(5*E),M+=l*(5*w),M+=h*(5*_),M+=d*(5*v);var L=k+=(M+=f*(5*b))>>>13;L+=i*b,L+=s*m,L+=o*$,L+=a*g,k=(L+=u*y)>>>13,L&=8191,L+=c*p,L+=l*(5*E),L+=h*(5*w),L+=d*(5*_);var x=k+=(L+=f*(5*v))>>>13;x+=i*v,x+=s*b,x+=o*m,x+=a*$,k=(x+=u*g)>>>13,x&=8191,x+=c*y,x+=l*p,x+=h*(5*E),x+=d*(5*w);var U=k+=(x+=f*(5*_))>>>13;U+=i*_,U+=s*v,U+=o*b,U+=a*m,k=(U+=u*$)>>>13,U&=8191,U+=c*g,U+=l*y,U+=h*p,U+=d*(5*E);var j=k+=(U+=f*(5*w))>>>13;j+=i*w,j+=s*_,j+=o*v,j+=a*b,k=(j+=u*m)>>>13,j&=8191,j+=c*$,j+=l*g,j+=h*y,j+=d*p;var q=k+=(j+=f*(5*E))>>>13;q+=i*E,q+=s*w,q+=o*_,q+=a*v,k=(q+=u*b)>>>13,q&=8191,q+=c*m,q+=l*$,q+=h*g,q+=d*y,i=K=8191&(k=(k=((k+=(q+=f*p)>>>13)<<2)+k|0)+(K&=8191)|0),s=O+=k>>>=13,o=N&=8191,a=D&=8191,u=M&=8191,c=L&=8191,l=x&=8191,h=U&=8191,d=j&=8191,f=q&=8191,t+=16,r-=16}this._h[0]=i,this._h[1]=s,this._h[2]=o,this._h[3]=a,this._h[4]=u,this._h[5]=c,this._h[6]=l,this._h[7]=h,this._h[8]=d,this._h[9]=f},t.prototype.finish=function(e,t){void 0===t&&(t=0);var r,n,i,s,o=new Uint16Array(10);if(this._leftover){for(s=this._leftover,this._buffer[s++]=1;s<16;s++)this._buffer[s]=0;this._fin=1,this._blocks(this._buffer,0,16)}for(r=this._h[1]>>>13,this._h[1]&=8191,s=2;s<10;s++)this._h[s]+=r,r=this._h[s]>>>13,this._h[s]&=8191;for(this._h[0]+=5*r,r=this._h[0]>>>13,this._h[0]&=8191,this._h[1]+=r,r=this._h[1]>>>13,this._h[1]&=8191,this._h[2]+=r,o[0]=this._h[0]+5,r=o[0]>>>13,o[0]&=8191,s=1;s<10;s++)o[s]=this._h[s]+r,r=o[s]>>>13,o[s]&=8191;for(o[9]-=8192,n=(1^r)-1,s=0;s<10;s++)o[s]&=n;for(n=~n,s=0;s<10;s++)this._h[s]=this._h[s]&n|o[s];for(this._h[0]=65535&(this._h[0]|this._h[1]<<13),this._h[1]=65535&(this._h[1]>>>3|this._h[2]<<10),this._h[2]=65535&(this._h[2]>>>6|this._h[3]<<7),this._h[3]=65535&(this._h[3]>>>9|this._h[4]<<4),this._h[4]=65535&(this._h[4]>>>12|this._h[5]<<1|this._h[6]<<14),this._h[5]=65535&(this._h[6]>>>2|this._h[7]<<11),this._h[6]=65535&(this._h[7]>>>5|this._h[8]<<8),this._h[7]=65535&(this._h[8]>>>8|this._h[9]<<5),i=this._h[0]+this._pad[0],this._h[0]=65535&i,s=1;s<8;s++)i=(this._h[s]+this._pad[s]|0)+(i>>>16)|0,this._h[s]=65535&i;return e[t+0]=this._h[0]>>>0,e[t+1]=this._h[0]>>>8,e[t+2]=this._h[1]>>>0,e[t+3]=this._h[1]>>>8,e[t+4]=this._h[2]>>>0,e[t+5]=this._h[2]>>>8,e[t+6]=this._h[3]>>>0,e[t+7]=this._h[3]>>>8,e[t+8]=this._h[4]>>>0,e[t+9]=this._h[4]>>>8,e[t+10]=this._h[5]>>>0,e[t+11]=this._h[5]>>>8,e[t+12]=this._h[6]>>>0,e[t+13]=this._h[6]>>>8,e[t+14]=this._h[7]>>>0,e[t+15]=this._h[7]>>>8,this._finished=!0,this},t.prototype.update=function(e){var t,r=0,n=e.length;if(this._leftover){(t=16-this._leftover)>n&&(t=n);for(var i=0;i<t;i++)this._buffer[this._leftover+i]=e[r+i];if(n-=t,r+=t,this._leftover+=t,this._leftover<16)return this;this._blocks(this._buffer,0,16),this._leftover=0}if(n>=16&&(t=n-n%16,this._blocks(e,r,t),r+=t,n-=t),n){for(i=0;i<n;i++)this._buffer[this._leftover+i]=e[r+i];this._leftover+=n}return this},t.prototype.digest=function(){if(this._finished)throw new Error("Poly1305 was finished");var e=new Uint8Array(16);return this.finish(e),e},t.prototype.clean=function(){return r.wipe(this._buffer),r.wipe(this._r),r.wipe(this._h),r.wipe(this._pad),this._leftover=0,this._fin=0,this._finished=!0,this},t}();e.Poly1305=n,e.oneTimeAuth=function(e,t){var r=new n(e);r.update(t);var i=r.digest();return r.clean(),i},e.equal=function(r,n){return r.length===e.DIGEST_LENGTH&&n.length===e.DIGEST_LENGTH&&t.equal(r,n)}}(poly1305),function(e){Object.defineProperty(e,"__esModule",{value:!0});var t=chacha,r=poly1305,n=wipe$1,i=binary,s=constantTime;e.KEY_LENGTH=32,e.NONCE_LENGTH=12,e.TAG_LENGTH=16;var o=new Uint8Array(16),a=function(){function a(t){if(this.nonceLength=e.NONCE_LENGTH,this.tagLength=e.TAG_LENGTH,t.length!==e.KEY_LENGTH)throw new Error("ChaCha20Poly1305 needs 32-byte key");this._key=new Uint8Array(t)}return a.prototype.seal=function(e,r,i,s){if(e.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");var o=new Uint8Array(16);o.set(e,o.length-e.length);var a=new Uint8Array(32);t.stream(this._key,o,a,4);var u,c=r.length+this.tagLength;if(s){if(s.length!==c)throw new Error("ChaCha20Poly1305: incorrect destination length");u=s}else u=new Uint8Array(c);return t.streamXOR(this._key,o,r,u,4),this._authenticate(u.subarray(u.length-this.tagLength,u.length),a,u.subarray(0,u.length-this.tagLength),i),n.wipe(o),u},a.prototype.open=function(e,r,i,o){if(e.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");if(r.length<this.tagLength)return null;var a=new Uint8Array(16);a.set(e,a.length-e.length);var u=new Uint8Array(32);t.stream(this._key,a,u,4);var c=new Uint8Array(this.tagLength);if(this._authenticate(c,u,r.subarray(0,r.length-this.tagLength),i),!s.equal(c,r.subarray(r.length-this.tagLength,r.length)))return null;var l,h=r.length-this.tagLength;if(o){if(o.length!==h)throw new Error("ChaCha20Poly1305: incorrect destination length");l=o}else l=new Uint8Array(h);return t.streamXOR(this._key,a,r.subarray(0,r.length-this.tagLength),l,4),n.wipe(a),l},a.prototype.clean=function(){return n.wipe(this._key),this},a.prototype._authenticate=function(e,t,s,a){var u=new r.Poly1305(t);a&&(u.update(a),a.length%16>0&&u.update(o.subarray(a.length%16))),u.update(s),s.length%16>0&&u.update(o.subarray(s.length%16));var c=new Uint8Array(8);a&&i.writeUint64LE(a.length,c),u.update(c),i.writeUint64LE(s.length,c),u.update(c);for(var l=u.digest(),h=0;h<l.length;h++)e[h]=l[h];u.clean(),n.wipe(l),n.wipe(c)},a}();e.ChaCha20Poly1305=a}(chacha20poly1305);var logger={};Object.defineProperty(exports,"__esModule",{value:!0}),exports.DUMP_SESSION_KEYS=exports.NOISE_MSG_MAX_LENGTH_BYTES_WITHOUT_TAG=exports.NOISE_MSG_MAX_LENGTH_BYTES=void 0,exports.NOISE_MSG_MAX_LENGTH_BYTES=65535,exports.NOISE_MSG_MAX_LENGTH_BYTES_WITHOUT_TAG=exports.NOISE_MSG_MAX_LENGTH_BYTES-16,exports.DUMP_SESSION_KEYS=process.env.DUMP_SESSION_KEYS;var constants=Object.freeze({__proto__:null}),require$$15=getAugmentedNamespace(constants);!function(e){var t=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(e,"__esModule",{value:!0}),e.logCipherState=e.logRemoteEphemeralKey=e.logRemoteStaticKey=e.logLocalEphemeralKeys=e.logLocalStaticKeys=e.logger=void 0;const r=t(require$$0$b),n=require$$15;let i;e.logger=r.default("libp2p:noise"),i=n.DUMP_SESSION_KEYS?e.logger:()=>{},e.logLocalStaticKeys=function(e){i(`LOCAL_STATIC_PUBLIC_KEY ${e.publicKey.toString("hex")}`),i(`LOCAL_STATIC_PRIVATE_KEY ${e.privateKey.toString("hex")}`)},e.logLocalEphemeralKeys=function(e){e?(i(`LOCAL_PUBLIC_EPHEMERAL_KEY ${e.publicKey.toString("hex")}`),i(`LOCAL_PRIVATE_EPHEMERAL_KEY ${e.privateKey.toString("hex")}`)):i("Missing local ephemeral keys.")},e.logRemoteStaticKey=function(e){i(`REMOTE_STATIC_PUBLIC_KEY ${e.toString("hex")}`)},e.logRemoteEphemeralKey=function(e){i(`REMOTE_EPHEMERAL_PUBLIC_KEY ${e.toString("hex")}`)},e.logCipherState=function(e){e.cs1&&e.cs2?(i(`CIPHER_STATE_1 ${e.cs1.n} ${e.cs1.k.toString("hex")}`),i(`CIPHER_STATE_2 ${e.cs2.n} ${e.cs2.k.toString("hex")}`)):i("Missing cipher state.")}}(logger),function(e){var t=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),r=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&t(n,e,i);return r(n,e),n};Object.defineProperty(e,"__esModule",{value:!0}),e.AbstractHandshake=e.MIN_NONCE=void 0;const i=require$$0$7,s=n(x25519$2),o=n(sha256$d),a=chacha20poly1305,u=utils$q,c=logger;e.MIN_NONCE=0;e.AbstractHandshake=class{encryptWithAd(e,t,r){const n=this.encrypt(e.k,e.n,t,r);return this.setNonce(e,this.incrementNonce(e.n)),n}decryptWithAd(e,t,r){const{plaintext:n,valid:i}=this.decrypt(e.k,e.n,t,r);return this.setNonce(e,this.incrementNonce(e.n)),{plaintext:n,valid:i}}hasKey(e){return!this.isEmptyKey(e.k)}setNonce(e,t){e.n=t}createEmptyKey(){return i.Buffer.alloc(32)}isEmptyKey(e){return this.createEmptyKey().equals(e)}incrementNonce(e){return e+1}nonceToBytes(e){const t=i.Buffer.alloc(12);return t.writeUInt32LE(e,4),t}encrypt(e,t,r,n){const s=this.nonceToBytes(t),o=new a.ChaCha20Poly1305(e).seal(s,n,r);return i.Buffer.from(o.buffer,o.byteOffset,o.length)}encryptAndHash(e,t){let r;return r=this.hasKey(e.cs)?this.encryptWithAd(e.cs,e.h,t):t,this.mixHash(e,r),r}decrypt(e,t,r,n){const s=this.nonceToBytes(t),o=new a.ChaCha20Poly1305(e).open(s,n,r);return o?{plaintext:i.Buffer.from(o.buffer,o.byteOffset,o.length),valid:!0}:{plaintext:i.Buffer.from(""),valid:!1}}decryptAndHash(e,t){let r,n=!0;return this.hasKey(e.cs)?({plaintext:r,valid:n}=this.decryptWithAd(e.cs,e.h,t)):r=t,this.mixHash(e,t),{plaintext:r,valid:n}}dh(e,t){try{const r=s.sharedKey(e,t),n=i.Buffer.from(r.buffer,r.byteOffset,r.length),o=i.Buffer.alloc(32);return n.copy(o),o}catch(e){return c.logger(e.message),i.Buffer.alloc(32)}}mixHash(e,t){e.h=this.getHash(e.h,t)}getHash(e,t){const r=o.hash(i.Buffer.from([...e,...t]));return i.Buffer.from(r.buffer,r.byteOffset,r.length)}mixKey(e,t){const[r,n]=u.getHkdf(e.ck,t);e.cs=this.initializeKey(n),e.ck=r}initializeKey(t){return{k:t,n:e.MIN_NONCE}}initializeSymmetric(e){const t=i.Buffer.from(e,"utf-8"),r=this.hashProtocolName(t),n=r,s=this.createEmptyKey();return{cs:this.initializeKey(s),ck:n,h:r}}hashProtocolName(e){if(e.length<=32){const t=i.Buffer.alloc(32);return e.copy(t),t}return this.getHash(e,i.Buffer.alloc(0))}split(e){const[t,r]=u.getHkdf(e.ck,i.Buffer.alloc(0));return{cs1:this.initializeKey(t),cs2:this.initializeKey(r)}}writeMessageRegular(e,t){const r=this.encryptWithAd(e,i.Buffer.alloc(0),t);return{ne:this.createEmptyKey(),ns:i.Buffer.alloc(0),ciphertext:r}}readMessageRegular(e,t){return this.decryptWithAd(e,i.Buffer.alloc(0),t.ciphertext)}}}(abstractHandshake),Object.defineProperty(xx,"__esModule",{value:!0}),xx.XX=void 0;const buffer_1$6=require$$0$7,utils_1$5=utils$q,abstract_handshake_1$1=abstractHandshake;class XX extends abstract_handshake_1$1.AbstractHandshake{initializeInitiator(e,t,r,n){const i=this.initializeSymmetric("Noise_XX_25519_ChaChaPoly_SHA256");this.mixHash(i,e);return{ss:i,s:t,rs:r,psk:n,re:buffer_1$6.Buffer.alloc(32)}}initializeResponder(e,t,r,n){const i=this.initializeSymmetric("Noise_XX_25519_ChaChaPoly_SHA256");this.mixHash(i,e);return{ss:i,s:t,rs:r,psk:n,re:buffer_1$6.Buffer.alloc(32)}}writeMessageA(e,t,r){const n=buffer_1$6.Buffer.alloc(0);e.e=void 0!==r?r:utils_1$5.generateKeypair();const i=e.e.publicKey;this.mixHash(e.ss,i);return{ne:i,ns:n,ciphertext:this.encryptAndHash(e.ss,t)}}writeMessageB(e,t){e.e=utils_1$5.generateKeypair();const r=e.e.publicKey;this.mixHash(e.ss,r),this.mixKey(e.ss,this.dh(e.e.privateKey,e.re));const n=buffer_1$6.Buffer.from(e.s.publicKey),i=this.encryptAndHash(e.ss,n);this.mixKey(e.ss,this.dh(e.s.privateKey,e.re));return{ne:r,ns:i,ciphertext:this.encryptAndHash(e.ss,t)}}writeMessageC(e,t){const r=buffer_1$6.Buffer.from(e.s.publicKey),n=this.encryptAndHash(e.ss,r);this.mixKey(e.ss,this.dh(e.s.privateKey,e.re));const i=this.encryptAndHash(e.ss,t),s={ne:this.createEmptyKey(),ns:n,ciphertext:i},{cs1:o,cs2:a}=this.split(e.ss);return{h:e.ss.h,messageBuffer:s,cs1:o,cs2:a}}readMessageA(e,t){return utils_1$5.isValidPublicKey(t.ne)&&(e.re=t.ne),this.mixHash(e.ss,e.re),this.decryptAndHash(e.ss,t.ciphertext)}readMessageB(e,t){if(utils_1$5.isValidPublicKey(t.ne)&&(e.re=t.ne),this.mixHash(e.ss,e.re),!e.e)throw new Error("Handshake state `e` param is missing.");this.mixKey(e.ss,this.dh(e.e.privateKey,e.re));const{plaintext:r,valid:n}=this.decryptAndHash(e.ss,t.ns);n&&32===r.length&&utils_1$5.isValidPublicKey(r)&&(e.rs=r),this.mixKey(e.ss,this.dh(e.e.privateKey,e.rs));const{plaintext:i,valid:s}=this.decryptAndHash(e.ss,t.ciphertext);return{plaintext:i,valid:n&&s}}readMessageC(e,t){const{plaintext:r,valid:n}=this.decryptAndHash(e.ss,t.ns);if(n&&32===r.length&&utils_1$5.isValidPublicKey(r)&&(e.rs=r),!e.e)throw new Error("Handshake state `e` param is missing.");this.mixKey(e.ss,this.dh(e.e.privateKey,e.rs));const{plaintext:i,valid:s}=this.decryptAndHash(e.ss,t.ciphertext),{cs1:o,cs2:a}=this.split(e.ss);return{h:e.ss.h,plaintext:i,valid:n&&s,cs1:o,cs2:a}}initSession(e,t,r){const n=this.createEmptyKey(),i=buffer_1$6.Buffer.alloc(32);let s;return s=e?this.initializeInitiator(t,r,i,n):this.initializeResponder(t,r,i,n),{hs:s,i:e,mc:0}}sendMessage(e,t,r){let n;if(0===e.mc)n=this.writeMessageA(e.hs,t,r);else if(1===e.mc)n=this.writeMessageB(e.hs,t);else if(2===e.mc){const{h:r,messageBuffer:i,cs1:s,cs2:o}=this.writeMessageC(e.hs,t);n=i,e.h=r,e.cs1=s,e.cs2=o}else{if(!(e.mc>2))throw new Error("Session invalid.");if(e.i){if(!e.cs1)throw new Error("CS1 (cipher state) is not defined");n=this.writeMessageRegular(e.cs1,t)}else{if(!e.cs2)throw new Error("CS2 (cipher state) is not defined");n=this.writeMessageRegular(e.cs2,t)}}return e.mc++,n}recvMessage(e,t){let r=buffer_1$6.Buffer.alloc(0),n=!1;if(0===e.mc)({plaintext:r,valid:n}=this.readMessageA(e.hs,t));else if(1===e.mc)({plaintext:r,valid:n}=this.readMessageB(e.hs,t));else if(2===e.mc){const{h:i,plaintext:s,valid:o,cs1:a,cs2:u}=this.readMessageC(e.hs,t);r=s,n=o,e.h=i,e.cs1=a,e.cs2=u}return e.mc++,{plaintext:r,valid:n}}}xx.XX=XX;var encoder$1={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.decode2=e.decode1=e.decode0=e.encode2=e.encode1=e.encode0=e.uint16BEDecode=e.uint16BEEncode=void 0;const t=require$$0$7;e.uint16BEEncode=(e,r,n)=>((r=r||t.Buffer.allocUnsafe(2)).writeUInt16BE(e,n),r),e.uint16BEEncode.bytes=2;e.uint16BEDecode=e=>{if(e.length<2)throw RangeError("Could not decode int16BE");return e.readUInt16BE(0)},e.uint16BEDecode.bytes=2,e.encode0=function(e){return t.Buffer.concat([e.ne,e.ciphertext])},e.encode1=function(e){return t.Buffer.concat([e.ne,e.ns,e.ciphertext])},e.encode2=function(e){return t.Buffer.concat([e.ns,e.ciphertext])},e.decode0=function(e){if(e.length<32)throw new Error("Cannot decode stage 0 MessageBuffer: length less than 32 bytes.");return{ne:e.slice(0,32),ciphertext:e.slice(32,e.length),ns:t.Buffer.alloc(0)}},e.decode1=function(e){if(e.length<80)throw new Error("Cannot decode stage 1 MessageBuffer: length less than 80 bytes.");return{ne:e.slice(0,32),ns:e.slice(32,80),ciphertext:e.slice(80,e.length)}},e.decode2=function(e){if(e.length<48)throw new Error("Cannot decode stage 2 MessageBuffer: length less than 48 bytes.");return{ne:t.Buffer.alloc(0),ns:e.slice(0,48),ciphertext:e.slice(48,e.length)}}}(encoder$1),Object.defineProperty(handshakeXx,"__esModule",{value:!0}),handshakeXx.XXHandshake=void 0;const buffer_1$5=require$$0$7,xx_1=xx,utils_1$4=utils$q,logger_1$3=logger,encoder_1$3=encoder$1;class XXHandshake{constructor(e,t,r,n,i,s,o){this.isInitiator=e,this.payload=t,this.prologue=r,this.staticKeypair=n,this.connection=i,s&&(this.remotePeer=s),this.xx=null!=o?o:new xx_1.XX,this.session=this.xx.initSession(this.isInitiator,this.prologue,this.staticKeypair),this.remoteEarlyData=buffer_1$5.Buffer.alloc(0)}async propose(){if(logger_1$3.logLocalStaticKeys(this.session.hs.s),this.isInitiator){logger_1$3.logger("Stage 0 - Initiator starting to send first message.");const e=this.xx.sendMessage(this.session,buffer_1$5.Buffer.alloc(0));this.connection.writeLP(encoder_1$3.encode0(e)),logger_1$3.logger("Stage 0 - Initiator finished sending first message."),logger_1$3.logLocalEphemeralKeys(this.session.hs.e)}else{logger_1$3.logger("Stage 0 - Responder waiting to receive first message...");const e=encoder_1$3.decode0((await this.connection.readLP()).slice()),{valid:t}=this.xx.recvMessage(this.session,e);if(!t)throw new Error("xx handshake stage 0 validation fail");logger_1$3.logger("Stage 0 - Responder received first message."),logger_1$3.logRemoteEphemeralKey(this.session.hs.re)}}async exchange(){if(this.isInitiator){logger_1$3.logger("Stage 1 - Initiator waiting to receive first message from responder...");const e=encoder_1$3.decode1((await this.connection.readLP()).slice()),{plaintext:t,valid:r}=this.xx.recvMessage(this.session,e);if(!r)throw new Error("xx handshake stage 1 validation fail");logger_1$3.logger("Stage 1 - Initiator received the message."),logger_1$3.logRemoteEphemeralKey(this.session.hs.re),logger_1$3.logRemoteStaticKey(this.session.hs.rs),logger_1$3.logger("Initiator going to check remote's signature...");try{const r=await utils_1$4.decodePayload(t);this.remotePeer=this.remotePeer||await utils_1$4.getPeerIdFromPayload(r),this.remotePeer=await utils_1$4.verifySignedPayload(e.ns,r,this.remotePeer),this.setRemoteEarlyData(r.data)}catch(e){throw new Error(`Error occurred while verifying signed payload: ${e.message}`)}logger_1$3.logger("All good with the signature!")}else{logger_1$3.logger("Stage 1 - Responder sending out first message with signed payload and static key.");const e=this.xx.sendMessage(this.session,this.payload);this.connection.writeLP(encoder_1$3.encode1(e)),logger_1$3.logger("Stage 1 - Responder sent the second handshake message with signed payload."),logger_1$3.logLocalEphemeralKeys(this.session.hs.e)}}async finish(){if(this.isInitiator){logger_1$3.logger("Stage 2 - Initiator sending third handshake message.");const e=this.xx.sendMessage(this.session,this.payload);this.connection.writeLP(encoder_1$3.encode2(e)),logger_1$3.logger("Stage 2 - Initiator sent message with signed payload.")}else{logger_1$3.logger("Stage 2 - Responder waiting for third handshake message...");const e=encoder_1$3.decode2((await this.connection.readLP()).slice()),{plaintext:t,valid:r}=this.xx.recvMessage(this.session,e);if(!r)throw new Error("xx handshake stage 2 validation fail");logger_1$3.logger("Stage 2 - Responder received the message, finished handshake.");try{const e=await utils_1$4.decodePayload(t);this.remotePeer=this.remotePeer||await utils_1$4.getPeerIdFromPayload(e),await utils_1$4.verifySignedPayload(this.session.hs.rs,e,this.remotePeer),this.setRemoteEarlyData(e.data)}catch(e){throw new Error(`Error occurred while verifying signed payload: ${e.message}`)}}logger_1$3.logCipherState(this.session)}encrypt(e,t){const r=this.getCS(t);return this.xx.encryptWithAd(r,buffer_1$5.Buffer.alloc(0),e)}decrypt(e,t){const r=this.getCS(t,!1);return this.xx.decryptWithAd(r,buffer_1$5.Buffer.alloc(0),e)}getRemoteStaticKey(){return this.session.hs.rs}getCS(e,t=!0){if(!e.cs1||!e.cs2)throw new Error("Handshake not completed properly, cipher state does not exist.");return this.isInitiator?t?e.cs1:e.cs2:t?e.cs2:e.cs1}setRemoteEarlyData(e){e&&(this.remoteEarlyData=buffer_1$5.Buffer.from(e.buffer,e.byteOffset,e.length))}}handshakeXx.XXHandshake=XXHandshake;var handshakeIk={},ik={};Object.defineProperty(ik,"__esModule",{value:!0}),ik.IK=void 0;const buffer_1$4=require$$0$7,utils_1$3=utils$q,abstract_handshake_1=abstractHandshake;class IK extends abstract_handshake_1.AbstractHandshake{initSession(e,t,r,n){const i=this.createEmptyKey();let s;return s=e?this.initializeInitiator(t,r,n,i):this.initializeResponder(t,r,n,i),{hs:s,i:e,mc:0}}sendMessage(e,t){let r;if(0===e.mc)r=this.writeMessageA(e.hs,t);else if(1===e.mc){const{messageBuffer:n,h:i,cs1:s,cs2:o}=this.writeMessageB(e.hs,t);r=n,e.h=i,e.cs1=s,e.cs2=o}else{if(!(e.mc>1))throw new Error("Session invalid.");if(e.i){if(!e.cs1)throw new Error("CS1 (cipher state) is not defined");r=this.writeMessageRegular(e.cs1,t)}else{if(!e.cs2)throw new Error("CS2 (cipher state) is not defined");r=this.writeMessageRegular(e.cs2,t)}}return e.mc++,r}recvMessage(e,t){let r=buffer_1$4.Buffer.alloc(0),n=!1;if(0===e.mc&&({plaintext:r,valid:n}=this.readMessageA(e.hs,t)),1===e.mc){const{plaintext:i,valid:s,h:o,cs1:a,cs2:u}=this.readMessageB(e.hs,t);r=i,n=s,e.h=o,e.cs1=a,e.cs2=u}return e.mc++,{plaintext:r,valid:n}}writeMessageA(e,t){e.e=utils_1$3.generateKeypair();const r=e.e.publicKey;this.mixHash(e.ss,r),this.mixKey(e.ss,this.dh(e.e.privateKey,e.rs));const n=buffer_1$4.Buffer.from(e.s.publicKey),i=this.encryptAndHash(e.ss,n);this.mixKey(e.ss,this.dh(e.s.privateKey,e.rs));return{ne:r,ns:i,ciphertext:this.encryptAndHash(e.ss,t)}}writeMessageB(e,t){e.e=utils_1$3.generateKeypair();const r=e.e.publicKey;this.mixHash(e.ss,r),this.mixKey(e.ss,this.dh(e.e.privateKey,e.re)),this.mixKey(e.ss,this.dh(e.e.privateKey,e.rs));const n=this.encryptAndHash(e.ss,t),i={ne:r,ns:this.createEmptyKey(),ciphertext:n},{cs1:s,cs2:o}=this.split(e.ss);return{messageBuffer:i,cs1:s,cs2:o,h:e.ss.h}}readMessageA(e,t){utils_1$3.isValidPublicKey(t.ne)&&(e.re=t.ne),this.mixHash(e.ss,e.re),this.mixKey(e.ss,this.dh(e.s.privateKey,e.re));const{plaintext:r,valid:n}=this.decryptAndHash(e.ss,t.ns);n&&32===r.length&&utils_1$3.isValidPublicKey(r)&&(e.rs=r),this.mixKey(e.ss,this.dh(e.s.privateKey,e.rs));const{plaintext:i,valid:s}=this.decryptAndHash(e.ss,t.ciphertext);return{plaintext:i,valid:n&&s}}readMessageB(e,t){if(utils_1$3.isValidPublicKey(t.ne)&&(e.re=t.ne),this.mixHash(e.ss,e.re),!e.e)throw new Error("Handshake state should contain ephemeral key by now.");this.mixKey(e.ss,this.dh(e.e.privateKey,e.re)),this.mixKey(e.ss,this.dh(e.s.privateKey,e.re));const{plaintext:r,valid:n}=this.decryptAndHash(e.ss,t.ciphertext),{cs1:i,cs2:s}=this.split(e.ss);return{h:e.ss.h,valid:n,plaintext:r,cs1:i,cs2:s}}initializeInitiator(e,t,r,n){const i=this.initializeSymmetric("Noise_IK_25519_ChaChaPoly_SHA256");this.mixHash(i,e),this.mixHash(i,r);return{ss:i,s:t,rs:r,re:buffer_1$4.Buffer.alloc(32),psk:n}}initializeResponder(e,t,r,n){const i=this.initializeSymmetric("Noise_IK_25519_ChaChaPoly_SHA256");this.mixHash(i,e),this.mixHash(i,t.publicKey);return{ss:i,s:t,rs:r,re:buffer_1$4.Buffer.alloc(32),psk:n}}}ik.IK=IK;var errors$1={};Object.defineProperty(errors$1,"__esModule",{value:!0}),errors$1.FailedIKError=void 0;class FailedIKError extends Error{constructor(e,t){super(t),this.initialMsg=e,this.name="FailedIKhandshake"}}errors$1.FailedIKError=FailedIKError,Object.defineProperty(handshakeIk,"__esModule",{value:!0}),handshakeIk.IKHandshake=void 0;const ik_1=ik,buffer_1$3=require$$0$7,encoder_1$2=encoder$1,utils_1$2=utils$q,errors_1=errors$1,logger_1$2=logger;class IKHandshake{constructor(e,t,r,n,i,s,o,a){this.isInitiator=e,this.payload=buffer_1$3.Buffer.from(t),this.prologue=r,this.staticKeypair=n,this.connection=i,o&&(this.remotePeer=o),this.ik=null!=a?a:new ik_1.IK,this.session=this.ik.initSession(this.isInitiator,this.prologue,this.staticKeypair,s),this.remoteEarlyData=buffer_1$3.Buffer.alloc(0)}async stage0(){if(logger_1$2.logLocalStaticKeys(this.session.hs.s),logger_1$2.logRemoteStaticKey(this.session.hs.rs),this.isInitiator){logger_1$2.logger("IK Stage 0 - Initiator sending message...");const e=this.ik.sendMessage(this.session,this.payload);this.connection.writeLP(encoder_1$2.encode1(e)),logger_1$2.logger("IK Stage 0 - Initiator sent message."),logger_1$2.logLocalEphemeralKeys(this.session.hs.e)}else{logger_1$2.logger("IK Stage 0 - Responder receiving message...");const e=await this.connection.readLP();try{const t=encoder_1$2.decode1(e.slice()),{plaintext:r,valid:n}=this.ik.recvMessage(this.session,t);if(!n)throw new Error("ik handshake stage 0 decryption validation fail");logger_1$2.logger("IK Stage 0 - Responder got message, going to verify payload.");const i=await utils_1$2.decodePayload(r);this.remotePeer=this.remotePeer||await utils_1$2.getPeerIdFromPayload(i),await utils_1$2.verifySignedPayload(this.session.hs.rs,i,this.remotePeer),this.setRemoteEarlyData(i.data),logger_1$2.logger("IK Stage 0 - Responder successfully verified payload!"),logger_1$2.logRemoteEphemeralKey(this.session.hs.re)}catch(t){const r=t;throw logger_1$2.logger("Responder breaking up with IK handshake in stage 0."),new errors_1.FailedIKError(e,`Error occurred while verifying initiator's signed payload: ${r.message}`)}}}async stage1(){if(this.isInitiator){logger_1$2.logger("IK Stage 1 - Initiator receiving message...");const e=(await this.connection.readLP()).slice(),t=encoder_1$2.decode0(buffer_1$3.Buffer.from(e)),{plaintext:r,valid:n}=this.ik.recvMessage(this.session,t);logger_1$2.logger("IK Stage 1 - Initiator got message, going to verify payload.");try{if(!n)throw new Error("ik stage 1 decryption validation fail");const e=await utils_1$2.decodePayload(r);this.remotePeer=this.remotePeer||await utils_1$2.getPeerIdFromPayload(e),await utils_1$2.verifySignedPayload(t.ns.slice(0,32),e,this.remotePeer),this.setRemoteEarlyData(e.data),logger_1$2.logger("IK Stage 1 - Initiator successfully verified payload!"),logger_1$2.logRemoteEphemeralKey(this.session.hs.re)}catch(t){const r=t;throw logger_1$2.logger("Initiator breaking up with IK handshake in stage 1."),new errors_1.FailedIKError(e,`Error occurred while verifying responder's signed payload: ${r.message}`)}}else{logger_1$2.logger("IK Stage 1 - Responder sending message...");const e=this.ik.sendMessage(this.session,this.payload);this.connection.writeLP(encoder_1$2.encode0(e)),logger_1$2.logger("IK Stage 1 - Responder sent message..."),logger_1$2.logLocalEphemeralKeys(this.session.hs.e)}logger_1$2.logCipherState(this.session)}decrypt(e,t){const r=this.getCS(t,!1);return this.ik.decryptWithAd(r,buffer_1$3.Buffer.alloc(0),e)}encrypt(e,t){const r=this.getCS(t);return this.ik.encryptWithAd(r,buffer_1$3.Buffer.alloc(0),e)}getLocalEphemeralKeys(){if(!this.session.hs.e)throw new Error("Ephemeral keys do not exist.");return this.session.hs.e}getCS(e,t=!0){if(!e.cs1||!e.cs2)throw new Error("Handshake not completed properly, cipher state does not exist.");return this.isInitiator?t?e.cs1:e.cs2:t?e.cs2:e.cs1}setRemoteEarlyData(e){e&&(this.remoteEarlyData=buffer_1$3.Buffer.from(e.buffer,e.byteOffset,e.length))}}handshakeIk.IKHandshake=IKHandshake;var handshakeXxFallback={};Object.defineProperty(handshakeXxFallback,"__esModule",{value:!0}),handshakeXxFallback.XXFallbackHandshake=void 0;const buffer_1$2=require$$0$7,handshake_xx_1$1=handshakeXx,utils_1$1=utils$q,logger_1$1=logger,encoder_1$1=encoder$1;class XXFallbackHandshake extends handshake_xx_1$1.XXHandshake{constructor(e,t,r,n,i,s,o,a,u){super(e,t,r,n,i,o,u),a&&(this.ephemeralKeys=a),this.initialMsg=s}async propose(){if(this.isInitiator)this.xx.sendMessage(this.session,buffer_1$2.Buffer.alloc(0),this.ephemeralKeys),logger_1$1.logger("XX Fallback Stage 0 - Initialized state as the first message was sent by initiator."),logger_1$1.logLocalEphemeralKeys(this.session.hs.e);else{logger_1$1.logger("XX Fallback Stage 0 - Responder decoding initial msg from IK.");const e=encoder_1$1.decode0(this.initialMsg),{valid:t}=this.xx.recvMessage(this.session,{ne:e.ne,ns:buffer_1$2.Buffer.alloc(0),ciphertext:buffer_1$2.Buffer.alloc(0)});if(!t)throw new Error("xx fallback stage 0 decryption validation fail");logger_1$1.logger("XX Fallback Stage 0 - Responder used received message from IK."),logger_1$1.logRemoteEphemeralKey(this.session.hs.re)}}async exchange(){if(this.isInitiator){const e=encoder_1$1.decode1(this.initialMsg),{plaintext:t,valid:r}=this.xx.recvMessage(this.session,e);if(!r)throw new Error("xx fallback stage 1 decryption validation fail");logger_1$1.logger("XX Fallback Stage 1 - Initiator used received message from IK."),logger_1$1.logRemoteEphemeralKey(this.session.hs.re),logger_1$1.logRemoteStaticKey(this.session.hs.rs),logger_1$1.logger("Initiator going to check remote's signature...");try{const e=await utils_1$1.decodePayload(t);this.remotePeer=this.remotePeer||await utils_1$1.getPeerIdFromPayload(e),await utils_1$1.verifySignedPayload(this.session.hs.rs,e,this.remotePeer),this.setRemoteEarlyData(e.data)}catch(e){throw new Error(`Error occurred while verifying signed payload from responder: ${e.message}`)}logger_1$1.logger("All good with the signature!")}else logger_1$1.logger("XX Fallback Stage 1 - Responder start"),await super.exchange(),logger_1$1.logger("XX Fallback Stage 1 - Responder end")}}handshakeXxFallback.XXFallbackHandshake=XXFallbackHandshake;var crypto$3={};Object.defineProperty(crypto$3,"__esModule",{value:!0}),crypto$3.decryptStream=crypto$3.encryptStream=void 0;const buffer_1$1=require$$0$7,constants_1$1=require$$15;function encryptStream(e){return async function*(t){for await(const r of t){const t=buffer_1$1.Buffer.from(r.buffer,r.byteOffset,r.length);for(let r=0;r<t.length;r+=constants_1$1.NOISE_MSG_MAX_LENGTH_BYTES_WITHOUT_TAG){let n=r+constants_1$1.NOISE_MSG_MAX_LENGTH_BYTES_WITHOUT_TAG;n>t.length&&(n=t.length);const i=e.encrypt(t.slice(r,n),e.session);yield i}}}}function decryptStream(e){return async function*(t){for await(const r of t){const t=buffer_1$1.Buffer.from(r.buffer,r.byteOffset,r.length);for(let r=0;r<t.length;r+=constants_1$1.NOISE_MSG_MAX_LENGTH_BYTES){let n=r+constants_1$1.NOISE_MSG_MAX_LENGTH_BYTES;n>t.length&&(n=t.length);const i=t.slice(r,n),{plaintext:s,valid:o}=await e.decrypt(i,e.session);if(!o)throw new Error("Failed to validate decrypted chunk");yield s}}}}crypto$3.encryptStream=encryptStream,crypto$3.decryptStream=decryptStream;var keycache={};Object.defineProperty(keycache,"__esModule",{value:!0}),keycache.KeyCache=void 0;class Keycache{constructor(){this.storage=new Map}store(e,t){this.storage.set(e.id,t)}load(e){var t;return e&&null!==(t=this.storage.get(e.id))&&void 0!==t?t:null}resetStorage(){this.storage.clear()}}const KeyCache=new Keycache;keycache.KeyCache=KeyCache;var __createBinding=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),__setModuleDefault=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding(t,e,r);return __setModuleDefault(t,e),t},__importDefault=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(noise,"__esModule",{value:!0}),noise.Noise=void 0;const x25519=__importStar(x25519$2),buffer_1=require$$0$7,it_pb_rpc_1=__importDefault(src$7),duplex_1=__importDefault(duplex),it_buffer_1=__importDefault(itBuffer.exports),it_pipe_1=__importDefault(itPipe.exports),it_length_prefixed_1=src$i,handshake_xx_1=handshakeXx,handshake_ik_1=handshakeIk,handshake_xx_fallback_1=handshakeXxFallback,utils_1=utils$q,encoder_1=encoder$1,crypto_1=crypto$3,keycache_1=keycache,logger_1=logger,constants_1=require$$15;class Noise{constructor(e,t){if(this.protocol="/noise",this.prologue=buffer_1.Buffer.alloc(0),this.earlyData=null!=t?t:buffer_1.Buffer.alloc(0),this.useNoisePipes=!1,e){const t=x25519.generateKeyPairFromSeed(e);this.staticKeys={privateKey:buffer_1.Buffer.from(t.secretKey.buffer,t.secretKey.byteOffset,t.secretKey.length),publicKey:buffer_1.Buffer.from(t.publicKey.buffer,t.publicKey.byteOffset,t.publicKey.length)}}else this.staticKeys=utils_1.generateKeypair()}async secureOutbound(e,t,r){const n=it_pb_rpc_1.default(t,{lengthEncoder:encoder_1.uint16BEEncode,lengthDecoder:encoder_1.uint16BEDecode,maxDataLength:constants_1.NOISE_MSG_MAX_LENGTH_BYTES}),i=await this.performHandshake({connection:n,isInitiator:!0,localPeer:e,remotePeer:r});return{conn:await this.createSecureConnection(n,i),remoteEarlyData:i.remoteEarlyData,remotePeer:i.remotePeer}}async secureInbound(e,t,r){const n=it_pb_rpc_1.default(t,{lengthEncoder:encoder_1.uint16BEEncode,lengthDecoder:encoder_1.uint16BEDecode,maxDataLength:constants_1.NOISE_MSG_MAX_LENGTH_BYTES}),i=await this.performHandshake({connection:n,isInitiator:!1,localPeer:e,remotePeer:r});return{conn:await this.createSecureConnection(n,i),remoteEarlyData:i.remoteEarlyData,remotePeer:i.remotePeer}}async performHandshake(e){var t;const r=await utils_1.getPayload(e.localPeer,this.staticKeys.publicKey,this.earlyData);let n=this.useNoisePipes;if(e.isInitiator&&null===keycache_1.KeyCache.load(e.remotePeer)&&(n=!1),!n)return await this.performXXHandshake(e,r);{const{remotePeer:n,connection:i,isInitiator:s}=e,o=new handshake_ik_1.IKHandshake(s,r,this.prologue,this.staticKeys,i,null!==(t=keycache_1.KeyCache.load(e.remotePeer))&&void 0!==t?t:buffer_1.Buffer.alloc(32),n);try{return await this.performIKHandshake(o)}catch(t){let n;return e.isInitiator&&(n=o.getLocalEphemeralKeys()),await this.performXXFallbackHandshake(e,r,t.initialMsg,n)}}}async performXXFallbackHandshake(e,t,r,n){const{isInitiator:i,remotePeer:s,connection:o}=e,a=new handshake_xx_fallback_1.XXFallbackHandshake(i,t,this.prologue,this.staticKeys,o,r,s,n);try{await a.propose(),await a.exchange(),await a.finish()}catch(e){logger_1.logger(e);throw new Error(`Error occurred during XX Fallback handshake: ${e.message}`)}return a}async performXXHandshake(e,t){const{isInitiator:r,remotePeer:n,connection:i}=e,s=new handshake_xx_1.XXHandshake(r,t,this.prologue,this.staticKeys,i,n);try{await s.propose(),await s.exchange(),await s.finish(),this.useNoisePipes&&s.remotePeer&&keycache_1.KeyCache.store(s.remotePeer,s.getRemoteStaticKey())}catch(e){throw new Error(`Error occurred during XX handshake: ${e.message}`)}return s}async performIKHandshake(e){return await e.stage0(),await e.stage1(),e}async createSecureConnection(e,t){const[r,n]=duplex_1.default(),i=e.unwrap();return await it_pipe_1.default(r,it_buffer_1.default,crypto_1.encryptStream(t),it_length_prefixed_1.encode({lengthEncoder:encoder_1.uint16BEEncode}),i,it_length_prefixed_1.decode({lengthDecoder:encoder_1.uint16BEDecode}),it_buffer_1.default,crypto_1.decryptStream(t),r),n}}noise.Noise=Noise,function(e){var t=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),r=commonjsGlobal&&commonjsGlobal.__exportStar||function(e,r){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(r,n)||t(r,e,n)};Object.defineProperty(e,"__esModule",{value:!0}),e.NOISE=void 0;const n=noise;r(noise,e),e.NOISE=new n.Noise}(src$8);var coder={};const{Buffer:Buffer}=require$$0$7,symbol=Symbol.for("BufferList");function BufferList$3(e){if(!(this instanceof BufferList$3))return new BufferList$3(e);BufferList$3._init.call(this,e)}BufferList$3._init=function(e){Object.defineProperty(this,symbol,{value:!0}),this._bufs=[],this.length=0,e&&this.append(e)},BufferList$3.prototype._new=function(e){return new BufferList$3(e)},BufferList$3.prototype._offset=function(e){if(0===e)return[0,0];let t=0;for(let r=0;r<this._bufs.length;r++){const n=t+this._bufs[r].length;if(e<n||r===this._bufs.length-1)return[r,e-t];t=n}},BufferList$3.prototype._reverseOffset=function(e){const t=e[0];let r=e[1];for(let e=0;e<t;e++)r+=this._bufs[e].length;return r},BufferList$3.prototype.get=function(e){if(e>this.length||e<0)return;const t=this._offset(e);return this._bufs[t[0]][t[1]]},BufferList$3.prototype.slice=function(e,t){return"number"==typeof e&&e<0&&(e+=this.length),"number"==typeof t&&t<0&&(t+=this.length),this.copy(null,0,e,t)},BufferList$3.prototype.copy=function(e,t,r,n){if(("number"!=typeof r||r<0)&&(r=0),("number"!=typeof n||n>this.length)&&(n=this.length),r>=this.length)return e||Buffer.alloc(0);if(n<=0)return e||Buffer.alloc(0);const i=!!e,s=this._offset(r),o=n-r;let a=o,u=i&&t||0,c=s[1];if(0===r&&n===this.length){if(!i)return 1===this._bufs.length?this._bufs[0]:Buffer.concat(this._bufs,this.length);for(let t=0;t<this._bufs.length;t++)this._bufs[t].copy(e,u),u+=this._bufs[t].length;return e}if(a<=this._bufs[s[0]].length-c)return i?this._bufs[s[0]].copy(e,t,c,c+a):this._bufs[s[0]].slice(c,c+a);i||(e=Buffer.allocUnsafe(o));for(let t=s[0];t<this._bufs.length;t++){const r=this._bufs[t].length-c;if(!(a>r)){this._bufs[t].copy(e,u,c,c+a),u+=r;break}this._bufs[t].copy(e,u,c),u+=r,a-=r,c&&(c=0)}return e.length>u?e.slice(0,u):e},BufferList$3.prototype.shallowSlice=function(e,t){if(e=e||0,t="number"!=typeof t?this.length:t,e<0&&(e+=this.length),t<0&&(t+=this.length),e===t)return this._new();const r=this._offset(e),n=this._offset(t),i=this._bufs.slice(r[0],n[0]+1);return 0===n[1]?i.pop():i[i.length-1]=i[i.length-1].slice(0,n[1]),0!==r[1]&&(i[0]=i[0].slice(r[1])),this._new(i)},BufferList$3.prototype.toString=function(e,t,r){return this.slice(t,r).toString(e)},BufferList$3.prototype.consume=function(e){if(e=Math.trunc(e),Number.isNaN(e)||e<=0)return this;for(;this._bufs.length;){if(!(e>=this._bufs[0].length)){this._bufs[0]=this._bufs[0].slice(e),this.length-=e;break}e-=this._bufs[0].length,this.length-=this._bufs[0].length,this._bufs.shift()}return this},BufferList$3.prototype.duplicate=function(){const e=this._new();for(let t=0;t<this._bufs.length;t++)e.append(this._bufs[t]);return e},BufferList$3.prototype.append=function(e){if(null==e)return this;if(e.buffer)this._appendBuffer(Buffer.from(e.buffer,e.byteOffset,e.byteLength));else if(Array.isArray(e))for(let t=0;t<e.length;t++)this.append(e[t]);else if(this._isBufferList(e))for(let t=0;t<e._bufs.length;t++)this.append(e._bufs[t]);else"number"==typeof e&&(e=e.toString()),this._appendBuffer(Buffer.from(e));return this},BufferList$3.prototype._appendBuffer=function(e){this._bufs.push(e),this.length+=e.length},BufferList$3.prototype.indexOf=function(e,t,r){if(void 0===r&&"string"==typeof t&&(r=t,t=void 0),"function"==typeof e||Array.isArray(e))throw new TypeError('The "value" argument must be one of type string, Buffer, BufferList, or Uint8Array.');if("number"==typeof e?e=Buffer.from([e]):"string"==typeof e?e=Buffer.from(e,r):this._isBufferList(e)?e=e.slice():Array.isArray(e.buffer)?e=Buffer.from(e.buffer,e.byteOffset,e.byteLength):Buffer.isBuffer(e)||(e=Buffer.from(e)),t=Number(t||0),isNaN(t)&&(t=0),t<0&&(t=this.length+t),t<0&&(t=0),0===e.length)return t>this.length?this.length:t;const n=this._offset(t);let i=n[0],s=n[1];for(;i<this._bufs.length;i++){const t=this._bufs[i];for(;s<t.length;){if(t.length-s>=e.length){const r=t.indexOf(e,s);if(-1!==r)return this._reverseOffset([i,r]);s=t.length-e.length+1}else{const t=this._reverseOffset([i,s]);if(this._match(t,e))return t;s++}}s=0}return-1},BufferList$3.prototype._match=function(e,t){if(this.length-e<t.length)return!1;for(let r=0;r<t.length;r++)if(this.get(e+r)!==t[r])return!1;return!0},function(){const e={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1,readIntBE:null,readIntLE:null,readUIntBE:null,readUIntLE:null};for(const t in e)!function(t){BufferList$3.prototype[t]=null===e[t]?function(e,r){return this.slice(e,e+r)[t](0,r)}:function(r=0){return this.slice(r,r+e[t])[t](0)}}(t)}(),BufferList$3.prototype._isBufferList=function(e){return e instanceof BufferList$3||BufferList$3.isBufferList(e)},BufferList$3.isBufferList=function(e){return null!=e&&e[symbol]};var BufferList_1=BufferList$3;const varint$1=varint$6,BufferList$2=BufferList_1,POOL_SIZE=10240;class Encoder{constructor(){this._pool=new Uint8Array(POOL_SIZE),this._poolOffset=0}write(e){const t=this._pool;let r=this._poolOffset;varint$1.encode(e.id<<3|e.type,t,r),r+=varint$1.encode.bytes,varint$1.encode(e.data?e.data.length:0,t,r),r+=varint$1.encode.bytes;const n=t.subarray(this._poolOffset,r);return POOL_SIZE-r<100?(this._pool=new Uint8Array(POOL_SIZE),this._poolOffset=0):this._poolOffset=r,e.data?[n,e.data]:n}}const encoder=new Encoder;var encode_browser=e=>async function*(){for await(const t of e)Array.isArray(t)?yield new BufferList$2(t.map((e=>encoder.write(e)))):yield new BufferList$2(encoder.write(t))}();const varint=varint$6,BufferList$1=BufferList_1;var decode=e=>async function*(){const t=new Decoder;for await(const r of e){const e=t.write(r);e.length&&(yield e)}}();class Decoder{constructor(){this._buffer=new BufferList$1,this._bufferProxy=new Proxy({},{get:(e,t)=>"l"===t[0]?this._buffer[t]:this._buffer.get(parseInt(t))}),this._headerInfo=null}write(e){if(!e||!e.length)return[];this._buffer.append(e);const t=[];for(;;){if(!this._headerInfo)try{this._headerInfo=this._decodeHeader(this._bufferProxy)}catch(e){break}const{id:e,type:r,length:n,offset:i}=this._headerInfo;if(this._buffer.length-i<n)break;t.push({id:e,type:r,data:this._buffer.shallowSlice(i,i+n)}),this._buffer.consume(i+n),this._headerInfo=null}return t}_decodeHeader(e){const t=varint.decode(e);let r=varint.decode.bytes;const n=varint.decode(e,r);return r+=varint.decode.bytes,{id:t>>3,type:7&t,offset:r,length:n}}}coder.encode=encode_browser,coder.decode=decode;var restrictSize$1={exports:{}};const MAX_MSG_SIZE$1=1<<20;restrictSize$1.exports=e=>{e=e||MAX_MSG_SIZE$1;const t=t=>{if(t.data&&t.data.length>e)throw Object.assign(new Error("message size too large!"),{code:"ERR_MSG_TOO_BIG"})};return e=>async function*(){for await(const r of e)Array.isArray(r)?r.forEach(t):t(r),yield r}()},restrictSize$1.exports.MAX_MSG_SIZE=MAX_MSG_SIZE$1;var messageTypes={};const MessageTypes$1=Object.freeze({NEW_STREAM:0,MESSAGE_RECEIVER:1,MESSAGE_INITIATOR:2,CLOSE_RECEIVER:3,CLOSE_INITIATOR:4,RESET_RECEIVER:5,RESET_INITIATOR:6});messageTypes.MessageTypes=MessageTypes$1,messageTypes.InitiatorMessageTypes=Object.freeze({NEW_STREAM:MessageTypes$1.NEW_STREAM,MESSAGE:MessageTypes$1.MESSAGE_INITIATOR,CLOSE:MessageTypes$1.CLOSE_INITIATOR,RESET:MessageTypes$1.RESET_INITIATOR}),messageTypes.ReceiverMessageTypes=Object.freeze({MESSAGE:MessageTypes$1.MESSAGE_RECEIVER,CLOSE:MessageTypes$1.CLOSE_RECEIVER,RESET:MessageTypes$1.RESET_RECEIVER}),messageTypes.MessageTypeNames=Object.freeze(Object.entries(MessageTypes$1).reduce(((e,t)=>(e[t[1]]=t[0],e)),{}));const abortable$2=abortableIterator.exports,AbortController$1=browser$7.exports,log$3=require$$0$b("libp2p:mplex:stream"),pushable$2=itPushable,BufferList=BufferList_1,errCode=errCode$m,{MAX_MSG_SIZE:MAX_MSG_SIZE}=restrictSize$1.exports,{InitiatorMessageTypes:InitiatorMessageTypes,ReceiverMessageTypes:ReceiverMessageTypes}=messageTypes,ERR_MPLEX_STREAM_RESET="ERR_MPLEX_STREAM_RESET",ERR_MPLEX_STREAM_ABORT="ERR_MPLEX_STREAM_ABORT";var stream=({id:e,name:t,send:r,onEnd:n=(()=>{}),type:i="initiator",maxMsgSize:s=MAX_MSG_SIZE})=>{const o=new AbortController$1,a=new AbortController$1,u="initiator"===i?InitiatorMessageTypes:ReceiverMessageTypes,c="initiator"===i?`i${e}`:`r${e}`;t=String(null==t?e:t);let l,h=!1,d=!1;const f=e=>{d||(d=!0,log$3("%s stream %s sink end",i,t,e),e&&!l&&(l=e),h&&(p.timeline.close=Date.now(),n(l)))},p={close:()=>p.source.end(),abort:e=>{log$3("%s stream %s abort",i,t,e),p.source.end(e),o.abort(),f(e)},reset:()=>{const e=errCode(new Error("stream reset"),ERR_MPLEX_STREAM_RESET);a.abort(),p.source.end(e),f(e)},sink:async n=>{n=abortable$2(n,[{signal:o.signal,options:{abortMessage:"stream aborted",abortCode:ERR_MPLEX_STREAM_ABORT}},{signal:a.signal,options:{abortMessage:"stream reset",abortCode:ERR_MPLEX_STREAM_RESET}}]),"initiator"===i&&r({id:e,type:u.NEW_STREAM,data:t});try{for await(let t of n)for(;t.length;){if(t.length<=s){r({id:e,type:u.MESSAGE,data:t});break}t=BufferList.isBufferList(t)?t:new BufferList(t),r({id:e,type:u.MESSAGE,data:t.shallowSlice(0,s)}),t.consume(s)}}catch(n){return n.code===ERR_MPLEX_STREAM_RESET?log$3("%s stream %s reset",i,t):(log$3("%s stream %s error",i,t,n),r({id:e,type:u.RESET})),p.source.end(n),f(n)}r({id:e,type:u.CLOSE}),f()},source:pushable$2((e=>{h||(h=!0,log$3("%s stream %s source end",i,t,e),e&&!l&&(l=e),d&&(p.timeline.close=Date.now(),n(l)))})),timeline:{open:Date.now(),close:null},id:c};return p};const pipe$2=itPipe.exports,pushable$1=itPushable,log$2=require$$0$b("libp2p:mplex"),abortable$1=abortableIterator.exports,Coder=coder,restrictSize=restrictSize$1.exports,{MessageTypes:MessageTypes,MessageTypeNames:MessageTypeNames}=messageTypes,createStream=stream;class Mplex{constructor(e){e="function"==typeof(e=e||{})?{onStream:e}:e,this._streamId=0,this._streams={initiators:new Map,receivers:new Map},this._options=e,this.sink=this._createSink(),this.source=this._createSource(),this.onStream=e.onStream,this.onStreamEnd=e.onStreamEnd}get streams(){const e=[];return this._streams.initiators.forEach((t=>{e.push(t)})),this._streams.receivers.forEach((t=>{e.push(t)})),e}newStream(e){const t=this._streamId++;e=null==e?t.toString():String(e);const r=this._streams.initiators;return this._newStream({id:t,name:e,type:"initiator",registry:r})}_newReceiverStream({id:e,name:t}){const r=this._streams.receivers;return this._newStream({id:e,name:t,type:"receiver",registry:r})}_newStream({id:e,name:t,type:r,registry:n}){if(n.has(e))throw new Error(`${r} stream ${e} already exists!`);log$2("new %s stream %s %s",r,e,t);const i=createStream({id:e,name:t,send:n=>(log$2.enabled&&log$2("%s stream %s %s send",r,e,t,{...n,type:MessageTypeNames[n.type],data:n.data&&n.data.slice()}),this.source.push(n)),type:r,onEnd:()=>{log$2("%s stream %s %s ended",r,e,t),n.delete(e),this.onStreamEnd&&this.onStreamEnd(i)},maxMsgSize:this._options.maxMsgSize});return n.set(e,i),i}_createSink(){return async e=>{this._options.signal&&(e=abortable$1(e,this._options.signal));try{await pipe$2(e,Coder.decode,restrictSize(this._options.maxMsgSize),(async e=>{for await(const t of e)for(const e of t)this._handleIncoming(e)}))}catch(e){return log$2("error in sink",e),this.source.end(e)}this.source.end()}}_createSource(){const e=pushable$1({onEnd:e=>{const{initiators:t,receivers:r}=this._streams;for(const r of t.values())r.abort(e);for(const t of r.values())t.abort(e)},writev:!0});return Object.assign(Coder.encode(e),{push:e.push,end:e.end,return:e.return})}_handleIncoming({id:e,type:t,data:r}){if(log$2.enabled&&log$2("incoming message",{id:e,type:MessageTypeNames[t],data:r.slice()}),t===MessageTypes.NEW_STREAM&&this.onStream){const t=this._newReceiverStream({id:e,name:r.toString()});return this.onStream(t)}const n=(1&t?this._streams.initiators:this._streams.receivers).get(e);if(!n)return log$2("missing stream %s",e);switch(t){case MessageTypes.MESSAGE_INITIATOR:case MessageTypes.MESSAGE_RECEIVER:n.source.push(r);break;case MessageTypes.CLOSE_INITIATOR:case MessageTypes.CLOSE_RECEIVER:n.close();break;case MessageTypes.RESET_INITIATOR:case MessageTypes.RESET_RECEIVER:n.reset();break;default:log$2("unknown message type %s",t)}}}Mplex.multicodec="/mplex/6.7.0";var mplex=Mplex,src$4=mplex,src$3={exports:{}},src$2={exports:{}},$protobuf$2=minimal,$Reader$2=$protobuf$2.Reader,$Writer$2=$protobuf$2.Writer,$util$2=$protobuf$2.util,$root$2=$protobuf$2.roots["libp2p-crypto-keys"]||($protobuf$2.roots["libp2p-crypto-keys"]={});$root$2.KeyType=function(){var e={},t=Object.create(e);return t[e[0]="RSA"]=0,t[e[1]="Ed25519"]=1,t[e[2]="Secp256k1"]=2,t}(),$root$2.PublicKey=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.Type=0,e.prototype.Data=$util$2.newBuffer([]),e.encode=function(e,t){return t||(t=$Writer$2.create()),t.uint32(8).int32(e.Type),t.uint32(18).bytes(e.Data),t},e.decode=function(e,t){e instanceof $Reader$2||(e=$Reader$2.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root$2.PublicKey;e.pos<r;){var i=e.uint32();switch(i>>>3){case 1:n.Type=e.int32();break;case 2:n.Data=e.bytes();break;default:e.skipType(7&i)}}if(!n.hasOwnProperty("Type"))throw $util$2.ProtocolError("missing required 'Type'",{instance:n});if(!n.hasOwnProperty("Data"))throw $util$2.ProtocolError("missing required 'Data'",{instance:n});return n},e.fromObject=function(e){if(e instanceof $root$2.PublicKey)return e;var t=new $root$2.PublicKey;switch(e.Type){case"RSA":case 0:t.Type=0;break;case"Ed25519":case 1:t.Type=1;break;case"Secp256k1":case 2:t.Type=2}return null!=e.Data&&("string"==typeof e.Data?$util$2.base64.decode(e.Data,t.Data=$util$2.newBuffer($util$2.base64.length(e.Data)),0):e.Data.length&&(t.Data=e.Data)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.Type=t.enums===String?"RSA":0,t.bytes===String?r.Data="":(r.Data=[],t.bytes!==Array&&(r.Data=$util$2.newBuffer(r.Data)))),null!=e.Type&&e.hasOwnProperty("Type")&&(r.Type=t.enums===String?$root$2.KeyType[e.Type]:e.Type),null!=e.Data&&e.hasOwnProperty("Data")&&(r.Data=t.bytes===String?$util$2.base64.encode(e.Data,0,e.Data.length):t.bytes===Array?Array.prototype.slice.call(e.Data):e.Data),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf$2.util.toJSONOptions)},e}(),$root$2.PrivateKey=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.Type=0,e.prototype.Data=$util$2.newBuffer([]),e.encode=function(e,t){return t||(t=$Writer$2.create()),t.uint32(8).int32(e.Type),t.uint32(18).bytes(e.Data),t},e.decode=function(e,t){e instanceof $Reader$2||(e=$Reader$2.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root$2.PrivateKey;e.pos<r;){var i=e.uint32();switch(i>>>3){case 1:n.Type=e.int32();break;case 2:n.Data=e.bytes();break;default:e.skipType(7&i)}}if(!n.hasOwnProperty("Type"))throw $util$2.ProtocolError("missing required 'Type'",{instance:n});if(!n.hasOwnProperty("Data"))throw $util$2.ProtocolError("missing required 'Data'",{instance:n});return n},e.fromObject=function(e){if(e instanceof $root$2.PrivateKey)return e;var t=new $root$2.PrivateKey;switch(e.Type){case"RSA":case 0:t.Type=0;break;case"Ed25519":case 1:t.Type=1;break;case"Secp256k1":case 2:t.Type=2}return null!=e.Data&&("string"==typeof e.Data?$util$2.base64.decode(e.Data,t.Data=$util$2.newBuffer($util$2.base64.length(e.Data)),0):e.Data.length&&(t.Data=e.Data)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.Type=t.enums===String?"RSA":0,t.bytes===String?r.Data="":(r.Data=[],t.bytes!==Array&&(r.Data=$util$2.newBuffer(r.Data)))),null!=e.Type&&e.hasOwnProperty("Type")&&(r.Type=t.enums===String?$root$2.KeyType[e.Type]:e.Type),null!=e.Data&&e.hasOwnProperty("Data")&&(r.Data=t.bytes===String?$util$2.base64.encode(e.Data,0,e.Data.length):t.bytes===Array?Array.prototype.slice.call(e.Data):e.Data),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf$2.util.toJSONOptions)},e}();var keys$1=$root$2,webcrypto$4={get:(e=globalThis)=>{const t=e.crypto;if(!t||!t.subtle)throw Object.assign(new Error("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p-crypto/blob/master/README.md#web-crypto-api"),{code:"ERR_MISSING_WEB_CRYPTO"});return t}};const{concat:concat}=require$$2$2,{fromString:fromString}=require$$3$1,webcrypto$3=webcrypto$4;function create({algorithm:e="AES-GCM",nonceLength:t=12,keyLength:r=16,digest:n="SHA-256",saltLength:i=16,iterations:s=32767}={}){const o=webcrypto$3.get();return r*=8,{encrypt:async function(a,u){const c=o.getRandomValues(new Uint8Array(i)),l=o.getRandomValues(new Uint8Array(t)),h={name:e,iv:l},d={name:"PBKDF2",salt:c,iterations:s,hash:{name:n}},f=await o.subtle.importKey("raw",fromString(u),{name:"PBKDF2"},!1,["deriveKey","deriveBits"]),p=await o.subtle.deriveKey(d,f,{name:e,length:r},!0,["encrypt"]),y=await o.subtle.encrypt(h,p,a);return concat([c,h.iv,new Uint8Array(y)])},decrypt:async function(a,u){const c=a.slice(0,i),l=a.slice(i,i+t),h=a.slice(i+t),d={name:e,iv:l},f={name:"PBKDF2",salt:c,iterations:s,hash:{name:n}},p=await o.subtle.importKey("raw",fromString(u),{name:"PBKDF2"},!1,["deriveKey","deriveBits"]),y=await o.subtle.deriveKey(f,p,{name:e,length:r},!0,["decrypt"]),g=await o.subtle.decrypt(d,y,h);return new Uint8Array(g)}}}var aesGcm_browser={create:create};const{base64:base64$1}=require$$4$5,ciphers$1=aesGcm_browser;var importer$1={import:async function(e,t){const r=base64$1.decode(e),n=ciphers$1.create();return await n.decrypt(r,t)}},rsaBrowser={};const randomBytes$2=random_browser,errcode$9=errCode$m;var randomBytes_1=function(e){if(isNaN(e)||e<=0)throw errcode$9(new Error("random bytes length must be a Number bigger than 0"),"ERR_INVALID_LENGTH");return randomBytes$2(e)},rsaUtils={},util={};!function(e){const t=forge$X,{fromString:r}=require$$3$1,{toString:n}=require$$1$5,{concat:i}=require$$2$2;e.bigIntegerToUintBase64url=(e,t)=>{let r=Uint8Array.from(e.abs().toByteArray());if(r=0===r[0]?r.slice(1):r,null!=t){if(r.length>t)throw new Error("byte array longer than desired length");r=i([new Uint8Array(t-r.length),r])}return n(r,"base64url")},e.base64urlToBigInteger=r=>{const i=e.base64urlToBuffer(r);return new t.jsbn.BigInteger(n(i,"base16"),16)},e.base64urlToBuffer=(e,t)=>{let n=r(e,"base64urlpad");if(null!=t){if(n.length>t)throw new Error("byte array longer than desired length");n=i([new Uint8Array(t-n.length),n])}return n}}(util);const forge$3=forge$X,{bigIntegerToUintBase64url:bigIntegerToUintBase64url,base64urlToBigInteger:base64urlToBigInteger$1}=util,{fromString:uint8ArrayFromString$5}=require$$3$1,{toString:uint8ArrayToString$5}=require$$1$5;rsaUtils.pkcs1ToJwk=function(e){const t=forge$3.asn1.fromDer(uint8ArrayToString$5(e,"ascii")),r=forge$3.pki.privateKeyFromAsn1(t);return{kty:"RSA",n:bigIntegerToUintBase64url(r.n),e:bigIntegerToUintBase64url(r.e),d:bigIntegerToUintBase64url(r.d),p:bigIntegerToUintBase64url(r.p),q:bigIntegerToUintBase64url(r.q),dp:bigIntegerToUintBase64url(r.dP),dq:bigIntegerToUintBase64url(r.dQ),qi:bigIntegerToUintBase64url(r.qInv),alg:"RS256",kid:"2011-04-29"}},rsaUtils.jwkToPkcs1=function(e){const t=forge$3.pki.privateKeyToAsn1({n:base64urlToBigInteger$1(e.n),e:base64urlToBigInteger$1(e.e),d:base64urlToBigInteger$1(e.d),p:base64urlToBigInteger$1(e.p),q:base64urlToBigInteger$1(e.q),dP:base64urlToBigInteger$1(e.dp),dQ:base64urlToBigInteger$1(e.dq),qInv:base64urlToBigInteger$1(e.qi)});return uint8ArrayFromString$5(forge$3.asn1.toDer(t).getBytes(),"ascii")},rsaUtils.pkixToJwk=function(e){const t=forge$3.asn1.fromDer(uint8ArrayToString$5(e,"ascii")),r=forge$3.pki.publicKeyFromAsn1(t);return{kty:"RSA",n:bigIntegerToUintBase64url(r.n),e:bigIntegerToUintBase64url(r.e),alg:"RS256",kid:"2011-04-29"}},rsaUtils.jwkToPkix=function(e){const t=forge$3.pki.publicKeyToAsn1({n:base64urlToBigInteger$1(e.n),e:base64urlToBigInteger$1(e.e)});return uint8ArrayFromString$5(forge$3.asn1.toDer(t).getBytes(),"ascii")};const forge$2=forge$X,{base64urlToBigInteger:base64urlToBigInteger}=util;function convert(e,t){return t.map((t=>base64urlToBigInteger(e[t])))}function jwk2priv$1(e){return forge$2.pki.setRsaPrivateKey(...convert(e,["n","e","d","p","q","dp","dq","qi"]))}function jwk2pub$1(e){return forge$2.pki.setRsaPublicKey(...convert(e,["n","e"]))}var jwk2pem={jwk2pub:jwk2pub$1,jwk2priv:jwk2priv$1};const webcrypto$2=webcrypto$4,randomBytes$1=randomBytes_1,{toString:uint8ArrayToString$4}=require$$1$5,{fromString:uint8ArrayFromString$4}=require$$3$1;function exportKey(e){return Promise.all([webcrypto$2.get().subtle.exportKey("jwk",e.privateKey),webcrypto$2.get().subtle.exportKey("jwk",e.publicKey)])}function derivePublicFromPrivate(e){return webcrypto$2.get().subtle.importKey("jwk",{kty:e.kty,n:e.n,e:e.e},{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])}rsaBrowser.utils=rsaUtils,rsaBrowser.generateKey=async function(e){const t=await webcrypto$2.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),r=await exportKey(t);return{privateKey:r[0],publicKey:r[1]}},rsaBrowser.unmarshalPrivateKey=async function(e){const t=[await webcrypto$2.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),await derivePublicFromPrivate(e)],r=await exportKey({privateKey:t[0],publicKey:t[1]});return{privateKey:r[0],publicKey:r[1]}},rsaBrowser.getRandomValues=randomBytes$1,rsaBrowser.hashAndSign=async function(e,t){const r=await webcrypto$2.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),n=await webcrypto$2.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},r,Uint8Array.from(t));return new Uint8Array(n,n.byteOffset,n.byteLength)},rsaBrowser.hashAndVerify=async function(e,t,r){const n=await webcrypto$2.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return webcrypto$2.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},n,t,r)};const{jwk2pub:jwk2pub,jwk2priv:jwk2priv}=jwk2pem;function convertKey(e,t,r,n){const i=t?jwk2pub(e):jwk2priv(e),s=n(uint8ArrayToString$4(Uint8Array.from(r),"ascii"),i);return uint8ArrayFromString$4(s,"ascii")}rsaBrowser.encrypt=function(e,t){return convertKey(e,!0,t,((e,t)=>t.encrypt(e)))},rsaBrowser.decrypt=function(e,t){return convertKey(e,!1,t,((e,t)=>t.decrypt(e)))};const{base64:base64}=require$$4$5,ciphers=aesGcm_browser;var exporter$3={export:async function(e,t){const r=ciphers.create(),n=await r.encrypt(e,t);return base64.encode(n)}};const{sha256:sha256$4}=require$$4$3,errcode$8=errCode$m,{equals:uint8ArrayEquals$3}=require$$10$1,{toString:uint8ArrayToString$3}=require$$1$5,forge$1=forge$X,crypto$2=rsaBrowser,pbm$1=keys$1,exporter$2=exporter$3;class RsaPublicKey{constructor(e){this._key=e}async verify(e,t){return crypto$2.hashAndVerify(this._key,t,e)}marshal(){return crypto$2.utils.jwkToPkix(this._key)}get bytes(){return pbm$1.PublicKey.encode({Type:pbm$1.KeyType.RSA,Data:this.marshal()}).finish()}encrypt(e){return crypto$2.encrypt(this._key,e)}equals(e){return uint8ArrayEquals$3(this.bytes,e.bytes)}async hash(){const{bytes:e}=await sha256$4.digest(this.bytes);return e}}class RsaPrivateKey{constructor(e,t){this._key=e,this._publicKey=t}genSecret(){return crypto$2.getRandomValues(16)}async sign(e){return crypto$2.hashAndSign(this._key,e)}get public(){if(!this._publicKey)throw errcode$8(new Error("public key not provided"),"ERR_PUBKEY_NOT_PROVIDED");return new RsaPublicKey(this._publicKey)}decrypt(e){return crypto$2.decrypt(this._key,e)}marshal(){return crypto$2.utils.jwkToPkcs1(this._key)}get bytes(){return pbm$1.PrivateKey.encode({Type:pbm$1.KeyType.RSA,Data:this.marshal()}).finish()}equals(e){return uint8ArrayEquals$3(this.bytes,e.bytes)}async hash(){const{bytes:e}=await sha256$4.digest(this.bytes);return e}async id(){const e=await this.public.hash();return uint8ArrayToString$3(e,"base58btc")}async export(e,t="pkcs-8"){if("pkcs-8"===t){const t=new forge$1.util.ByteBuffer(this.marshal()),r=forge$1.asn1.fromDer(t),n=forge$1.pki.privateKeyFromAsn1(r),i={algorithm:"aes256",count:1e4,saltSize:16,prfAlgorithm:"sha512"};return forge$1.pki.encryptRsaPrivateKey(n,e,i)}if("libp2p-key"===t)return exporter$2.export(this.bytes,e);throw errcode$8(new Error(`export format '${t}' is not supported`),"ERR_INVALID_EXPORT_FORMAT")}}async function unmarshalRsaPrivateKey(e){const t=crypto$2.utils.pkcs1ToJwk(e),r=await crypto$2.unmarshalPrivateKey(t);return new RsaPrivateKey(r.privateKey,r.publicKey)}function unmarshalRsaPublicKey(e){const t=crypto$2.utils.pkixToJwk(e);return new RsaPublicKey(t)}async function fromJwk(e){const t=await crypto$2.unmarshalPrivateKey(e);return new RsaPrivateKey(t.privateKey,t.publicKey)}async function generateKeyPair$2(e){const t=await crypto$2.generateKey(e);return new RsaPrivateKey(t.privateKey,t.publicKey)}var rsaClass={RsaPublicKey:RsaPublicKey,RsaPrivateKey:RsaPrivateKey,unmarshalRsaPublicKey:unmarshalRsaPublicKey,unmarshalRsaPrivateKey:unmarshalRsaPrivateKey,generateKeyPair:generateKeyPair$2,fromJwk:fromJwk},ed25519={};!function(e){const t=ed25519$6.exports;function r(t,r){const n=new Uint8Array(e.privateKeyLength);for(let e=0;e<32;e++)n[e]=t[e],n[32+e]=r[e];return n}e.publicKeyLength=32,e.privateKeyLength=64,e.generateKey=async function(){const e=t.utils.randomPrivateKey(),n=await t.getPublicKey(e);return{privateKey:r(e,n),publicKey:n}},e.generateKeyFromSeed=async function(e){if(32!==e.length)throw new TypeError('"seed" must be 32 bytes in length.');if(!(e instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, or Uint8Array.');const n=e,i=await t.getPublicKey(n);return{privateKey:r(n,i),publicKey:i}},e.hashAndSign=function(e,r){const n=e.slice(0,32);return t.sign(r,n)},e.hashAndVerify=function(e,r,n){return t.verify(r,n,e)}}(ed25519);const errcode$7=errCode$m,{equals:uint8ArrayEquals$2}=require$$10$1,{sha256:sha256$3}=require$$4$3,{base58btc:base58btc}=require$$3$2,{identity:identity}=require$$13,crypto$1=ed25519,pbm=keys$1,exporter$1=exporter$3;class Ed25519PublicKey{constructor(e){this._key=ensureKey(e,crypto$1.publicKeyLength)}async verify(e,t){return crypto$1.hashAndVerify(this._key,t,e)}marshal(){return this._key}get bytes(){return pbm.PublicKey.encode({Type:pbm.KeyType.Ed25519,Data:this.marshal()}).finish()}equals(e){return uint8ArrayEquals$2(this.bytes,e.bytes)}async hash(){const{bytes:e}=await sha256$3.digest(this.bytes);return e}}class Ed25519PrivateKey{constructor(e,t){this._key=ensureKey(e,crypto$1.privateKeyLength),this._publicKey=ensureKey(t,crypto$1.publicKeyLength)}async sign(e){return crypto$1.hashAndSign(this._key,e)}get public(){return new Ed25519PublicKey(this._publicKey)}marshal(){return this._key}get bytes(){return pbm.PrivateKey.encode({Type:pbm.KeyType.Ed25519,Data:this.marshal()}).finish()}equals(e){return uint8ArrayEquals$2(this.bytes,e.bytes)}async hash(){const{bytes:e}=await sha256$3.digest(this.bytes);return e}async id(){const e=await identity.digest(this.public.bytes);return base58btc.encode(e.bytes).substring(1)}async export(e,t="libp2p-key"){if("libp2p-key"===t)return exporter$1.export(this.bytes,e);throw errcode$7(new Error(`export format '${t}' is not supported`),"ERR_INVALID_EXPORT_FORMAT")}}function unmarshalEd25519PrivateKey(e){if(e.length>crypto$1.privateKeyLength){const t=(e=ensureKey(e,crypto$1.privateKeyLength+crypto$1.publicKeyLength)).slice(0,crypto$1.privateKeyLength),r=e.slice(crypto$1.privateKeyLength,e.length);return new Ed25519PrivateKey(t,r)}const t=(e=ensureKey(e,crypto$1.privateKeyLength)).slice(0,crypto$1.privateKeyLength),r=e.slice(crypto$1.publicKeyLength);return new Ed25519PrivateKey(t,r)}function unmarshalEd25519PublicKey(e){return e=ensureKey(e,crypto$1.publicKeyLength),new Ed25519PublicKey(e)}async function generateKeyPair$1(){const{privateKey:e,publicKey:t}=await crypto$1.generateKey();return new Ed25519PrivateKey(e,t)}async function generateKeyPairFromSeed$1(e){const{privateKey:t,publicKey:r}=await crypto$1.generateKeyFromSeed(e);return new Ed25519PrivateKey(t,r)}function ensureKey(e,t){if((e=Uint8Array.from(e||[])).length!==t)throw errcode$7(new Error(`Key must be a Uint8Array of length ${t}, got ${e.length}`),"ERR_INVALID_KEY_TYPE");return e}var ed25519Class={Ed25519PublicKey:Ed25519PublicKey,Ed25519PrivateKey:Ed25519PrivateKey,unmarshalEd25519PrivateKey:unmarshalEd25519PrivateKey,unmarshalEd25519PublicKey:unmarshalEd25519PublicKey,generateKeyPair:generateKeyPair$1,generateKeyPairFromSeed:generateKeyPairFromSeed$1};const errcode$6=errCode$m,secp=secp256k1$6.exports,{sha256:sha256$2}=require$$4$3;var secp256k1=()=>({generateKey:function(){return secp.utils.randomPrivateKey()},privateKeyLength:32,hashAndSign:async function(e,t){const{digest:r}=await sha256$2.digest(t);try{return await secp.sign(r,e)}catch(e){throw errcode$6(e,"ERR_INVALID_INPUT")}},hashAndVerify:async function(e,t,r){try{const{digest:n}=await sha256$2.digest(r);return secp.verify(t,n,e)}catch(e){throw errcode$6(e,"ERR_INVALID_INPUT")}},compressPublicKey:function(e){return secp.Point.fromHex(e).toRawBytes(!0)},decompressPublicKey:function(e){return secp.Point.fromHex(e).toRawBytes(!1)},validatePrivateKey:function(e){try{secp.getPublicKey(e,!0)}catch(e){throw errcode$6(e,"ERR_INVALID_PRIVATE_KEY")}},validatePublicKey:function(e){try{secp.Point.fromHex(e)}catch(e){throw errcode$6(e,"ERR_INVALID_PUBLIC_KEY")}},computePublicKey:function(e){try{return secp.getPublicKey(e,!0)}catch(e){throw errcode$6(e,"ERR_INVALID_PRIVATE_KEY")}}});const{sha256:sha256$1}=require$$4$3,errcode$5=errCode$m,{equals:uint8ArrayEquals$1}=require$$10$1,{toString:uint8ArrayToString$2}=require$$1$5,exporter=exporter$3;var secp256k1Class=(e,t,r)=>{r=r||secp256k1();class n{constructor(e){r.validatePublicKey(e),this._key=e}verify(e,t){return r.hashAndVerify(this._key,t,e)}marshal(){return r.compressPublicKey(this._key)}get bytes(){return e.PublicKey.encode({Type:e.KeyType.Secp256k1,Data:this.marshal()}).finish()}equals(e){return uint8ArrayEquals$1(this.bytes,e.bytes)}async hash(){const{bytes:e}=await sha256$1.digest(this.bytes);return e}}class i{constructor(e,t){this._key=e,this._publicKey=t||r.computePublicKey(e),r.validatePrivateKey(this._key),r.validatePublicKey(this._publicKey)}sign(e){return r.hashAndSign(this._key,e)}get public(){return new n(this._publicKey)}marshal(){return this._key}get bytes(){return e.PrivateKey.encode({Type:e.KeyType.Secp256k1,Data:this.marshal()}).finish()}equals(e){return uint8ArrayEquals$1(this.bytes,e.bytes)}async hash(){const{bytes:e}=await sha256$1.digest(this.bytes);return e}async id(){const e=await this.public.hash();return uint8ArrayToString$2(e,"base58btc")}async export(e,t="libp2p-key"){if("libp2p-key"===t)return exporter.export(this.bytes,e);throw errcode$5(new Error(`export format '${t}' is not supported`),"ERR_INVALID_EXPORT_FORMAT")}}return{Secp256k1PublicKey:n,Secp256k1PrivateKey:i,unmarshalSecp256k1PrivateKey:function(e){return new i(e)},unmarshalSecp256k1PublicKey:function(e){return new n(e)},generateKeyPair:async function(){const e=await r.generateKey();return new i(e)}}},indexBrowser={},lengths$1={SHA1:20,SHA256:32,SHA512:64};const webcrypto$1=webcrypto$4,lengths=lengths$1,hashTypes={SHA1:"SHA-1",SHA256:"SHA-256",SHA512:"SHA-512"},sign$1=async(e,t)=>{const r=await webcrypto$1.get().subtle.sign({name:"HMAC"},e,t);return new Uint8Array(r,r.byteOffset,r.byteLength)};indexBrowser.create=async function(e,t){const r=hashTypes[e],n=await webcrypto$1.get().subtle.importKey("raw",t,{name:"HMAC",hash:{name:r}},!1,["sign"]);return{digest:async e=>sign$1(n,e),length:lengths[e]}};const errcode$4=errCode$m,{concat:uint8ArrayConcat$2}=require$$2$2,{fromString:uint8ArrayFromString$3}=require$$3$1,hmac=indexBrowser,cipherMap={"AES-128":{ivSize:16,keySize:16},"AES-256":{ivSize:16,keySize:32},Blowfish:{ivSize:8,cipherKeySize:32}};var keyStretcher=async(e,t,r)=>{const n=cipherMap[e];if(!n){const t=Object.keys(cipherMap).join(" / ");throw errcode$4(new Error(`unknown cipher type '${e}'. Must be ${t}`),"ERR_INVALID_CIPHER_TYPE")}if(!t)throw errcode$4(new Error("missing hash type"),"ERR_MISSING_HASH_TYPE");const i=n.keySize,s=n.ivSize,o=uint8ArrayFromString$3("key expansion"),a=2*(s+i+20),u=await hmac.create(t,r);let c=await u.digest(o);const l=[];let h=0;for(;h<a;){const e=await u.digest(uint8ArrayConcat$2([c,o]));let t=e.length;h+t>a&&(t=a-h),l.push(e),h+=t,c=await u.digest(c)}const d=a/2,f=uint8ArrayConcat$2(l),p=f.slice(0,d),y=f.slice(d,a),g=e=>({iv:e.slice(0,s),cipherKey:e.slice(s,s+i),macKey:e.slice(s+i)});return{k1:g(p),k2:g(y)}},ecdhBrowser={};const errcode$3=errCode$m;var validateCurveType$1=function(e,t){if(!e.includes(t)){const r=e.join(" / ");throw errcode$3(new Error(`Unknown curve: ${t}. Must be ${r}`),"ERR_INVALID_CURVE")}};const errcode$2=errCode$m,webcrypto=webcrypto$4,{base64urlToBuffer:base64urlToBuffer}=util,validateCurveType=validateCurveType$1,{toString:uint8ArrayToString$1}=require$$1$5,{concat:uint8ArrayConcat$1}=require$$2$2,{equals:uint8ArrayEquals}=require$$10$1,bits={"P-256":256,"P-384":384,"P-521":521};ecdhBrowser.generateEphmeralKeyPair=async function(e){validateCurveType(Object.keys(bits),e);const t=await webcrypto.get().subtle.generateKey({name:"ECDH",namedCurve:e},!0,["deriveBits"]);return{key:marshalPublicKey$1(await webcrypto.get().subtle.exportKey("jwk",t.publicKey)),genSharedKey:async(r,n)=>{let i;i=n?await webcrypto.get().subtle.importKey("jwk",unmarshalPrivateKey$1(e,n),{name:"ECDH",namedCurve:e},!1,["deriveBits"]):t.privateKey;const s=[await webcrypto.get().subtle.importKey("jwk",unmarshalPublicKey$1(e,r),{name:"ECDH",namedCurve:e},!1,[]),i],o=await webcrypto.get().subtle.deriveBits({name:"ECDH",namedCurve:e,public:s[0]},s[1],bits[e]);return new Uint8Array(o,o.byteOffset,o.byteLength)}}};const curveLengths={"P-256":32,"P-384":48,"P-521":66};function marshalPublicKey$1(e){const t=curveLengths[e.crv];return uint8ArrayConcat$1([Uint8Array.from([4]),base64urlToBuffer(e.x,t),base64urlToBuffer(e.y,t)],1+2*t)}function unmarshalPublicKey$1(e,t){const r=curveLengths[e];if(uint8ArrayEquals(!t.slice(0,1),Uint8Array.from([4])))throw errcode$2(new Error("Cannot unmarshal public key - invalid key format"),"ERR_INVALID_KEY_FORMAT");return{kty:"EC",crv:e,x:uint8ArrayToString$1(t.slice(1,r+1),"base64url"),y:uint8ArrayToString$1(t.slice(1+r),"base64url"),ext:!0}}const unmarshalPrivateKey$1=(e,t)=>({...unmarshalPublicKey$1(e,t.public),d:uint8ArrayToString$1(t.private,"base64url")}),ecdh=ecdhBrowser;var ephemeralKeys=async e=>ecdh.generateEphmeralKeyPair(e);const keysPBM=keys$1,forge=forge$X,errcode$1=errCode$m,{fromString:uint8ArrayFromString$2}=require$$3$1,importer=importer$1,supportedKeys={rsa:rsaClass,ed25519:ed25519Class,secp256k1:secp256k1Class(keysPBM)},ErrMissingSecp256K1={message:"secp256k1 support requires libp2p-crypto-secp256k1 package",code:"ERR_MISSING_PACKAGE"};function typeToKey(e){const t=supportedKeys[e.toLowerCase()];if(!t){const t=Object.keys(supportedKeys).join(" / ");throw errcode$1(new Error(`invalid or unsupported key type ${e}. Must be ${t}`),"ERR_UNSUPPORTED_KEY_TYPE")}return t}const generateKeyPair=async(e,t)=>typeToKey(e).generateKeyPair(t),generateKeyPairFromSeed=async(e,t,r)=>{const n=typeToKey(e);if("ed25519"!==e.toLowerCase())throw errcode$1(new Error("Seed key derivation is unimplemented for RSA or secp256k1"),"ERR_UNSUPPORTED_KEY_DERIVATION_TYPE");return n.generateKeyPairFromSeed(t,r)},unmarshalPublicKey=e=>{const t=keysPBM.PublicKey.decode(e),r=t.Data;switch(t.Type){case keysPBM.KeyType.RSA:return supportedKeys.rsa.unmarshalRsaPublicKey(r);case keysPBM.KeyType.Ed25519:return supportedKeys.ed25519.unmarshalEd25519PublicKey(r);case keysPBM.KeyType.Secp256k1:if(supportedKeys.secp256k1)return supportedKeys.secp256k1.unmarshalSecp256k1PublicKey(r);throw errcode$1(new Error(ErrMissingSecp256K1.message),ErrMissingSecp256K1.code);default:typeToKey(t.Type)}},marshalPublicKey=(e,t)=>(typeToKey(t=(t||"rsa").toLowerCase()),e.bytes),unmarshalPrivateKey=async e=>{const t=keysPBM.PrivateKey.decode(e),r=t.Data;switch(t.Type){case keysPBM.KeyType.RSA:return supportedKeys.rsa.unmarshalRsaPrivateKey(r);case keysPBM.KeyType.Ed25519:return supportedKeys.ed25519.unmarshalEd25519PrivateKey(r);case keysPBM.KeyType.Secp256k1:if(supportedKeys.secp256k1)return supportedKeys.secp256k1.unmarshalSecp256k1PrivateKey(r);throw errcode$1(new Error(ErrMissingSecp256K1.message),ErrMissingSecp256K1.code);default:typeToKey(t.Type)}},marshalPrivateKey=(e,t)=>(typeToKey(t=(t||"rsa").toLowerCase()),e.bytes),importKey=async(e,t)=>{try{const r=await importer.import(e,t);return unmarshalPrivateKey(r)}catch(e){}const r=forge.pki.decryptRsaPrivateKey(e,t);if(null===r)throw errcode$1(new Error("Cannot read the key, most likely the password is wrong or not a RSA key"),"ERR_CANNOT_DECRYPT_PEM");let n=forge.asn1.toDer(forge.pki.privateKeyToAsn1(r));return n=uint8ArrayFromString$2(n.getBytes(),"ascii"),supportedKeys.rsa.unmarshalRsaPrivateKey(n)};var keys={supportedKeys:supportedKeys,keysPBM:keysPBM,keyStretcher:keyStretcher,generateEphemeralKeyPair:ephemeralKeys,generateKeyPair:generateKeyPair,generateKeyPairFromSeed:generateKeyPairFromSeed,unmarshalPublicKey:unmarshalPublicKey,marshalPublicKey:marshalPublicKey,unmarshalPrivateKey:unmarshalPrivateKey,marshalPrivateKey:marshalPrivateKey,import:importKey},$protobuf$1=minimal,$Reader$1=$protobuf$1.Reader,$Writer$1=$protobuf$1.Writer,$util$1=$protobuf$1.util,$root$1=$protobuf$1.roots["libp2p-peer-id"]||($protobuf$1.roots["libp2p-peer-id"]={});$root$1.PeerIdProto=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.id=$util$1.newBuffer([]),e.prototype.pubKey=$util$1.newBuffer([]),e.prototype.privKey=$util$1.newBuffer([]),e.encode=function(e,t){return t||(t=$Writer$1.create()),t.uint32(10).bytes(e.id),null!=e.pubKey&&Object.hasOwnProperty.call(e,"pubKey")&&t.uint32(18).bytes(e.pubKey),null!=e.privKey&&Object.hasOwnProperty.call(e,"privKey")&&t.uint32(26).bytes(e.privKey),t},e.decode=function(e,t){e instanceof $Reader$1||(e=$Reader$1.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root$1.PeerIdProto;e.pos<r;){var i=e.uint32();switch(i>>>3){case 1:n.id=e.bytes();break;case 2:n.pubKey=e.bytes();break;case 3:n.privKey=e.bytes();break;default:e.skipType(7&i)}}if(!n.hasOwnProperty("id"))throw $util$1.ProtocolError("missing required 'id'",{instance:n});return n},e.fromObject=function(e){if(e instanceof $root$1.PeerIdProto)return e;var t=new $root$1.PeerIdProto;return null!=e.id&&("string"==typeof e.id?$util$1.base64.decode(e.id,t.id=$util$1.newBuffer($util$1.base64.length(e.id)),0):e.id.length&&(t.id=e.id)),null!=e.pubKey&&("string"==typeof e.pubKey?$util$1.base64.decode(e.pubKey,t.pubKey=$util$1.newBuffer($util$1.base64.length(e.pubKey)),0):e.pubKey.length&&(t.pubKey=e.pubKey)),null!=e.privKey&&("string"==typeof e.privKey?$util$1.base64.decode(e.privKey,t.privKey=$util$1.newBuffer($util$1.base64.length(e.privKey)),0):e.privKey.length&&(t.privKey=e.privKey)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(t.bytes===String?r.id="":(r.id=[],t.bytes!==Array&&(r.id=$util$1.newBuffer(r.id))),t.bytes===String?r.pubKey="":(r.pubKey=[],t.bytes!==Array&&(r.pubKey=$util$1.newBuffer(r.pubKey))),t.bytes===String?r.privKey="":(r.privKey=[],t.bytes!==Array&&(r.privKey=$util$1.newBuffer(r.privKey)))),null!=e.id&&e.hasOwnProperty("id")&&(r.id=t.bytes===String?$util$1.base64.encode(e.id,0,e.id.length):t.bytes===Array?Array.prototype.slice.call(e.id):e.id),null!=e.pubKey&&e.hasOwnProperty("pubKey")&&(r.pubKey=t.bytes===String?$util$1.base64.encode(e.pubKey,0,e.pubKey.length):t.bytes===Array?Array.prototype.slice.call(e.pubKey):e.pubKey),null!=e.privKey&&e.hasOwnProperty("privKey")&&(r.privKey=t.bytes===String?$util$1.base64.encode(e.privKey,0,e.privKey.length):t.bytes===Array?Array.prototype.slice.call(e.privKey):e.privKey),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf$1.util.toJSONOptions)},e}();var proto=$root$1;!function(e,t){const{CID:r}=require$$0$a,n=require$$1$8,i=require$$2$3,s=require$$3$2,o=require$$4$5,{base58btc:a}=require$$3$2,{base32:u}=require$$1$8,{base16:c}=require$$5$1,l=require$$6$1,h=keys,d=classIs.exports,{PeerIdProto:f}=proto,{equals:p}=require$$10$1,{fromString:y}=require$$3$1,{toString:g}=require$$1$5,{identity:$}=require$$13,m={...n,...i,...s,...o},b=Object.keys(m).reduce(((e,t)=>e.or(m[t])),u.decoder);const v=d(class{constructor(e,t,r){if(!(e instanceof Uint8Array))throw new Error("invalid id provided");if(t&&r&&!p(t.public.bytes,r.bytes))throw new Error("inconsistent arguments");this._id=e,this._idB58String=a.encode(this.id).substring(1),this._privKey=t,this._pubKey=r}get id(){return this._id}set id(e){throw new Error("Id is immutable")}get privKey(){return this._privKey}set privKey(e){this._privKey=e}get pubKey(){if(this._pubKey)return this._pubKey;if(this._privKey)return this._privKey.public;try{const e=l.decode(this.id);e.code===$.code&&(this._pubKey=h.unmarshalPublicKey(e.digest))}catch(e){}return this._pubKey}set pubKey(e){this._pubKey=e}marshalPubKey(){if(this.pubKey)return h.marshalPublicKey(this.pubKey)}marshalPrivKey(){if(this.privKey)return h.marshalPrivateKey(this.privKey)}marshal(e){return f.encode({id:this.toBytes(),pubKey:this.marshalPubKey(),privKey:e?null:this.marshalPrivKey()}).finish()}toPrint(){let e=this.toB58String();e.startsWith("Qm")&&(e=e.slice(2));let t=6;return e.length<t&&(t=e.length),"<peer.ID "+e.substr(0,t)+">"}toJSON(){return{id:this.toB58String(),privKey:S(this.marshalPrivKey()),pubKey:S(this.marshalPubKey())}}toHexString(){return c.encode(this.id).substring(1)}toBytes(){return this.id}toB58String(){return this._idB58String}toString(){if(!this._idCIDString){const e=r.createV1(114,l.decode(this.id));Object.defineProperty(this,"_idCIDString",{value:e.toString(),enumerable:!1})}return this._idCIDString}equals(e){if(e instanceof Uint8Array)return p(this.id,e);if(e.id)return p(this.id,e.id);throw new Error("not valid Id")}isEqual(e){return this.equals(e)}isValid(){return Boolean(this.privKey&&this.privKey.public&&this.privKey.public.bytes&&this.pubKey.bytes instanceof Uint8Array&&p(this.privKey.public.bytes,this.pubKey.bytes))}hasInlinePublicKey(){try{if(l.decode(this.id).code===$.code)return!0}catch(e){}return!1}},{className:"PeerId",symbolName:"@libp2p/js-peer-id/PeerId"});t=e.exports=v;const _=e=>e.bytes.length<=42?l.create($.code,e.bytes).bytes:e.hash(),w=async(e,t)=>{const r=await _(t);return new v(r,e,t)};t.create=async e=>{(e=e||{}).bits=e.bits||2048,e.keyType=e.keyType||"RSA";const t=await h.generateKeyPair(e.keyType,e.bits);return w(t,t.public)},t.createFromHexString=e=>new v(c.decode("f"+e)),t.createFromBytes=e=>{try{const n=r.decode(e);if(!E(n))throw new Error("Supplied PeerID CID is invalid");return t.createFromCID(n)}catch{if(l.decode(e).code!==$.code)throw new Error("Supplied PeerID CID is invalid");return new v(e)}},t.createFromB58String=e=>t.createFromBytes(a.decode("z"+e));const E=e=>114===e.code||112===e.code;function S(e){if(e)return g(e,"base64pad")}t.createFromCID=e=>{if(!(e=r.asCID(e))||!E(e))throw new Error("Supplied PeerID CID is invalid");return new v(e.multihash.bytes)},t.createFromPubKey=async e=>{let t=e;if("string"==typeof t&&(t=y(e,"base64pad")),!(t instanceof Uint8Array))throw new Error("Supplied key is neither a base64 string nor a Uint8Array");const r=await h.unmarshalPublicKey(t);return w(void 0,r)},t.createFromPrivKey=async e=>{if("string"==typeof e&&(e=y(e,"base64pad")),!(e instanceof Uint8Array))throw new Error("Supplied key is neither a base64 string nor a Uint8Array");const t=await h.unmarshalPrivateKey(e);return w(t,t.public)},t.createFromJSON=async e=>{const t=a.decode("z"+e.id),r=e.privKey&&y(e.privKey,"base64pad"),n=e.pubKey&&y(e.pubKey,"base64pad"),i=n&&await h.unmarshalPublicKey(n);if(!r)return new v(t,void 0,i);const s=await h.unmarshalPrivateKey(r),o=await _(s.public);let u;if(i&&(u=await _(i)),i&&!p(o,u))throw new Error("Public and private key do not match");if(t&&!p(o,t))throw new Error("Id and private key do not match");return new v(t,s,i)},t.createFromProtobuf=async e=>{"string"==typeof e&&(e=y(e,"base16"));let t,r,{id:n,privKey:i,pubKey:s}=f.decode(e);if(i=!!i&&await h.unmarshalPrivateKey(i),s=!!s&&await h.unmarshalPublicKey(s),i&&(r=await _(i.public)),s&&(t=await _(s)),i){if(s&&!p(r,t))throw new Error("Public and private key do not match");return new v(r,i,i.public)}if(s)return new v(t,void 0,s);if(n)return new v(n);throw new Error("Protobuf did not contain any usable key material")},t.parse=e=>("1"!==e.charAt(0)&&"Q"!==e.charAt(0)||(e=`z${e}`),t.createFromBytes(b.decode(e))),t.isPeerId=e=>Boolean("object"==typeof e&&e._id&&e._idB58String)}(src$2,src$2.exports),function(e,t){const r=src$2.exports,{Multiaddr:n}=src$o,i=src$j,{EventEmitter:s}=require$$1$9,o=require$$0$b,a=Object.assign(o("libp2p:bootstrap"),{error:o("libp2p:bootstrap:error")});(e.exports=class extends s{constructor(e={list:[]}){if(!e.list||!e.list.length)throw new Error("Bootstrap requires a list of peer addresses");super(),this._list=e.list,this._interval=e.interval||1e4,this._timer=null}start(){this._timer||(this._timer=setInterval((()=>this._discoverBootstrapPeers()),this._interval),a("Starting bootstrap node discovery"),this._discoverBootstrapPeers())}_discoverBootstrapPeers(){this._timer&&this._list.forEach((e=>{if(!i.P2P.matches(e))return a.error("Invalid multiaddr");const t=new n(e),s=t.getPeerId();if(!s)return void a.error("Invalid bootstrap multiaddr without peer id");const o=r.createFromB58String(s);try{this.emit("peer",{id:o,multiaddrs:[t]})}catch(e){a.error("Invalid bootstrap peer id",e)}}))}stop(){this._timer&&clearInterval(this._timer),this._timer=null}}).tag="bootstrap"}(src$3,src$3.exports);var Bootstrap=src$3.exports,src$1={exports:{}},src={exports:{}},FUNC_ERROR_TEXT="Expected a function",NAN=NaN,symbolTag="[object Symbol]",reTrim=/^\s+|\s+$/g,reIsBadHex=/^[-+]0x[0-9a-f]+$/i,reIsBinary=/^0b[01]+$/i,reIsOctal=/^0o[0-7]+$/i,freeParseInt=parseInt,freeGlobal="object"==typeof global$1&&global$1&&global$1.Object===Object&&global$1,freeSelf="object"==typeof self&&self&&self.Object===Object&&self,root=freeGlobal||freeSelf||Function("return this")(),objectProto=Object.prototype,objectToString=objectProto.toString,nativeMax=Math.max,nativeMin=Math.min,now=function(){return root.Date.now()};function debounce(e,t,r){var n,i,s,o,a,u,c=0,l=!1,h=!1,d=!0;if("function"!=typeof e)throw new TypeError(FUNC_ERROR_TEXT);function f(t){var r=n,s=i;return n=i=void 0,c=t,o=e.apply(s,r)}function p(e){return c=e,a=setTimeout(g,t),l?f(e):o}function y(e){var r=e-u;return void 0===u||r>=t||r<0||h&&e-c>=s}function g(){var e=now();if(y(e))return $(e);a=setTimeout(g,function(e){var r=t-(e-u);return h?nativeMin(r,s-(e-c)):r}(e))}function $(e){return a=void 0,d&&n?f(e):(n=i=void 0,o)}function m(){var e=now(),r=y(e);if(n=arguments,i=this,u=e,r){if(void 0===a)return p(u);if(h)return a=setTimeout(g,t),f(u)}return void 0===a&&(a=setTimeout(g,t)),o}return t=toNumber(t)||0,isObject(r)&&(l=!!r.leading,s=(h="maxWait"in r)?nativeMax(toNumber(r.maxWait)||0,t):s,d="trailing"in r?!!r.trailing:d),m.cancel=function(){void 0!==a&&clearTimeout(a),c=0,n=u=i=a=void 0},m.flush=function(){return void 0===a?o:$(now())},m}function throttle(e,t,r){var n=!0,i=!0;if("function"!=typeof e)throw new TypeError(FUNC_ERROR_TEXT);return isObject(r)&&(n="leading"in r?!!r.leading:n,i="trailing"in r?!!r.trailing:i),debounce(e,t,{leading:n,maxWait:t,trailing:i})}function isObject(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function isObjectLike(e){return!!e&&"object"==typeof e}function isSymbol(e){return"symbol"==typeof e||isObjectLike(e)&&objectToString.call(e)==symbolTag}function toNumber(e){if("number"==typeof e)return e;if(isSymbol(e))return NAN;if(isObject(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=isObject(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(reTrim,"");var r=reIsBinary.test(e);return r||reIsOctal.test(e)?freeParseInt(e.slice(2),r?2:8):reIsBadHex.test(e)?NAN:+e}module.exports=throttle;var lodash_throttle=Object.freeze({__proto__:null}),require$$0=getAugmentedNamespace(lodash_throttle);!function(e,t){const r=require$$0;src.exports=function e(t){if(!(this instanceof e))return new e(t);const n=(t=t||{}).validity||30,i=new Map,s=r((()=>{i.forEach(((e,t)=>{const r=e.validity||n;(function(e){const t=(new Date).getTime()-e.getTime();return Math.floor(t/1e3)})(e.timestamp)>r&&i.delete(t)}))}),200);this.put=(e,t,r)=>{this.has(e)||i.set(e,{value:t,timestamp:new Date,validity:r}),s()},this.get=e=>{if(i.has(e))return i.get(e).value;throw new Error("key does not exist")},this.has=e=>i.has(e)}}();var dist={},eventemitter3={exports:{}};!function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}function i(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function s(e,t,n,s,o){if("function"!=typeof n)throw new TypeError("The listener must be a function");var a=new i(n,s||e,o),u=r?r+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],a]:e._events[u].push(a):(e._events[u]=a,e._eventsCount++),e}function o(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function a(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),a.prototype.eventNames=function(){var e,n,i=[];if(0===this._eventsCount)return i;for(n in e=this._events)t.call(e,n)&&i.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},a.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,s=n.length,o=new Array(s);i<s;i++)o[i]=n[i].fn;return o},a.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},a.prototype.emit=function(e,t,n,i,s,o){var a=r?r+e:e;if(!this._events[a])return!1;var u,c,l=this._events[a],h=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),h){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,n),!0;case 4:return l.fn.call(l.context,t,n,i),!0;case 5:return l.fn.call(l.context,t,n,i,s),!0;case 6:return l.fn.call(l.context,t,n,i,s,o),!0}for(c=1,u=new Array(h-1);c<h;c++)u[c-1]=arguments[c];l.fn.apply(l.context,u)}else{var d,f=l.length;for(c=0;c<f;c++)switch(l[c].once&&this.removeListener(e,l[c].fn,void 0,!0),h){case 1:l[c].fn.call(l[c].context);break;case 2:l[c].fn.call(l[c].context,t);break;case 3:l[c].fn.call(l[c].context,t,n);break;case 4:l[c].fn.call(l[c].context,t,n,i);break;default:if(!u)for(d=1,u=new Array(h-1);d<h;d++)u[d-1]=arguments[d];l[c].fn.apply(l[c].context,u)}}return!0},a.prototype.on=function(e,t,r){return s(this,e,t,r,!1)},a.prototype.once=function(e,t,r){return s(this,e,t,r,!0)},a.prototype.removeListener=function(e,t,n,i){var s=r?r+e:e;if(!this._events[s])return this;if(!t)return o(this,s),this;var a=this._events[s];if(a.fn)a.fn!==t||i&&!a.once||n&&a.context!==n||o(this,s);else{for(var u=0,c=[],l=a.length;u<l;u++)(a[u].fn!==t||i&&!a[u].once||n&&a[u].context!==n)&&c.push(a[u]);c.length?this._events[s]=1===c.length?c[0]:c:o(this,s)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&o(this,t)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=r,a.EventEmitter=a,e.exports=a}(eventemitter3);var pTimeout$1={exports:{}},pFinally$1=(e,t)=>(t=t||(()=>{}),e.then((e=>new Promise((e=>{e(t())})).then((()=>e))),(e=>new Promise((e=>{e(t())})).then((()=>{throw e})))));const pFinally=pFinally$1;class TimeoutError extends Error{constructor(e){super(e),this.name="TimeoutError"}}const pTimeout=(e,t,r)=>new Promise(((n,i)=>{if("number"!=typeof t||t<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(t===1/0)return void n(e);const s=setTimeout((()=>{if("function"==typeof r){try{n(r())}catch(e){i(e)}return}const s=r instanceof Error?r:new TimeoutError("string"==typeof r?r:`Promise timed out after ${t} milliseconds`);"function"==typeof e.cancel&&e.cancel(),i(s)}),t);pFinally(e.then(n,i),(()=>{clearTimeout(s)}))}));pTimeout$1.exports=pTimeout,pTimeout$1.exports.default=pTimeout,pTimeout$1.exports.TimeoutError=TimeoutError;var priorityQueue={},lowerBound$1={};function lowerBound(e,t,r){let n=0,i=e.length;for(;i>0;){const s=i/2|0;let o=n+s;r(e[o],t)<=0?(n=++o,i-=s+1):i=s}return n}Object.defineProperty(lowerBound$1,"__esModule",{value:!0}),lowerBound$1.default=lowerBound,Object.defineProperty(priorityQueue,"__esModule",{value:!0});const lower_bound_1=lowerBound$1;class PriorityQueue{constructor(){this._queue=[]}enqueue(e,t){const r={priority:(t=Object.assign({priority:0},t)).priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority)return void this._queue.push(r);const n=lower_bound_1.default(this._queue,r,((e,t)=>t.priority-e.priority));this._queue.splice(n,0,r)}dequeue(){const e=this._queue.shift();return null==e?void 0:e.run}filter(e){return this._queue.filter((t=>t.priority===e.priority)).map((e=>e.run))}get size(){return this._queue.length}}priorityQueue.default=PriorityQueue,Object.defineProperty(dist,"__esModule",{value:!0});const EventEmitter$2=eventemitter3.exports,p_timeout_1=pTimeout$1.exports,priority_queue_1=priorityQueue,empty=()=>{},timeoutError=new p_timeout_1.TimeoutError;class PQueue extends EventEmitter$2{constructor(e){var t,r,n,i;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=empty,this._resolveIdle=empty,!("number"==typeof(e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:priority_queue_1.default},e)).intervalCap&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${null!==(r=null===(t=e.intervalCap)||void 0===t?void 0:t.toString())&&void 0!==r?r:""}\` (${typeof e.intervalCap})`);if(void 0===e.interval||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${null!==(i=null===(n=e.interval)||void 0===n?void 0:n.toString())&&void 0!==i?i:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||0===e.interval,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=!0===e.throwOnTimeout,this._isPaused=!1===e.autoStart}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=empty,0===this._pendingCount&&(this._resolveIdle(),this._resolveIdle=empty,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const e=Date.now();if(void 0===this._intervalId){const t=this._intervalEnd-e;if(!(t<0))return void 0===this._timeoutId&&(this._timeoutId=setTimeout((()=>{this._onResumeInterval()}),t)),!0;this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0}return!1}_tryToStartAnother(){if(0===this._queue.size)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const t=this._queue.dequeue();return!!t&&(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0)}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||void 0!==this._intervalId||(this._intervalId=setInterval((()=>{this._onInterval()}),this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){0===this._intervalCount&&0===this._pendingCount&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!("number"==typeof e&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise(((r,n)=>{this._queue.enqueue((async()=>{this._pendingCount++,this._intervalCount++;try{const i=void 0===this._timeout&&void 0===t.timeout?e():p_timeout_1.default(Promise.resolve(e()),void 0===t.timeout?this._timeout:t.timeout,(()=>{(void 0===t.throwOnTimeout?this._throwOnTimeout:t.throwOnTimeout)&&n(timeoutError)}));r(await i)}catch(e){n(e)}this._next()}),t),this._tryToStartAnother(),this.emit("add")}))}async addAll(e,t){return Promise.all(e.map((async e=>this.add(e,t))))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(0!==this._queue.size)return new Promise((e=>{const t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}}))}async onIdle(){if(0!==this._pendingCount||0!==this._queue.size)return new Promise((e=>{const t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}}))}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}}dist.default=PQueue;const Topology=topology,multicodecTopologySymbol=Symbol.for("@libp2p/js-interfaces/topology/multicodec-topology");class MulticodecTopology$1 extends Topology{constructor({min:e,max:t,multicodecs:r,handlers:n}){if(super({min:e,max:t,handlers:n}),!r)throw new Error("one or more multicodec should be provided");if(!n)throw new Error("the handlers should be provided");if("function"!=typeof n.onConnect)throw new Error("the 'onConnect' handler must be provided");if("function"!=typeof n.onDisconnect)throw new Error("the 'onDisconnect' handler must be provided");this.multicodecs=Array.isArray(r)?r:[r],this._registrar=void 0,this._onProtocolChange=this._onProtocolChange.bind(this),this._onPeerConnect=this._onPeerConnect.bind(this)}get[Symbol.toStringTag](){return"Topology"}get[multicodecTopologySymbol](){return!0}static isMulticodecTopology(e){return Boolean(e&&e[multicodecTopologySymbol])}set registrar(e){this._registrar=e,this._registrar.peerStore.on("change:protocols",this._onProtocolChange),this._registrar.connectionManager.on("peer:connect",this._onPeerConnect),this._updatePeers(this._registrar.peerStore.peers.values())}_updatePeers(e){for(const{id:t,protocols:r}of e)if(this.multicodecs.filter((e=>r.includes(e))).length){this.peers.add(t.toB58String());const e=this._registrar.getConnection(t);e&&this._onConnect(t,e)}else this.peers.delete(t.toB58String())}_onProtocolChange({peerId:e,protocols:t}){const r=this.peers.has(e.toB58String()),n=t.filter((e=>this.multicodecs.includes(e)));r&&0===n.length&&this._onDisconnect(e);for(const r of t)if(this.multicodecs.includes(r)){const t=this._registrar.peerStore.get(e);return void this._updatePeers([t])}}_onPeerConnect(e){const t=e.remotePeer,r=this._registrar.peerStore.protoBook.get(t);r&&this.multicodecs.find((e=>r.includes(e)))&&(this.peers.add(t.toB58String()),this._onConnect(t,e))}}var multicodecTopology=MulticodecTopology$1,errors={codes:{ERR_INVALID_SIGNATURE_POLICY:"ERR_INVALID_SIGNATURE_POLICY",ERR_UNHANDLED_SIGNATURE_POLICY:"ERR_UNHANDLED_SIGNATURE_POLICY",ERR_MISSING_SIGNATURE:"ERR_MISSING_SIGNATURE",ERR_MISSING_SEQNO:"ERR_MISSING_SEQNO",ERR_INVALID_SIGNATURE:"ERR_INVALID_SIGNATURE",ERR_UNEXPECTED_FROM:"ERR_UNEXPECTED_FROM",ERR_UNEXPECTED_SIGNATURE:"ERR_UNEXPECTED_SIGNATURE",ERR_UNEXPECTED_KEY:"ERR_UNEXPECTED_KEY",ERR_UNEXPECTED_SEQNO:"ERR_UNEXPECTED_SEQNO"}},$protobuf=minimal,$Reader=$protobuf.Reader,$Writer=$protobuf.Writer,$util=$protobuf.util,$root=$protobuf.roots["libp2p-pubsub-rpc"]||($protobuf.roots["libp2p-pubsub-rpc"]={});$root.RPC=function(){function e(e){if(this.subscriptions=[],this.msgs=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.subscriptions=$util.emptyArray,e.prototype.msgs=$util.emptyArray,e.encode=function(e,t){if(t||(t=$Writer.create()),null!=e.subscriptions&&e.subscriptions.length)for(var r=0;r<e.subscriptions.length;++r)$root.RPC.SubOpts.encode(e.subscriptions[r],t.uint32(10).fork()).ldelim();if(null!=e.msgs&&e.msgs.length)for(r=0;r<e.msgs.length;++r)$root.RPC.Message.encode(e.msgs[r],t.uint32(18).fork()).ldelim();return t},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root.RPC;e.pos<r;){var i=e.uint32();switch(i>>>3){case 1:n.subscriptions&&n.subscriptions.length||(n.subscriptions=[]),n.subscriptions.push($root.RPC.SubOpts.decode(e,e.uint32()));break;case 2:n.msgs&&n.msgs.length||(n.msgs=[]),n.msgs.push($root.RPC.Message.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return n},e.fromObject=function(e){if(e instanceof $root.RPC)return e;var t=new $root.RPC;if(e.subscriptions){if(!Array.isArray(e.subscriptions))throw TypeError(".RPC.subscriptions: array expected");t.subscriptions=[];for(var r=0;r<e.subscriptions.length;++r){if("object"!=typeof e.subscriptions[r])throw TypeError(".RPC.subscriptions: object expected");t.subscriptions[r]=$root.RPC.SubOpts.fromObject(e.subscriptions[r])}}if(e.msgs){if(!Array.isArray(e.msgs))throw TypeError(".RPC.msgs: array expected");t.msgs=[];for(r=0;r<e.msgs.length;++r){if("object"!=typeof e.msgs[r])throw TypeError(".RPC.msgs: object expected");t.msgs[r]=$root.RPC.Message.fromObject(e.msgs[r])}}return t},e.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.subscriptions=[],r.msgs=[]),e.subscriptions&&e.subscriptions.length){r.subscriptions=[];for(var n=0;n<e.subscriptions.length;++n)r.subscriptions[n]=$root.RPC.SubOpts.toObject(e.subscriptions[n],t)}if(e.msgs&&e.msgs.length){r.msgs=[];for(n=0;n<e.msgs.length;++n)r.msgs[n]=$root.RPC.Message.toObject(e.msgs[n],t)}return r},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e.SubOpts=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}var t;return e.prototype.subscribe=null,e.prototype.topicID=null,Object.defineProperty(e.prototype,"_subscribe",{get:$util.oneOfGetter(t=["subscribe"]),set:$util.oneOfSetter(t)}),Object.defineProperty(e.prototype,"_topicID",{get:$util.oneOfGetter(t=["topicID"]),set:$util.oneOfSetter(t)}),e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.subscribe&&Object.hasOwnProperty.call(e,"subscribe")&&t.uint32(8).bool(e.subscribe),null!=e.topicID&&Object.hasOwnProperty.call(e,"topicID")&&t.uint32(18).string(e.topicID),t},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root.RPC.SubOpts;e.pos<r;){var i=e.uint32();switch(i>>>3){case 1:n.subscribe=e.bool();break;case 2:n.topicID=e.string();break;default:e.skipType(7&i)}}return n},e.fromObject=function(e){if(e instanceof $root.RPC.SubOpts)return e;var t=new $root.RPC.SubOpts;return null!=e.subscribe&&(t.subscribe=Boolean(e.subscribe)),null!=e.topicID&&(t.topicID=String(e.topicID)),t},e.toObject=function(e,t){t||(t={});var r={};return null!=e.subscribe&&e.hasOwnProperty("subscribe")&&(r.subscribe=e.subscribe,t.oneofs&&(r._subscribe="subscribe")),null!=e.topicID&&e.hasOwnProperty("topicID")&&(r.topicID=e.topicID,t.oneofs&&(r._topicID="topicID")),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),e.Message=function(){function e(e){if(this.topicIDs=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}var t;return e.prototype.from=null,e.prototype.data=null,e.prototype.seqno=null,e.prototype.topicIDs=$util.emptyArray,e.prototype.signature=null,e.prototype.key=null,Object.defineProperty(e.prototype,"_from",{get:$util.oneOfGetter(t=["from"]),set:$util.oneOfSetter(t)}),Object.defineProperty(e.prototype,"_data",{get:$util.oneOfGetter(t=["data"]),set:$util.oneOfSetter(t)}),Object.defineProperty(e.prototype,"_seqno",{get:$util.oneOfGetter(t=["seqno"]),set:$util.oneOfSetter(t)}),Object.defineProperty(e.prototype,"_signature",{get:$util.oneOfGetter(t=["signature"]),set:$util.oneOfSetter(t)}),Object.defineProperty(e.prototype,"_key",{get:$util.oneOfGetter(t=["key"]),set:$util.oneOfSetter(t)}),e.encode=function(e,t){if(t||(t=$Writer.create()),null!=e.from&&Object.hasOwnProperty.call(e,"from")&&t.uint32(10).bytes(e.from),null!=e.data&&Object.hasOwnProperty.call(e,"data")&&t.uint32(18).bytes(e.data),null!=e.seqno&&Object.hasOwnProperty.call(e,"seqno")&&t.uint32(26).bytes(e.seqno),null!=e.topicIDs&&e.topicIDs.length)for(var r=0;r<e.topicIDs.length;++r)t.uint32(34).string(e.topicIDs[r]);return null!=e.signature&&Object.hasOwnProperty.call(e,"signature")&&t.uint32(42).bytes(e.signature),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(50).bytes(e.key),t},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new $root.RPC.Message;e.pos<r;){var i=e.uint32();switch(i>>>3){case 1:n.from=e.bytes();break;case 2:n.data=e.bytes();break;case 3:n.seqno=e.bytes();break;case 4:n.topicIDs&&n.topicIDs.length||(n.topicIDs=[]),n.topicIDs.push(e.string());break;case 5:n.signature=e.bytes();break;case 6:n.key=e.bytes();break;default:e.skipType(7&i)}}return n},e.fromObject=function(e){if(e instanceof $root.RPC.Message)return e;var t=new $root.RPC.Message;if(null!=e.from&&("string"==typeof e.from?$util.base64.decode(e.from,t.from=$util.newBuffer($util.base64.length(e.from)),0):e.from.length&&(t.from=e.from)),null!=e.data&&("string"==typeof e.data?$util.base64.decode(e.data,t.data=$util.newBuffer($util.base64.length(e.data)),0):e.data.length&&(t.data=e.data)),null!=e.seqno&&("string"==typeof e.seqno?$util.base64.decode(e.seqno,t.seqno=$util.newBuffer($util.base64.length(e.seqno)),0):e.seqno.length&&(t.seqno=e.seqno)),e.topicIDs){if(!Array.isArray(e.topicIDs))throw TypeError(".RPC.Message.topicIDs: array expected");t.topicIDs=[];for(var r=0;r<e.topicIDs.length;++r)t.topicIDs[r]=String(e.topicIDs[r])}return null!=e.signature&&("string"==typeof e.signature?$util.base64.decode(e.signature,t.signature=$util.newBuffer($util.base64.length(e.signature)),0):e.signature.length&&(t.signature=e.signature)),null!=e.key&&("string"==typeof e.key?$util.base64.decode(e.key,t.key=$util.newBuffer($util.base64.length(e.key)),0):e.key.length&&(t.key=e.key)),t},e.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.topicIDs=[]),null!=e.from&&e.hasOwnProperty("from")&&(r.from=t.bytes===String?$util.base64.encode(e.from,0,e.from.length):t.bytes===Array?Array.prototype.slice.call(e.from):e.from,t.oneofs&&(r._from="from")),null!=e.data&&e.hasOwnProperty("data")&&(r.data=t.bytes===String?$util.base64.encode(e.data,0,e.data.length):t.bytes===Array?Array.prototype.slice.call(e.data):e.data,t.oneofs&&(r._data="data")),null!=e.seqno&&e.hasOwnProperty("seqno")&&(r.seqno=t.bytes===String?$util.base64.encode(e.seqno,0,e.seqno.length):t.bytes===Array?Array.prototype.slice.call(e.seqno):e.seqno,t.oneofs&&(r._seqno="seqno")),e.topicIDs&&e.topicIDs.length){r.topicIDs=[];for(var n=0;n<e.topicIDs.length;++n)r.topicIDs[n]=e.topicIDs[n]}return null!=e.signature&&e.hasOwnProperty("signature")&&(r.signature=t.bytes===String?$util.base64.encode(e.signature,0,e.signature.length):t.bytes===Array?Array.prototype.slice.call(e.signature):e.signature,t.oneofs&&(r._signature="signature")),null!=e.key&&e.hasOwnProperty("key")&&(r.key=t.bytes===String?$util.base64.encode(e.key,0,e.key.length):t.bytes===Array?Array.prototype.slice.call(e.key):e.key,t.oneofs&&(r._key="key")),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},e}(),e}();var rpc=$root;const debug$2=require$$0$b,log$1=Object.assign(debug$2("libp2p-pubsub:peer-streams"),{error:debug$2("libp2p-pubsub:peer-streams:err")}),{EventEmitter:EventEmitter$1}=require$$1$9,lp=src$i,pushable=itPushable,{pipe:pipe$1}=itPipe.exports,{source:abortable}=abortableIterator.exports,AbortController=browser$7.exports.default;class PeerStreams$1 extends EventEmitter$1{constructor({id:e,protocol:t}){super(),this.id=e,this.protocol=t,this._rawOutboundStream=null,this._rawInboundStream=null,this._inboundAbortController=new AbortController,this.outboundStream=null,this.inboundStream=null}get isReadable(){return Boolean(this.inboundStream)}get isWritable(){return Boolean(this.outboundStream)}write(e){if(!this.outboundStream){const e=this.id.toB58String();throw new Error("No writable connection to "+e)}this.outboundStream.push(e)}attachInboundStream(e){return this._rawInboundStream=e,this.inboundStream=abortable(pipe$1(this._rawInboundStream,lp.decode()),this._inboundAbortController.signal,{returnOnAbort:!0}),this.emit("stream:inbound"),this.inboundStream}async attachOutboundStream(e){const t=this.outboundStream;this.outboundStream&&await this.outboundStream.end(),this._rawOutboundStream=e,this.outboundStream=pushable({onEnd:e=>{this._rawOutboundStream&&this._rawOutboundStream.reset&&this._rawOutboundStream.reset(),this._rawOutboundStream=null,this.outboundStream=null,e&&this.emit("close")}}),pipe$1(this.outboundStream,lp.encode(),this._rawOutboundStream).catch((e=>{log$1.error(e)})),t||this.emit("stream:outbound")}close(){this.outboundStream&&this.outboundStream.end(),this.inboundStream&&this._inboundAbortController.abort(),this._rawOutboundStream=null,this.outboundStream=null,this._rawInboundStream=null,this.inboundStream=null,this.emit("close")}}var peerStreams=PeerStreams$1,signaturePolicy={};const SignaturePolicy$1={StrictSign:"StrictSign",StrictNoSign:"StrictNoSign"};signaturePolicy.SignaturePolicy=SignaturePolicy$1;const randomBytes=randomBytes_1$4,{toString:uint8ArrayToString}=require$$1$5,{fromString:uint8ArrayFromString$1}=require$$3$1,PeerId$1=src$e.exports,{sha256:sha256}=require$$4$3,randomSeqno=()=>randomBytes(8),msgId=(e,t)=>{let r;r=e instanceof Uint8Array?PeerId$1.createFromBytes(e).id:PeerId$1.parse(e).id;const n=new Uint8Array(r.length+t.length);return n.set(r,0),n.set(t,r.length),n},noSignMsgId=e=>sha256.encode(e),anyMatch=(e,t)=>{let r;r=Array.isArray(t)?e=>t.indexOf(e)>-1:e=>t.has(e);for(const t of e)if(r(t))return!0;return!1},ensureArray=e=>Array.isArray(e)?e:[e],normalizeInRpcMessage=(e,t)=>{const r=Object.assign({},e);return e.from instanceof Uint8Array&&(r.from=uint8ArrayToString(e.from,"base58btc")),t&&(r.receivedFrom=t),r},normalizeOutRpcMessage$1=e=>{const t=Object.assign({},e);return"string"==typeof e.from&&(t.from=uint8ArrayFromString$1(e.from,"base58btc")),"string"==typeof e.data&&(t.data=uint8ArrayFromString$1(e.data)),t};var utils$2={randomSeqno:randomSeqno,msgId:msgId,noSignMsgId:noSignMsgId,anyMatch:anyMatch,ensureArray:ensureArray,normalizeInRpcMessage:normalizeInRpcMessage,normalizeOutRpcMessage:normalizeOutRpcMessage$1};const PeerId=src$e.exports,{RPC:RPC$1}=rpc,{concat:uint8ArrayConcat}=require$$2$2,{fromString:uint8ArrayFromString}=require$$3$1,SignPrefix=uint8ArrayFromString("libp2p-pubsub:"),{normalizeOutRpcMessage:normalizeOutRpcMessage}=utils$2;async function signMessage$1(e,t){const r=uint8ArrayConcat([SignPrefix,RPC$1.Message.encode(normalizeOutRpcMessage(t)).finish()]),n=await e.privKey.sign(r);return{...t,signature:n,key:e.pubKey.bytes}}async function verifySignature$1(e){if(!e.signature)throw new Error("Message must contain a signature to be verified");if(!e.from)throw new Error("Message must contain a from property to be verified");const t=uint8ArrayConcat([SignPrefix,RPC$1.Message.encode({...e,from:PeerId.createFromB58String(e.from).toBytes(),signature:void 0,key:void 0}).finish()]);return(await messagePublicKey(e)).verify(t,e.signature)}async function messagePublicKey(e){if(!e.from)throw new Error("Could not get the public key from the originator id");const t=PeerId.createFromB58String(e.from);if(e.key){const r=await PeerId.createFromPubKey(e.key);if(r.equals(t))return r.pubKey;throw new Error("Public Key does not match the originator")}if(t.pubKey)return t.pubKey;throw new Error("Could not get the public key from the originator id")}var sign={messagePublicKey:messagePublicKey,signMessage:signMessage$1,SignPrefix:SignPrefix,verifySignature:verifySignature$1};const debug$1=require$$0$b,{EventEmitter:EventEmitter}=require$$1$9,errcode=errCode$m,{pipe:pipe}=itPipe.exports,{default:Queue}=dist,MulticodecTopology=multicodecTopology,{codes:codes}=errors,{RPC:RPC}=rpc,PeerStreams=peerStreams,{SignaturePolicy:SignaturePolicy}=signaturePolicy,utils$1=utils$2,{signMessage:signMessage,verifySignature:verifySignature}=sign;class PubsubBaseProtocol extends EventEmitter{constructor({debugName:e,multicodecs:t,libp2p:r,globalSignaturePolicy:n=SignaturePolicy.StrictSign,canRelayMessage:i=!1,emitSelf:s=!1,messageProcessingConcurrency:o=10}){if("string"!=typeof e)throw new Error("a debugname `string` is required");if(!t)throw new Error("multicodecs are required");if(!r)throw new Error("libp2p is required");if(super(),this.log=Object.assign(debug$1(e),{err:debug$1(`${e}:error`)}),this.multicodecs=utils$1.ensureArray(t),this._libp2p=r,this.registrar=r.registrar,this.peerId=r.peerId,this.started=!1,this.topics=new Map,this.subscriptions=new Set,this.peers=new Map,!SignaturePolicy[n])throw errcode(new Error("Invalid global signature policy"),codes.ERR_INVALID_SIGNATURE_POLICY);this.globalSignaturePolicy=n,this.canRelayMessage=i,this.emitSelf=s,this.topicValidators=new Map,this.queue=new Queue({concurrency:o}),this._registrarId=void 0,this._onIncomingStream=this._onIncomingStream.bind(this),this._onPeerConnected=this._onPeerConnected.bind(this),this._onPeerDisconnected=this._onPeerDisconnected.bind(this)}start(){if(this.started)return;this.log("starting"),this.registrar.handle(this.multicodecs,this._onIncomingStream);const e=new MulticodecTopology({multicodecs:this.multicodecs,handlers:{onConnect:this._onPeerConnected,onDisconnect:this._onPeerDisconnected}});this._registrarId=this.registrar.register(e),this.log("started"),this.started=!0}stop(){this.started&&(this.registrar.unregister(this._registrarId),this.log("stopping"),this.peers.forEach((e=>e.close())),this.peers=new Map,this.subscriptions=new Set,this.started=!1,this.log("stopped"))}_onIncomingStream({protocol:e,stream:t,connection:r}){const n=r.remotePeer,i=n.toB58String(),s=this._addPeer(n,e),o=s.attachInboundStream(t);this._processMessages(i,o,s)}async _onPeerConnected(e,t){const r=e.toB58String();this.log("connected",r);try{const{stream:r,protocol:n}=await t.newStream(this.multicodecs),i=this._addPeer(e,n);await i.attachOutboundStream(r)}catch(e){this.log.err(e)}this._sendSubscriptions(r,Array.from(this.subscriptions),!0)}_onPeerDisconnected(e,t){const r=e.toB58String();this.log("connection ended",r,t?t.message:""),this._removePeer(e)}_addPeer(e,t){const r=e.toB58String(),n=this.peers.get(r);if(n)return n;this.log("new peer",r);const i=new PeerStreams({id:e,protocol:t});return this.peers.set(r,i),i.once("close",(()=>this._removePeer(e))),i}_removePeer(e){if(!e)return;const t=e.toB58String(),r=this.peers.get(t);if(r){r.removeAllListeners(),r.close(),this.log("delete peer",t),this.peers.delete(t);for(const e of this.topics.values())e.delete(t);return r}}async _processMessages(e,t,r){try{await pipe(t,(async t=>{for await(const n of t){const t=n instanceof Uint8Array?n:n.slice(),i=this._decodeRpc(t);(async()=>{try{await this._processRpc(e,r,i)}catch(e){this.log.err(e)}})()}}))}catch(e){this._onPeerDisconnected(r.id,e)}}async _processRpc(e,t,r){this.log("rpc from",e);const n=r.subscriptions,i=r.msgs;return n.length&&(n.forEach((t=>{this._processRpcSubOpt(e,t)})),this.emit("pubsub:subscription-change",t.id,n)),this._acceptFrom(e)?(i.length&&this.queue.addAll(i.map((t=>async()=>{if(this.canRelayMessage||t.topicIDs&&t.topicIDs.some((e=>this.subscriptions.has(e))))try{const r=utils$1.normalizeInRpcMessage(t,e);await this._processRpcMessage(r)}catch(e){this.log.err(e)}else this.log("received message we didn't subscribe to. Dropping.")}))),!0):(this.log("received message from unacceptable peer %s",e),!1)}_processRpcSubOpt(e,t){const r=t.topicID;if(!r)return;let n=this.topics.get(r);n||(n=new Set,this.topics.set(r,n)),t.subscribe?n.add(e):n.delete(e)}async _processRpcMessage(e){if(this.peerId.toB58String()!==e.from||this.emitSelf){try{await this.validate(e)}catch(e){return void this.log("Message is invalid, dropping it. %O",e)}return this._emitMessage(e),this._publish(utils$1.normalizeOutRpcMessage(e))}}_emitMessage(e){e.topicIDs.forEach((t=>{this.subscriptions.has(t)&&this.emit(t,e)}))}getMsgId(e){const t=this.globalSignaturePolicy;switch(t){case SignaturePolicy.StrictSign:return utils$1.msgId(e.from,e.seqno);case SignaturePolicy.StrictNoSign:return utils$1.noSignMsgId(e.data);default:throw errcode(new Error("Cannot get message id: unhandled signature policy: "+t),codes.ERR_UNHANDLED_SIGNATURE_POLICY)}}_acceptFrom(e){return!0}_decodeRpc(e){return RPC.decode(e)}_encodeRpc(e){return RPC.encode(e).finish()}_sendRpc(e,t){const r=this.peers.get(e);if(r&&r.isWritable)r.write(this._encodeRpc(t));else{const t=`Cannot send RPC to ${e} as there is no open stream to it available`;this.log.err(t)}}_sendSubscriptions(e,t,r){return this._sendRpc(e,{subscriptions:t.map((e=>({topicID:e,subscribe:r})))})}async validate(e){const t=this.globalSignaturePolicy;switch(t){case SignaturePolicy.StrictNoSign:if(e.from)throw errcode(new Error("StrictNoSigning: from should not be present"),codes.ERR_UNEXPECTED_FROM);if(e.signature)throw errcode(new Error("StrictNoSigning: signature should not be present"),codes.ERR_UNEXPECTED_SIGNATURE);if(e.key)throw errcode(new Error("StrictNoSigning: key should not be present"),codes.ERR_UNEXPECTED_KEY);if(e.seqno)throw errcode(new Error("StrictNoSigning: seqno should not be present"),codes.ERR_UNEXPECTED_SEQNO);break;case SignaturePolicy.StrictSign:if(!e.signature)throw errcode(new Error("StrictSigning: Signing required and no signature was present"),codes.ERR_MISSING_SIGNATURE);if(!e.seqno)throw errcode(new Error("StrictSigning: Signing required and no seqno was present"),codes.ERR_MISSING_SEQNO);if(!await verifySignature(e))throw errcode(new Error("StrictSigning: Invalid message signature"),codes.ERR_INVALID_SIGNATURE);break;default:throw errcode(new Error("Cannot validate message: unhandled signature policy: "+t),codes.ERR_UNHANDLED_SIGNATURE_POLICY)}for(const t of e.topicIDs){const r=this.topicValidators.get(t);r&&await r(t,e)}}_buildMessage(e){const t=this.globalSignaturePolicy;switch(t){case SignaturePolicy.StrictSign:return e.from=this.peerId.toB58String(),e.seqno=utils$1.randomSeqno(),signMessage(this.peerId,e);case SignaturePolicy.StrictNoSign:return Promise.resolve(e);default:throw errcode(new Error("Cannot build message: unhandled signature policy: "+t),codes.ERR_UNHANDLED_SIGNATURE_POLICY)}}getSubscribers(e){if(!this.started)throw errcode(new Error("not started yet"),"ERR_NOT_STARTED_YET");if(!e||"string"!=typeof e)throw errcode(new Error("a string topic must be provided"),"ERR_NOT_VALID_TOPIC");const t=this.topics.get(e);return t?Array.from(t):[]}async publish(e,t){if(!this.started)throw new Error("Pubsub has not started");this.log("publish",e,t);const r={receivedFrom:this.peerId.toB58String(),data:t,topicIDs:[e]},n=await this._buildMessage(r),i=utils$1.normalizeInRpcMessage(n);this.emitSelf&&this._emitMessage(i),await this._publish(i)}_publish(e){throw errcode(new Error("publish must be implemented by the subclass"),"ERR_NOT_IMPLEMENTED")}subscribe(e){if(!this.started)throw new Error("Pubsub has not started");this.subscriptions.has(e)||(this.subscriptions.add(e),this.peers.forEach(((t,r)=>this._sendSubscriptions(r,[e],!0))))}unsubscribe(e){if(!this.started)throw new Error("Pubsub is not started");this.subscriptions.has(e)&&0===this.listenerCount(e)&&(this.subscriptions.delete(e),this.peers.forEach(((t,r)=>this._sendSubscriptions(r,[e],!1))))}getTopics(){if(!this.started)throw new Error("Pubsub is not started");return Array.from(this.subscriptions)}}PubsubBaseProtocol.utils=utils$1,PubsubBaseProtocol.SignaturePolicy=SignaturePolicy;var pubsub=PubsubBaseProtocol;const debug=require$$0$b,log=Object.assign(debug("libp2p:floodsub"),{error:debug("libp2p:floodsub:err")});var config={log:log,multicodec:"/floodsub/1.0.0"};const debugName="libp2p:floodsub",TimeCache=src.exports,{toString:toString}=require$$1$5,BaseProtocol=pubsub,{utils:utils}=pubsub,{multicodec:multicodec}=config;class FloodSub extends BaseProtocol{constructor(e,t={}){super({debugName:debugName,multicodecs:multicodec,libp2p:e,canRelayMessage:!0,...t}),this.seenCache=new TimeCache}async _processRpcMessage(e){const t=await this.getMsgId(e),r=toString(t,"base64");this.seenCache.has(r)||(this.seenCache.put(r),await super._processRpcMessage(e))}_publish(e){return this._forwardMessage(e),Promise.resolve()}_forwardMessage(e){e.topicIDs.forEach((t=>{const r=this.topics.get(t);r&&r.forEach((t=>{this.log("publish msgs on topics",e.topicIDs,t),t!==this.peerId.toB58String()&&t!==e.receivedFrom&&this._sendRpc(t,{msgs:[utils.normalizeOutRpcMessage(e)]})}))}))}}src$1.exports=FloodSub,src$1.exports.multicodec=multicodec;var FloodSub$1=src$1.exports;async function createLibp2p(){const e=await src$c.create({addresses:{listen:["/dns4/wrtc-star1.par.dwebops.pub/tcp/443/wss/p2p-webrtc-star","/dns4/wrtc-star2.sjc.dwebops.pub/tcp/443/wss/p2p-webrtc-star"]},modules:{transport:[src$b,src$9],connEncryption:[src$8.NOISE],streamMuxer:[src$4],pubsub:FloodSub$1,peerDiscovery:[Bootstrap]},config:{peerDiscovery:{[Bootstrap.tag]:{enabled:!0,list:["/dnsaddr/bootstrap.libp2p.io/p2p/QmNnooDu7bfjPFoTZYxMNLWUQJyrVwtbZg5gBMjTezGAJN","/dnsaddr/bootstrap.libp2p.io/p2p/QmbLHAnMoJPWSCR5Zhtx6BHJX9KiKNN6tpvbUcqanj75Nb","/dnsaddr/bootstrap.libp2p.io/p2p/QmZa1sAxajnQjVM8WjWXoMbmPd7NsWhfKsPkErzpm9wGkp","/dnsaddr/bootstrap.libp2p.io/p2p/QmQCU2EcMqAqQPR2i9bChDtGNJchTbq5TbXJJ16u19uLTa","/dnsaddr/bootstrap.libp2p.io/p2p/QmcZf59bWwK5XFi76CZX8cbJ4BhTzzA3gU1ZjYZcYW3dwt"]},pubsub:{enabled:!0,emitSelf:!1}}}});return await e.start(),e}export{createLibp2p};
//# sourceMappingURL=index.js.map
